/*! For license information please see bundle.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("GPEngine",[],e):"object"==typeof exports?exports.GPEngine=e():t.GPEngine=e()}(self,(()=>(()=>{var t={312:(t,e,n)=>{"use strict";n.d(e,{n:()=>i});class i{static memory(){return performance.memory}static jsHeapSizeLimit(){return performance.memory.jsHeapSizeLimit}static totalJSHeapSize(){return performance.memory.totalJSHeapSize}static usedJSHeapSize(){return performance.memory.usedJSHeapSize}}},521:(t,e,n)=>{"use strict";n.d(e,{u:()=>s});var i=n(477),r=n(542);t=n.hmd(t);const s={distributions:{BOX:1,SPHERE:2,DISC:3,LINE:4},valueOverLifetimeLength:4};var o,a;"function"==typeof define&&n.amdO?define("spe",s):"undefined"!=typeof exports&&(t.exports=s),s.TypedArrayHelper=function(t,e,n,i){this.componentSize=n||1,this.size=e||1,this.TypedArrayConstructor=t||Float32Array,this.array=new t(e*this.componentSize),this.indexOffset=i||0},s.TypedArrayHelper.constructor=s.TypedArrayHelper,s.TypedArrayHelper.prototype.setSize=function(t,e){var n=this.array.length;return e||(t*=this.componentSize),t<n?this.shrink(t):t>n?this.grow(t):void console.info("TypedArray is already of size:",t+".","Will not resize.")},s.TypedArrayHelper.prototype.shrink=function(t){return this.array=this.array.subarray(0,t),this.size=t,this},s.TypedArrayHelper.prototype.grow=function(t){var e=this.array,n=new this.TypedArrayConstructor(t);return n.set(e),this.array=n,this.size=t,this},s.TypedArrayHelper.prototype.splice=function(t,e){t*=this.componentSize,e*=this.componentSize;for(var n=[],i=this.array,r=i.length,s=0;s<r;++s)(s<t||s>=e)&&n.push(i[s]);return this.setFromArray(0,n),this},s.TypedArrayHelper.prototype.setFromArray=function(t,e){var n=t+e.length;return n>this.array.length?this.grow(n):n<this.array.length&&this.shrink(n),this.array.set(e,this.indexOffset+t),this},s.TypedArrayHelper.prototype.setVec2=function(t,e){return this.setVec2Components(t,e.x,e.y)},s.TypedArrayHelper.prototype.setVec2Components=function(t,e,n){var i=this.array,r=this.indexOffset+t*this.componentSize;return i[r]=e,i[r+1]=n,this},s.TypedArrayHelper.prototype.setVec3=function(t,e){return this.setVec3Components(t,e.x,e.y,e.z)},s.TypedArrayHelper.prototype.setVec3Components=function(t,e,n,i){var r=this.array,s=this.indexOffset+t*this.componentSize;return r[s]=e,r[s+1]=n,r[s+2]=i,this},s.TypedArrayHelper.prototype.setVec4=function(t,e){return this.setVec4Components(t,e.x,e.y,e.z,e.w)},s.TypedArrayHelper.prototype.setVec4Components=function(t,e,n,i,r){var s=this.array,o=this.indexOffset+t*this.componentSize;return s[o]=e,s[o+1]=n,s[o+2]=i,s[o+3]=r,this},s.TypedArrayHelper.prototype.setMat3=function(t,e){return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},s.TypedArrayHelper.prototype.setMat4=function(t,e){return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},s.TypedArrayHelper.prototype.setColor=function(t,e){return this.setVec3Components(t,e.r,e.g,e.b)},s.TypedArrayHelper.prototype.setNumber=function(t,e){return this.array[this.indexOffset+t*this.componentSize]=e,this},s.TypedArrayHelper.prototype.getValueAtIndex=function(t){return this.array[this.indexOffset+t]},s.TypedArrayHelper.prototype.getComponentValueAtIndex=function(t){return this.array.subarray(this.indexOffset+t*this.componentSize)},s.ShaderAttribute=function(t,e,n){var i=s.ShaderAttribute.typeSizeMap;this.type="string"==typeof t&&i.hasOwnProperty(t)?t:"f",this.componentSize=i[this.type],this.arrayType=n||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!e,this.updateMin=0,this.updateMax=0},s.ShaderAttribute.constructor=s.ShaderAttribute,s.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},s.ShaderAttribute.prototype.setUpdateRange=function(t,e){this.updateMin=Math.min(t*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(e*this.componentSize,this.updateMax*this.componentSize)},s.ShaderAttribute.prototype.flagUpdate=function(){var t=this.bufferAttribute,e=t.updateRange;e.offset=this.updateMin,e.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),t.needsUpdate=!0},s.ShaderAttribute.prototype.resetUpdateRange=function(){this.updateMin=0,this.updateMax=0},s.ShaderAttribute.prototype.resetDynamic=function(){this.bufferAttribute.usage=this.dynamicBuffer?i.dj0:i.W2J},s.ShaderAttribute.prototype.splice=function(t,e){this.typedArray.splice(t,e),this.forceUpdateAll()},s.ShaderAttribute.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.usage=i.W2J,this.bufferAttribute.needsUpdate=!0},s.ShaderAttribute.prototype._ensureTypedArray=function(t){null!==this.typedArray&&this.typedArray.size===t*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==t?this.typedArray.setSize(t):null===this.typedArray&&(this.typedArray=new s.TypedArrayHelper(this.arrayType,t,this.componentSize)))},s.ShaderAttribute.prototype._createBufferAttribute=function(t){if(this._ensureTypedArray(t),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,parseFloat(i.UZH)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new i.TlE(this.typedArray.array,this.componentSize),this.bufferAttribute.usage=this.dynamicBuffer?i.dj0:i.W2J},s.ShaderAttribute.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length},s.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );"].join("\n")},s.shaders={vertex:[s.shaderChunks.defines,s.shaderChunks.uniforms,s.shaderChunks.attributes,s.shaderChunks.varyings,i.WdD.common,i.WdD.logdepthbuf_pars_vertex,i.WdD.fog_pars_vertex,s.shaderChunks.branchAvoidanceFunctions,s.shaderChunks.unpackColor,s.shaderChunks.unpackRotationAxis,s.shaderChunks.floatOverLifetime,s.shaderChunks.colorOverLifetime,s.shaderChunks.paramFetchingFunctions,s.shaderChunks.forceFetchingFunctions,s.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",i.WdD.logdepthbuf_vertex,i.WdD.fog_vertex,"}"].join("\n"),fragment:[s.shaderChunks.uniforms,i.WdD.common,i.WdD.fog_pars_fragment,i.WdD.logdepthbuf_pars_fragment,s.shaderChunks.varyings,s.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",s.shaderChunks.rotateTexture,i.WdD.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",i.WdD.fog_fragment,"}"].join("\n")},s.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(t,e,n){return typeof t===e?t:n},ensureArrayTypedArg:function(t,e,n){if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(typeof t[i]!==e)return n;return t}return this.ensureTypedArg(t,e,n)},ensureInstanceOf:function(t,e,n){return void 0!==e&&t instanceof e?t:n},ensureArrayInstanceOf:function(t,e,n){if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(void 0!==e&&t[i]instanceof e==0)return n;return t}return this.ensureInstanceOf(t,e,n)},ensureValueOverLifetimeCompliance:function(t,e,n){e=e||3,n=n||3,!1===Array.isArray(t._value)&&(t._value=[t._value]),!1===Array.isArray(t._spread)&&(t._spread=[t._spread]);var i=this.clamp(t._value.length,e,n),r=this.clamp(t._spread.length,e,n),s=Math.max(i,r);t._value.length!==s&&(t._value=this.interpolateArray(t._value,s)),t._spread.length!==s&&(t._spread=this.interpolateArray(t._spread,s))},interpolateArray:function(t,e){for(var n=t.length,i=["function"==typeof t[0].clone?t[0].clone():t[0]],r=(n-1)/(e-1),s=1;s<e-1;++s){var o=s*r,a=Math.floor(o),l=Math.ceil(o),h=o-a;i[s]=this.lerpTypeAgnostic(t[a],t[l],h)}return i.push("function"==typeof t[n-1].clone?t[n-1].clone():t[n-1]),i},clamp:function(t,e,n){return Math.max(e,Math.min(t,n))},zeroToEpsilon:function(t,e){var n=1e-5,i=t;return i=e?Math.random()*n*10:n,t<0&&t>-1e-5&&(i=-i),i},lerpTypeAgnostic:function(t,e,n){var r,s=this.types;return typeof t===s.NUMBER&&typeof e===s.NUMBER?t+(e-t)*n:t instanceof i.FM8&&e instanceof i.FM8?((r=t.clone()).x=this.lerp(t.x,e.x,n),r.y=this.lerp(t.y,e.y,n),r):t instanceof i.Pa4&&e instanceof i.Pa4?((r=t.clone()).x=this.lerp(t.x,e.x,n),r.y=this.lerp(t.y,e.y,n),r.z=this.lerp(t.z,e.z,n),r):t instanceof i.Ltg&&e instanceof i.Ltg?((r=t.clone()).x=this.lerp(t.x,e.x,n),r.y=this.lerp(t.y,e.y,n),r.z=this.lerp(t.z,e.z,n),r.w=this.lerp(t.w,e.w,n),r):t instanceof i.Ilk&&e instanceof i.Ilk?((r=t.clone()).r=this.lerp(t.r,e.r,n),r.g=this.lerp(t.g,e.g,n),r.b=this.lerp(t.b,e.b,n),r):void console.warn("Invalid argument types, or argument types do not match:",t,e)},lerp:function(t,e,n){return t+(e-t)*n},roundToNearestMultiple:function(t,e){var n;return 0===e||0==(n=Math.abs(t)%e)?t:t<0?-(Math.abs(t)-n):t+e-n},arrayValuesAreEqual:function(t){for(var e=0;e<t.length-1;++e)if(t[e]!==t[e+1])return!1;return!0},randomFloat:function(t,e){return t+e*(Math.random()-.5)},randomVector3:function(t,e,n,i,r){var s=n.x+(Math.random()*i.x-.5*i.x),o=n.y+(Math.random()*i.y-.5*i.y),a=n.z+(Math.random()*i.z-.5*i.z);r&&(s=.5*-r.x+this.roundToNearestMultiple(s,r.x),o=.5*-r.y+this.roundToNearestMultiple(o,r.y),a=.5*-r.z+this.roundToNearestMultiple(a,r.z)),t.typedArray.setVec3Components(e,s,o,a)},randomColor:function(t,e,n,i){var r=n.r+Math.random()*i.x,s=n.g+Math.random()*i.y,o=n.b+Math.random()*i.z;r=this.clamp(r,0,1),s=this.clamp(s,0,1),o=this.clamp(o,0,1),t.typedArray.setVec3Components(e,r,s,o)},randomColorAsHex:(a=new i.Ilk,function(t,e,n,i){for(var r=n.length,s=[],o=0;o<r;++o){var l=i[o];a.copy(n[o]),a.r+=Math.random()*l.x-.5*l.x,a.g+=Math.random()*l.y-.5*l.y,a.b+=Math.random()*l.z-.5*l.z,a.r=this.clamp(a.r,0,1),a.g=this.clamp(a.g,0,1),a.b=this.clamp(a.b,0,1),s.push(a.getHex())}t.typedArray.setVec4Components(e,s[0],s[1],s[2],s[3])}),randomVector3OnLine:function(t,e,n,i){var r=n.clone();r.lerp(i,Math.random()),t.typedArray.setVec3Components(e,r.x,r.y,r.z)},randomVector3OnSphere:function(t,e,n,i,r,s,o,a){var l=2*Math.random()-1,h=6.2832*Math.random(),c=Math.sqrt(1-l*l),u=this.randomFloat(i,r),d=0,p=0,f=0;o&&(u=Math.round(u/o)*o),d=c*Math.cos(h)*u,p=c*Math.sin(h)*u,f=l*u,d*=s.x,p*=s.y,f*=s.z,d+=n.x,p+=n.y,f+=n.z,t.typedArray.setVec3Components(e,d,p,f)},seededRandom:function(t){var e=1e4*Math.sin(t);return e-(0|e)},randomVector3OnDisc:function(t,e,n,i,r,s,o){var a=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,r)),h=0,c=0,u=0;o&&(l=Math.round(l/o)*o),h=Math.cos(a)*l,c=Math.sin(a)*l,h*=s.x,c*=s.y,h+=n.x,c+=n.y,u+=n.z,t.typedArray.setVec3Components(e,h,c,u)},randomDirectionVector3OnSphere:(o=new i.Pa4,function(t,e,n,i,r,s,a,l){o.copy(s),o.x-=n,o.y-=i,o.z-=r,o.normalize().multiplyScalar(-this.randomFloat(a,l)),t.typedArray.setVec3Components(e,o.x,o.y,o.z)}),randomDirectionVector3OnDisc:function(){var t=new i.Pa4;return function(e,n,i,r,s,o,a,l){t.copy(o),t.x-=i,t.y-=r,t.z-=s,t.normalize().multiplyScalar(-this.randomFloat(a,l)),e.typedArray.setVec3Components(n,t.x,t.y,0)}}(),getPackedRotationAxis:function(){var t=new i.Pa4,e=new i.Pa4,n=new i.Ilk,r=new i.Pa4(1,1,1);return function(i,s){return t.copy(i).normalize(),e.copy(s).normalize(),t.x+=.5*-s.x+Math.random()*s.x,t.y+=.5*-s.y+Math.random()*s.y,t.z+=.5*-s.z+Math.random()*s.z,t.normalize().add(r).multiplyScalar(.5),n.setRGB(t.x,t.y,t.z),n.getHex()}}()},s.Group=function(t){var e=s.utils,n=e.types;(t=e.ensureTypedArg(t,n.OBJECT,{})).texture=e.ensureTypedArg(t.texture,n.OBJECT,{}),this.uuid=(0,r.DO)(),this.fixedTimeStep=e.ensureTypedArg(t.fixedTimeStep,n.NUMBER,.016),this.texture=e.ensureInstanceOf(t.texture.value,i.xEZ,null),this.textureFrames=e.ensureInstanceOf(t.texture.frames,i.FM8,new i.FM8(1,1)),this.textureFrameCount=e.ensureTypedArg(t.texture.frameCount,n.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=e.ensureTypedArg(t.texture.loop,n.NUMBER,1),this.textureFrames.max(new i.FM8(1,1)),this.hasPerspective=e.ensureTypedArg(t.hasPerspective,n.BOOLEAN,!0),this.colorize=e.ensureTypedArg(t.colorize,n.BOOLEAN,!0),this.maxParticleCount=e.ensureTypedArg(t.maxParticleCount,n.NUMBER,null),this.blending=e.ensureTypedArg(t.blending,n.NUMBER,i.WMw),this.transparent=e.ensureTypedArg(t.transparent,n.BOOLEAN,!0),this.alphaTest=parseFloat(e.ensureTypedArg(t.alphaTest,n.NUMBER,0)),this.depthWrite=e.ensureTypedArg(t.depthWrite,n.BOOLEAN,!1),this.depthTest=e.ensureTypedArg(t.depthTest,n.BOOLEAN,!0),this.fog=e.ensureTypedArg(t.fog,n.BOOLEAN,!0),this.scale=e.ensureTypedArg(t.scale,n.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new i.Ltg(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:this.fog?new i.Ilk:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:s.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new s.ShaderAttribute("v3",!0),acceleration:new s.ShaderAttribute("v4",!0),velocity:new s.ShaderAttribute("v3",!0),rotation:new s.ShaderAttribute("v4",!0),rotationCenter:new s.ShaderAttribute("v3",!0),params:new s.ShaderAttribute("v4",!0),size:new s.ShaderAttribute("v4",!0),angle:new s.ShaderAttribute("v4",!0),color:new s.ShaderAttribute("v4",!0),opacity:new s.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new i.jyz({uniforms:this.uniforms,vertexShader:s.shaders.vertex,fragmentShader:s.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new i.u9r,this.mesh=new i.woe(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},s.Group.constructor=s.Group,s.Group.prototype._updateDefines=function(){for(var t,e=this.emitters,n=e.length-1,i=this.defines;n>=0;--n)t=e[n],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,t.angle.value),Math.max.apply(null,t.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(t.rotation.angle,t.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(t.wiggle.value,t.wiggle.spread);this.material.needsUpdate=!0},s.Group.prototype._applyAttributesToGeometry=function(){var t,e,n=this.attributes,i=this.geometry,r=i.attributes;for(var s in n)n.hasOwnProperty(s)&&(t=n[s],(e=r[s])?e.array=t.typedArray.array:i.setAttribute(s,t.bufferAttribute),t.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},s.Group.prototype.addEmitter=function(t){if(t instanceof s.Emitter!=0)if(this.emitterIDs.indexOf(t.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===t.group){var e=this.attributes,n=this.particleCount,i=n+t.particleCount;for(var r in this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),t._calculatePPSValue(t.maxAge._value+t.maxAge._spread),t._setBufferUpdateRanges(this.attributeKeys),t._setAttributeOffset(n),t.group=this,t.attributes=this.attributes,e)e.hasOwnProperty(r)&&e[r]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=n;o<i;++o)t._assignPositionValue(o),t._assignForceValue(o,"velocity"),t._assignForceValue(o,"acceleration"),t._assignAbsLifetimeValue(o,"opacity"),t._assignAbsLifetimeValue(o,"size"),t._assignAngleValue(o),t._assignRotationValue(o),t._assignParamsValue(o),t._assignColorValue(o);return this._applyAttributesToGeometry(),this.emitters.push(t),this.emitterIDs.push(t.uuid),this._updateDefines(t),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",t)},s.Group.prototype.removeEmitter=function(t){var e=this.emitterIDs.indexOf(t.uuid);if(t instanceof s.Emitter!=0)if(-1!==e){for(var n=t.attributeOffset,i=n+t.particleCount,r=this.attributes.params.typedArray,o=n;o<i;++o)r.array[4*o]=0,r.array[4*o+1]=0;for(var a in this.emitters.splice(e,1),this.emitterIDs.splice(e,1),this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(n,i);this.particleCount-=t.particleCount,t._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",t)},s.Group.prototype.getFromPool=function(){var t=this._pool,e=this._createNewWhenPoolEmpty;if(t.length)return t.pop();if(e){var n=new s.Emitter(this._poolCreationSettings);return this.addEmitter(n),n}return null},s.Group.prototype.releaseIntoPool=function(t){if(t instanceof s.Emitter!=0)return t.reset(),this._pool.unshift(t),this;console.error("Argument is not instanceof SPE.Emitter:",t)},s.Group.prototype.getPool=function(){return this._pool},s.Group.prototype.addPool=function(t,e,n){var i;this._poolCreationSettings=e,this._createNewWhenPoolEmpty=!!n;for(var r=0;r<t;++r)i=Array.isArray(e)?new s.Emitter(e[r]):new s.Emitter(e),this.addEmitter(i),this.releaseIntoPool(i);return this},s.Group.prototype._triggerSingleEmitter=function(t){var e=this.getFromPool(),n=this;if(null!==e)return t instanceof i.Pa4&&(e.position.value.copy(t),e.position.value=e.position.value),e.enable(),setTimeout((function(){e.disable(),n.releaseIntoPool(e)}),1e3*Math.max(e.duration,e.maxAge.value+e.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},s.Group.prototype.triggerPoolEmitter=function(t,e){if("number"==typeof t&&t>1)for(var n=0;n<t;++n)this._triggerSingleEmitter(e);else this._triggerSingleEmitter(e);return this},s.Group.prototype._updateUniforms=function(t){this.uniforms.runTime.value+=t,this.uniforms.deltaTime.value=t},s.Group.prototype._resetBufferRanges=function(){for(var t=this.attributeKeys,e=this.attributeCount-1,n=this.attributes;e>=0;--e)n[t[e]].resetUpdateRange()},s.Group.prototype._updateBuffers=function(t){for(var e,n,i,r=this.attributeKeys,s=this.attributeCount-1,o=this.attributes,a=t.bufferUpdateRanges;s>=0;--s)n=a[e=r[s]],(i=o[e]).setUpdateRange(n.min,n.max),i.flagUpdate()},s.Group.prototype.tick=function(t){var e=this.emitters,n=e.length,i=t||this.fixedTimeStep,r=this.attributeKeys,s=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),0!==n||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var o,a=0;a<n;++a)(o=e[a]).tick(i),this._updateBuffers(o);if(!0===this._attributesNeedDynamicReset){for(a=this.attributeCount-1;a>=0;--a)s[r[a]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(a=this.attributeCount-1;a>=0;--a)s[r[a]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},s.Group.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this},s.Emitter=function(t){var e=s.utils,n=e.types,o=s.valueOverLifetimeLength;for(var a in(t=e.ensureTypedArg(t,n.OBJECT,{})).position=e.ensureTypedArg(t.position,n.OBJECT,{}),t.velocity=e.ensureTypedArg(t.velocity,n.OBJECT,{}),t.acceleration=e.ensureTypedArg(t.acceleration,n.OBJECT,{}),t.radius=e.ensureTypedArg(t.radius,n.OBJECT,{}),t.drag=e.ensureTypedArg(t.drag,n.OBJECT,{}),t.rotation=e.ensureTypedArg(t.rotation,n.OBJECT,{}),t.color=e.ensureTypedArg(t.color,n.OBJECT,{}),t.opacity=e.ensureTypedArg(t.opacity,n.OBJECT,{}),t.size=e.ensureTypedArg(t.size,n.OBJECT,{}),t.angle=e.ensureTypedArg(t.angle,n.OBJECT,{}),t.wiggle=e.ensureTypedArg(t.wiggle,n.OBJECT,{}),t.maxAge=e.ensureTypedArg(t.maxAge,n.OBJECT,{}),t.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=(0,r.DO)(),this.type=e.ensureTypedArg(t.type,n.NUMBER,s.distributions.BOX),this.position={_value:e.ensureInstanceOf(t.position.value,i.Pa4,new i.Pa4),_spread:e.ensureInstanceOf(t.position.spread,i.Pa4,new i.Pa4),_spreadClamp:e.ensureInstanceOf(t.position.spreadClamp,i.Pa4,new i.Pa4),_distribution:e.ensureTypedArg(t.position.distribution,n.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1),_radius:e.ensureTypedArg(t.position.radius,n.NUMBER,10),_radiusScale:e.ensureInstanceOf(t.position.radiusScale,i.Pa4,new i.Pa4(1,1,1)),_distributionClamp:e.ensureTypedArg(t.position.distributionClamp,n.NUMBER,0)},this.velocity={_value:e.ensureInstanceOf(t.velocity.value,i.Pa4,new i.Pa4),_spread:e.ensureInstanceOf(t.velocity.spread,i.Pa4,new i.Pa4),_distribution:e.ensureTypedArg(t.velocity.distribution,n.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.acceleration={_value:e.ensureInstanceOf(t.acceleration.value,i.Pa4,new i.Pa4),_spread:e.ensureInstanceOf(t.acceleration.spread,i.Pa4,new i.Pa4),_distribution:e.ensureTypedArg(t.acceleration.distribution,n.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.drag={_value:e.ensureTypedArg(t.drag.value,n.NUMBER,0),_spread:e.ensureTypedArg(t.drag.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.wiggle={_value:e.ensureTypedArg(t.wiggle.value,n.NUMBER,0),_spread:e.ensureTypedArg(t.wiggle.spread,n.NUMBER,0)},this.rotation={_axis:e.ensureInstanceOf(t.rotation.axis,i.Pa4,new i.Pa4(0,1,0)),_axisSpread:e.ensureInstanceOf(t.rotation.axisSpread,i.Pa4,new i.Pa4),_angle:e.ensureTypedArg(t.rotation.angle,n.NUMBER,0),_angleSpread:e.ensureTypedArg(t.rotation.angleSpread,n.NUMBER,0),_static:e.ensureTypedArg(t.rotation.static,n.BOOLEAN,!1),_center:e.ensureInstanceOf(t.rotation.center,i.Pa4,this.position._value.clone()),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.maxAge={_value:e.ensureTypedArg(t.maxAge.value,n.NUMBER,2),_spread:e.ensureTypedArg(t.maxAge.spread,n.NUMBER,0)},this.color={_value:e.ensureArrayInstanceOf(t.color.value,i.Ilk,new i.Ilk),_spread:e.ensureArrayInstanceOf(t.color.spread,i.Pa4,new i.Pa4),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.opacity={_value:e.ensureArrayTypedArg(t.opacity.value,n.NUMBER,1),_spread:e.ensureArrayTypedArg(t.opacity.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.size={_value:e.ensureArrayTypedArg(t.size.value,n.NUMBER,1),_spread:e.ensureArrayTypedArg(t.size.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.angle={_value:e.ensureArrayTypedArg(t.angle.value,n.NUMBER,0),_spread:e.ensureArrayTypedArg(t.angle.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.particleCount=e.ensureTypedArg(t.particleCount,n.NUMBER,100),this.duration=e.ensureTypedArg(t.duration,n.NUMBER,null),this.isStatic=e.ensureTypedArg(t.isStatic,n.BOOLEAN,!1),this.activeMultiplier=e.ensureTypedArg(t.activeMultiplier,n.NUMBER,1),this.direction=e.ensureTypedArg(t.direction,n.NUMBER,1),this.alive=e.ensureTypedArg(t.alive,n.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)||e.ensureTypedArg(t.radius.randomise,n.BOOLEAN,!1),velocity:e.ensureTypedArg(t.velocity.randomise,n.BOOLEAN,!1),acceleration:e.ensureTypedArg(t.acceleration.randomise,n.BOOLEAN,!1)||e.ensureTypedArg(t.drag.randomise,n.BOOLEAN,!1),rotation:e.ensureTypedArg(t.rotation.randomise,n.BOOLEAN,!1),rotationCenter:e.ensureTypedArg(t.rotation.randomise,n.BOOLEAN,!1),size:e.ensureTypedArg(t.size.randomise,n.BOOLEAN,!1),color:e.ensureTypedArg(t.color.randomise,n.BOOLEAN,!1),opacity:e.ensureTypedArg(t.opacity.randomise,n.BOOLEAN,!1),angle:e.ensureTypedArg(t.angle.randomise,n.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(a)&&(this.updateCounts[this.updateMap[a]]=0,this.updateFlags[this.updateMap[a]]=!1,this._createGetterSetters(this[a],a));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,e.ensureValueOverLifetimeCompliance(this.color,o,o),e.ensureValueOverLifetimeCompliance(this.opacity,o,o),e.ensureValueOverLifetimeCompliance(this.size,o,o),e.ensureValueOverLifetimeCompliance(this.angle,o,o)},s.Emitter.constructor=s.Emitter,s.Emitter.prototype._createGetterSetters=function(t,e){var n=this;for(var i in t)if(t.hasOwnProperty(i)){var r=i.replace("_","");Object.defineProperty(t,r,{get:function(t){return function(){return this[t]}}(i),set:function(t){return function(i){var r=n.updateMap[e],o=this[t],a=s.valueOverLifetimeLength;"_rotationCenter"===t?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===t?n.resetFlags[r]=i:(n.updateFlags[r]=!0,n.updateCounts[r]=0),n.group._updateDefines(),this[t]=i,Array.isArray(o)&&s.utils.ensureValueOverLifetimeCompliance(n[e],a,a)}}(i)})}},s.Emitter.prototype._setBufferUpdateRanges=function(t){this.attributeKeys=t,this.attributeCount=t.length;for(var e=this.attributeCount-1;e>=0;--e)this.bufferUpdateRanges[t[e]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},s.Emitter.prototype._calculatePPSValue=function(t){var e=this.particleCount;this.duration?this.particlesPerSecond=e/(t<this.duration?t:this.duration):this.particlesPerSecond=e/t},s.Emitter.prototype._setAttributeOffset=function(t){this.attributeOffset=t,this.activationIndex=t,this.activationEnd=t+this.particleCount},s.Emitter.prototype._assignValue=function(t,e){switch(t){case"position":this._assignPositionValue(e);break;case"velocity":case"acceleration":this._assignForceValue(e,t);break;case"size":case"opacity":this._assignAbsLifetimeValue(e,t);break;case"angle":this._assignAngleValue(e);break;case"params":this._assignParamsValue(e);break;case"rotation":this._assignRotationValue(e);break;case"color":this._assignColorValue(e)}},s.Emitter.prototype._assignPositionValue=function(t){var e=s.distributions,n=s.utils,i=this.position,r=this.attributes.position,o=i._value,a=i._spread;switch(i._distribution){case e.BOX:n.randomVector3(r,t,o,a,i._spreadClamp);break;case e.SPHERE:n.randomVector3OnSphere(r,t,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case e.DISC:n.randomVector3OnDisc(r,t,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x);break;case e.LINE:n.randomVector3OnLine(r,t,o,a)}},s.Emitter.prototype._assignForceValue=function(t,e){var n,i,r,o,a,l=s.distributions,h=s.utils,c=this[e],u=c._value,d=c._spread;switch(c._distribution){case l.BOX:h.randomVector3(this.attributes[e],t,u,d);break;case l.SPHERE:i=(n=this.attributes.position.typedArray.array)[a=3*t],r=n[a+1],o=n[a+2],h.randomDirectionVector3OnSphere(this.attributes[e],t,i,r,o,this.position._value,c._value.x,c._spread.x);break;case l.DISC:i=(n=this.attributes.position.typedArray.array)[a=3*t],r=n[a+1],o=n[a+2],h.randomDirectionVector3OnDisc(this.attributes[e],t,i,r,o,this.position._value,c._value.x,c._spread.x);break;case l.LINE:h.randomVector3OnLine(this.attributes[e],t,u,d)}if("acceleration"===e){var p=h.clamp(h.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[4*t+3]=p}},s.Emitter.prototype._assignAbsLifetimeValue=function(t,e){var n,i=this.attributes[e].typedArray,r=this[e],o=s.utils;o.arrayValuesAreEqual(r._value)&&o.arrayValuesAreEqual(r._spread)?(n=Math.abs(o.randomFloat(r._value[0],r._spread[0])),i.setVec4Components(t,n,n,n,n)):i.setVec4Components(t,Math.abs(o.randomFloat(r._value[0],r._spread[0])),Math.abs(o.randomFloat(r._value[1],r._spread[1])),Math.abs(o.randomFloat(r._value[2],r._spread[2])),Math.abs(o.randomFloat(r._value[3],r._spread[3])))},s.Emitter.prototype._assignAngleValue=function(t){var e,n=this.attributes.angle.typedArray,i=this.angle,r=s.utils;r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=r.randomFloat(i._value[0],i._spread[0]),n.setVec4Components(t,e,e,e,e)):n.setVec4Components(t,r.randomFloat(i._value[0],i._spread[0]),r.randomFloat(i._value[1],i._spread[1]),r.randomFloat(i._value[2],i._spread[2]),r.randomFloat(i._value[3],i._spread[3]))},s.Emitter.prototype._assignParamsValue=function(t){this.attributes.params.typedArray.setVec4Components(t,this.isStatic?1:0,0,Math.abs(s.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),s.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},s.Emitter.prototype._assignRotationValue=function(t){this.attributes.rotation.typedArray.setVec3Components(t,s.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),s.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(t,this.rotation._center)},s.Emitter.prototype._assignColorValue=function(t){s.utils.randomColorAsHex(this.attributes.color,t,this.color._value,this.color._spread)},s.Emitter.prototype._resetParticle=function(t){for(var e,n,i=this.resetFlags,r=this.updateFlags,s=this.updateCounts,o=this.attributeKeys,a=this.attributeCount-1;a>=0;--a)n=r[e=o[a]],!0!==i[e]&&!0!==n||(this._assignValue(e,t),this._updateAttributeUpdateRange(e,t),!0===n&&s[e]===this.particleCount?(r[e]=!1,s[e]=0):1==n&&++s[e])},s.Emitter.prototype._updateAttributeUpdateRange=function(t,e){var n=this.bufferUpdateRanges[t];n.min=Math.min(e,n.min),n.max=Math.max(e,n.max)},s.Emitter.prototype._resetBufferRanges=function(){for(var t,e=this.bufferUpdateRanges,n=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;i>=0;--i)e[t=n[i]].min=Number.POSITIVE_INFINITY,e[t].max=Number.NEGATIVE_INFINITY},s.Emitter.prototype._onRemove=function(){this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},s.Emitter.prototype._decrementParticleCount=function(){--this.activeParticleCount},s.Emitter.prototype._incrementParticleCount=function(){++this.activeParticleCount},s.Emitter.prototype._checkParticleAges=function(t,e,n,i){for(var r,s,o,a,l=e-1;l>=t;--l)0!==(a=n[r=4*l])&&(o=n[r+1],s=n[r+2],1===this.direction?(o+=i)>=s&&(o=0,a=0,this._decrementParticleCount()):(o-=i)<=0&&(o=s,a=0,this._decrementParticleCount()),n[r]=a,n[r+1]=o,this._updateAttributeUpdateRange("params",l))},s.Emitter.prototype._activateParticles=function(t,e,n,i){for(var r,s,o=this.direction,a=t;a<e;++a)0!=n[r=4*a]&&1!==this.particleCount||(this._incrementParticleCount(),n[r]=1,this._resetParticle(a),s=i*(a-t),n[r+1]=-1===o?n[r+2]-s:s,this._updateAttributeUpdateRange("params",a))},s.Emitter.prototype.tick=function(t){if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var e=this.attributeOffset,n=e+this.particleCount,i=this.paramsArray,r=this.particlesPerSecond*this.activeMultiplier*t,s=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(e,n,i,t),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var o=1===this.particleCount?s:0|s,a=Math.min(o+r,this.activationEnd),l=a-this.activationIndex|0,h=l>0?t/l:0;this._activateParticles(o,a,i,h),this.activationIndex+=r,this.activationIndex>n&&(this.activationIndex=e),this.age+=t}else this.age=0}},s.Emitter.prototype.reset=function(t){if(this.age=0,this.alive=!1,!0===t){for(var e,n=this.attributeOffset,i=n+this.particleCount,r=this.paramsArray,s=this.attributes.params.bufferAttribute,o=i-1;o>=n;--o)r[e=4*o]=0,r[e+1]=0;s.updateRange.offset=0,s.updateRange.count=-1,s.needsUpdate=!0}return this},s.Emitter.prototype.enable=function(){return this.alive=!0,this},s.Emitter.prototype.disable=function(){return this.alive=!1,this},s.Emitter.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this}},670:function(t){t.exports=function(){"use strict";for(var t=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=1),t<e?e:t>n?n:t},e=t,n={},i=0,r=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];i<r.length;i+=1){var s=r[i];n["[object "+s+"]"]=s.toLowerCase()}var o=function(t){return n[Object.prototype.toString.call(t)]||"object"},a=o,l=o,h=Math.PI,c={clip_rgb:function(t){t._clipped=!1,t._unclipped=t.slice(0);for(var n=0;n<=3;n++)n<3?((t[n]<0||t[n]>255)&&(t._clipped=!0),t[n]=e(t[n],0,255)):3===n&&(t[n]=e(t[n],0,1));return t},limit:t,type:o,unpack:function(t,e){return void 0===e&&(e=null),t.length>=3?Array.prototype.slice.call(t):"object"==a(t[0])&&e?e.split("").filter((function(e){return void 0!==t[0][e]})).map((function(e){return t[0][e]})):t[0]},last:function(t){if(t.length<2)return null;var e=t.length-1;return"string"==l(t[e])?t[e].toLowerCase():null},PI:h,TWOPI:2*h,PITHIRD:h/3,DEG2RAD:h/180,RAD2DEG:180/h},u={format:{},autodetect:[]},d=c.last,p=c.clip_rgb,f=c.type,m=u,g=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=this;if("object"===f(t[0])&&t[0].constructor&&t[0].constructor===this.constructor)return t[0];var i=d(t),r=!1;if(!i){r=!0,m.sorted||(m.autodetect=m.autodetect.sort((function(t,e){return e.p-t.p})),m.sorted=!0);for(var s=0,o=m.autodetect;s<o.length;s+=1){var a=o[s];if(i=a.test.apply(a,t))break}}if(!m.format[i])throw new Error("unknown format: "+t);var l=m.format[i].apply(null,r?t:t.slice(0,-1));n._rgb=p(l),3===n._rgb.length&&n._rgb.push(1)};g.prototype.toString=function(){return"function"==f(this.hex)?this.hex():"["+this._rgb.join(",")+"]"};var v=g,y=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(y.Color,[null].concat(t)))};y.Color=v,y.version="2.4.2";var x=y,b=c.unpack,w=Math.max,_=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=b(t,"rgb"),i=n[0],r=n[1],s=n[2],o=1-w(i/=255,w(r/=255,s/=255)),a=o<1?1/(1-o):0;return[(1-i-o)*a,(1-r-o)*a,(1-s-o)*a,o]},M=c.unpack,S=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=M(t,"cmyk"))[0],i=t[1],r=t[2],s=t[3],o=t.length>4?t[4]:1;return 1===s?[0,0,0,o]:[n>=1?0:255*(1-n)*(1-s),i>=1?0:255*(1-i)*(1-s),r>=1?0:255*(1-r)*(1-s),o]},T=x,E=v,A=u,C=c.unpack,P=c.type,R=_;E.prototype.cmyk=function(){return R(this._rgb)},T.cmyk=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(E,[null].concat(t,["cmyk"])))},A.format.cmyk=S,A.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=C(t,"cmyk"),"array"===P(t)&&4===t.length)return"cmyk"}});var L=c.unpack,I=c.last,D=function(t){return Math.round(100*t)/100},O=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=L(t,"hsla"),i=I(t)||"lsa";return n[0]=D(n[0]||0),n[1]=D(100*n[1])+"%",n[2]=D(100*n[2])+"%","hsla"===i||n.length>3&&n[3]<1?(n[3]=n.length>3?n[3]:1,i="hsla"):n.length=3,i+"("+n.join(",")+")"},B=c.unpack,N=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=B(t,"rgba"))[0],i=t[1],r=t[2];n/=255,i/=255,r/=255;var s,o,a=Math.min(n,i,r),l=Math.max(n,i,r),h=(l+a)/2;return l===a?(s=0,o=Number.NaN):s=h<.5?(l-a)/(l+a):(l-a)/(2-l-a),n==l?o=(i-r)/(l-a):i==l?o=2+(r-n)/(l-a):r==l&&(o=4+(n-i)/(l-a)),(o*=60)<0&&(o+=360),t.length>3&&void 0!==t[3]?[o,s,h,t[3]]:[o,s,h]},z=c.unpack,k=c.last,F=O,U=N,H=Math.round,V=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=z(t,"rgba"),i=k(t)||"rgb";return"hsl"==i.substr(0,3)?F(U(n),i):(n[0]=H(n[0]),n[1]=H(n[1]),n[2]=H(n[2]),("rgba"===i||n.length>3&&n[3]<1)&&(n[3]=n.length>3?n[3]:1,i="rgba"),i+"("+n.slice(0,"rgb"===i?3:4).join(",")+")")},G=c.unpack,W=Math.round,j=function(){for(var t,e=[],n=arguments.length;n--;)e[n]=arguments[n];var i,r,s,o=(e=G(e,"hsl"))[0],a=e[1],l=e[2];if(0===a)i=r=s=255*l;else{var h=[0,0,0],c=[0,0,0],u=l<.5?l*(1+a):l+a-l*a,d=2*l-u,p=o/360;h[0]=p+1/3,h[1]=p,h[2]=p-1/3;for(var f=0;f<3;f++)h[f]<0&&(h[f]+=1),h[f]>1&&(h[f]-=1),6*h[f]<1?c[f]=d+6*(u-d)*h[f]:2*h[f]<1?c[f]=u:3*h[f]<2?c[f]=d+(u-d)*(2/3-h[f])*6:c[f]=d;i=(t=[W(255*c[0]),W(255*c[1]),W(255*c[2])])[0],r=t[1],s=t[2]}return e.length>3?[i,r,s,e[3]]:[i,r,s,1]},q=j,X=u,Y=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,$=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,K=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Z=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,J=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Q=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,tt=Math.round,et=function(t){var e;if(t=t.toLowerCase().trim(),X.format.named)try{return X.format.named(t)}catch(t){}if(e=t.match(Y)){for(var n=e.slice(1,4),i=0;i<3;i++)n[i]=+n[i];return n[3]=1,n}if(e=t.match($)){for(var r=e.slice(1,5),s=0;s<4;s++)r[s]=+r[s];return r}if(e=t.match(K)){for(var o=e.slice(1,4),a=0;a<3;a++)o[a]=tt(2.55*o[a]);return o[3]=1,o}if(e=t.match(Z)){for(var l=e.slice(1,5),h=0;h<3;h++)l[h]=tt(2.55*l[h]);return l[3]=+l[3],l}if(e=t.match(J)){var c=e.slice(1,4);c[1]*=.01,c[2]*=.01;var u=q(c);return u[3]=1,u}if(e=t.match(Q)){var d=e.slice(1,4);d[1]*=.01,d[2]*=.01;var p=q(d);return p[3]=+e[4],p}};et.test=function(t){return Y.test(t)||$.test(t)||K.test(t)||Z.test(t)||J.test(t)||Q.test(t)};var nt=x,it=v,rt=u,st=c.type,ot=V,at=et;it.prototype.css=function(t){return ot(this._rgb,t)},nt.css=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(it,[null].concat(t,["css"])))},rt.format.css=at,rt.autodetect.push({p:5,test:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(!e.length&&"string"===st(t)&&at.test(t))return"css"}});var lt=v,ht=x,ct=c.unpack;u.format.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=ct(t,"rgba");return n[0]*=255,n[1]*=255,n[2]*=255,n},ht.gl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(lt,[null].concat(t,["gl"])))},lt.prototype.gl=function(){var t=this._rgb;return[t[0]/255,t[1]/255,t[2]/255,t[3]]};var ut=c.unpack,dt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,i=ut(t,"rgb"),r=i[0],s=i[1],o=i[2],a=Math.min(r,s,o),l=Math.max(r,s,o),h=l-a,c=100*h/255,u=a/(255-h)*100;return 0===h?n=Number.NaN:(r===l&&(n=(s-o)/h),s===l&&(n=2+(o-r)/h),o===l&&(n=4+(r-s)/h),(n*=60)<0&&(n+=360)),[n,c,u]},pt=c.unpack,ft=Math.floor,mt=function(){for(var t,e,n,i,r,s,o=[],a=arguments.length;a--;)o[a]=arguments[a];var l,h,c,u=(o=pt(o,"hcg"))[0],d=o[1],p=o[2];p*=255;var f=255*d;if(0===d)l=h=c=p;else{360===u&&(u=0),u>360&&(u-=360),u<0&&(u+=360);var m=ft(u/=60),g=u-m,v=p*(1-d),y=v+f*(1-g),x=v+f*g,b=v+f;switch(m){case 0:l=(t=[b,x,v])[0],h=t[1],c=t[2];break;case 1:l=(e=[y,b,v])[0],h=e[1],c=e[2];break;case 2:l=(n=[v,b,x])[0],h=n[1],c=n[2];break;case 3:l=(i=[v,y,b])[0],h=i[1],c=i[2];break;case 4:l=(r=[x,v,b])[0],h=r[1],c=r[2];break;case 5:l=(s=[b,v,y])[0],h=s[1],c=s[2]}}return[l,h,c,o.length>3?o[3]:1]},gt=c.unpack,vt=c.type,yt=x,xt=v,bt=u,wt=dt;xt.prototype.hcg=function(){return wt(this._rgb)},yt.hcg=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(xt,[null].concat(t,["hcg"])))},bt.format.hcg=mt,bt.autodetect.push({p:1,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=gt(t,"hcg"),"array"===vt(t)&&3===t.length)return"hcg"}});var _t=c.unpack,Mt=c.last,St=Math.round,Tt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=_t(t,"rgba"),i=n[0],r=n[1],s=n[2],o=n[3],a=Mt(t)||"auto";void 0===o&&(o=1),"auto"===a&&(a=o<1?"rgba":"rgb");var l="000000"+((i=St(i))<<16|(r=St(r))<<8|(s=St(s))).toString(16);l=l.substr(l.length-6);var h="0"+St(255*o).toString(16);switch(h=h.substr(h.length-2),a.toLowerCase()){case"rgba":return"#"+l+h;case"argb":return"#"+h+l;default:return"#"+l}},Et=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,At=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,Ct=function(t){if(t.match(Et)){4!==t.length&&7!==t.length||(t=t.substr(1)),3===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=parseInt(t,16);return[e>>16,e>>8&255,255&e,1]}if(t.match(At)){5!==t.length&&9!==t.length||(t=t.substr(1)),4===t.length&&(t=(t=t.split(""))[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var n=parseInt(t,16);return[n>>24&255,n>>16&255,n>>8&255,Math.round((255&n)/255*100)/100]}throw new Error("unknown hex color: "+t)},Pt=x,Rt=v,Lt=c.type,It=u,Dt=Tt;Rt.prototype.hex=function(t){return Dt(this._rgb,t)},Pt.hex=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(Rt,[null].concat(t,["hex"])))},It.format.hex=Ct,It.autodetect.push({p:4,test:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(!e.length&&"string"===Lt(t)&&[3,4,5,6,7,8,9].indexOf(t.length)>=0)return"hex"}});var Ot=c.unpack,Bt=c.TWOPI,Nt=Math.min,zt=Math.sqrt,kt=Math.acos,Ft=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,i=Ot(t,"rgb"),r=i[0],s=i[1],o=i[2],a=Nt(r/=255,s/=255,o/=255),l=(r+s+o)/3,h=l>0?1-a/l:0;return 0===h?n=NaN:(n=(r-s+(r-o))/2,n/=zt((r-s)*(r-s)+(r-o)*(s-o)),n=kt(n),o>s&&(n=Bt-n),n/=Bt),[360*n,h,l]},Ut=c.unpack,Ht=c.limit,Vt=c.TWOPI,Gt=c.PITHIRD,Wt=Math.cos,jt=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,i,r,s=(t=Ut(t,"hsi"))[0],o=t[1],a=t[2];return isNaN(s)&&(s=0),isNaN(o)&&(o=0),s>360&&(s-=360),s<0&&(s+=360),(s/=360)<1/3?i=1-((r=(1-o)/3)+(n=(1+o*Wt(Vt*s)/Wt(Gt-Vt*s))/3)):s<2/3?r=1-((n=(1-o)/3)+(i=(1+o*Wt(Vt*(s-=1/3))/Wt(Gt-Vt*s))/3)):n=1-((i=(1-o)/3)+(r=(1+o*Wt(Vt*(s-=2/3))/Wt(Gt-Vt*s))/3)),[255*(n=Ht(a*n*3)),255*(i=Ht(a*i*3)),255*(r=Ht(a*r*3)),t.length>3?t[3]:1]},qt=c.unpack,Xt=c.type,Yt=x,$t=v,Kt=u,Zt=Ft;$t.prototype.hsi=function(){return Zt(this._rgb)},Yt.hsi=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply($t,[null].concat(t,["hsi"])))},Kt.format.hsi=jt,Kt.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=qt(t,"hsi"),"array"===Xt(t)&&3===t.length)return"hsi"}});var Jt=c.unpack,Qt=c.type,te=x,ee=v,ne=u,ie=N;ee.prototype.hsl=function(){return ie(this._rgb)},te.hsl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(ee,[null].concat(t,["hsl"])))},ne.format.hsl=j,ne.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Jt(t,"hsl"),"array"===Qt(t)&&3===t.length)return"hsl"}});var re=c.unpack,se=Math.min,oe=Math.max,ae=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,i,r,s=(t=re(t,"rgb"))[0],o=t[1],a=t[2],l=se(s,o,a),h=oe(s,o,a),c=h-l;return r=h/255,0===h?(n=Number.NaN,i=0):(i=c/h,s===h&&(n=(o-a)/c),o===h&&(n=2+(a-s)/c),a===h&&(n=4+(s-o)/c),(n*=60)<0&&(n+=360)),[n,i,r]},le=c.unpack,he=Math.floor,ce=function(){for(var t,e,n,i,r,s,o=[],a=arguments.length;a--;)o[a]=arguments[a];var l,h,c,u=(o=le(o,"hsv"))[0],d=o[1],p=o[2];if(p*=255,0===d)l=h=c=p;else{360===u&&(u=0),u>360&&(u-=360),u<0&&(u+=360);var f=he(u/=60),m=u-f,g=p*(1-d),v=p*(1-d*m),y=p*(1-d*(1-m));switch(f){case 0:l=(t=[p,y,g])[0],h=t[1],c=t[2];break;case 1:l=(e=[v,p,g])[0],h=e[1],c=e[2];break;case 2:l=(n=[g,p,y])[0],h=n[1],c=n[2];break;case 3:l=(i=[g,v,p])[0],h=i[1],c=i[2];break;case 4:l=(r=[y,g,p])[0],h=r[1],c=r[2];break;case 5:l=(s=[p,g,v])[0],h=s[1],c=s[2]}}return[l,h,c,o.length>3?o[3]:1]},ue=c.unpack,de=c.type,pe=x,fe=v,me=u,ge=ae;fe.prototype.hsv=function(){return ge(this._rgb)},pe.hsv=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(fe,[null].concat(t,["hsv"])))},me.format.hsv=ce,me.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=ue(t,"hsv"),"array"===de(t)&&3===t.length)return"hsv"}});var ve={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},ye=ve,xe=c.unpack,be=Math.pow,we=function(t){return(t/=255)<=.04045?t/12.92:be((t+.055)/1.055,2.4)},_e=function(t){return t>ye.t3?be(t,1/3):t/ye.t2+ye.t0},Me=function(t,e,n){return t=we(t),e=we(e),n=we(n),[_e((.4124564*t+.3575761*e+.1804375*n)/ye.Xn),_e((.2126729*t+.7151522*e+.072175*n)/ye.Yn),_e((.0193339*t+.119192*e+.9503041*n)/ye.Zn)]},Se=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=xe(t,"rgb"),i=n[0],r=n[1],s=n[2],o=Me(i,r,s),a=o[0],l=o[1],h=116*l-16;return[h<0?0:h,500*(a-l),200*(l-o[2])]},Te=ve,Ee=c.unpack,Ae=Math.pow,Ce=function(t){return 255*(t<=.00304?12.92*t:1.055*Ae(t,1/2.4)-.055)},Pe=function(t){return t>Te.t1?t*t*t:Te.t2*(t-Te.t0)},Re=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n,i,r,s=(t=Ee(t,"lab"))[0],o=t[1],a=t[2];return i=(s+16)/116,n=isNaN(o)?i:i+o/500,r=isNaN(a)?i:i-a/200,i=Te.Yn*Pe(i),n=Te.Xn*Pe(n),r=Te.Zn*Pe(r),[Ce(3.2404542*n-1.5371385*i-.4985314*r),Ce(-.969266*n+1.8760108*i+.041556*r),Ce(.0556434*n-.2040259*i+1.0572252*r),t.length>3?t[3]:1]},Le=c.unpack,Ie=c.type,De=x,Oe=v,Be=u,Ne=Se;Oe.prototype.lab=function(){return Ne(this._rgb)},De.lab=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(Oe,[null].concat(t,["lab"])))},Be.format.lab=Re,Be.autodetect.push({p:2,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Le(t,"lab"),"array"===Ie(t)&&3===t.length)return"lab"}});var ze=c.unpack,ke=c.RAD2DEG,Fe=Math.sqrt,Ue=Math.atan2,He=Math.round,Ve=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=ze(t,"lab"),i=n[0],r=n[1],s=n[2],o=Fe(r*r+s*s),a=(Ue(s,r)*ke+360)%360;return 0===He(1e4*o)&&(a=Number.NaN),[i,o,a]},Ge=c.unpack,We=Se,je=Ve,qe=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=Ge(t,"rgb"),i=n[0],r=n[1],s=n[2],o=We(i,r,s),a=o[0],l=o[1],h=o[2];return je(a,l,h)},Xe=c.unpack,Ye=c.DEG2RAD,$e=Math.sin,Ke=Math.cos,Ze=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=Xe(t,"lch"),i=n[0],r=n[1],s=n[2];return isNaN(s)&&(s=0),[i,Ke(s*=Ye)*r,$e(s)*r]},Je=c.unpack,Qe=Ze,tn=Re,en=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=Je(t,"lch"))[0],i=t[1],r=t[2],s=Qe(n,i,r),o=s[0],a=s[1],l=s[2],h=tn(o,a,l);return[h[0],h[1],h[2],t.length>3?t[3]:1]},nn=c.unpack,rn=en,sn=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=nn(t,"hcl").reverse();return rn.apply(void 0,n)},on=c.unpack,an=c.type,ln=x,hn=v,cn=u,un=qe;hn.prototype.lch=function(){return un(this._rgb)},hn.prototype.hcl=function(){return un(this._rgb).reverse()},ln.lch=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(hn,[null].concat(t,["lch"])))},ln.hcl=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(hn,[null].concat(t,["hcl"])))},cn.format.lch=en,cn.format.hcl=sn,["lch","hcl"].forEach((function(t){return cn.autodetect.push({p:2,test:function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(e=on(e,t),"array"===an(e)&&3===e.length)return t}})}));var dn={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},pn=u,fn=c.type,mn=dn,gn=Ct,vn=Tt;v.prototype.name=function(){for(var t=vn(this._rgb,"rgb"),e=0,n=Object.keys(mn);e<n.length;e+=1){var i=n[e];if(mn[i]===t)return i.toLowerCase()}return t},pn.format.named=function(t){if(t=t.toLowerCase(),mn[t])return gn(mn[t]);throw new Error("unknown color name: "+t)},pn.autodetect.push({p:5,test:function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];if(!e.length&&"string"===fn(t)&&mn[t.toLowerCase()])return"named"}});var yn=c.unpack,xn=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=yn(t,"rgb");return(n[0]<<16)+(n[1]<<8)+n[2]},bn=c.type,wn=function(t){if("number"==bn(t)&&t>=0&&t<=16777215)return[t>>16,t>>8&255,255&t,1];throw new Error("unknown num color: "+t)},_n=x,Mn=v,Sn=u,Tn=c.type,En=xn;Mn.prototype.num=function(){return En(this._rgb)},_n.num=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(Mn,[null].concat(t,["num"])))},Sn.format.num=wn,Sn.autodetect.push({p:5,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(1===t.length&&"number"===Tn(t[0])&&t[0]>=0&&t[0]<=16777215)return"num"}});var An=x,Cn=v,Pn=u,Rn=c.unpack,Ln=c.type,In=Math.round;Cn.prototype.rgb=function(t){return void 0===t&&(t=!0),!1===t?this._rgb.slice(0,3):this._rgb.slice(0,3).map(In)},Cn.prototype.rgba=function(t){return void 0===t&&(t=!0),this._rgb.slice(0,4).map((function(e,n){return n<3?!1===t?e:In(e):e}))},An.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(Cn,[null].concat(t,["rgb"])))},Pn.format.rgb=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=Rn(t,"rgba");return void 0===n[3]&&(n[3]=1),n},Pn.autodetect.push({p:3,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Rn(t,"rgba"),"array"===Ln(t)&&(3===t.length||4===t.length&&"number"==Ln(t[3])&&t[3]>=0&&t[3]<=1))return"rgb"}});var Dn=Math.log,On=function(t){var e,n,i,r=t/100;return r<66?(e=255,n=r<6?0:-155.25485562709179-.44596950469579133*(n=r-2)+104.49216199393888*Dn(n),i=r<20?0:.8274096064007395*(i=r-10)-254.76935184120902+115.67994401066147*Dn(i)):(e=351.97690566805693+.114206453784165*(e=r-55)-40.25366309332127*Dn(e),n=325.4494125711974+.07943456536662342*(n=r-50)-28.0852963507957*Dn(n),i=255),[e,n,i,1]},Bn=On,Nn=c.unpack,zn=Math.round,kn=x,Fn=v,Un=u,Hn=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var n,i=Nn(t,"rgb"),r=i[0],s=i[2],o=1e3,a=4e4,l=.4;a-o>l;){var h=Bn(n=.5*(a+o));h[2]/h[0]>=s/r?a=n:o=n}return zn(n)};Fn.prototype.temp=Fn.prototype.kelvin=Fn.prototype.temperature=function(){return Hn(this._rgb)},kn.temp=kn.kelvin=kn.temperature=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(Fn,[null].concat(t,["temp"])))},Un.format.temp=Un.format.kelvin=Un.format.temperature=On;var Vn=c.unpack,Gn=Math.cbrt,Wn=Math.pow,jn=Math.sign,qn=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=Vn(t,"rgb"),i=n[0],r=n[1],s=n[2],o=[Xn(i/255),Xn(r/255),Xn(s/255)],a=o[0],l=o[1],h=o[2],c=Gn(.4122214708*a+.5363325363*l+.0514459929*h),u=Gn(.2119034982*a+.6806995451*l+.1073969566*h),d=Gn(.0883024619*a+.2817188376*l+.6299787005*h);return[.2104542553*c+.793617785*u-.0040720468*d,1.9779984951*c-2.428592205*u+.4505937099*d,.0259040371*c+.7827717662*u-.808675766*d]};function Xn(t){var e=Math.abs(t);return e<.04045?t/12.92:(jn(t)||1)*Wn((e+.055)/1.055,2.4)}var Yn=c.unpack,$n=Math.pow,Kn=Math.sign,Zn=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=Yn(t,"lab"))[0],i=t[1],r=t[2],s=$n(n+.3963377774*i+.2158037573*r,3),o=$n(n-.1055613458*i-.0638541728*r,3),a=$n(n-.0894841775*i-1.291485548*r,3);return[255*Jn(4.0767416621*s-3.3077115913*o+.2309699292*a),255*Jn(-1.2684380046*s+2.6097574011*o-.3413193965*a),255*Jn(-.0041960863*s-.7034186147*o+1.707614701*a),t.length>3?t[3]:1]};function Jn(t){var e=Math.abs(t);return e>.0031308?(Kn(t)||1)*(1.055*$n(e,1/2.4)-.055):12.92*t}var Qn=c.unpack,ti=c.type,ei=x,ni=v,ii=u,ri=qn;ni.prototype.oklab=function(){return ri(this._rgb)},ei.oklab=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(ni,[null].concat(t,["oklab"])))},ii.format.oklab=Zn,ii.autodetect.push({p:3,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=Qn(t,"oklab"),"array"===ti(t)&&3===t.length)return"oklab"}});var si=c.unpack,oi=qn,ai=Ve,li=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=si(t,"rgb"),i=n[0],r=n[1],s=n[2],o=oi(i,r,s),a=o[0],l=o[1],h=o[2];return ai(a,l,h)},hi=c.unpack,ci=Ze,ui=Zn,di=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=(t=hi(t,"lch"))[0],i=t[1],r=t[2],s=ci(n,i,r),o=s[0],a=s[1],l=s[2],h=ui(o,a,l);return[h[0],h[1],h[2],t.length>3?t[3]:1]},pi=c.unpack,fi=c.type,mi=x,gi=v,vi=u,yi=li;gi.prototype.oklch=function(){return yi(this._rgb)},mi.oklch=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new(Function.prototype.bind.apply(gi,[null].concat(t,["oklch"])))},vi.format.oklch=di,vi.autodetect.push({p:3,test:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t=pi(t,"oklch"),"array"===fi(t)&&3===t.length)return"oklch"}});var xi=v,bi=c.type;xi.prototype.alpha=function(t,e){return void 0===e&&(e=!1),void 0!==t&&"number"===bi(t)?e?(this._rgb[3]=t,this):new xi([this._rgb[0],this._rgb[1],this._rgb[2],t],"rgb"):this._rgb[3]},v.prototype.clipped=function(){return this._rgb._clipped||!1};var wi=v,_i=ve;wi.prototype.darken=function(t){void 0===t&&(t=1);var e=this.lab();return e[0]-=_i.Kn*t,new wi(e,"lab").alpha(this.alpha(),!0)},wi.prototype.brighten=function(t){return void 0===t&&(t=1),this.darken(-t)},wi.prototype.darker=wi.prototype.darken,wi.prototype.brighter=wi.prototype.brighten,v.prototype.get=function(t){var e=t.split("."),n=e[0],i=e[1],r=this[n]();if(i){var s=n.indexOf(i)-("ok"===n.substr(0,2)?2:0);if(s>-1)return r[s];throw new Error("unknown channel "+i+" in mode "+n)}return r};var Mi=v,Si=c.type,Ti=Math.pow;Mi.prototype.luminance=function(t){if(void 0!==t&&"number"===Si(t)){if(0===t)return new Mi([0,0,0,this._rgb[3]],"rgb");if(1===t)return new Mi([255,255,255,this._rgb[3]],"rgb");var e=this.luminance(),n=20,i=function(e,r){var s=e.interpolate(r,.5,"rgb"),o=s.luminance();return Math.abs(t-o)<1e-7||!n--?s:o>t?i(e,s):i(s,r)},r=(e>t?i(new Mi([0,0,0]),this):i(this,new Mi([255,255,255]))).rgb();return new Mi(r.concat([this._rgb[3]]))}return Ei.apply(void 0,this._rgb.slice(0,3))};var Ei=function(t,e,n){return.2126*(t=Ai(t))+.7152*(e=Ai(e))+.0722*Ai(n)},Ai=function(t){return(t/=255)<=.03928?t/12.92:Ti((t+.055)/1.055,2.4)},Ci={},Pi=v,Ri=c.type,Li=Ci,Ii=function(t,e,n){void 0===n&&(n=.5);for(var i=[],r=arguments.length-3;r-- >0;)i[r]=arguments[r+3];var s=i[0]||"lrgb";if(Li[s]||i.length||(s=Object.keys(Li)[0]),!Li[s])throw new Error("interpolation mode "+s+" is not defined");return"object"!==Ri(t)&&(t=new Pi(t)),"object"!==Ri(e)&&(e=new Pi(e)),Li[s](t,e,n).alpha(t.alpha()+n*(e.alpha()-t.alpha()))},Di=v,Oi=Ii;Di.prototype.mix=Di.prototype.interpolate=function(t,e){void 0===e&&(e=.5);for(var n=[],i=arguments.length-2;i-- >0;)n[i]=arguments[i+2];return Oi.apply(void 0,[this,t,e].concat(n))};var Bi=v;Bi.prototype.premultiply=function(t){void 0===t&&(t=!1);var e=this._rgb,n=e[3];return t?(this._rgb=[e[0]*n,e[1]*n,e[2]*n,n],this):new Bi([e[0]*n,e[1]*n,e[2]*n,n],"rgb")};var Ni=v,zi=ve;Ni.prototype.saturate=function(t){void 0===t&&(t=1);var e=this.lch();return e[1]+=zi.Kn*t,e[1]<0&&(e[1]=0),new Ni(e,"lch").alpha(this.alpha(),!0)},Ni.prototype.desaturate=function(t){return void 0===t&&(t=1),this.saturate(-t)};var ki=v,Fi=c.type;ki.prototype.set=function(t,e,n){void 0===n&&(n=!1);var i=t.split("."),r=i[0],s=i[1],o=this[r]();if(s){var a=r.indexOf(s)-("ok"===r.substr(0,2)?2:0);if(a>-1){if("string"==Fi(e))switch(e.charAt(0)){case"+":case"-":o[a]+=+e;break;case"*":o[a]*=+e.substr(1);break;case"/":o[a]/=+e.substr(1);break;default:o[a]=+e}else{if("number"!==Fi(e))throw new Error("unsupported value for Color.set");o[a]=e}var l=new ki(o,r);return n?(this._rgb=l._rgb,this):l}throw new Error("unknown channel "+s+" in mode "+r)}return o};var Ui=v;Ci.rgb=function(t,e,n){var i=t._rgb,r=e._rgb;return new Ui(i[0]+n*(r[0]-i[0]),i[1]+n*(r[1]-i[1]),i[2]+n*(r[2]-i[2]),"rgb")};var Hi=v,Vi=Math.sqrt,Gi=Math.pow;Ci.lrgb=function(t,e,n){var i=t._rgb,r=i[0],s=i[1],o=i[2],a=e._rgb,l=a[0],h=a[1],c=a[2];return new Hi(Vi(Gi(r,2)*(1-n)+Gi(l,2)*n),Vi(Gi(s,2)*(1-n)+Gi(h,2)*n),Vi(Gi(o,2)*(1-n)+Gi(c,2)*n),"rgb")};var Wi=v;Ci.lab=function(t,e,n){var i=t.lab(),r=e.lab();return new Wi(i[0]+n*(r[0]-i[0]),i[1]+n*(r[1]-i[1]),i[2]+n*(r[2]-i[2]),"lab")};var ji=v,qi=function(t,e,n,i){var r,s,o,a,l,h,c,u,d,p,f,m,g;return"hsl"===i?(o=t.hsl(),a=e.hsl()):"hsv"===i?(o=t.hsv(),a=e.hsv()):"hcg"===i?(o=t.hcg(),a=e.hcg()):"hsi"===i?(o=t.hsi(),a=e.hsi()):"lch"===i||"hcl"===i?(i="hcl",o=t.hcl(),a=e.hcl()):"oklch"===i&&(o=t.oklch().reverse(),a=e.oklch().reverse()),"h"!==i.substr(0,1)&&"oklch"!==i||(l=(r=o)[0],c=r[1],d=r[2],h=(s=a)[0],u=s[1],p=s[2]),isNaN(l)||isNaN(h)?isNaN(l)?isNaN(h)?m=Number.NaN:(m=h,1!=d&&0!=d||"hsv"==i||(f=u)):(m=l,1!=p&&0!=p||"hsv"==i||(f=c)):m=l+n*(h>l&&h-l>180?h-(l+360):h<l&&l-h>180?h+360-l:h-l),void 0===f&&(f=c+n*(u-c)),g=d+n*(p-d),new ji("oklch"===i?[g,f,m]:[m,f,g],i)},Xi=qi,Yi=function(t,e,n){return Xi(t,e,n,"lch")};Ci.lch=Yi,Ci.hcl=Yi;var $i=v;Ci.num=function(t,e,n){var i=t.num(),r=e.num();return new $i(i+n*(r-i),"num")};var Ki=qi;Ci.hcg=function(t,e,n){return Ki(t,e,n,"hcg")};var Zi=qi;Ci.hsi=function(t,e,n){return Zi(t,e,n,"hsi")};var Ji=qi;Ci.hsl=function(t,e,n){return Ji(t,e,n,"hsl")};var Qi=qi;Ci.hsv=function(t,e,n){return Qi(t,e,n,"hsv")};var tr=v;Ci.oklab=function(t,e,n){var i=t.oklab(),r=e.oklab();return new tr(i[0]+n*(r[0]-i[0]),i[1]+n*(r[1]-i[1]),i[2]+n*(r[2]-i[2]),"oklab")};var er=qi;Ci.oklch=function(t,e,n){return er(t,e,n,"oklch")};var nr=v,ir=c.clip_rgb,rr=Math.pow,sr=Math.sqrt,or=Math.PI,ar=Math.cos,lr=Math.sin,hr=Math.atan2,cr=function(t,e){for(var n=t.length,i=[0,0,0,0],r=0;r<t.length;r++){var s=t[r],o=e[r]/n,a=s._rgb;i[0]+=rr(a[0],2)*o,i[1]+=rr(a[1],2)*o,i[2]+=rr(a[2],2)*o,i[3]+=a[3]*o}return i[0]=sr(i[0]),i[1]=sr(i[1]),i[2]=sr(i[2]),i[3]>.9999999&&(i[3]=1),new nr(ir(i))},ur=x,dr=c.type,pr=Math.pow,fr=function(t){var e="rgb",n=ur("#ccc"),i=0,r=[0,1],s=[],o=[0,0],a=!1,l=[],h=!1,c=0,u=1,d=!1,p={},f=!0,m=1,g=function(t){if((t=t||["#fff","#000"])&&"string"===dr(t)&&ur.brewer&&ur.brewer[t.toLowerCase()]&&(t=ur.brewer[t.toLowerCase()]),"array"===dr(t)){1===t.length&&(t=[t[0],t[0]]),t=t.slice(0);for(var e=0;e<t.length;e++)t[e]=ur(t[e]);s.length=0;for(var n=0;n<t.length;n++)s.push(n/(t.length-1))}return b(),l=t},v=function(t){return t},y=function(t){return t},x=function(t,i){var r,h;if(null==i&&(i=!1),isNaN(t)||null===t)return n;h=i?t:a&&a.length>2?function(t){if(null!=a){for(var e=a.length-1,n=0;n<e&&t>=a[n];)n++;return n-1}return 0}(t)/(a.length-2):u!==c?(t-c)/(u-c):1,h=y(h),i||(h=v(h)),1!==m&&(h=pr(h,m)),h=o[0]+h*(1-o[0]-o[1]),h=Math.min(1,Math.max(0,h));var d=Math.floor(1e4*h);if(f&&p[d])r=p[d];else{if("array"===dr(l))for(var g=0;g<s.length;g++){var x=s[g];if(h<=x){r=l[g];break}if(h>=x&&g===s.length-1){r=l[g];break}if(h>x&&h<s[g+1]){h=(h-x)/(s[g+1]-x),r=ur.interpolate(l[g],l[g+1],h,e);break}}else"function"===dr(l)&&(r=l(h));f&&(p[d]=r)}return r},b=function(){return p={}};g(t);var w=function(t){var e=ur(x(t));return h&&e[h]?e[h]():e};return w.classes=function(t){if(null!=t){if("array"===dr(t))a=t,r=[t[0],t[t.length-1]];else{var e=ur.analyze(r);a=0===t?[e.min,e.max]:ur.limits(e,"e",t)}return w}return a},w.domain=function(t){if(!arguments.length)return r;c=t[0],u=t[t.length-1],s=[];var e=l.length;if(t.length===e&&c!==u)for(var n=0,i=Array.from(t);n<i.length;n+=1){var o=i[n];s.push((o-c)/(u-c))}else{for(var a=0;a<e;a++)s.push(a/(e-1));if(t.length>2){var h=t.map((function(e,n){return n/(t.length-1)})),d=t.map((function(t){return(t-c)/(u-c)}));d.every((function(t,e){return h[e]===t}))||(y=function(t){if(t<=0||t>=1)return t;for(var e=0;t>=d[e+1];)e++;var n=(t-d[e])/(d[e+1]-d[e]);return h[e]+n*(h[e+1]-h[e])})}}return r=[c,u],w},w.mode=function(t){return arguments.length?(e=t,b(),w):e},w.range=function(t,e){return g(t),w},w.out=function(t){return h=t,w},w.spread=function(t){return arguments.length?(i=t,w):i},w.correctLightness=function(t){return null==t&&(t=!0),d=t,b(),v=d?function(t){for(var e=x(0,!0).lab()[0],n=x(1,!0).lab()[0],i=e>n,r=x(t,!0).lab()[0],s=e+(n-e)*t,o=r-s,a=0,l=1,h=20;Math.abs(o)>.01&&h-- >0;)i&&(o*=-1),o<0?(a=t,t+=.5*(l-t)):(l=t,t+=.5*(a-t)),o=(r=x(t,!0).lab()[0])-s;return t}:function(t){return t},w},w.padding=function(t){return null!=t?("number"===dr(t)&&(t=[t,t]),o=t,w):o},w.colors=function(e,n){arguments.length<2&&(n="hex");var i=[];if(0===arguments.length)i=l.slice(0);else if(1===e)i=[w(.5)];else if(e>1){var s=r[0],o=r[1]-s;i=mr(0,e,!1).map((function(t){return w(s+t/(e-1)*o)}))}else{t=[];var h=[];if(a&&a.length>2)for(var c=1,u=a.length,d=1<=u;d?c<u:c>u;d?c++:c--)h.push(.5*(a[c-1]+a[c]));else h=r;i=h.map((function(t){return w(t)}))}return ur[n]&&(i=i.map((function(t){return t[n]()}))),i},w.cache=function(t){return null!=t?(f=t,w):f},w.gamma=function(t){return null!=t?(m=t,w):m},w.nodata=function(t){return null!=t?(n=ur(t),w):n},w};function mr(t,e,n){for(var i=[],r=t<e,s=n?r?e+1:e-1:e,o=t;r?o<s:o>s;r?o++:o--)i.push(o);return i}var gr=v,vr=fr,yr=x,xr=function(t,e,n){if(!xr[n])throw new Error("unknown blend mode "+n);return xr[n](t,e)},br=function(t){return function(e,n){var i=yr(n).rgb(),r=yr(e).rgb();return yr.rgb(t(i,r))}},wr=function(t){return function(e,n){var i=[];return i[0]=t(e[0],n[0]),i[1]=t(e[1],n[1]),i[2]=t(e[2],n[2]),i}};xr.normal=br(wr((function(t){return t}))),xr.multiply=br(wr((function(t,e){return t*e/255}))),xr.screen=br(wr((function(t,e){return 255*(1-(1-t/255)*(1-e/255))}))),xr.overlay=br(wr((function(t,e){return e<128?2*t*e/255:255*(1-2*(1-t/255)*(1-e/255))}))),xr.darken=br(wr((function(t,e){return t>e?e:t}))),xr.lighten=br(wr((function(t,e){return t>e?t:e}))),xr.dodge=br(wr((function(t,e){return 255===t||(t=e/255*255/(1-t/255))>255?255:t}))),xr.burn=br(wr((function(t,e){return 255*(1-(1-e/255)/(t/255))})));for(var _r=xr,Mr=c.type,Sr=c.clip_rgb,Tr=c.TWOPI,Er=Math.pow,Ar=Math.sin,Cr=Math.cos,Pr=x,Rr=v,Lr=Math.floor,Ir=Math.random,Dr=o,Or=Math.log,Br=Math.pow,Nr=Math.floor,zr=Math.abs,kr=function(t,e){void 0===e&&(e=null);var n={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};return"object"===Dr(t)&&(t=Object.values(t)),t.forEach((function(t){e&&"object"===Dr(t)&&(t=t[e]),null==t||isNaN(t)||(n.values.push(t),n.sum+=t,t<n.min&&(n.min=t),t>n.max&&(n.max=t),n.count+=1)})),n.domain=[n.min,n.max],n.limits=function(t,e){return Fr(n,t,e)},n},Fr=function(t,e,n){void 0===e&&(e="equal"),void 0===n&&(n=7),"array"==Dr(t)&&(t=kr(t));var i=t.min,r=t.max,s=t.values.sort((function(t,e){return t-e}));if(1===n)return[i,r];var o=[];if("c"===e.substr(0,1)&&(o.push(i),o.push(r)),"e"===e.substr(0,1)){o.push(i);for(var a=1;a<n;a++)o.push(i+a/n*(r-i));o.push(r)}else if("l"===e.substr(0,1)){if(i<=0)throw new Error("Logarithmic scales are only possible for values > 0");var l=Math.LOG10E*Or(i),h=Math.LOG10E*Or(r);o.push(i);for(var c=1;c<n;c++)o.push(Br(10,l+c/n*(h-l)));o.push(r)}else if("q"===e.substr(0,1)){o.push(i);for(var u=1;u<n;u++){var d=(s.length-1)*u/n,p=Nr(d);if(p===d)o.push(s[p]);else{var f=d-p;o.push(s[p]*(1-f)+s[p+1]*f)}}o.push(r)}else if("k"===e.substr(0,1)){var m,g=s.length,v=new Array(g),y=new Array(n),x=!0,b=0,w=null;(w=[]).push(i);for(var _=1;_<n;_++)w.push(i+_/n*(r-i));for(w.push(r);x;){for(var M=0;M<n;M++)y[M]=0;for(var S=0;S<g;S++)for(var T=s[S],E=Number.MAX_VALUE,A=void 0,C=0;C<n;C++){var P=zr(w[C]-T);P<E&&(E=P,A=C),y[A]++,v[S]=A}for(var R=new Array(n),L=0;L<n;L++)R[L]=null;for(var I=0;I<g;I++)null===R[m=v[I]]?R[m]=s[I]:R[m]+=s[I];for(var D=0;D<n;D++)R[D]*=1/y[D];x=!1;for(var O=0;O<n;O++)if(R[O]!==w[O]){x=!0;break}w=R,++b>200&&(x=!1)}for(var B={},N=0;N<n;N++)B[N]=[];for(var z=0;z<g;z++)B[m=v[z]].push(s[z]);for(var k=[],F=0;F<n;F++)k.push(B[F][0]),k.push(B[F][B[F].length-1]);k=k.sort((function(t,e){return t-e})),o.push(k[0]);for(var U=1;U<k.length;U+=2){var H=k[U];isNaN(H)||-1!==o.indexOf(H)||o.push(H)}}return o},Ur={analyze:kr,limits:Fr},Hr=v,Vr=v,Gr=Math.sqrt,Wr=Math.pow,jr=Math.min,qr=Math.max,Xr=Math.atan2,Yr=Math.abs,$r=Math.cos,Kr=Math.sin,Zr=Math.exp,Jr=Math.PI,Qr=v,ts=v,es=x,ns=fr,is={cool:function(){return ns([es.hsl(180,1,.9),es.hsl(250,.7,.4)])},hot:function(){return ns(["#000","#f00","#ff0","#fff"]).mode("rgb")}},rs={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},ss=0,os=Object.keys(rs);ss<os.length;ss+=1){var as=os[ss];rs[as.toLowerCase()]=rs[as]}var ls=rs,hs=x;return hs.average=function(t,e,n){void 0===e&&(e="lrgb"),void 0===n&&(n=null);var i=t.length;n||(n=Array.from(new Array(i)).map((function(){return 1})));var r=i/n.reduce((function(t,e){return t+e}));if(n.forEach((function(t,e){n[e]*=r})),t=t.map((function(t){return new nr(t)})),"lrgb"===e)return cr(t,n);for(var s=t.shift(),o=s.get(e),a=[],l=0,h=0,c=0;c<o.length;c++)if(o[c]=(o[c]||0)*n[0],a.push(isNaN(o[c])?0:n[0]),"h"===e.charAt(c)&&!isNaN(o[c])){var u=o[c]/180*or;l+=ar(u)*n[0],h+=lr(u)*n[0]}var d=s.alpha()*n[0];t.forEach((function(t,i){var r=t.get(e);d+=t.alpha()*n[i+1];for(var s=0;s<o.length;s++)if(!isNaN(r[s]))if(a[s]+=n[i+1],"h"===e.charAt(s)){var c=r[s]/180*or;l+=ar(c)*n[i+1],h+=lr(c)*n[i+1]}else o[s]+=r[s]*n[i+1]}));for(var p=0;p<o.length;p++)if("h"===e.charAt(p)){for(var f=hr(h/a[p],l/a[p])/or*180;f<0;)f+=360;for(;f>=360;)f-=360;o[p]=f}else o[p]=o[p]/a[p];return d/=i,new nr(o,e).alpha(d>.99999?1:d,!0)},hs.bezier=function(t){var e=function(t){var e,n,i,r,s,o,a;if(2===(t=t.map((function(t){return new gr(t)}))).length)e=t.map((function(t){return t.lab()})),s=e[0],o=e[1],r=function(t){var e=[0,1,2].map((function(e){return s[e]+t*(o[e]-s[e])}));return new gr(e,"lab")};else if(3===t.length)n=t.map((function(t){return t.lab()})),s=n[0],o=n[1],a=n[2],r=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*s[e]+2*(1-t)*t*o[e]+t*t*a[e]}));return new gr(e,"lab")};else if(4===t.length){var l;i=t.map((function(t){return t.lab()})),s=i[0],o=i[1],a=i[2],l=i[3],r=function(t){var e=[0,1,2].map((function(e){return(1-t)*(1-t)*(1-t)*s[e]+3*(1-t)*(1-t)*t*o[e]+3*(1-t)*t*t*a[e]+t*t*t*l[e]}));return new gr(e,"lab")}}else{if(!(t.length>=5))throw new RangeError("No point in running bezier with only one color.");var h,c,u;h=t.map((function(t){return t.lab()})),u=t.length-1,c=function(t){for(var e=[1,1],n=1;n<t;n++){for(var i=[1],r=1;r<=e.length;r++)i[r]=(e[r]||0)+e[r-1];e=i}return e}(u),r=function(t){var e=1-t,n=[0,1,2].map((function(n){return h.reduce((function(i,r,s){return i+c[s]*Math.pow(e,u-s)*Math.pow(t,s)*r[n]}),0)}));return new gr(n,"lab")}}return r}(t);return e.scale=function(){return vr(e)},e},hs.blend=_r,hs.cubehelix=function(t,e,n,i,r){void 0===t&&(t=300),void 0===e&&(e=-1.5),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=[0,1]);var s,o=0;"array"===Mr(r)?s=r[1]-r[0]:(s=0,r=[r,r]);var a=function(a){var l=Tr*((t+120)/360+e*a),h=Er(r[0]+s*a,i),c=(0!==o?n[0]+a*o:n)*h*(1-h)/2,u=Cr(l),d=Ar(l);return Pr(Sr([255*(h+c*(-.14861*u+1.78277*d)),255*(h+c*(-.29227*u-.90649*d)),255*(h+c*(1.97294*u)),1]))};return a.start=function(e){return null==e?t:(t=e,a)},a.rotations=function(t){return null==t?e:(e=t,a)},a.gamma=function(t){return null==t?i:(i=t,a)},a.hue=function(t){return null==t?n:("array"===Mr(n=t)?0==(o=n[1]-n[0])&&(n=n[1]):o=0,a)},a.lightness=function(t){return null==t?r:("array"===Mr(t)?(r=t,s=t[1]-t[0]):(r=[t,t],s=0),a)},a.scale=function(){return Pr.scale(a)},a.hue(n),a},hs.mix=hs.interpolate=Ii,hs.random=function(){for(var t="#",e=0;e<6;e++)t+="0123456789abcdef".charAt(Lr(16*Ir()));return new Rr(t,"hex")},hs.scale=fr,hs.analyze=Ur.analyze,hs.contrast=function(t,e){t=new Hr(t),e=new Hr(e);var n=t.luminance(),i=e.luminance();return n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)},hs.deltaE=function(t,e,n,i,r){void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=1);var s=function(t){return 360*t/(2*Jr)},o=function(t){return 2*Jr*t/360};t=new Vr(t),e=new Vr(e);var a=Array.from(t.lab()),l=a[0],h=a[1],c=a[2],u=Array.from(e.lab()),d=u[0],p=u[1],f=u[2],m=(l+d)/2,g=(Gr(Wr(h,2)+Wr(c,2))+Gr(Wr(p,2)+Wr(f,2)))/2,v=.5*(1-Gr(Wr(g,7)/(Wr(g,7)+Wr(25,7)))),y=h*(1+v),x=p*(1+v),b=Gr(Wr(y,2)+Wr(c,2)),w=Gr(Wr(x,2)+Wr(f,2)),_=(b+w)/2,M=s(Xr(c,y)),S=s(Xr(f,x)),T=M>=0?M:M+360,E=S>=0?S:S+360,A=Yr(T-E)>180?(T+E+360)/2:(T+E)/2,C=1-.17*$r(o(A-30))+.24*$r(o(2*A))+.32*$r(o(3*A+6))-.2*$r(o(4*A-63)),P=E-T;P=Yr(P)<=180?P:E<=T?P+360:P-360,P=2*Gr(b*w)*Kr(o(P)/2);var R=d-l,L=w-b,I=1+.015*Wr(m-50,2)/Gr(20+Wr(m-50,2)),D=1+.045*_,O=1+.015*_*C,B=30*Zr(-Wr((A-275)/25,2)),N=-2*Gr(Wr(_,7)/(Wr(_,7)+Wr(25,7)))*Kr(2*o(B)),z=Gr(Wr(R/(n*I),2)+Wr(L/(i*D),2)+Wr(P/(r*O),2)+N*(L/(i*D))*(P/(r*O)));return qr(0,jr(100,z))},hs.distance=function(t,e,n){void 0===n&&(n="lab"),t=new Qr(t),e=new Qr(e);var i=t.get(n),r=e.get(n),s=0;for(var o in i){var a=(i[o]||0)-(r[o]||0);s+=a*a}return Math.sqrt(s)},hs.limits=Ur.limits,hs.valid=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];try{return new(Function.prototype.bind.apply(ts,[null].concat(t))),!0}catch(t){return!1}},hs.scales=is,hs.colors=dn,hs.brewer=ls,hs}()},477:(t,e,n)=>{"use strict";n.d(e,{$V:()=>uh,A5E:()=>Ah,CdI:()=>d,D1R:()=>T,DvJ:()=>Hn,EJi:()=>qa,F5T:()=>on,FM8:()=>yt,IOt:()=>Z,Ilk:()=>It,Kj0:()=>Fn,LY2:()=>p,Ltg:()=>Ft,M8C:()=>vt,Mig:()=>Ul,N$j:()=>uo,NMF:()=>H,OdW:()=>go,OoA:()=>x,Ox3:()=>Fl,PMe:()=>Il,Pa4:()=>Wt,QRU:()=>Wl,QmN:()=>s,Qpg:()=>wh,ROQ:()=>Uo,RSm:()=>$a,RsA:()=>r,SUY:()=>Xl,Syv:()=>U,TUv:()=>co,TlE:()=>cn,Tme:()=>qe,TyD:()=>b,UY4:()=>Do,UZH:()=>i,UlW:()=>q,V1s:()=>qn,VzW:()=>P,W2J:()=>et,WMw:()=>c,WdD:()=>li,Wid:()=>ja,Wl3:()=>a,YLQ:()=>w,ZAu:()=>Rs,Zp0:()=>Gl,ZzF:()=>Xt,_12:()=>ai,_C8:()=>el,_am:()=>$n,_fP:()=>Gt,_kC:()=>Tl,a$l:()=>pn,aH4:()=>_,aLr:()=>de,aNw:()=>yl,anP:()=>Ti,b5g:()=>zs,blk:()=>Io,cBI:()=>Th,cBK:()=>_l,cLu:()=>R,cPb:()=>Xn,cek:()=>zl,dUE:()=>ll,dd2:()=>Ut,dj0:()=>nt,dpR:()=>Sl,dwk:()=>o,ehD:()=>l,ejS:()=>Lo,fHI:()=>la,hEm:()=>B,hH6:()=>bl,iKG:()=>vi,iLg:()=>cl,iMs:()=>lh,iUV:()=>sh,jFi:()=>h,jyz:()=>jn,kB5:()=>Gs,knz:()=>$,lLk:()=>gl,lRF:()=>Ms,m7l:()=>pl,mSO:()=>K,nls:()=>_o,pBf:()=>st,qyh:()=>S,rDY:()=>Wn,rnI:()=>Y,rpg:()=>v,u9r:()=>wn,uWy:()=>y,vBJ:()=>an,vmT:()=>El,vpT:()=>Hs,wem:()=>M,wk1:()=>I,woe:()=>ko,x12:()=>Co,xEZ:()=>kt,xo$:()=>Va,xsS:()=>Us,y8_:()=>Eh,yC1:()=>dl,yGw:()=>we,yo9:()=>ks,yxD:()=>Ml,z$h:()=>X});const i="140",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=3,a=0,l=2,h=0,c=2,u=100,d=2,p=4,f=301,m=302,g=306,v=1e3,y=1001,x=1002,b=1003,w=1004,_=1005,M=1006,S=1007,T=1008,E=1009,A=1012,C=1014,P=1015,R=1016,L=1020,I=1023,D=1026,O=1027,B=1028,N=33776,z=33777,k=33778,F=33779,U=2300,H=2301,V=2302,G=2400,W=2401,j=2402,q=1,X=2,Y=3e3,$=3001,K=3201,Z=0,J="srgb",Q="srgb-linear",tt=7680,et=35044,nt=35048,it="300 es",rt=1035;class st{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const ot=[];for(let t=0;t<256;t++)ot[t]=(t<16?"0":"")+t.toString(16);let at=1234567;const lt=Math.PI/180,ht=180/Math.PI;function ct(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ot[255&t]+ot[t>>8&255]+ot[t>>16&255]+ot[t>>24&255]+"-"+ot[255&e]+ot[e>>8&255]+"-"+ot[e>>16&15|64]+ot[e>>24&255]+"-"+ot[63&n|128]+ot[n>>8&255]+"-"+ot[n>>16&255]+ot[n>>24&255]+ot[255&i]+ot[i>>8&255]+ot[i>>16&255]+ot[i>>24&255]).toLowerCase()}function ut(t,e,n){return Math.max(e,Math.min(n,t))}function dt(t,e){return(t%e+e)%e}function pt(t,e,n){return(1-n)*t+n*e}function ft(t){return 0==(t&t-1)&&0!==t}function mt(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function gt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var vt=Object.freeze({__proto__:null,DEG2RAD:lt,RAD2DEG:ht,generateUUID:ct,clamp:ut,euclideanModulo:dt,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:pt,damp:function(t,e,n,i){return pt(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(dt(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(at=t);let e=at+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*lt},radToDeg:function(t){return t*ht},isPowerOfTwo:ft,ceilPowerOfTwo:mt,floorPowerOfTwo:gt,setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),h=s((e+i)/2),c=o((e+i)/2),u=s((e-i)/2),d=o((e-i)/2),p=s((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":t.set(a*c,l*u,l*d,a*h);break;case"YZY":t.set(l*d,a*c,l*u,a*h);break;case"ZXZ":t.set(l*u,l*d,a*c,a*h);break;case"XZX":t.set(a*c,l*f,l*p,a*h);break;case"YXY":t.set(l*p,a*c,l*f,a*h);break;case"ZYZ":t.set(l*f,l*p,a*c,a*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}},denormalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}});class yt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}yt.prototype.isVector2=!0;class xt{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,l){const h=this.elements;return h[0]=t,h[1]=i,h[2]=o,h[3]=e,h[4]=r,h[5]=a,h[6]=n,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],h=n[4],c=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],w=i[5],_=i[8];return r[0]=s*f+o*v+a*b,r[3]=s*m+o*y+a*w,r[6]=s*g+o*x+a*_,r[1]=l*f+h*v+c*b,r[4]=l*m+h*y+c*w,r[7]=l*g+h*x+c*_,r[2]=u*f+d*v+p*b,r[5]=u*m+d*y+p*w,r[8]=u*g+d*x+p*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8];return e*s*h-e*o*l-n*r*h+n*o*a+i*r*l-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=h*s-o*l,u=o*a-h*r,d=l*r-s*a,p=e*c+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(i*l-h*n)*f,t[2]=(o*n-i*s)*f,t[3]=u*f,t[4]=(h*e-i*a)*f,t[5]=(i*r-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-i*l,i*a,-i*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],s=i[3],o=i[6],a=i[1],l=i[4],h=i[7];return i[0]=e*r+n*a,i[3]=e*s+n*l,i[6]=e*o+n*h,i[1]=-n*r+e*a,i[4]=-n*s+e*l,i[7]=-n*o+e*h,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function bt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function wt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function _t(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Mt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}xt.prototype.isMatrix3=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const St={[J]:{[Q]:_t},[Q]:{[J]:Mt}},Tt={legacyMode:!0,get workingColorSpace(){return Q},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,n){if(this.legacyMode||e===n||!e||!n)return t;if(St[e]&&void 0!==St[e][n]){const i=St[e][n];return t.r=i(t.r),t.g=i(t.g),t.b=i(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Et={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},At={r:0,g:0,b:0},Ct={h:0,s:0,l:0},Pt={h:0,s:0,l:0};function Rt(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function Lt(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class It{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Tt.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i="srgb-linear"){return this.r=t,this.g=e,this.b=n,Tt.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i="srgb-linear"){if(t=dt(t,1),e=ut(e,0,1),n=ut(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Rt(r,i,t+1/3),this.g=Rt(r,i,t),this.b=Rt(r,i,t-1/3)}return Tt.toWorkingColorSpace(this,i),this}setStyle(t,e="srgb"){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Tt.toWorkingColorSpace(this,e),n(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Tt.toWorkingColorSpace(this,e),n(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100;return n(t[4]),this.setHSL(i,r,s,e)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=i[1],n=t.length;if(3===n)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Tt.toWorkingColorSpace(this,e),this;if(6===n)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Tt.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const n=Et[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=_t(t.r),this.g=_t(t.g),this.b=_t(t.b),this}copyLinearToSRGB(t){return this.r=Mt(t.r),this.g=Mt(t.g),this.b=Mt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return Tt.fromWorkingColorSpace(Lt(this,At),t),ut(255*At.r,0,255)<<16^ut(255*At.g,0,255)<<8^ut(255*At.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){Tt.fromWorkingColorSpace(Lt(this,At),e);const n=At.r,i=At.g,r=At.b,s=Math.max(n,i,r),o=Math.min(n,i,r);let a,l;const h=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=h<=.5?t/(s+o):t/(2-s-o),s){case n:a=(i-r)/t+(i<r?6:0);break;case i:a=(r-n)/t+2;break;case r:a=(n-i)/t+4}a/=6}return t.h=a,t.s=l,t.l=h,t}getRGB(t,e="srgb-linear"){return Tt.fromWorkingColorSpace(Lt(this,At),e),t.r=At.r,t.g=At.g,t.b=At.b,t}getStyle(t="srgb"){return Tt.fromWorkingColorSpace(Lt(this,At),t),t!==J?`color(${t} ${At.r} ${At.g} ${At.b})`:`rgb(${255*At.r|0},${255*At.g|0},${255*At.b|0})`}offsetHSL(t,e,n){return this.getHSL(Ct),Ct.h+=t,Ct.s+=e,Ct.l+=n,this.setHSL(Ct.h,Ct.s,Ct.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Ct),t.getHSL(Pt);const n=pt(Ct.h,Pt.h,e),i=pt(Ct.s,Pt.s,e),r=pt(Ct.l,Pt.l,e);return this.setHSL(n,i,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Dt;It.NAMES=Et,It.prototype.isColor=!0,It.prototype.r=1,It.prototype.g=1,It.prototype.b=1;class Ot{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Dt&&(Dt=wt("canvas")),Dt.width=t.width,Dt.height=t.height;const n=Dt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Dt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=wt("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*_t(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*_t(e[t]/255)):e[t]=_t(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Bt{constructor(t=null){this.uuid=ct(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(Nt(i[e].image)):t.push(Nt(i[e]))}else t=Nt(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function Nt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Ot.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Bt.prototype.isSource=!0;let zt=0;class kt extends st{constructor(t=kt.DEFAULT_IMAGE,e=kt.DEFAULT_MAPPING,n=y,i=y,r=M,s=T,o=I,a=1009,l=1,h=Y){super(),Object.defineProperty(this,"id",{value:zt++}),this.uuid=ct(),this.name="",this.source=new Bt(t),this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new yt(0,0),this.repeat=new yt(1,1),this.center=new yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case v:t.x=t.x-Math.floor(t.x);break;case y:t.x=t.x<0?0:1;break;case x:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case v:t.y=t.y-Math.floor(t.y);break;case y:t.y=t.y<0?0:1;break;case x:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}kt.DEFAULT_IMAGE=null,kt.DEFAULT_MAPPING=300,kt.prototype.isTexture=!0;class Ft{constructor(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,o=.1,a=t.elements,l=a[0],h=a[4],c=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(h-u)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(h+u)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(h+u)/4,x=(c+f)/4,b=(p+m)/4;return t>a&&t>v?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=y/n,r=x/n):a>v?a<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=b/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=b/r),this.set(n,i,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-h)*(u-h));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(u-h)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Ft.prototype.isVector4=!0;class Ut extends st{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Ft(0,0,t,e),this.scissorTest=!1,this.viewport=new Ft(0,0,t,e);const i={width:t,height:e,depth:1};this.texture=new kt(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:M,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ut.prototype.isWebGLRenderTarget=!0;class Ht extends kt{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=b,this.minFilter=b,this.wrapR=y,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ht.prototype.isDataArrayTexture=!0,class extends Ut{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new Ht(null,t,e,n),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class Vt extends kt{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=b,this.minFilter=b,this.wrapR=y,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Vt.prototype.isData3DTexture=!0,class extends Ut{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new Vt(null,t,e,n),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class extends Ut{constructor(t,e,n,i={}){super(t,e,i);const r=this.texture;this.texture=[];for(let t=0;t<n;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=t,this.texture[i].image.height=e,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}.prototype.isWebGLMultipleRenderTargets=!0;class Gt{constructor(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}static slerp(t,e,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,i)}static slerpFlat(t,e,n,i,r,s,o){let a=n[i+0],l=n[i+1],h=n[i+2],c=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||a!==u||l!==d||h!==p){let t=1-o;const e=a*u+l*d+h*p+c*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+h*h+c*c);a*=t,l*=t,h*=t,c*=t}}t[e]=a,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,i,r,s){const o=n[i],a=n[i+1],l=n[i+2],h=n[i+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=o*p+h*c+a*d-l*u,t[e+1]=a*p+h*u+l*c-o*d,t[e+2]=l*p+h*d+o*u-a*c,t[e+3]=h*p-o*c-a*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),h=o(i/2),c=o(r/2),u=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],h=e[6],c=e[10],u=n+o+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-a)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>o&&n>c){const t=2*Math.sqrt(1+n-o-c);this._w=(h-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(o>c){const t=2*Math.sqrt(1+o-n-c);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+h)/t}else{const t=2*Math.sqrt(1+c-n-o);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(a+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ut(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,h=e._w;return this._x=n*h+s*o+i*l-r*a,this._y=i*h+s*a+r*o-n*l,this._z=r*h+s*l+n*a-i*o,this._w=s*h-n*o-i*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),h=Math.atan2(l,o),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=n*c+this._x*u,this._y=i*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}Gt.prototype.isQuaternion=!0;class Wt{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(qt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(qt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*i-o*n,h=a*n+o*e-r*i,c=a*i+r*n-s*e,u=-r*e-s*n-o*i;return this.x=l*a+u*-r+h*-o-c*-s,this.y=h*a+u*-s+c*-r-l*-o,this.z=c*a+u*-o+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return jt.copy(this).projectOnVector(t),this.sub(jt)}reflect(t){return this.sub(jt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ut(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Wt.prototype.isVector3=!0;const jt=new Wt,qt=new Gt;class Xt{constructor(t=new Wt(1/0,1/0,1/0),e=new Wt(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=3){const l=t[a],h=t[a+1],c=t[a+2];l<e&&(e=l),h<n&&(n=h),c<i&&(i=c),l>r&&(r=l),h>s&&(s=h),c>o&&(o=c)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=t.count;a<l;a++){const l=t.getX(a),h=t.getY(a),c=t.getZ(a);l<e&&(e=l),h<n&&(n=h),c<i&&(i=c),l>r&&(r=l),h>s&&(s=h),c>o&&(o=c)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=$t.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n)if(e&&null!=n.attributes&&void 0!==n.attributes.position){const e=n.attributes.position;for(let n=0,i=e.count;n<i;n++)$t.fromBufferAttribute(e,n).applyMatrix4(t.matrixWorld),this.expandByPoint($t)}else null===n.boundingBox&&n.computeBoundingBox(),Kt.copy(n.boundingBox),Kt.applyMatrix4(t.matrixWorld),this.union(Kt);const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,$t),$t.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ie),re.subVectors(this.max,ie),Zt.subVectors(t.a,ie),Jt.subVectors(t.b,ie),Qt.subVectors(t.c,ie),te.subVectors(Jt,Zt),ee.subVectors(Qt,Jt),ne.subVectors(Zt,Qt);let e=[0,-te.z,te.y,0,-ee.z,ee.y,0,-ne.z,ne.y,te.z,0,-te.x,ee.z,0,-ee.x,ne.z,0,-ne.x,-te.y,te.x,0,-ee.y,ee.x,0,-ne.y,ne.x,0];return!!ae(e,Zt,Jt,Qt,re)&&(e=[1,0,0,0,1,0,0,0,1],!!ae(e,Zt,Jt,Qt,re)&&(se.crossVectors(te,ee),e=[se.x,se.y,se.z],ae(e,Zt,Jt,Qt,re)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return $t.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize($t).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Yt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Yt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Yt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Yt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Yt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Yt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Yt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Yt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Yt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Xt.prototype.isBox3=!0;const Yt=[new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt],$t=new Wt,Kt=new Xt,Zt=new Wt,Jt=new Wt,Qt=new Wt,te=new Wt,ee=new Wt,ne=new Wt,ie=new Wt,re=new Wt,se=new Wt,oe=new Wt;function ae(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){oe.fromArray(t,s);const o=r.x*Math.abs(oe.x)+r.y*Math.abs(oe.y)+r.z*Math.abs(oe.z),a=e.dot(oe),l=n.dot(oe),h=i.dot(oe);if(Math.max(-Math.max(a,l,h),Math.min(a,l,h))>o)return!1}return!0}const le=new Xt,he=new Wt,ce=new Wt,ue=new Wt;class de{constructor(t=new Wt,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):le.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){ue.subVectors(t,this.center);const e=ue.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(ue.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return!0===this.center.equals(t.center)?ce.set(0,0,1).multiplyScalar(t.radius):ce.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(he.copy(t.center).add(ce)),this.expandByPoint(he.copy(t.center).sub(ce)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const pe=new Wt,fe=new Wt,me=new Wt,ge=new Wt,ve=new Wt,ye=new Wt,xe=new Wt;class be{constructor(t=new Wt,e=new Wt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,pe)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=pe.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(pe.copy(this.direction).multiplyScalar(e).add(this.origin),pe.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){fe.copy(t).add(e).multiplyScalar(.5),me.copy(e).sub(t).normalize(),ge.copy(this.origin).sub(fe);const r=.5*t.distanceTo(e),s=-this.direction.dot(me),o=ge.dot(this.direction),a=-ge.dot(me),l=ge.lengthSq(),h=Math.abs(1-s*s);let c,u,d,p;if(h>0)if(c=s*a-o,u=s*o-a,p=r*h,c>=0)if(u>=-p)if(u<=p){const t=1/h;c*=t,u*=t,d=c*(c+s*u+2*o)+u*(s*c+u+2*a)+l}else u=r,c=Math.max(0,-(s*u+o)),d=-c*c+u*(u+2*a)+l;else u=-r,c=Math.max(0,-(s*u+o)),d=-c*c+u*(u+2*a)+l;else u<=-p?(c=Math.max(0,-(-s*r+o)),u=c>0?-r:Math.min(Math.max(-r,-a),r),d=-c*c+u*(u+2*a)+l):u<=p?(c=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(c=Math.max(0,-(s*r+o)),u=c>0?r:Math.min(Math.max(-r,-a),r),d=-c*c+u*(u+2*a)+l);else u=s>0?-r:r,c=Math.max(0,-(s*u+o)),d=-c*c+u*(u+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),i&&i.copy(me).multiplyScalar(u).add(fe),d}intersectSphere(t,e){pe.subVectors(t.center,this.origin);const n=pe.dot(this.direction),i=pe.dot(pe)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,o,a;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,s=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,s=(t.min.y-u.y)*h),n>s||r>i?null:((r>n||n!=n)&&(n=r),(s<i||i!=i)&&(i=s),c>=0?(o=(t.min.z-u.z)*c,a=(t.max.z-u.z)*c):(o=(t.max.z-u.z)*c,a=(t.min.z-u.z)*c),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,pe)}intersectTriangle(t,e,n,i,r){ve.subVectors(e,t),ye.subVectors(n,t),xe.crossVectors(ve,ye);let s,o=this.direction.dot(xe);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}ge.subVectors(this.origin,t);const a=s*this.direction.dot(ye.crossVectors(ge,ye));if(a<0)return null;const l=s*this.direction.dot(ve.cross(ge));if(l<0)return null;if(a+l>o)return null;const h=-s*ge.dot(xe);return h<0?null:this.at(h/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class we{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,l,h,c,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new we).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/_e.setFromMatrixColumn(t,0).length(),r=1/_e.setFromMatrixColumn(t,1).length(),s=1/_e.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,n=s*c,i=o*h,r=o*c;e[0]=a*h,e[4]=-a*c,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*h,n=a*c,i=l*h,r=l*c;e[0]=t+r*o,e[4]=i*o-n,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*h,n=a*c,i=l*h,r=l*c;e[0]=t-r*o,e[4]=-s*c,e[8]=i+n*o,e[1]=n+i*o,e[5]=s*h,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*h,n=s*c,i=o*h,r=o*c;e[0]=a*h,e[4]=i*l-n,e[8]=t*l+r,e[1]=a*c,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*h,e[4]=r-t*c,e[8]=i*c+n,e[1]=c,e[5]=s*h,e[9]=-o*h,e[2]=-l*h,e[6]=n*c+i,e[10]=t-r*c}else if("XZY"===t.order){const t=s*a,n=s*l,i=o*a,r=o*l;e[0]=a*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=n*c-i,e[2]=i*c-n,e[6]=o*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Se,t,Te)}lookAt(t,e,n){const i=this.elements;return Ce.subVectors(t,e),0===Ce.lengthSq()&&(Ce.z=1),Ce.normalize(),Ee.crossVectors(n,Ce),0===Ee.lengthSq()&&(1===Math.abs(n.z)?Ce.x+=1e-4:Ce.z+=1e-4,Ce.normalize(),Ee.crossVectors(n,Ce)),Ee.normalize(),Ae.crossVectors(Ce,Ee),i[0]=Ee.x,i[4]=Ae.x,i[8]=Ce.x,i[1]=Ee.y,i[5]=Ae.y,i[9]=Ce.y,i[2]=Ee.z,i[6]=Ae.z,i[10]=Ce.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],h=n[1],c=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],w=i[0],_=i[4],M=i[8],S=i[12],T=i[1],E=i[5],A=i[9],C=i[13],P=i[2],R=i[6],L=i[10],I=i[14],D=i[3],O=i[7],B=i[11],N=i[15];return r[0]=s*w+o*T+a*P+l*D,r[4]=s*_+o*E+a*R+l*O,r[8]=s*M+o*A+a*L+l*B,r[12]=s*S+o*C+a*I+l*N,r[1]=h*w+c*T+u*P+d*D,r[5]=h*_+c*E+u*R+d*O,r[9]=h*M+c*A+u*L+d*B,r[13]=h*S+c*C+u*I+d*N,r[2]=p*w+f*T+m*P+g*D,r[6]=p*_+f*E+m*R+g*O,r[10]=p*M+f*A+m*L+g*B,r[14]=p*S+f*C+m*I+g*N,r[3]=v*w+y*T+x*P+b*D,r[7]=v*_+y*E+x*R+b*O,r[11]=v*M+y*A+x*L+b*B,r[15]=v*S+y*C+x*I+b*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*a*c-i*l*c-r*o*u+n*l*u+i*o*d-n*a*d)+t[7]*(+e*a*d-e*l*u+r*s*u-i*s*d+i*l*h-r*a*h)+t[11]*(+e*l*c-e*o*d-r*s*c+n*s*d+r*o*h-n*l*h)+t[15]*(-i*o*h-e*a*c+e*o*u+i*s*c-n*s*u+n*a*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=c*m*l-f*u*l+f*a*d-o*m*d-c*a*g+o*u*g,y=p*u*l-h*m*l-p*a*d+s*m*d+h*a*g-s*u*g,x=h*f*l-p*c*l+p*o*d-s*f*d-h*o*g+s*c*g,b=p*c*a-h*f*a-p*o*u+s*f*u+h*o*m-s*c*m,w=e*v+n*y+i*x+r*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/w;return t[0]=v*_,t[1]=(f*u*r-c*m*r-f*i*d+n*m*d+c*i*g-n*u*g)*_,t[2]=(o*m*r-f*a*r+f*i*l-n*m*l-o*i*g+n*a*g)*_,t[3]=(c*a*r-o*u*r-c*i*l+n*u*l+o*i*d-n*a*d)*_,t[4]=y*_,t[5]=(h*m*r-p*u*r+p*i*d-e*m*d-h*i*g+e*u*g)*_,t[6]=(p*a*r-s*m*r-p*i*l+e*m*l+s*i*g-e*a*g)*_,t[7]=(s*u*r-h*a*r+h*i*l-e*u*l-s*i*d+e*a*d)*_,t[8]=x*_,t[9]=(p*c*r-h*f*r-p*n*d+e*f*d+h*n*g-e*c*g)*_,t[10]=(s*f*r-p*o*r+p*n*l-e*f*l-s*n*g+e*o*g)*_,t[11]=(h*o*r-s*c*r-h*n*l+e*c*l+s*n*d-e*o*d)*_,t[12]=b*_,t[13]=(h*f*i-p*c*i+p*n*u-e*f*u-h*n*m+e*c*m)*_,t[14]=(p*o*i-s*f*i-p*n*a+e*f*a+s*n*m-e*o*m)*_,t[15]=(s*c*i-h*o*i+h*n*a-e*c*a-s*n*u+e*o*u)*_,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,o=t.y,a=t.z,l=r*s,h=r*o;return this.set(l*s+n,l*o-i*a,l*a+i*o,0,l*o+i*a,h*o+n,h*a-i*s,0,l*a-i*o,h*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,h=s+s,c=o+o,u=r*l,d=r*h,p=r*c,f=s*h,m=s*c,g=o*c,v=a*l,y=a*h,x=a*c,b=n.x,w=n.y,_=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+x)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(d-x)*w,i[5]=(1-(u+g))*w,i[6]=(m+v)*w,i[7]=0,i[8]=(p+y)*_,i[9]=(m-v)*_,i[10]=(1-(u+f))*_,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=_e.set(i[0],i[1],i[2]).length();const s=_e.set(i[4],i[5],i[6]).length(),o=_e.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Me.copy(this);const a=1/r,l=1/s,h=1/o;return Me.elements[0]*=a,Me.elements[1]*=a,Me.elements[2]*=a,Me.elements[4]*=l,Me.elements[5]*=l,Me.elements[6]*=l,Me.elements[8]*=h,Me.elements[9]*=h,Me.elements[10]*=h,e.setFromRotationMatrix(Me),n.x=r,n.y=s,n.z=o,this}makePerspective(t,e,n,i,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(e-t),l=2*r/(n-i),h=(e+t)/(e-t),c=(n+i)/(n-i),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s){const o=this.elements,a=1/(e-t),l=1/(n-i),h=1/(s-r),c=(e+t)*a,u=(n+i)*l,d=(s+r)*h;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}we.prototype.isMatrix4=!0;const _e=new Wt,Me=new we,Se=new Wt(0,0,0),Te=new Wt(1,1,1),Ee=new Wt,Ae=new Wt,Ce=new Wt,Pe=new we,Re=new Gt;class Le{constructor(t=0,e=0,n=0,i=Le.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],h=i[9],c=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(ut(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ut(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(ut(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-ut(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ut(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-ut(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Pe.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Pe,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Re.setFromEuler(this),this.setFromQuaternion(Re,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Le.prototype.isEuler=!0,Le.DefaultOrder="XYZ",Le.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ie{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let De=0;const Oe=new Wt,Be=new Gt,Ne=new we,ze=new Wt,ke=new Wt,Fe=new Wt,Ue=new Gt,He=new Wt(1,0,0),Ve=new Wt(0,1,0),Ge=new Wt(0,0,1),We={type:"added"},je={type:"removed"};class qe extends st{constructor(){super(),Object.defineProperty(this,"id",{value:De++}),this.uuid=ct(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qe.DefaultUp.clone();const t=new Wt,e=new Le,n=new Gt,i=new Wt(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new we},normalMatrix:{value:new xt}}),this.matrix=new we,this.matrixWorld=new we,this.matrixAutoUpdate=qe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ie,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Be.setFromAxisAngle(t,e),this.quaternion.multiply(Be),this}rotateOnWorldAxis(t,e){return Be.setFromAxisAngle(t,e),this.quaternion.premultiply(Be),this}rotateX(t){return this.rotateOnAxis(He,t)}rotateY(t){return this.rotateOnAxis(Ve,t)}rotateZ(t){return this.rotateOnAxis(Ge,t)}translateOnAxis(t,e){return Oe.copy(t).applyQuaternion(this.quaternion),this.position.add(Oe.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(He,t)}translateY(t){return this.translateOnAxis(Ve,t)}translateZ(t){return this.translateOnAxis(Ge,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Ne.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?ze.copy(t):ze.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ke.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ne.lookAt(ke,ze,this.up):Ne.lookAt(ze,ke,this.up),this.quaternion.setFromRotationMatrix(Ne),i&&(Ne.extractRotation(i.matrixWorld),Be.setFromRotationMatrix(Ne),this.quaternion.premultiply(Be.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(We)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(je)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(je)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Ne.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ne.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ne),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ke,t,Fe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ke,Ue,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),h=s(t.animations),c=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),h.length>0&&(n.animations=h),c.length>0&&(n.nodes=c)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}qe.DefaultUp=new Wt(0,1,0),qe.DefaultMatrixAutoUpdate=!0,qe.prototype.isObject3D=!0;const Xe=new Wt,Ye=new Wt,$e=new Wt,Ke=new Wt,Ze=new Wt,Je=new Wt,Qe=new Wt,tn=new Wt,en=new Wt,nn=new Wt;class rn{constructor(t=new Wt,e=new Wt,n=new Wt){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Xe.subVectors(t,e),i.cross(Xe);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){Xe.subVectors(i,e),Ye.subVectors(n,e),$e.subVectors(t,e);const s=Xe.dot(Xe),o=Xe.dot(Ye),a=Xe.dot($e),l=Ye.dot(Ye),h=Ye.dot($e),c=s*l-o*o;if(0===c)return r.set(-2,-1,-1);const u=1/c,d=(l*a-o*h)*u,p=(s*h-o*a)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,Ke),Ke.x>=0&&Ke.y>=0&&Ke.x+Ke.y<=1}static getUV(t,e,n,i,r,s,o,a){return this.getBarycoord(t,e,n,i,Ke),a.set(0,0),a.addScaledVector(r,Ke.x),a.addScaledVector(s,Ke.y),a.addScaledVector(o,Ke.z),a}static isFrontFacing(t,e,n,i){return Xe.subVectors(n,e),Ye.subVectors(t,e),Xe.cross(Ye).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Xe.subVectors(this.c,this.b),Ye.subVectors(this.a,this.b),.5*Xe.cross(Ye).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return rn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return rn.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return rn.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return rn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return rn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,o;Ze.subVectors(i,n),Je.subVectors(r,n),tn.subVectors(t,n);const a=Ze.dot(tn),l=Je.dot(tn);if(a<=0&&l<=0)return e.copy(n);en.subVectors(t,i);const h=Ze.dot(en),c=Je.dot(en);if(h>=0&&c<=h)return e.copy(i);const u=a*c-h*l;if(u<=0&&a>=0&&h<=0)return s=a/(a-h),e.copy(n).addScaledVector(Ze,s);nn.subVectors(t,r);const d=Ze.dot(nn),p=Je.dot(nn);if(p>=0&&d<=p)return e.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(Je,o);const m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return Qe.subVectors(r,i),o=(c-h)/(c-h+(d-p)),e.copy(i).addScaledVector(Qe,o);const g=1/(m+f+u);return s=f*g,o=u*g,e.copy(n).addScaledVector(Ze,s).addScaledVector(Je,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let sn=0;class on extends st{constructor(){super(),Object.defineProperty(this,"id",{value:sn++}),this.uuid=ct(),this.name="",this.type="Material",this.blending=1,this.side=a,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=u,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tt,this.stencilZFail=tt,this.stencilZPass=tt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==a&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}on.prototype.isMaterial=!0,on.fromType=function(){return null};class an extends on{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new It(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}an.prototype.isMeshBasicMaterial=!0;const ln=new Wt,hn=new yt;class cn{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=et,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new It),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new yt),e[n++]=r.x,e[n++]=r.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Wt),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new Ft),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)hn.fromBufferAttribute(this,e),hn.applyMatrix3(t),this.setXY(e,hn.x,hn.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)ln.fromBufferAttribute(this,e),ln.applyMatrix3(t),this.setXYZ(e,ln.x,ln.y,ln.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)ln.fromBufferAttribute(this,e),ln.applyMatrix4(t),this.setXYZ(e,ln.x,ln.y,ln.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)ln.fromBufferAttribute(this,e),ln.applyNormalMatrix(t),this.setXYZ(e,ln.x,ln.y,ln.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)ln.fromBufferAttribute(this,e),ln.transformDirection(t),this.setXYZ(e,ln.x,ln.y,ln.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==et&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}cn.prototype.isBufferAttribute=!0;class un extends cn{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class dn extends cn{constructor(t,e,n){super(new Uint32Array(t),e,n)}}(class extends cn{constructor(t,e,n){super(new Uint16Array(t),e,n)}}).prototype.isFloat16BufferAttribute=!0;class pn extends cn{constructor(t,e,n){super(new Float32Array(t),e,n)}}let fn=0;const mn=new we,gn=new qe,vn=new Wt,yn=new Xt,xn=new Xt,bn=new Wt;class wn extends st{constructor(){super(),Object.defineProperty(this,"id",{value:fn++}),this.uuid=ct(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(bt(t)?dn:un)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new xt).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return mn.makeRotationFromQuaternion(t),this.applyMatrix4(mn),this}rotateX(t){return mn.makeRotationX(t),this.applyMatrix4(mn),this}rotateY(t){return mn.makeRotationY(t),this.applyMatrix4(mn),this}rotateZ(t){return mn.makeRotationZ(t),this.applyMatrix4(mn),this}translate(t,e,n){return mn.makeTranslation(t,e,n),this.applyMatrix4(mn),this}scale(t,e,n){return mn.makeScale(t,e,n),this.applyMatrix4(mn),this}lookAt(t){return gn.lookAt(t),gn.updateMatrix(),this.applyMatrix4(gn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vn).negate(),this.translate(vn.x,vn.y,vn.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new pn(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Xt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Wt(-1/0,-1/0,-1/0),new Wt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];yn.setFromBufferAttribute(n),this.morphTargetsRelative?(bn.addVectors(this.boundingBox.min,yn.min),this.boundingBox.expandByPoint(bn),bn.addVectors(this.boundingBox.max,yn.max),this.boundingBox.expandByPoint(bn)):(this.boundingBox.expandByPoint(yn.min),this.boundingBox.expandByPoint(yn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new de);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Wt,1/0);if(t){const n=this.boundingSphere.center;if(yn.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];xn.setFromBufferAttribute(n),this.morphTargetsRelative?(bn.addVectors(yn.min,xn.min),yn.expandByPoint(bn),bn.addVectors(yn.max,xn.max),yn.expandByPoint(bn)):(yn.expandByPoint(xn.min),yn.expandByPoint(xn.max))}yn.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)bn.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(bn));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)bn.fromBufferAttribute(s,e),o&&(vn.fromBufferAttribute(t,e),bn.add(vn)),i=Math.max(i,n.distanceToSquared(bn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new cn(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],h=[];for(let t=0;t<o;t++)l[t]=new Wt,h[t]=new Wt;const c=new Wt,u=new Wt,d=new Wt,p=new yt,f=new yt,m=new yt,g=new Wt,v=new Wt;function y(t,e,n){c.fromArray(i,3*t),u.fromArray(i,3*e),d.fromArray(i,3*n),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*n),u.sub(c),d.sub(c),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[n].add(g),h[t].add(v),h[e].add(v),h[n].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let t=0,e=x.length;t<e;++t){const e=x[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)y(n[t+0],n[t+1],n[t+2])}const b=new Wt,w=new Wt,_=new Wt,M=new Wt;function S(t){_.fromArray(r,3*t),M.copy(_);const e=l[t];b.copy(e),b.sub(_.multiplyScalar(_.dot(e))).normalize(),w.crossVectors(M,e);const n=w.dot(h[t])<0?-1:1;a[4*t]=b.x,a[4*t+1]=b.y,a[4*t+2]=b.z,a[4*t+3]=n}for(let t=0,e=x.length;t<e;++t){const e=x[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)S(n[t+0]),S(n[t+1]),S(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new cn(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Wt,r=new Wt,s=new Wt,o=new Wt,a=new Wt,l=new Wt,h=new Wt,c=new Wt;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),h.subVectors(s,r),c.subVectors(i,r),h.cross(c),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(h),a.add(h),l.add(h),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,r),c.subVectors(i,r),h.cross(c),n.setXYZ(t+0,h.x,h.y,h.z),n.setXYZ(t+1,h.x,h.y,h.z),n.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const r=n[i].array,s=t.attributes[i],o=s.array,a=s.itemSize*e,l=Math.min(o.length,r.length-a);for(let t=0,e=a;t<l;t++,e++)r[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)bn.fromBufferAttribute(t,e),bn.normalize(),t.setXYZ(e,bn.x,bn.y,bn.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let o=0,a=0;for(let r=0,l=e.length;r<l;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[a++]=n[o++]}return new cn(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new wn,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],o=r[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}wn.prototype.isBufferGeometry=!0;const _n=new we,Mn=new be,Sn=new de,Tn=new Wt,En=new Wt,An=new Wt,Cn=new Wt,Pn=new Wt,Rn=new Wt,Ln=new Wt,In=new Wt,Dn=new Wt,On=new yt,Bn=new yt,Nn=new yt,zn=new Wt,kn=new Wt;class Fn extends qe{constructor(t=new wn,e=new an){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Sn.copy(n.boundingSphere),Sn.applyMatrix4(r),!1===t.ray.intersectsSphere(Sn))return;if(_n.copy(r).invert(),Mn.copy(t.ray).applyMatrix4(_n),null!==n.boundingBox&&!1===Mn.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,h=n.attributes.uv,c=n.attributes.uv2,u=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=u.length;n<p;n++){const p=u[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));n<i;n+=3){const i=r.getX(n),u=r.getX(n+1),d=r.getX(n+2);s=Un(this,f,t,Mn,o,a,l,h,c,i,u,d),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else for(let n=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);n<u;n+=3){const u=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);s=Un(this,i,t,Mn,o,a,l,h,c,u,d,p),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else if(void 0!==o)if(Array.isArray(i))for(let n=0,r=u.length;n<r;n++){const r=u[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));n<i;n+=3)s=Un(this,p,t,Mn,o,a,l,h,c,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=r.materialIndex,e.push(s))}else for(let n=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);n<r;n+=3)s=Un(this,i,t,Mn,o,a,l,h,c,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Un(t,e,n,i,r,s,o,a,h,c,u,d){Tn.fromBufferAttribute(r,c),En.fromBufferAttribute(r,u),An.fromBufferAttribute(r,d);const p=t.morphTargetInfluences;if(s&&p){Ln.set(0,0,0),In.set(0,0,0),Dn.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=p[t],n=s[t];0!==e&&(Cn.fromBufferAttribute(n,c),Pn.fromBufferAttribute(n,u),Rn.fromBufferAttribute(n,d),o?(Ln.addScaledVector(Cn,e),In.addScaledVector(Pn,e),Dn.addScaledVector(Rn,e)):(Ln.addScaledVector(Cn.sub(Tn),e),In.addScaledVector(Pn.sub(En),e),Dn.addScaledVector(Rn.sub(An),e)))}Tn.add(Ln),En.add(In),An.add(Dn)}t.isSkinnedMesh&&(t.boneTransform(c,Tn),t.boneTransform(u,En),t.boneTransform(d,An));const f=function(t,e,n,i,r,s,o,a){let h;if(h=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,e.side!==l,a),null===h)return null;kn.copy(a),kn.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(kn);return c<n.near||c>n.far?null:{distance:c,point:kn.clone(),object:t}}(t,e,n,i,Tn,En,An,zn);if(f){a&&(On.fromBufferAttribute(a,c),Bn.fromBufferAttribute(a,u),Nn.fromBufferAttribute(a,d),f.uv=rn.getUV(zn,Tn,En,An,On,Bn,Nn,new yt)),h&&(On.fromBufferAttribute(h,c),Bn.fromBufferAttribute(h,u),Nn.fromBufferAttribute(h,d),f.uv2=rn.getUV(zn,Tn,En,An,On,Bn,Nn,new yt));const t={a:c,b:u,c:d,normal:new Wt,materialIndex:0};rn.getNormal(Tn,En,An,t.normal),f.face=t}return f}Fn.prototype.isMesh=!0;class Hn extends wn{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],h=[],c=[];let u=0,d=0;function p(t,e,n,i,r,s,p,f,m,g,v){const y=s/m,x=p/g,b=s/2,w=p/2,_=f/2,M=m+1,S=g+1;let T=0,E=0;const A=new Wt;for(let s=0;s<S;s++){const o=s*x-w;for(let a=0;a<M;a++){const u=a*y-b;A[t]=u*i,A[e]=o*r,A[n]=_,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,h.push(A.x,A.y,A.z),c.push(a/m),c.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=u+e+M*t,i=u+e+M*(t+1),r=u+(e+1)+M*(t+1),s=u+(e+1)+M*t;a.push(n,i,s),a.push(i,r,s),E+=6}o.addGroup(d,E,v),d+=E,u+=T}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new pn(l,3)),this.setAttribute("normal",new pn(h,3)),this.setAttribute("uv",new pn(c,2))}static fromJSON(t){return new Hn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Vn(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Gn(t){const e={};for(let n=0;n<t.length;n++){const i=Vn(t[n]);for(const t in i)e[t]=i[t]}return e}const Wn={clone:Vn,merge:Gn};class jn extends on{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Vn(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}jn.prototype.isShaderMaterial=!0;class qn extends qe{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new we,this.projectionMatrix=new we,this.projectionMatrixInverse=new we}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}qn.prototype.isCamera=!0;class Xn extends qn{constructor(t=50,e=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*ht*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*lt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*ht*Math.atan(Math.tan(.5*lt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*lt*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/o,i*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Xn.prototype.isPerspectiveCamera=!0;const Yn=90;class $n extends qe{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Xn(Yn,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Wt(1,0,0)),this.add(i);const r=new Xn(Yn,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Wt(-1,0,0)),this.add(r);const s=new Xn(Yn,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Wt(0,1,0)),this.add(s);const o=new Xn(Yn,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Wt(0,-1,0)),this.add(o);const a=new Xn(Yn,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Wt(0,0,1)),this.add(a);const l=new Xn(Yn,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Wt(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,o,a,l]=this.children,h=t.getRenderTarget(),c=t.toneMapping,u=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=d,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(h),t.toneMapping=c,t.xr.enabled=u,n.texture.needsPMREMUpdate=!0}}class Kn extends kt{constructor(t,e,n,i,r,s,o,a,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:f,n,i,r,s,o,a,l,h),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Kn.prototype.isCubeTexture=!0;class Zn extends Ut{constructor(t,e={}){super(t,t,e);const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new Kn(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:M}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new Hn(5,5,5),o=new jn({name:"CubemapFromEquirect",uniforms:Vn(n),vertexShader:i,fragmentShader:r,side:1,blending:h});o.uniforms.tEquirect.value=e;const a=new Fn(s,o),l=e.minFilter;return e.minFilter===T&&(e.minFilter=M),new $n(1,10,this).update(t,a),e.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}Zn.prototype.isWebGLCubeRenderTarget=!0;const Jn=new Wt,Qn=new Wt,ti=new xt;class ei{constructor(t=new Wt(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Jn.subVectors(n,e).cross(Qn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(Jn),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||ti.getNormalMatrix(t),i=this.coplanarPoint(Jn).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}ei.prototype.isPlane=!0;const ni=new de,ii=new Wt;class ri{constructor(t=new ei,e=new ei,n=new ei,i=new ei,r=new ei,s=new ei){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],h=n[6],c=n[7],u=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(o-i,c-a,f-u,y-m).normalize(),e[1].setComponents(o+i,c+a,f+u,y+m).normalize(),e[2].setComponents(o+r,c+l,f+d,y+g).normalize(),e[3].setComponents(o-r,c-l,f-d,y-g).normalize(),e[4].setComponents(o-s,c-h,f-p,y-v).normalize(),e[5].setComponents(o+s,c+h,f+p,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),ni.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(ni)}intersectsSprite(t){return ni.center.set(0,0,0),ni.radius=.7071067811865476,ni.applyMatrix4(t.matrixWorld),this.intersectsSphere(ni)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(ii.x=i.normal.x>0?t.max.x:t.min.x,ii.y=i.normal.y>0?t.max.y:t.min.y,ii.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(ii)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function si(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function oi(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);void 0===s?i.set(e,function(e,i){const r=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback(),r instanceof Float32Array)a=5126;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(r instanceof Int16Array)a=5122;else if(r instanceof Uint32Array)a=5125;else if(r instanceof Int32Array)a=5124;else if(r instanceof Int8Array)a=5120;else if(r instanceof Uint8Array)a=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=5121}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function(e,i,r){const s=i.array,o=i.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(n?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class ai extends wn{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,o=Math.floor(n),a=Math.floor(i),l=o+1,h=a+1,c=t/o,u=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<h;t++){const e=t*u-s;for(let n=0;n<l;n++){const i=n*c-r;p.push(i,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,i=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new pn(p,3)),this.setAttribute("normal",new pn(f,3)),this.setAttribute("uv",new pn(m,2))}static fromJSON(t){return new ai(t.width,t.height,t.widthSegments,t.heightSegments)}}const li={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},hi={common:{diffuse:{value:new It(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new xt},uv2Transform:{value:new xt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new yt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new It(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new It(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xt}},sprite:{diffuse:{value:new It(16777215)},opacity:{value:1},center:{value:new yt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xt}}},ci={basic:{uniforms:Gn([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.fog]),vertexShader:li.meshbasic_vert,fragmentShader:li.meshbasic_frag},lambert:{uniforms:Gn([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.fog,hi.lights,{emissive:{value:new It(0)}}]),vertexShader:li.meshlambert_vert,fragmentShader:li.meshlambert_frag},phong:{uniforms:Gn([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.fog,hi.lights,{emissive:{value:new It(0)},specular:{value:new It(1118481)},shininess:{value:30}}]),vertexShader:li.meshphong_vert,fragmentShader:li.meshphong_frag},standard:{uniforms:Gn([hi.common,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.roughnessmap,hi.metalnessmap,hi.fog,hi.lights,{emissive:{value:new It(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:li.meshphysical_vert,fragmentShader:li.meshphysical_frag},toon:{uniforms:Gn([hi.common,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.gradientmap,hi.fog,hi.lights,{emissive:{value:new It(0)}}]),vertexShader:li.meshtoon_vert,fragmentShader:li.meshtoon_frag},matcap:{uniforms:Gn([hi.common,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.fog,{matcap:{value:null}}]),vertexShader:li.meshmatcap_vert,fragmentShader:li.meshmatcap_frag},points:{uniforms:Gn([hi.points,hi.fog]),vertexShader:li.points_vert,fragmentShader:li.points_frag},dashed:{uniforms:Gn([hi.common,hi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:li.linedashed_vert,fragmentShader:li.linedashed_frag},depth:{uniforms:Gn([hi.common,hi.displacementmap]),vertexShader:li.depth_vert,fragmentShader:li.depth_frag},normal:{uniforms:Gn([hi.common,hi.bumpmap,hi.normalmap,hi.displacementmap,{opacity:{value:1}}]),vertexShader:li.meshnormal_vert,fragmentShader:li.meshnormal_frag},sprite:{uniforms:Gn([hi.sprite,hi.fog]),vertexShader:li.sprite_vert,fragmentShader:li.sprite_frag},background:{uniforms:{uvTransform:{value:new xt},t2D:{value:null}},vertexShader:li.background_vert,fragmentShader:li.background_frag},cube:{uniforms:Gn([hi.envmap,{opacity:{value:1}}]),vertexShader:li.cube_vert,fragmentShader:li.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:li.equirect_vert,fragmentShader:li.equirect_frag},distanceRGBA:{uniforms:Gn([hi.common,hi.displacementmap,{referencePosition:{value:new Wt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:li.distanceRGBA_vert,fragmentShader:li.distanceRGBA_frag},shadow:{uniforms:Gn([hi.lights,hi.fog,{color:{value:new It(0)},opacity:{value:1}}]),vertexShader:li.shadow_vert,fragmentShader:li.shadow_frag}};function ui(t,e,n,i,r,s){const o=new It(0);let l,h,c=!0===r?0:1,u=null,d=0,p=null;function f(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),c=e,f(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,f(o,c)},render:function(n,r){let s=!1,m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=e.get(m));const v=t.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?f(o,c):m&&m.isColor&&(f(m,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===g)?(void 0===h&&(h=new Fn(new Hn(1,1,1),new jn({name:"BackgroundCubeMaterial",uniforms:Vn(ci.cube.uniforms),vertexShader:ci.cube.vertexShader,fragmentShader:ci.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),h.material.uniforms.envMap.value=m,h.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,u===m&&d===m.version&&p===t.toneMapping||(h.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),h.layers.enableAll(),n.unshift(h,h.geometry,h.material,0,0,null)):m&&m.isTexture&&(void 0===l&&(l=new Fn(new ai(2,2),new jn({name:"BackgroundMaterial",uniforms:Vn(ci.background.uniforms),vertexShader:ci.background.vertexShader,fragmentShader:ci.background.fragmentShader,side:a,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),l.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&d===m.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),l.layers.enableAll(),n.unshift(l,l.geometry,l.material,0,0,null))}}}function di(t,e,n,i){const r=t.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=p(null);let h=l,c=!1;function u(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function f(){const t=h.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function m(t){g(t,0)}function g(n,r){const s=h.newAttributes,o=h.enabledAttributes,a=h.attributeDivisors;s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==r&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r)}function v(){const e=h.newAttributes,n=h.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function y(e,n,r,s,o,a){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,s,o,a):t.vertexAttribIPointer(e,n,r,o,a)}function x(){b(),c=!0,h!==l&&(h=l,u(h.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,x,b){let w=!1;if(o){const e=function(e,n,r){const o=!0===r.wireframe;let l=a[e.id];void 0===l&&(l={},a[e.id]=l);let h=l[n.id];void 0===h&&(h={},l[n.id]=h);let c=h[o];return void 0===c&&(c=p(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),h[o]=c),c}(x,d,l);h!==e&&(h=e,u(h.object)),w=function(t,e,n,i){const r=h.attributes,s=e.attributes;let o=0;const a=n.getAttributes();for(const e in a)if(a[e].location>=0){const n=r[e];let i=s[e];if(void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;o++}return h.attributesNum!==o||h.index!==i}(r,x,d,b),w&&function(t,e,n,i){const r={},s=e.attributes;let o=0;const a=n.getAttributes();for(const e in a)if(a[e].location>=0){let n=s[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[e]=i,o++}h.attributes=r,h.attributesNum=o,h.index=i}(r,x,d,b)}else{const t=!0===l.wireframe;h.geometry===x.id&&h.program===d.id&&h.wireframe===t||(h.geometry=x.id,h.program=d.id,h.wireframe=t,w=!0)}null!==b&&n.update(b,34963),(w||c)&&(c=!1,function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,h=o.getAttributes(),c=s.defaultAttributeValues;for(const e in h){const i=h[e];if(i.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,l=n.get(s);if(void 0===l)continue;const h=l.buffer,c=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,l=n.stride,d=s.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)g(i.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<i.locationSize;t++)m(i.location+t);t.bindBuffer(34962,h);for(let t=0;t<i.locationSize;t++)y(i.location+t,o/i.locationSize,c,e,l*u,(d+o/i.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)g(i.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<i.locationSize;t++)m(i.location+t);t.bindBuffer(34962,h);for(let t=0;t<i.locationSize;t++)y(i.location+t,o/i.locationSize,c,e,o*u,o/i.locationSize*t*u)}}else if(void 0!==c){const n=c[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i.location,n);break;case 3:t.vertexAttrib3fv(i.location,n);break;case 4:t.vertexAttrib4fv(i.location,n);break;default:t.vertexAttrib1fv(i.location,n)}}}}v()}(r,l,d,x),null!==b&&t.bindBuffer(34963,n.get(b).buffer))},reset:x,resetDefaultState:b,dispose:function(){x();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)d(i[t].object),delete i[t];delete n[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function pi(t,e,n,i){const r=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](s,i,o,a),n.update(o,s,a)}}function fi(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||e.has("WEBGL_draw_buffers"),h=!0===n.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=u>0,x=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:s?t.getParameter(36183):0}}function mi(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new ei,a=new xt,l={value:null,needsUpdate:!1};function h(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(t,n,i,r){const s=null!==t?t.length:0;let h=null;if(0!==s){if(h=l.value,!0!==r||null===h){const e=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(h,n),h[n+3]=o.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==i||r;return r=e,n=c(t,s,0),i=t.length,o},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(e,o,a){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?c(null):h();else{const t=s?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=c(u,o,e,a);for(let t=0;t!==e;++t)r[t]=n[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function gi(t){let e=new WeakMap;function n(t,e){return 303===e?t.mapping=f:304===e&&(t.mapping=m),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(303===s||304===s){if(e.has(r))return n(e.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const o=new Zn(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}ci.physical={uniforms:Gn([ci.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new yt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new It(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new yt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new It(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new It(1,1,1)},specularColorMap:{value:null}}]),vertexShader:li.meshphysical_vert,fragmentShader:li.meshphysical_frag};class vi extends qn{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}vi.prototype.isOrthographicCamera=!0;const yi=[.125,.215,.35,.446,.526,.582],xi=new vi,bi=new It;let wi=null;const _i=(1+Math.sqrt(5))/2,Mi=1/_i,Si=[new Wt(1,1,1),new Wt(-1,1,1),new Wt(1,1,-1),new Wt(-1,1,-1),new Wt(0,_i,Mi),new Wt(0,_i,-Mi),new Wt(Mi,0,_i),new Wt(-Mi,0,_i),new Wt(_i,Mi,0),new Wt(-_i,Mi,0)];class Ti{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){wi=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Pi(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Ci(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(wi),t.scissorTest=!1,Ai(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===f||t.mapping===m?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),wi=this._renderer.getRenderTarget();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:M,minFilter:M,generateMipmaps:!1,type:R,format:I,encoding:Y,depthBuffer:!1},i=Ei(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ei(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+yi.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>t-4?a=yi[o-t+4-1]:0===o&&(a=0),i.push(a);const l=1/(s-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),x=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(i,f*p*t),y.set(u,m*p*t);const r=[t,t,t,t,t,t];x.set(r,g*p*t)}const b=new wn;b.setAttribute("position",new cn(v,f)),b.setAttribute("uv",new cn(y,m)),b.setAttribute("faceIndex",new cn(x,g)),e.push(b),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(20),r=new Wt(0,1,0);return new jn({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:h,depthTest:!1,depthWrite:!1})}(i,t,e)}return i}_compileMaterial(t){const e=new Fn(this._lodPlanes[0],t);this._renderer.compile(e,xi)}_sceneToCubeUV(t,e,n,i){const r=new Xn(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,h=a.toneMapping;a.getClearColor(bi),a.toneMapping=0,a.autoClear=!1;const c=new an({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Fn(new Hn,c);let d=!1;const p=t.background;p?p.isColor&&(c.color.copy(p),t.background=null,d=!0):(c.color.copy(bi),d=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1===n?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e]));const l=this._cubeSize;Ai(i,n*l,e>2?l:0,l,l),a.setRenderTarget(i),d&&a.render(u,r),a.render(t,r)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=h,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===f||t.mapping===m;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Pi()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ci());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new Fn(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const o=this._cubeSize;Ai(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,xi)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=Si[(e-1)%Si.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new Fn(this._lodPlanes[i],l),c=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<20;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const y=this._sizeLods[i];Ai(e,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(h,xi)}}function Ei(t,e,n){const i=new Ut(t,e,n);return i.texture.mapping=g,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ai(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Ci(){return new jn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:h,depthTest:!1,depthWrite:!1})}function Pi(){return new jn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:h,depthTest:!1,depthWrite:!1})}function Ri(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=303===s||304===s,a=s===f||s===m;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=e.get(r);return null===n&&(n=new Ti(t)),i=o?n.fromEquirectangular(r,i):n.fromCubemap(r,i),e.set(r,i),i.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(t){let e=0;for(let n=0;n<6;n++)void 0!==t[n]&&e++;return 6===e}(s)){null===n&&(n=new Ti(t));const s=o?n.fromEquirectangular(r):n.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Li(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Ii(t,e,n,i){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const a=new(bt(n)?dn:un)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const i=t.morphAttributes;for(const t in i){const n=i[t];for(let t=0,i=n.length;t<i;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Di(t,e,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,o,e*a),n.update(i,s,1)},this.renderInstances=function(i,l,h){if(0===h)return;let c,u;if(r)c=t,u="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](s,l,o,i*a,h),n.update(l,s,h)}}function Oi(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Bi(t,e){return t[0]-e[0]}function Ni(t,e){return Math.abs(e[1])-Math.abs(t[1])}function zi(t,e){let n=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),t.divideScalar(n)}function ki(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new Ft,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(l,h,c,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,f=void 0!==p?p.length:0;let m=s.get(h);if(void 0===m||m.count!==f){void 0!==m&&m.texture.dispose();const y=void 0!==h.morphAttributes.position,x=void 0!==h.morphAttributes.normal,b=void 0!==h.morphAttributes.color,w=h.morphAttributes.position||[],_=h.morphAttributes.normal||[],M=h.morphAttributes.color||[];let S=0;!0===y&&(S=1),!0===x&&(S=2),!0===b&&(S=3);let T=h.attributes.position.count*S,E=1;T>e.maxTextureSize&&(E=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const A=new Float32Array(T*E*4*f),C=new Ht(A,T,E,f);C.type=P,C.needsUpdate=!0;const R=4*S;for(let I=0;I<f;I++){const D=w[I],O=_[I],B=M[I],N=T*E*4*I;for(let z=0;z<D.count;z++){const k=z*R;!0===y&&(o.fromBufferAttribute(D,z),!0===D.normalized&&zi(o,D),A[N+k+0]=o.x,A[N+k+1]=o.y,A[N+k+2]=o.z,A[N+k+3]=0),!0===x&&(o.fromBufferAttribute(O,z),!0===O.normalized&&zi(o,O),A[N+k+4]=o.x,A[N+k+5]=o.y,A[N+k+6]=o.z,A[N+k+7]=0),!0===b&&(o.fromBufferAttribute(B,z),!0===B.normalized&&zi(o,B),A[N+k+8]=o.x,A[N+k+9]=o.y,A[N+k+10]=o.z,A[N+k+11]=4===B.itemSize?o.w:1)}}function L(){C.dispose(),s.delete(h),h.removeEventListener("dispose",L)}m={count:f,texture:C,size:new yt(T,E)},s.set(h,m),h.addEventListener("dispose",L)}let g=0;for(let F=0;F<d.length;F++)g+=d[F];const v=h.morphTargetsRelative?1:1-g;u.getUniforms().setValue(t,"morphTargetBaseInfluence",v),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",m.texture,n),u.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const U=void 0===d?0:d.length;let H=i[h.id];if(void 0===H||H.length!==U){H=[];for(let q=0;q<U;q++)H[q]=[q,0];i[h.id]=H}for(let X=0;X<U;X++){const Y=H[X];Y[0]=X,Y[1]=d[X]}H.sort(Ni);for(let $=0;$<8;$++)$<U&&H[$][1]?(a[$][0]=H[$][0],a[$][1]=H[$][1]):(a[$][0]=Number.MAX_SAFE_INTEGER,a[$][1]=0);a.sort(Bi);const V=h.morphAttributes.position,G=h.morphAttributes.normal;let W=0;for(let K=0;K<8;K++){const Z=a[K],J=Z[0],Q=Z[1];J!==Number.MAX_SAFE_INTEGER&&Q?(V&&h.getAttribute("morphTarget"+K)!==V[J]&&h.setAttribute("morphTarget"+K,V[J]),G&&h.getAttribute("morphNormal"+K)!==G[J]&&h.setAttribute("morphNormal"+K,G[J]),r[K]=Q,W+=Q):(V&&!0===h.hasAttribute("morphTarget"+K)&&h.deleteAttribute("morphTarget"+K),G&&!0===h.hasAttribute("morphNormal"+K)&&h.deleteAttribute("morphNormal"+K),r[K]=0)}const j=h.morphTargetsRelative?1:1-W;u.getUniforms().setValue(t,"morphTargetBaseInfluence",j),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function Fi(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const o=i.render.frame,a=t.geometry,l=e.get(t,a);return r.get(l)!==o&&(e.update(l),r.set(l,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const Ui=new kt,Hi=new Ht,Vi=new Vt,Gi=new Kn,Wi=[],ji=[],qi=new Float32Array(16),Xi=new Float32Array(9),Yi=new Float32Array(4);function $i(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=Wi[r];if(void 0===s&&(s=new Float32Array(r),Wi[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function Ki(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Zi(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Ji(t,e){let n=ji[e];void 0===n&&(n=new Int32Array(e),ji[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Qi(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function tr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ki(n,e))return;t.uniform2fv(this.addr,e),Zi(n,e)}}function er(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ki(n,e))return;t.uniform3fv(this.addr,e),Zi(n,e)}}function nr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ki(n,e))return;t.uniform4fv(this.addr,e),Zi(n,e)}}function ir(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Ki(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Zi(n,e)}else{if(Ki(n,i))return;Yi.set(i),t.uniformMatrix2fv(this.addr,!1,Yi),Zi(n,i)}}function rr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Ki(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Zi(n,e)}else{if(Ki(n,i))return;Xi.set(i),t.uniformMatrix3fv(this.addr,!1,Xi),Zi(n,i)}}function sr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Ki(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Zi(n,e)}else{if(Ki(n,i))return;qi.set(i),t.uniformMatrix4fv(this.addr,!1,qi),Zi(n,i)}}function or(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function ar(t,e){const n=this.cache;Ki(n,e)||(t.uniform2iv(this.addr,e),Zi(n,e))}function lr(t,e){const n=this.cache;Ki(n,e)||(t.uniform3iv(this.addr,e),Zi(n,e))}function hr(t,e){const n=this.cache;Ki(n,e)||(t.uniform4iv(this.addr,e),Zi(n,e))}function cr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function ur(t,e){const n=this.cache;Ki(n,e)||(t.uniform2uiv(this.addr,e),Zi(n,e))}function dr(t,e){const n=this.cache;Ki(n,e)||(t.uniform3uiv(this.addr,e),Zi(n,e))}function pr(t,e){const n=this.cache;Ki(n,e)||(t.uniform4uiv(this.addr,e),Zi(n,e))}function fr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(e||Ui,r)}function mr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Vi,r)}function gr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||Gi,r)}function vr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||Hi,r)}function yr(t,e){t.uniform1fv(this.addr,e)}function xr(t,e){const n=$i(e,this.size,2);t.uniform2fv(this.addr,n)}function br(t,e){const n=$i(e,this.size,3);t.uniform3fv(this.addr,n)}function wr(t,e){const n=$i(e,this.size,4);t.uniform4fv(this.addr,n)}function _r(t,e){const n=$i(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Mr(t,e){const n=$i(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Sr(t,e){const n=$i(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Tr(t,e){t.uniform1iv(this.addr,e)}function Er(t,e){t.uniform2iv(this.addr,e)}function Ar(t,e){t.uniform3iv(this.addr,e)}function Cr(t,e){t.uniform4iv(this.addr,e)}function Pr(t,e){t.uniform1uiv(this.addr,e)}function Rr(t,e){t.uniform2uiv(this.addr,e)}function Lr(t,e){t.uniform3uiv(this.addr,e)}function Ir(t,e){t.uniform4uiv(this.addr,e)}function Dr(t,e,n){const i=e.length,r=Ji(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture2D(e[t]||Ui,r[t])}function Or(t,e,n){const i=e.length,r=Ji(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture3D(e[t]||Vi,r[t])}function Br(t,e,n){const i=e.length,r=Ji(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTextureCube(e[t]||Gi,r[t])}function Nr(t,e,n){const i=e.length,r=Ji(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture2DArray(e[t]||Hi,r[t])}function zr(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Qi;case 35664:return tr;case 35665:return er;case 35666:return nr;case 35674:return ir;case 35675:return rr;case 35676:return sr;case 5124:case 35670:return or;case 35667:case 35671:return ar;case 35668:case 35672:return lr;case 35669:case 35673:return hr;case 5125:return cr;case 36294:return ur;case 36295:return dr;case 36296:return pr;case 35678:case 36198:case 36298:case 36306:case 35682:return fr;case 35679:case 36299:case 36307:return mr;case 35680:case 36300:case 36308:case 36293:return gr;case 36289:case 36303:case 36311:case 36292:return vr}}(e.type)}function kr(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return yr;case 35664:return xr;case 35665:return br;case 35666:return wr;case 35674:return _r;case 35675:return Mr;case 35676:return Sr;case 5124:case 35670:return Tr;case 35667:case 35671:return Er;case 35668:case 35672:return Ar;case 35669:case 35673:return Cr;case 5125:return Pr;case 36294:return Rr;case 36295:return Lr;case 36296:return Ir;case 35678:case 36198:case 36298:case 36306:case 35682:return Dr;case 35679:case 36299:case 36307:return Or;case 35680:case 36300:case 36308:case 36293:return Br;case 36289:case 36303:case 36311:case 36292:return Nr}}(e.type)}function Fr(t){this.id=t,this.seq=[],this.map={}}Fr.prototype.setValue=function(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}};const Ur=/(\w+)(\])?(\[|\.)?/g;function Hr(t,e){t.seq.push(e),t.map[e.id]=e}function Vr(t,e,n){const i=t.name,r=i.length;for(Ur.lastIndex=0;;){const s=Ur.exec(i),o=Ur.lastIndex;let a=s[1];const l="]"===s[2],h=s[3];if(l&&(a|=0),void 0===h||"["===h&&o+2===r){Hr(n,void 0===h?new zr(a,t,e):new kr(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Fr(a),Hr(n,t)),n=t}}}function Gr(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);Vr(n,t.getUniformLocation(e,n.name),this)}}function Wr(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}Gr.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},Gr.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},Gr.upload=function(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,i)}},Gr.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n};let jr=0;function qr(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[0]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=r;t<s;t++)i.push(t+1+": "+n[t]);return i.join("\n")}(t.getShaderSource(e),i)}return r}function Xr(t,e){const n=function(t){switch(t){case Y:return["Linear","( value )"];case $:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Yr(t,e){let n;switch(e){case 1:n="Linear";break;case d:n="Reinhard";break;case 3:n="OptimizedCineon";break;case p:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function $r(t){return""!==t}function Kr(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Zr(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Jr=/^[ \t]*#include +<([\w\d./]+)>/gm;function Qr(t){return t.replace(Jr,ts)}function ts(t,e){const n=li[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Qr(n)}const es=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ns=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function is(t){return t.replace(ns,ss).replace(es,rs)}function rs(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ss(0,e,n,i)}function ss(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function os(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function as(t,e,n,i){const r=t.getContext(),s=n.defines;let a=n.vertexShader,l=n.fragmentShader;const h=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===o&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case f:case m:e="ENVMAP_TYPE_CUBE";break;case g:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===m&&(e="ENVMAP_MODE_REFRACTION"),e}(n),d=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),p=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),v=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($r).join("\n")}(n),y=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),x=r.createProgram();let b,w,_=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(b=[y].filter($r).join("\n"),b.length>0&&(b+="\n"),w=[v,y].filter($r).join("\n"),w.length>0&&(w+="\n")):(b=[os(n),"#define SHADER_NAME "+n.shaderName,y,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter($r).join("\n"),w=[v,os(n),"#define SHADER_NAME "+n.shaderName,y,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?li.tonemapping_pars_fragment:"",0!==n.toneMapping?Yr("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",li.encodings_pars_fragment,Xr("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter($r).join("\n")),a=Qr(a),a=Kr(a,n),a=Zr(a,n),l=Qr(l),l=Kr(l,n),l=Zr(l,n),a=is(a),l=is(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(_="#version 300 es\n",b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,w=["#define varying in",n.glslVersion===it?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===it?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+w);const M=_+w+l,S=Wr(r,35633,_+b+a),T=Wr(r,35632,M);if(r.attachShader(x,S),r.attachShader(x,T),void 0!==n.index0AttributeName?r.bindAttribLocation(x,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(x,0,"position"),r.linkProgram(x),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(x).trim(),e=r.getShaderInfoLog(S).trim(),n=r.getShaderInfoLog(T).trim();let i=!0,s=!0;if(!1===r.getProgramParameter(x,35714)){i=!1;const e=qr(r,S,"vertex"),n=qr(r,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(x,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==n||(s=!1);s&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:b},fragmentShader:{log:n,prefix:w}})}let E,A;return r.deleteShader(S),r.deleteShader(T),this.getUniforms=function(){return void 0===E&&(E=new Gr(r,x)),E},this.getAttributes=function(){return void 0===A&&(A=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(r,x)),A},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(x),this.program=void 0},this.name=n.shaderName,this.id=jr++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=S,this.fragmentShader=T,this}let ls=0;class hs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const n=new cs(t);e.set(t,n)}return e.get(t)}}class cs{constructor(t){this.id=ls++,this.code=t,this.usedTimes=0}}function us(t,e,n,i,r,s,o){const a=new Ie,h=new hs,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,p=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,c,v,y){const x=v.fog,b=y.geometry,w=s.isMeshStandardMaterial?v.environment:null,_=(s.isMeshStandardMaterial?n:e).get(s.envMap||w),M=_&&_.mapping===g?_.image.height:null,S=m[s.type];null!==s.precision&&(f=r.getMaxPrecision(s.precision),f!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));const T=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,E=void 0!==T?T.length:0;let A,C,P,R,L=0;if(void 0!==b.morphAttributes.position&&(L=1),void 0!==b.morphAttributes.normal&&(L=2),void 0!==b.morphAttributes.color&&(L=3),S){const t=ci[S];A=t.vertexShader,C=t.fragmentShader}else A=s.vertexShader,C=s.fragmentShader,h.update(s),P=h.getVertexShaderID(s),R=h.getFragmentShaderID(s);const I=t.getRenderTarget(),D=s.alphaTest>0,O=s.clearcoat>0;return{isWebGL2:u,shaderID:S,shaderName:s.type,vertexShader:A,fragmentShader:C,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:R,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:p,outputEncoding:null===I?t.outputEncoding:!0===I.isXRRenderTarget?I.texture.encoding:Y,map:!!s.map,matcap:!!s.matcap,envMap:!!_,envMapMode:_&&_.mapping,envMapCubeUVHeight:M,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:s.normalMapType===Z,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===$,clearcoat:O,clearcoatMap:O&&!!s.clearcoatMap,clearcoatRoughnessMap:O&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:O&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:D,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!b.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!x,useFog:!0===s.fog,fogExp2:x&&x.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:E,morphTextureStride:L,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===l,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0),e.supportsVertexTextures&&a.enable(1),e.instancing&&a.enable(2),e.instancingColor&&a.enable(3),e.map&&a.enable(4),e.matcap&&a.enable(5),e.envMap&&a.enable(6),e.lightMap&&a.enable(7),e.aoMap&&a.enable(8),e.emissiveMap&&a.enable(9),e.bumpMap&&a.enable(10),e.normalMap&&a.enable(11),e.objectSpaceNormalMap&&a.enable(12),e.tangentSpaceNormalMap&&a.enable(13),e.clearcoat&&a.enable(14),e.clearcoatMap&&a.enable(15),e.clearcoatRoughnessMap&&a.enable(16),e.clearcoatNormalMap&&a.enable(17),e.displacementMap&&a.enable(18),e.specularMap&&a.enable(19),e.roughnessMap&&a.enable(20),e.metalnessMap&&a.enable(21),e.gradientMap&&a.enable(22),e.alphaMap&&a.enable(23),e.alphaTest&&a.enable(24),e.vertexColors&&a.enable(25),e.vertexAlphas&&a.enable(26),e.vertexUvs&&a.enable(27),e.vertexTangents&&a.enable(28),e.uvsVertexOnly&&a.enable(29),e.fog&&a.enable(30),t.push(a.mask),a.disableAll(),e.useFog&&a.enable(0),e.flatShading&&a.enable(1),e.logarithmicDepthBuffer&&a.enable(2),e.skinning&&a.enable(3),e.morphTargets&&a.enable(4),e.morphNormals&&a.enable(5),e.morphColors&&a.enable(6),e.premultipliedAlpha&&a.enable(7),e.shadowMapEnabled&&a.enable(8),e.physicallyCorrectLights&&a.enable(9),e.doubleSided&&a.enable(10),e.flipSided&&a.enable(11),e.useDepthPacking&&a.enable(12),e.dithering&&a.enable(13),e.specularIntensityMap&&a.enable(14),e.specularColorMap&&a.enable(15),e.transmission&&a.enable(16),e.transmissionMap&&a.enable(17),e.thicknessMap&&a.enable(18),e.sheen&&a.enable(19),e.sheenColorMap&&a.enable(20),e.sheenRoughnessMap&&a.enable(21),e.decodeVideoTexture&&a.enable(22),e.opaque&&a.enable(23),t.push(a.mask)}(n,e),n.push(t.outputEncoding)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=m[t.type];let n;if(e){const t=ci[e];n=Wn.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new as(t,n,e,s),c.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){h.remove(t)},programs:c,dispose:function(){h.dispose()}}}function ds(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function ps(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function fs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ms(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,o,a){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,o,a,l,h){const c=s(t,e,o,a,l,h);o.transmission>0?i.push(c):!0===o.transparent?r.push(c):n.push(c)},unshift:function(t,e,o,a,l,h){const c=s(t,e,o,a,l,h);o.transmission>0?i.unshift(c):!0===o.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||ps),i.length>1&&i.sort(e||fs),r.length>1&&r.sort(e||fs)}}}function gs(){let t=new WeakMap;return{get:function(e,n){let i;return!1===t.has(e)?(i=new ms,t.set(e,[i])):n>=t.get(e).length?(i=new ms,t.get(e).push(i)):i=t.get(e)[n],i},dispose:function(){t=new WeakMap}}}function vs(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Wt,color:new It};break;case"SpotLight":n={position:new Wt,direction:new Wt,color:new It,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Wt,color:new It,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Wt,skyColor:new It,groundColor:new It};break;case"RectAreaLight":n={color:new It,position:new Wt,halfWidth:new Wt,halfHeight:new Wt}}return t[e.id]=n,n}}}let ys=0;function xs(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function bs(t,e){const n=new vs,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new Wt);const s=new Wt,o=new we,a=new we;return{setup:function(s,o){let a=0,l=0,h=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0;s.sort(xs);const y=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,x=e.intensity,b=e.distance,w=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*x*y,l+=o.g*x*y,h+=o.b*x*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],x);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[c]=n,r.directionalShadowMap[c]=w,r.directionalShadowMatrix[c]=e.shadow.matrix,m++}r.directional[c]=t,c++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(x*y),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.spotShadow[d]=n,r.spotShadowMap[d]=w,r.spotShadowMatrix[d]=e.shadow.matrix,v++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(o).multiplyScalar(x),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[u]=n,r.pointShadowMap[u]=w,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(x*y),t.groundColor.copy(e.groundColor).multiplyScalar(x*y),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=hi.LTC_FLOAT_1,r.rectAreaLTC2=hi.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=hi.LTC_HALF_1,r.rectAreaLTC2=hi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=h;const x=r.hash;x.directionalLength===c&&x.pointLength===u&&x.spotLength===d&&x.rectAreaLength===p&&x.hemiLength===f&&x.numDirectionalShadows===m&&x.numPointShadows===g&&x.numSpotShadows===v||(r.directional.length=c,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=v,x.directionalLength=c,x.pointLength=u,x.spotLength=d,x.rectAreaLength=p,x.hemiLength=f,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=v,r.version=ys++)},setupView:function(t,e){let n=0,i=0,l=0,h=0,c=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),n++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[h];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),h++}else if(d.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const t=r.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),c++}}},state:r}}function ws(t,e){const n=new bs(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function _s(t,e){let n=new WeakMap;return{get:function(i,r=0){let s;return!1===n.has(i)?(s=new ws(t,e),n.set(i,[s])):r>=n.get(i).length?(s=new ws(t,e),n.get(i).push(s)):s=n.get(i)[r],s},dispose:function(){n=new WeakMap}}}class Ms extends on{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Ms.prototype.isMeshDepthMaterial=!0;class Ss extends on{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Wt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Ts(t,e,n){let i=new ri;const r=new yt,s=new yt,c=new Ft,u=new Ms({depthPacking:K}),d=new Ss,p={},f=n.maxTextureSize,m={0:1,1:a,2:l},g=new jn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),v=g.clone();v.defines.HORIZONTAL_PASS=1;const y=new wn;y.setAttribute("position",new cn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new Fn(y,g),w=this;function _(n,i){const r=e.update(x);g.defines.VSM_SAMPLES!==n.blurSamples&&(g.defines.VSM_SAMPLES=n.blurSamples,v.defines.VSM_SAMPLES=n.blurSamples,g.needsUpdate=!0,v.needsUpdate=!0),g.uniforms.shadow_pass.value=n.map.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,g,x,null),v.uniforms.shadow_pass.value=n.mapPass.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,v,x,null)}function M(e,n,i,r,s,a){let l=null;const h=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(l=void 0!==h?h:!0===i.isPointLight?d:u,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=l.uuid,e=n.uuid;let i=p[t];void 0===i&&(i={},p[t]=i);let r=i[e];void 0===r&&(r=l.clone(),i[e]=r),l=r}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=a===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:m[n.side],l.alphaMap=n.alphaMap,l.alphaTest=n.alphaTest,l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.displacementMap=n.displacementMap,l.displacementScale=n.displacementScale,l.displacementBias=n.displacementBias,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=r,l.farDistance=s),l}function S(n,r,s,a,l){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&l===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let o=0,h=e.length;o<h;o++){const h=e[o],c=r[h.materialIndex];if(c&&c.visible){const e=M(n,c,a,s.near,s.far,l);t.renderBufferDirect(s,null,i,e,n,h)}}}else if(r.visible){const e=M(n,r,a,s.near,s.far,l);t.renderBufferDirect(s,null,i,e,n,null)}}const h=n.children;for(let t=0,e=h.length;t<e;t++)S(h[t],r,s,a,l)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,a){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.state;p.setBlending(h),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let l=0,h=e.length;l<h;l++){const h=e[l],u=h.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const d=u.getFrameExtents();if(r.multiply(d),s.copy(u.mapSize),(r.x>f||r.y>f)&&(r.x>f&&(s.x=Math.floor(f/d.x),r.x=s.x*d.x,u.mapSize.x=s.x),r.y>f&&(s.y=Math.floor(f/d.y),r.y=s.y*d.y,u.mapSize.y=s.y)),null!==u.map||u.isPointLightShadow||this.type!==o||(u.map=new Ut(r.x,r.y),u.map.texture.name=h.name+".shadowMap",u.mapPass=new Ut(r.x,r.y),u.camera.updateProjectionMatrix()),null===u.map){const t={minFilter:b,magFilter:b,format:I};u.map=new Ut(r.x,r.y,t),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);c.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),p.viewport(c),u.updateMatrices(h,t),i=u.getFrustum(),S(n,a,u.camera,h,this.type)}u.isPointLightShadow||this.type!==o||_(u,a),u.needsUpdate=!1}w.needsUpdate=!1,t.setRenderTarget(l,u,d)}}function Es(t,e,n){const i=n.isWebGL2,r=new function(){let e=!1;const n=new Ft;let i=null;const r=new Ft(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,o,a){!0===a&&(e*=o,i*=o,s*=o),n.set(e,i,s,o),!1===r.equals(n)&&(t.clearColor(e,i,s,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?V(2929):G(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},o=new function(){let e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,h=null;return{setTest:function(t){e||(t?V(2960):G(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&s===o||(t.stencilFunc(e,n,o),i=e,r=n,s=o)},setOp:function(e,n,i){o===e&&a===n&&l===i||(t.stencilOp(e,n,i),o=e,a=n,l=i)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,h=null}}};let a={},d={},p=new WeakMap,f=[],m=null,g=!1,v=null,y=null,x=null,b=null,w=null,_=null,M=null,S=!1,T=null,E=null,A=null,C=null,P=null;const R=t.getParameter(35661);let L=!1,I=0;const D=t.getParameter(7938);-1!==D.indexOf("WebGL")?(I=parseFloat(/^WebGL (\d)/.exec(D)[1]),L=I>=1):-1!==D.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),L=I>=2);let O=null,B={};const N=t.getParameter(3088),z=t.getParameter(2978),k=(new Ft).fromArray(N),F=(new Ft).fromArray(z);function U(e,n,i){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<i;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,r);return s}const H={};function V(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function G(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}H[3553]=U(3553,3553,1),H[34067]=U(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),V(2929),s.setFunc(3),X(!1),Y(1),V(2884),q(h);const W={[u]:32774,101:32778,102:32779};if(i)W[103]=32775,W[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(W[103]=t.MIN_EXT,W[104]=t.MAX_EXT)}const j={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function q(e,n,i,r,s,o,a,l){if(e!==h){if(!1===g&&(V(3042),g=!0),5===e)s=s||n,o=o||i,a=a||r,n===y&&s===w||(t.blendEquationSeparate(W[n],W[s]),y=n,w=s),i===x&&r===b&&o===_&&a===M||(t.blendFuncSeparate(j[i],j[r],j[o],j[a]),x=i,b=r,_=o,M=a),v=e,S=null;else if(e!==v||l!==S){if(y===u&&w===u||(t.blendEquation(32774),y=u,w=u),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case c:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case c:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}x=null,b=null,_=null,M=null,v=e,S=l}}else!0===g&&(G(3042),g=!1)}function X(e){T!==e&&(e?t.frontFace(2304):t.frontFace(2305),T=e)}function Y(e){0!==e?(V(2884),e!==E&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):G(2884),E=e}function $(e,n,i){e?(V(32823),C===n&&P===i||(t.polygonOffset(n,i),C=n,P=i)):G(32823)}function K(e){void 0===e&&(e=33984+R-1),O!==e&&(t.activeTexture(e),O=e)}return{buffers:{color:r,depth:s,stencil:o},enable:V,disable:G,bindFramebuffer:function(e,n){return d[e]!==n&&(t.bindFramebuffer(e,n),d[e]=n,i&&(36009===e&&(d[36160]=n),36160===e&&(d[36009]=n)),!0)},drawBuffers:function(i,r){let s=f,o=!1;if(i)if(s=p.get(r),void 0===s&&(s=[],p.set(r,s)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,n=t.length;e<n;e++)s[e]=36064+e;s.length=t.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return m!==e&&(t.useProgram(e),m=e,!0)},setBlending:q,setMaterial:function(t,e){t.side===l?G(2884):V(2884);let n=1===t.side;e&&(n=!n),X(n),1===t.blending&&!1===t.transparent?q(h):q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),r.setMask(t.colorWrite);const i=t.stencilWrite;o.setTest(i),i&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),$(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?V(32926):G(32926)},setFlipSided:X,setCullFace:Y,setLineWidth:function(e){e!==A&&(L&&t.lineWidth(e),A=e)},setPolygonOffset:$,setScissorTest:function(t){t?V(3089):G(3089)},activeTexture:K,bindTexture:function(e,n){null===O&&K();let i=B[O];void 0===i&&(i={type:void 0,texture:void 0},B[O]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||H[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=B[O];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===k.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),k.copy(e))},viewport:function(e){!1===F.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===i&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},O=null,B={},d={},p=new WeakMap,f=[],m=null,g=!1,v=null,y=null,x=null,b=null,w=null,_=null,M=null,S=!1,T=null,E=null,A=null,C=null,P=null,k.set(0,0,t.canvas.width,t.canvas.height),F.set(0,0,t.canvas.width,t.canvas.height),r.reset(),s.reset(),o.reset()}}}function As(t,e,n,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,h=r.maxCubemapSize,c=r.maxTextureSize,u=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let B=!1;try{B="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function N(t,e){return B?new OffscreenCanvas(t,e):wt("canvas")}function z(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?gt:Math.floor,s=i(r*t.width),o=i(r*t.height);void 0===m&&(m=N(s,o));const a=n?N(s,o):m;return a.width=s,a.height=o,a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function k(t){return ft(t.width)&&ft(t.height)}function F(t,e){return t.generateMipmaps&&e&&t.minFilter!==b&&t.minFilter!==M}function U(e){t.generateMipmap(e)}function H(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;return 6403===i&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===i&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===i&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===$&&!1===o?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||e.get("EXT_color_buffer_float"),l}function V(t,e,n){return!0===F(t,n)||t.isFramebufferTexture&&t.minFilter!==b&&t.minFilter!==M?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function G(t){return t===b||t===w||t===_?9728:9729}function W(t){const e=t.target;e.removeEventListener("dispose",W),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=g.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&q(t),0===Object.keys(r).length&&g.delete(n)}i.remove(t)}(e),e.isVideoTexture&&f.delete(e)}function j(e){const n=e.target;n.removeEventListener("dispose",j),function(e){const n=e.texture,r=i.get(e),s=i.get(n);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),i.remove(n[e])}i.remove(n),i.remove(e)}(n)}function q(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete g.get(r)[n.__cacheKey],o.memory.textures--}let X=0;function K(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const n=t.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void et(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}const Z={[v]:10497,[y]:33071,[x]:33648},J={[b]:9728,[w]:9984,[_]:9986,[M]:9729,[S]:9985,[T]:9987};function Q(n,s,o){if(o?(t.texParameteri(n,10242,Z[s.wrapS]),t.texParameteri(n,10243,Z[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,Z[s.wrapR]),t.texParameteri(n,10240,J[s.magFilter]),t.texParameteri(n,10241,J[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===y&&s.wrapT===y||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,G(s.magFilter)),t.texParameteri(n,10241,G(s.minFilter)),s.minFilter!==b&&s.minFilter!==M&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===P&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===R&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function tt(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",W));const r=n.source;let s=g.get(r);void 0===s&&(s={},g.set(r,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&q(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return i}function et(e,i,r){let o=3553;i.isDataArrayTexture&&(o=35866),i.isData3DTexture&&(o=32879);const l=tt(e,i),h=i.source;if(n.activeTexture(33984+r),n.bindTexture(o,e.__webglTexture),h.version!==h.__currentVersion||!0===l){t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const r=function(t){return!a&&(t.wrapS!==y||t.wrapT!==y||t.minFilter!==b&&t.minFilter!==M)}(i)&&!1===k(i.image);let u=z(i.image,r,!1,c);u=lt(i,u);const d=k(u)||a,p=s.convert(i.format,i.encoding);let f,m=s.convert(i.type),g=H(i.internalFormat,p,m,i.encoding,i.isVideoTexture);Q(o,i,d);const v=i.mipmaps,x=a&&!0!==i.isVideoTexture,w=void 0===e.__version||!0===l,_=V(i,u,d);if(i.isDepthTexture)g=6402,a?g=i.type===P?36012:i.type===C?33190:i.type===L?35056:33189:i.type===P&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===D&&6402===g&&i.type!==A&&i.type!==C&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=A,m=s.convert(i.type)),i.format===O&&6402===g&&(g=34041,i.type!==L&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=L,m=s.convert(i.type))),w&&(x?n.texStorage2D(3553,1,g,u.width,u.height):n.texImage2D(3553,0,g,u.width,u.height,0,p,m,null));else if(i.isDataTexture)if(v.length>0&&d){x&&w&&n.texStorage2D(3553,_,g,v[0].width,v[0].height);for(let t=0,e=v.length;t<e;t++)f=v[t],x?n.texSubImage2D(3553,t,0,0,f.width,f.height,p,m,f.data):n.texImage2D(3553,t,g,f.width,f.height,0,p,m,f.data);i.generateMipmaps=!1}else x?(w&&n.texStorage2D(3553,_,g,u.width,u.height),n.texSubImage2D(3553,0,0,0,u.width,u.height,p,m,u.data)):n.texImage2D(3553,0,g,u.width,u.height,0,p,m,u.data);else if(i.isCompressedTexture){x&&w&&n.texStorage2D(3553,_,g,v[0].width,v[0].height);for(let t=0,e=v.length;t<e;t++)f=v[t],i.format!==I?null!==p?x?n.compressedTexSubImage2D(3553,t,0,0,f.width,f.height,p,f.data):n.compressedTexImage2D(3553,t,g,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):x?n.texSubImage2D(3553,t,0,0,f.width,f.height,p,m,f.data):n.texImage2D(3553,t,g,f.width,f.height,0,p,m,f.data)}else if(i.isDataArrayTexture)x?(w&&n.texStorage3D(35866,_,g,u.width,u.height,u.depth),n.texSubImage3D(35866,0,0,0,0,u.width,u.height,u.depth,p,m,u.data)):n.texImage3D(35866,0,g,u.width,u.height,u.depth,0,p,m,u.data);else if(i.isData3DTexture)x?(w&&n.texStorage3D(32879,_,g,u.width,u.height,u.depth),n.texSubImage3D(32879,0,0,0,0,u.width,u.height,u.depth,p,m,u.data)):n.texImage3D(32879,0,g,u.width,u.height,u.depth,0,p,m,u.data);else if(i.isFramebufferTexture){if(w)if(x)n.texStorage2D(3553,_,g,u.width,u.height);else{let t=u.width,e=u.height;for(let i=0;i<_;i++)n.texImage2D(3553,i,g,t,e,0,p,m,null),t>>=1,e>>=1}}else if(v.length>0&&d){x&&w&&n.texStorage2D(3553,_,g,v[0].width,v[0].height);for(let t=0,e=v.length;t<e;t++)f=v[t],x?n.texSubImage2D(3553,t,0,0,p,m,f):n.texImage2D(3553,t,g,p,m,f);i.generateMipmaps=!1}else x?(w&&n.texStorage2D(3553,_,g,u.width,u.height),n.texSubImage2D(3553,0,0,0,p,m,u)):n.texImage2D(3553,0,g,p,m,u);F(i,d)&&U(o),h.__currentVersion=h.version,i.onUpdate&&i.onUpdate(i)}e.__version=i.version}function nt(e,r,o,a,l){const h=s.convert(o.format,o.encoding),c=s.convert(o.type),u=H(o.internalFormat,h,c,o.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,u,r.width,r.height,r.depth,0,h,c,null):n.texImage2D(l,0,u,r.width,r.height,0,h,c,null)),n.bindFramebuffer(36160,e),at(r)?d.framebufferTexture2DMultisampleEXT(36160,a,l,i.get(o).__webglTexture,0,ot(r)):t.framebufferTexture2D(36160,a,l,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function it(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||at(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===P?r=36012:e.type===C&&(r=33190));const i=ot(n);at(n)?d.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=ot(n);i&&!1===at(n)?t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):at(n)?d.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,r=s.convert(e.format,e.encoding),o=s.convert(e.type),a=H(e.internalFormat,r,o,e.encoding),l=ot(n);i&&!1===at(n)?t.renderbufferStorageMultisample(36161,l,a,n.width,n.height):at(n)?d.renderbufferStorageMultisampleEXT(36161,l,a,n.width,n.height):t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function st(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),K(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=ot(r);if(r.depthTexture.format===D)at(r)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==O)throw new Error("Unknown depthTexture format");at(r)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),it(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),it(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function ot(t){return Math.min(u,t.samples)}function at(t){const n=i.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function lt(t,n){const i=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===rt||i!==Y&&(i===$?!1===a?!0===e.has("EXT_sRGB")&&r===I?(t.format=rt,t.minFilter=M,t.generateMipmaps=!1):n=Ot.sRGBToLinear(n):r===I&&s===E||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){const t=X;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),X+=1,t},this.resetTextureUnits=function(){X=0},this.setTexture2D=K,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?et(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?et(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(e,r){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,i,r){if(6!==i.image.length)return;const o=tt(e,i),l=i.source;if(n.activeTexture(33984+r),n.bindTexture(34067,e.__webglTexture),l.version!==l.__currentVersion||!0===o){t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const r=i.isCompressedTexture||i.image[0].isCompressedTexture,o=i.image[0]&&i.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=r||o?o?i.image[t].image:i.image[t]:z(i.image[t],!1,!0,h),c[t]=lt(i,c[t]);const u=c[0],d=k(u)||a,p=s.convert(i.format,i.encoding),f=s.convert(i.type),m=H(i.internalFormat,p,f,i.encoding),g=a&&!0!==i.isVideoTexture,v=void 0===e.__version;let y,x=V(i,u,d);if(Q(34067,i,d),r){g&&v&&n.texStorage2D(34067,x,m,u.width,u.height);for(let t=0;t<6;t++){y=c[t].mipmaps;for(let e=0;e<y.length;e++){const r=y[e];i.format!==I?null!==p?g?n.compressedTexSubImage2D(34069+t,e,0,0,r.width,r.height,p,r.data):n.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?n.texSubImage2D(34069+t,e,0,0,r.width,r.height,p,f,r.data):n.texImage2D(34069+t,e,m,r.width,r.height,0,p,f,r.data)}}}else{y=i.mipmaps,g&&v&&(y.length>0&&x++,n.texStorage2D(34067,x,m,c[0].width,c[0].height));for(let t=0;t<6;t++)if(o){g?n.texSubImage2D(34069+t,0,0,0,c[t].width,c[t].height,p,f,c[t].data):n.texImage2D(34069+t,0,m,c[t].width,c[t].height,0,p,f,c[t].data);for(let e=0;e<y.length;e++){const i=y[e].image[t].image;g?n.texSubImage2D(34069+t,e+1,0,0,i.width,i.height,p,f,i.data):n.texImage2D(34069+t,e+1,m,i.width,i.height,0,p,f,i.data)}}else{g?n.texSubImage2D(34069+t,0,0,0,p,f,c[t]):n.texImage2D(34069+t,0,m,p,f,c[t]);for(let e=0;e<y.length;e++){const i=y[e];g?n.texSubImage2D(34069+t,e+1,0,0,p,f,i.image[t]):n.texImage2D(34069+t,e+1,m,p,f,i.image[t])}}}F(i,d)&&U(34067),l.__currentVersion=l.version,i.onUpdate&&i.onUpdate(i)}e.__version=i.version}(o,e,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(t,e,n){const r=i.get(t);void 0!==e&&nt(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&st(t)},this.setupRenderTarget=function(e){const l=e.texture,h=i.get(e),c=i.get(l);e.addEventListener("dispose",j),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=l.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=k(e)||a;if(u){h.__webglFramebuffer=[];for(let e=0;e<6;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else if(h.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(a&&e.samples>0&&!1===at(e)){h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,h.__webglColorRenderbuffer);const i=s.convert(l.format,l.encoding),r=s.convert(l.type),o=H(l.internalFormat,i,r,l.encoding),a=ot(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,h.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),it(h.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}if(u){n.bindTexture(34067,c.__webglTexture),Q(34067,l,p);for(let t=0;t<6;t++)nt(h.__webglFramebuffer[t],e,l,36064,34069+t);F(l,p)&&U(34067),n.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=i.get(s);n.bindTexture(3553,o.__webglTexture),Q(3553,s,p),nt(h.__webglFramebuffer,e,s,36064+r,3553),F(s,p)&&U(3553)}n.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(t,c.__webglTexture),Q(t,l,p),nt(h.__webglFramebuffer,e,l,36064,t),F(l,p)&&U(t),n.unbindTexture()}e.depthBuffer&&st(e)},this.updateRenderTargetMipmap=function(t){const e=k(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(F(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=i.get(o).__webglTexture;n.bindTexture(e,r),U(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===at(e)){const r=e.width,s=e.height;let o=16384;const a=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&a.push(l);const h=i.get(e),c=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;!1===c&&(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024)),n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer),!0===c&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),p&&t.invalidateFramebuffer(36008,a),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=st,this.setupFrameBufferTexture=nt,this.useMultisampledRTT=at}function Cs(t,e,n){const i=n.isWebGL2;return{convert:function(n,r=null){let s;if(n===E)return 5121;if(1017===n)return 32819;if(1018===n)return 32820;if(1010===n)return 5120;if(1011===n)return 5122;if(n===A)return 5123;if(1013===n)return 5124;if(n===C)return 5125;if(n===P)return 5126;if(n===R)return i?5131:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return 6406;if(n===I)return 6408;if(1024===n)return 6409;if(1025===n)return 6410;if(n===D)return 6402;if(n===O)return 34041;if(n===B)return 6403;if(1022===n)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(n===rt)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===n)return 36244;if(1030===n)return 33319;if(1031===n)return 33320;if(1033===n)return 36249;if(n===N||n===z||n===k||n===F)if(r===$){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(n===N)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===z)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===k)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===F)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(n===N)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===z)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===k)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===F)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===n)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===n)return r===$?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return r===$?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===n){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(36492===n)return r===$?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===L?i?34042:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[n]?t[n]:null}}}Ss.prototype.isMeshDistanceMaterial=!0;class Ps extends Xn{constructor(t=[]){super(),this.cameras=t}}Ps.prototype.isArrayCamera=!0;class Rs extends qe{constructor(){super(),this.type="Group"}}Rs.prototype.isGroup=!0;const Ls={type:"move"};class Is{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Rs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Rs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Wt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Wt),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Rs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Wt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Wt),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(i=e.getPose(t.targetRaySpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ls))),l&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const t=new Rs;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[i.jointName]=t,l.add(t)}const r=l.joints[i.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,h=.005;l.inputState.pinching&&o>a+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Ds extends kt{constructor(t,e,n,i,r,s,o,a,l,h){if((h=void 0!==h?h:D)!==D&&h!==O)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&h===D&&(n=A),void 0===n&&h===O&&(n=L),super(null,i,r,s,o,a,h,n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:b,this.minFilter=void 0!==a?a:b,this.flipY=!1,this.generateMipmaps=!1}}Ds.prototype.isDepthTexture=!0;class Os extends st{constructor(t,e){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=null,l=null,h=null,c=null,u=null,d=null;const p=e.getContextAttributes();let f=null,m=null;const g=[],v=new Map,y=new Xn;y.layers.enable(1),y.viewport=new Ft;const x=new Xn;x.layers.enable(2),x.viewport=new Ft;const b=[y,x],w=new Ps;w.layers.enable(1),w.layers.enable(2);let _=null,M=null;function S(t){const e=v.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function T(){v.forEach((function(t,e){t.disconnect(e)})),v.clear(),_=null,M=null,t.setRenderTarget(f),u=null,c=null,h=null,i=null,m=null,z.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function C(t){const e=i.inputSources;for(let t=0;t<e.length;t++){const n="right"===e[t].handedness?1:0;v.set(e[t],g[n])}for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=v.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),v.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],i=v.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=g[t];return void 0===e&&(e=new Is,g[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=g[t];return void 0===e&&(e=new Is,g[t]=e),e.getGripSpace()},this.getHand=function(t){let e=g[t];return void 0===e&&(e=new Is,g[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a||s},this.setReferenceSpace=function(t){a=t},this.getBaseLayer=function(){return null!==c?c:u},this.getBinding=function(){return h},this.getFrame=function(){return d},this.getSession=function(){return i},this.setSession=async function(a){if(i=a,null!==i){if(f=t.getRenderTarget(),i.addEventListener("select",S),i.addEventListener("selectstart",S),i.addEventListener("selectend",S),i.addEventListener("squeeze",S),i.addEventListener("squeezestart",S),i.addEventListener("squeezeend",S),i.addEventListener("end",T),i.addEventListener("inputsourceschange",C),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:u}),m=new Ut(u.framebufferWidth,u.framebufferHeight,{format:I,type:E,encoding:t.outputEncoding})}else{let n=null,s=null,o=null;p.depth&&(o=p.stencil?35056:33190,n=p.stencil?O:D,s=p.stencil?L:A);const a={colorFormat:t.outputEncoding===$?35907:32856,depthFormat:o,scaleFactor:r};h=new XRWebGLBinding(i,e),c=h.createProjectionLayer(a),i.updateRenderState({layers:[c]}),m=new Ut(c.textureWidth,c.textureHeight,{format:I,type:E,depthTexture:new Ds(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0}),t.properties.get(m).__ignoreDepthValues=c.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),s=await i.requestReferenceSpace(o),z.setContext(i),z.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const P=new Wt,R=new Wt;function B(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;w.near=x.near=y.near=t.near,w.far=x.far=y.far=t.far,_===w.near&&M===w.far||(i.updateRenderState({depthNear:w.near,depthFar:w.far}),_=w.near,M=w.far);const e=t.parent,n=w.cameras;B(w,e);for(let t=0;t<n.length;t++)B(n[t],e);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),t.position.copy(w.position),t.quaternion.copy(w.quaternion),t.scale.copy(w.scale),t.matrix.copy(w.matrix),t.matrixWorld.copy(w.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===n.length?function(t,e,n){P.setFromMatrixPosition(e.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const i=P.distanceTo(R),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*c,p=o*u,f=i/(-c+u),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+f,v=a+f,y=d-m,x=p+(i-m),b=l*a/v*g,w=h*a/v*g;t.projectionMatrix.makePerspective(y,x,b,w,g,v)}(w,y,x):w.projectionMatrix.copy(y.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let N=null;const z=new si;z.setAnimationLoop((function(e,n){if(l=n.getViewerPose(a||s),d=n,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(m,u.framebuffer),t.setRenderTarget(m));let n=!1;e.length!==w.cameras.length&&(w.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==u)s=u.getViewport(r);else{const e=h.getViewSubImage(c,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(m,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}const o=b[i];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&w.matrix.copy(o.matrix),!0===n&&w.cameras.push(o)}}const r=i.inputSources;for(let t=0;t<g.length;t++){const e=r[t],i=v.get(e);void 0!==i&&i.update(e,n,a||s)}N&&N(e,n),d=null})),this.setAnimationLoop=function(t){N=t},this.dispose=function(){}}}function Bs(t,e){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,1===i.side&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),1===i.side&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);const r=e.get(i).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*e}let s,o;i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap?s=i.clearcoatRoughnessMap:i.specularIntensityMap?s=i.specularIntensityMap:i.specularColorMap?s=i.specularColorMap:i.transmissionMap?s=i.transmissionMap:i.thicknessMap?s=i.thicknessMap:i.sheenColorMap?s=i.sheenColorMap:i.sheenRoughnessMap&&(s=i.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),n.uvTransform.value.copy(s.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),n.uv2Transform.value.copy(o.matrix))}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(t,i):i.isMeshToonMaterial?(n(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,i)):i.isMeshPhongMaterial?(n(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,i)):i.isMeshStandardMaterial?(n(t,i),function(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}(t,i),i.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,i,o)):i.isMeshMatcapMaterial?(n(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,i)):i.isMeshDepthMaterial?n(t,i):i.isMeshDistanceMaterial?(n(t,i),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?n(t,i):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,r,s):i.isSpriteMaterial?function(t,e){let n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Ns(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=wt("canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,r=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,h=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",d=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let p;p=null!==n?n.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let f=null,m=null;const g=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Y,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let x=!1,b=0,w=0,_=null,M=-1,S=null;const A=new Ft,C=new Ft;let L=null,D=e.width,O=e.height,B=1,N=null,z=null;const k=new Ft(0,0,D,O),F=new Ft(0,0,D,O);let U=!1;const H=new ri;let V=!1,G=!1,W=null;const j=new we,q=new yt,X=new Wt,$={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return null===_?B:1}let Z,J,Q,tt,et,nt,it,rt,st,ot,at,lt,ht,ct,ut,dt,pt,ft,mt,vt,xt,bt,_t,Mt=n;function St(t,n){for(let i=0;i<t.length;i++){const r=t[i],s=e.getContext(r,n);if(null!==s)return s}return null}try{const t={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:h,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${i}`),e.addEventListener("webglcontextlost",At,!1),e.addEventListener("webglcontextrestored",Ct,!1),null===Mt){const e=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&e.shift(),Mt=St(e,t),null===Mt)throw St(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Mt.getShaderPrecisionFormat&&(Mt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Tt(){Z=new Li(Mt),J=new fi(Mt,Z,t),Z.init(J),bt=new Cs(Mt,Z,J),Q=new Es(Mt,Z,J),tt=new Oi(Mt),et=new ds,nt=new As(Mt,Z,Q,et,J,bt,tt),it=new gi(y),rt=new Ri(y),st=new oi(Mt,J),_t=new di(Mt,Z,st,J),ot=new Ii(Mt,st,tt,_t),at=new Fi(Mt,ot,st,tt),mt=new ki(Mt,J,nt),dt=new mi(et),lt=new us(y,it,rt,Z,J,_t,dt),ht=new Bs(y,et),ct=new gs,ut=new _s(Z,J),ft=new ui(y,it,Q,at,p,h),pt=new Ts(y,at,J),vt=new pi(Mt,Z,tt,J),xt=new Di(Mt,Z,tt,J),tt.programs=lt.programs,y.capabilities=J,y.extensions=Z,y.properties=et,y.renderLists=ct,y.shadowMap=pt,y.state=Q,y.info=tt}Tt();const Et=new Os(y,Mt);function At(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Ct(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const t=tt.autoReset,e=pt.enabled,n=pt.autoUpdate,i=pt.needsUpdate,r=pt.type;Tt(),tt.autoReset=t,pt.enabled=e,pt.autoUpdate=n,pt.needsUpdate=i,pt.type=r}function Pt(t){const e=t.target;e.removeEventListener("dispose",Pt),function(t){(function(t){const e=et.get(t).programs;void 0!==e&&(e.forEach((function(t){lt.releaseProgram(t)})),t.isShaderMaterial&&lt.releaseShaderCache(t))})(t),et.remove(t)}(e)}this.xr=Et,this.getContext=function(){return Mt},this.getContextAttributes=function(){return Mt.getContextAttributes()},this.forceContextLoss=function(){const t=Z.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Z.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(t){void 0!==t&&(B=t,this.setSize(D,O,!1))},this.getSize=function(t){return t.set(D,O)},this.setSize=function(t,n,i){Et.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(D=t,O=n,e.width=Math.floor(t*B),e.height=Math.floor(n*B),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(D*B,O*B).floor()},this.setDrawingBufferSize=function(t,n,i){D=t,O=n,B=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(k)},this.setViewport=function(t,e,n,i){t.isVector4?k.set(t.x,t.y,t.z,t.w):k.set(t,e,n,i),Q.viewport(A.copy(k).multiplyScalar(B).floor())},this.getScissor=function(t){return t.copy(F)},this.setScissor=function(t,e,n,i){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,n,i),Q.scissor(C.copy(F).multiplyScalar(B).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(t){Q.setScissorTest(U=t)},this.setOpaqueSort=function(t){N=t},this.setTransparentSort=function(t){z=t},this.getClearColor=function(t){return t.copy(ft.getClearColor())},this.setClearColor=function(){ft.setClearColor.apply(ft,arguments)},this.getClearAlpha=function(){return ft.getClearAlpha()},this.setClearAlpha=function(){ft.setClearAlpha.apply(ft,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;t&&(i|=16384),e&&(i|=256),n&&(i|=1024),Mt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",At,!1),e.removeEventListener("webglcontextrestored",Ct,!1),ct.dispose(),ut.dispose(),et.dispose(),it.dispose(),rt.dispose(),at.dispose(),_t.dispose(),lt.dispose(),Et.dispose(),Et.removeEventListener("sessionstart",Lt),Et.removeEventListener("sessionend",It),W&&(W.dispose(),W=null),Dt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=$);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,n,i,r){!0!==e.isScene&&(e=$),nt.resetTextureUnits();const s=e.fog,o=i.isMeshStandardMaterial?e.environment:null,a=null===_?y.outputEncoding:!0===_.isXRRenderTarget?_.texture.encoding:Y,l=(i.isMeshStandardMaterial?rt:it).get(i.envMap||o),h=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!i.normalMap&&!!n.attributes.tangent,u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,f=i.toneMapped?y.toneMapping:0,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,x=et.get(i),b=m.state.lights;if(!0===V&&(!0===G||t!==S)){const e=t===S&&i.id===M;dt.setState(i,t,e)}let w=!1;i.version===x.__version?x.needsLights&&x.lightsStateVersion!==b.state.version||x.outputEncoding!==a||r.isInstancedMesh&&!1===x.instancing?w=!0:r.isInstancedMesh||!0!==x.instancing?r.isSkinnedMesh&&!1===x.skinning?w=!0:r.isSkinnedMesh||!0!==x.skinning?x.envMap!==l||!0===i.fog&&x.fog!==s?w=!0:void 0===x.numClippingPlanes||x.numClippingPlanes===dt.numPlanes&&x.numIntersection===dt.numIntersection?(x.vertexAlphas!==h||x.vertexTangents!==c||x.morphTargets!==u||x.morphNormals!==d||x.morphColors!==p||x.toneMapping!==f||!0===J.isWebGL2&&x.morphTargetsCount!==v)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,x.__version=i.version);let T=x.currentProgram;!0===w&&(T=kt(i,e,r));let E=!1,A=!1,C=!1;const P=T.getUniforms(),R=x.uniforms;if(Q.useProgram(T.program)&&(E=!0,A=!0,C=!0),i.id!==M&&(M=i.id,A=!0),E||S!==t){if(P.setValue(Mt,"projectionMatrix",t.projectionMatrix),J.logarithmicDepthBuffer&&P.setValue(Mt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),S!==t&&(S=t,A=!0,C=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=P.map.cameraPosition;void 0!==e&&e.setValue(Mt,X.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(Mt,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&P.setValue(Mt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){P.setOptional(Mt,r,"bindMatrix"),P.setOptional(Mt,r,"bindMatrixInverse");const t=r.skeleton;t&&(J.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(Mt,"boneTexture",t.boneTexture,nt),P.setValue(Mt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const L=n.morphAttributes;var I,D;return(void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===J.isWebGL2)&&mt.update(r,n,i,T),(A||x.receiveShadow!==r.receiveShadow)&&(x.receiveShadow=r.receiveShadow,P.setValue(Mt,"receiveShadow",r.receiveShadow)),A&&(P.setValue(Mt,"toneMappingExposure",y.toneMappingExposure),x.needsLights&&(D=C,(I=R).ambientLightColor.needsUpdate=D,I.lightProbe.needsUpdate=D,I.directionalLights.needsUpdate=D,I.directionalLightShadows.needsUpdate=D,I.pointLights.needsUpdate=D,I.pointLightShadows.needsUpdate=D,I.spotLights.needsUpdate=D,I.spotLightShadows.needsUpdate=D,I.rectAreaLights.needsUpdate=D,I.hemisphereLights.needsUpdate=D),s&&!0===i.fog&&ht.refreshFogUniforms(R,s),ht.refreshMaterialUniforms(R,i,B,O,W),Gr.upload(Mt,x.uniformsList,R,nt)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Gr.upload(Mt,x.uniformsList,R,nt),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&P.setValue(Mt,"center",r.center),P.setValue(Mt,"modelViewMatrix",r.modelViewMatrix),P.setValue(Mt,"normalMatrix",r.normalMatrix),P.setValue(Mt,"modelMatrix",r.matrixWorld),T}(t,e,n,i,r);Q.setMaterial(i,o);let l=n.index;const h=n.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,u=1;!0===i.wireframe&&(l=ot.getWireframeAttribute(n),u=2),_t.setup(r,i,a,n,l);let d=vt;null!==l&&(c=st.get(l),d=xt,d.setIndex(c));const p=null!==l?l.count:h.count,f=n.drawRange.start*u,g=n.drawRange.count*u,v=null!==s?s.start*u:0,x=null!==s?s.count*u:1/0,b=Math.max(f,v),w=Math.min(p,f+g,v+x)-1,T=Math.max(0,w-b+1);if(0!==T){if(r.isMesh)!0===i.wireframe?(Q.setLineWidth(i.wireframeLinewidth*K()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),Q.setLineWidth(t*K()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(b,T,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(b,T,t)}else d.render(b,T)}},this.compile=function(t,e){m=ut.get(t),m.init(),v.push(m),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(m.pushLight(t),t.castShadow&&m.pushShadow(t))})),m.setupLights(y.physicallyCorrectLights),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++)kt(n[i],t,e);else kt(n,t,e)})),v.pop(),m=null};let Rt=null;function Lt(){Dt.stop()}function It(){Dt.start()}const Dt=new si;function Ot(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)m.pushLight(t),t.castShadow&&m.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||H.intersectsSprite(t)){i&&X.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=at.update(t),r=t.material;r.visible&&f.push(t,e,r,n,X.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==tt.render.frame&&(t.skeleton.update(),t.skeleton.frame=tt.render.frame),!t.frustumCulled||H.intersectsObject(t))){i&&X.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=at.update(t),r=t.material;if(Array.isArray(r)){const i=e.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r[o.materialIndex];a&&a.visible&&f.push(t,e,a,n,X.z,o)}}else r.visible&&f.push(t,e,r,n,X.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Ot(r[t],e,n,i)}function Bt(t,e,n,i){const r=t.opaque,s=t.transmissive,a=t.transparent;m.setupLightsView(n),s.length>0&&function(t,e,n){const i=J.isWebGL2;null===W&&(W=new Ut(1,1,{generateMipmaps:!0,type:Z.has("EXT_color_buffer_half_float")?R:E,minFilter:T,samples:i&&!0===o?4:0})),y.getDrawingBufferSize(q),i?W.setSize(q.x,q.y):W.setSize(gt(q.x),gt(q.y));const r=y.getRenderTarget();y.setRenderTarget(W),y.clear();const s=y.toneMapping;y.toneMapping=0,Nt(t,e,n),y.toneMapping=s,nt.updateMultisampleRenderTarget(W),nt.updateRenderTargetMipmap(W),y.setRenderTarget(r)}(r,e,n),i&&Q.viewport(A.copy(i)),r.length>0&&Nt(r,e,n),s.length>0&&Nt(s,e,n),a.length>0&&Nt(a,e,n),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function Nt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,l=null===i?s.material:i,h=s.group;o.layers.test(n.layers)&&zt(o,e,n,a,l,h)}}function zt(t,e,n,i,r,s){t.onBeforeRender(y,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(y,e,n,i,t,s),!0===r.transparent&&r.side===l?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=a,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=l):y.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(y,e,n,i,r,s)}function kt(t,e,n){!0!==e.isScene&&(e=$);const i=et.get(t),r=m.state.lights,s=m.state.shadowsArray,o=r.state.version,a=lt.getParameters(t,r.state,s,e,n),l=lt.getProgramCacheKey(a);let h=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?rt:it).get(t.envMap||i.environment),void 0===h&&(t.addEventListener("dispose",Pt),h=new Map,i.programs=h);let c=h.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===o)return Ht(t,a),c}else a.uniforms=lt.getUniforms(t),t.onBuild(n,a,y),t.onBeforeCompile(a,y),c=lt.acquireProgram(a,l),h.set(l,c),i.uniforms=a.uniforms;const u=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=dt.uniform),Ht(t,a),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=c.getUniforms(),p=Gr.seqWithValue(d.seq,u);return i.currentProgram=c,i.uniformsList=p,c}function Ht(t,e){const n=et.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Dt.setAnimationLoop((function(t){Rt&&Rt(t)})),"undefined"!=typeof self&&Dt.setContext(self),this.setAnimationLoop=function(t){Rt=t,Et.setAnimationLoop(t),null===t?Dt.stop():Dt.start()},Et.addEventListener("sessionstart",Lt),Et.addEventListener("sessionend",It),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Et.enabled&&!0===Et.isPresenting&&(!0===Et.cameraAutoUpdate&&Et.updateCamera(e),e=Et.getCamera()),!0===t.isScene&&t.onBeforeRender(y,t,e,_),m=ut.get(t,v.length),m.init(),v.push(m),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),H.setFromProjectionMatrix(j),G=this.localClippingEnabled,V=dt.init(this.clippingPlanes,G,e),f=ct.get(t,g.length),f.init(),g.push(f),Ot(t,e,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(N,z),!0===V&&dt.beginShadows();const n=m.state.shadowsArray;if(pt.render(n,t,e),!0===V&&dt.endShadows(),!0===this.info.autoReset&&this.info.reset(),ft.render(f,t),m.setupLights(y.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Bt(f,t,i,i.viewport)}}else Bt(f,t,e);null!==_&&(nt.updateMultisampleRenderTarget(_),nt.updateRenderTargetMipmap(_)),!0===t.isScene&&t.onAfterRender(y,t,e),_t.resetDefaultState(),M=-1,S=null,v.pop(),m=v.length>0?v[v.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(t,e,n){et.get(t.texture).__webglTexture=e,et.get(t.depthTexture).__webglTexture=n;const i=et.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===Z.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const n=et.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){_=t,b=e,w=n;let i=!0;if(t){const e=et.get(t);void 0!==e.__useDefaultFramebuffer?(Q.bindFramebuffer(36160,null),i=!1):void 0===e.__webglFramebuffer?nt.setupRenderTarget(t):e.__hasExternalTextures&&nt.rebindTextures(t,et.get(t.texture).__webglTexture,et.get(t.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(t){const n=t.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(o=!0);const i=et.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=i[e],s=!0):r=J.isWebGL2&&t.samples>0&&!1===nt.useMultisampledRTT(t)?et.get(t).__webglMultisampledFramebuffer:i,A.copy(t.viewport),C.copy(t.scissor),L=t.scissorTest}else A.copy(k).multiplyScalar(B).floor(),C.copy(F).multiplyScalar(B).floor(),L=U;if(Q.bindFramebuffer(36160,r)&&J.drawBuffers&&i&&Q.drawBuffers(t,r),Q.viewport(A),Q.scissor(C),Q.setScissorTest(L),s){const i=et.get(t.texture);Mt.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}else if(o){const i=et.get(t.texture),r=e||0;Mt.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}M=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=et.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Q.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,l=o.type;if(a!==I&&bt.convert(a)!==Mt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===R&&(Z.has("EXT_color_buffer_half_float")||J.isWebGL2&&Z.has("EXT_color_buffer_float"));if(!(l===E||bt.convert(l)===Mt.getParameter(35738)||l===P&&(J.isWebGL2||Z.has("OES_texture_float")||Z.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&Mt.readPixels(e,n,i,r,bt.convert(a),bt.convert(l),s)}finally{const t=null!==_?et.get(_).__webglFramebuffer:null;Q.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);nt.setTexture2D(e,0),Mt.copyTexSubImage2D(3553,n,0,0,t.x,t.y,r,s),Q.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,o=bt.convert(n.format),a=bt.convert(n.type);nt.setTexture2D(n,0),Mt.pixelStorei(37440,n.flipY),Mt.pixelStorei(37441,n.premultiplyAlpha),Mt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?Mt.texSubImage2D(3553,i,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?Mt.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):Mt.texSubImage2D(3553,i,t.x,t.y,o,a,e.image),0===i&&n.generateMipmaps&&Mt.generateMipmap(3553),Q.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,l=bt.convert(i.format),h=bt.convert(i.type);let c;if(i.isData3DTexture)nt.setTexture3D(i,0),c=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");nt.setTexture2DArray(i,0),c=35866}Mt.pixelStorei(37440,i.flipY),Mt.pixelStorei(37441,i.premultiplyAlpha),Mt.pixelStorei(3317,i.unpackAlignment);const u=Mt.getParameter(3314),d=Mt.getParameter(32878),p=Mt.getParameter(3316),f=Mt.getParameter(3315),m=Mt.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;Mt.pixelStorei(3314,g.width),Mt.pixelStorei(32878,g.height),Mt.pixelStorei(3316,t.min.x),Mt.pixelStorei(3315,t.min.y),Mt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isData3DTexture?Mt.texSubImage3D(c,r,e.x,e.y,e.z,s,o,a,l,h,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Mt.compressedTexSubImage3D(c,r,e.x,e.y,e.z,s,o,a,l,g.data)):Mt.texSubImage3D(c,r,e.x,e.y,e.z,s,o,a,l,h,g),Mt.pixelStorei(3314,u),Mt.pixelStorei(32878,d),Mt.pixelStorei(3316,p),Mt.pixelStorei(3315,f),Mt.pixelStorei(32877,m),0===r&&i.generateMipmaps&&Mt.generateMipmap(c),Q.unbindTexture()},this.initTexture=function(t){nt.setTexture2D(t,0),Q.unbindTexture()},this.resetState=function(){b=0,w=0,_=null,Q.reset(),_t.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ns.prototype.isWebGLRenderer=!0;class zs extends Ns{}zs.prototype.isWebGL1Renderer=!0;class ks{constructor(t,e=25e-5){this.name="",this.color=new It(t),this.density=e}clone(){return new ks(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}ks.prototype.isFogExp2=!0;class Fs{constructor(t,e=1,n=1e3){this.name="",this.color=new It(t),this.near=e,this.far=n}clone(){return new Fs(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Fs.prototype.isFog=!0;class Us extends qe{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Us.prototype.isScene=!0;class Hs{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=et,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ct()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ct()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ct()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Hs.prototype.isInterleavedBuffer=!0;const Vs=new Wt;class Gs{constructor(t,e,n,i=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Vs.fromBufferAttribute(this,e),Vs.applyMatrix4(t),this.setXYZ(e,Vs.x,Vs.y,Vs.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Vs.fromBufferAttribute(this,e),Vs.applyNormalMatrix(t),this.setXYZ(e,Vs.x,Vs.y,Vs.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Vs.fromBufferAttribute(this,e),Vs.transformDirection(t),this.setXYZ(e,Vs.x,Vs.y,Vs.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new cn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Gs(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Gs.prototype.isInterleavedBufferAttribute=!0;class Ws extends on{constructor(t){super(),this.type="SpriteMaterial",this.color=new It(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let js;Ws.prototype.isSpriteMaterial=!0;const qs=new Wt,Xs=new Wt,Ys=new Wt,$s=new yt,Ks=new yt,Zs=new we,Js=new Wt,Qs=new Wt,to=new Wt,eo=new yt,no=new yt,io=new yt;function ro(t,e,n,i,r,s){$s.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(Ks.x=s*$s.x-r*$s.y,Ks.y=r*$s.x+s*$s.y):Ks.copy($s),t.copy(e),t.x+=Ks.x,t.y+=Ks.y,t.applyMatrix4(Zs)}(class extends qe{constructor(t){if(super(),this.type="Sprite",void 0===js){js=new wn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new Hs(t,5);js.setIndex([0,1,2,0,2,3]),js.setAttribute("position",new Gs(e,3,0,!1)),js.setAttribute("uv",new Gs(e,2,3,!1))}this.geometry=js,this.material=void 0!==t?t:new Ws,this.center=new yt(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Xs.setFromMatrixScale(this.matrixWorld),Zs.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ys.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Xs.multiplyScalar(-Ys.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;ro(Js.set(-.5,-.5,0),Ys,s,Xs,i,r),ro(Qs.set(.5,-.5,0),Ys,s,Xs,i,r),ro(to.set(.5,.5,0),Ys,s,Xs,i,r),eo.set(0,0),no.set(1,0),io.set(1,1);let o=t.ray.intersectTriangle(Js,Qs,to,!1,qs);if(null===o&&(ro(Qs.set(-.5,.5,0),Ys,s,Xs,i,r),no.set(0,1),o=t.ray.intersectTriangle(Js,to,Qs,!1,qs),null===o))return;const a=t.ray.origin.distanceTo(qs);a<t.near||a>t.far||e.push({distance:a,point:qs.clone(),uv:rn.getUV(qs,Js,Qs,to,eo,no,io,new yt),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}).prototype.isSprite=!0;const so=new Wt,oo=new Ft,ao=new Ft,lo=new Wt,ho=new we;class co extends Fn{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new we,this.bindMatrixInverse=new we}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Ft,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,i=this.geometry;oo.fromBufferAttribute(i.attributes.skinIndex,t),ao.fromBufferAttribute(i.attributes.skinWeight,t),so.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const i=ao.getComponent(t);if(0!==i){const r=oo.getComponent(t);ho.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(lo.copy(so).applyMatrix4(ho),i)}}return e.applyMatrix4(this.bindMatrixInverse)}}co.prototype.isSkinnedMesh=!0;class uo extends qe{constructor(){super(),this.type="Bone"}}uo.prototype.isBone=!0;class po extends kt{constructor(t=null,e=1,n=1,i,r,s,o,a,l=b,h=b,c,u){super(null,s,o,a,l,h,i,r,c,u),this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}po.prototype.isDataTexture=!0;const fo=new we,mo=new we;class go{constructor(t=[],e=[]){this.uuid=ct(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new we)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new we;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:mo;fo.multiplyMatrices(r,e[i]),fo.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new go(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=mt(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new po(e,t,t,I,P);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new uo),this.bones.push(r),this.boneInverses.push((new we).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class vo extends cn{constructor(t,e,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}vo.prototype.isInstancedBufferAttribute=!0;const yo=new we,xo=new we,bo=[],wo=new Fn;(class extends Fn{constructor(t,e,n){super(t,e),this.instanceMatrix=new vo(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(wo.geometry=this.geometry,wo.material=this.material,void 0!==wo.material)for(let r=0;r<i;r++){this.getMatrixAt(r,yo),xo.multiplyMatrices(n,yo),wo.matrixWorld=xo,wo.raycast(t,bo);for(let t=0,n=bo.length;t<n;t++){const n=bo[t];n.instanceId=r,n.object=this,e.push(n)}bo.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new vo(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class _o extends on{constructor(t){super(),this.type="LineBasicMaterial",this.color=new It(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}_o.prototype.isLineBasicMaterial=!0;const Mo=new Wt,So=new Wt,To=new we,Eo=new be,Ao=new de;class Co extends qe{constructor(t=new wn,e=new _o){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Mo.fromBufferAttribute(e,t-1),So.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Mo.distanceTo(So);t.setAttribute("lineDistance",new pn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ao.copy(n.boundingSphere),Ao.applyMatrix4(i),Ao.radius+=r,!1===t.ray.intersectsSphere(Ao))return;To.copy(i).invert(),Eo.copy(t.ray).applyMatrix4(To);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Wt,h=new Wt,c=new Wt,u=new Wt,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i)for(let n=Math.max(0,s.start),o=Math.min(i.count,s.start+s.count)-1;n<o;n+=d){const s=i.getX(n),o=i.getX(n+1);if(l.fromBufferAttribute(r,s),h.fromBufferAttribute(r,o),Eo.distanceSqToSegment(l,h,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,s.start),i=Math.min(r.count,s.start+s.count)-1;n<i;n+=d){if(l.fromBufferAttribute(r,n),h.fromBufferAttribute(r,n+1),Eo.distanceSqToSegment(l,h,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(u);i<t.near||i>t.far||e.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Co.prototype.isLine=!0;const Po=new Wt,Ro=new Wt;class Lo extends Co{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Po.fromBufferAttribute(e,t),Ro.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Po.distanceTo(Ro);t.setAttribute("lineDistance",new pn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Lo.prototype.isLineSegments=!0;class Io extends Co{constructor(t,e){super(t,e),this.type="LineLoop"}}Io.prototype.isLineLoop=!0;class Do extends on{constructor(t){super(),this.type="PointsMaterial",this.color=new It(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}Do.prototype.isPointsMaterial=!0;const Oo=new we,Bo=new be,No=new de,zo=new Wt;class ko extends qe{constructor(t=new wn,e=new Do){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),No.copy(n.boundingSphere),No.applyMatrix4(i),No.radius+=r,!1===t.ray.intersectsSphere(No))return;Oo.copy(i).invert(),Bo.copy(t.ray).applyMatrix4(Oo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position;if(null!==r)for(let n=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);n<l;n++){const s=r.getX(n);zo.fromBufferAttribute(o,s),Fo(zo,s,a,i,t,e,this)}else for(let n=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);n<r;n++)zo.fromBufferAttribute(o,n),Fo(zo,n,a,i,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Fo(t,e,n,i,r,s,o){const a=Bo.distanceSqToPoint(t);if(a<n){const n=new Wt;Bo.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}ko.prototype.isPoints=!0,class extends kt{constructor(t,e,n,i,r,s,o,a,l){super(t,e,n,i,r,s,o,a,l),this.minFilter=void 0!==s?s:M,this.magFilter=void 0!==r?r:M,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends kt{constructor(t,e,n){super({width:t,height:e}),this.format=n,this.magFilter=b,this.minFilter=b,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;(class extends kt{constructor(t,e,n,i,r,s,o,a,l,h,c,u){super(null,s,o,a,l,h,i,r,c,u),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0;class Uo extends kt{constructor(t,e,n,i,r,s,o,a,l){super(t,e,n,i,r,s,o,a,l),this.needsUpdate=!0}}Uo.prototype.isCanvasTexture=!0;class Ho{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let o,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=n[i]-s,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const h=n[i];return(i+(s-h)/(n[i+1]-h))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),o=this.getPoint(r),a=e||(s.isVector2?new yt:new Wt);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new Wt,i=[],r=[],s=[],o=new Wt,a=new we;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new Wt)}r[0]=new Wt,s[0]=new Wt;let l=Number.MAX_VALUE;const h=Math.abs(i[0].x),c=Math.abs(i[0].y),u=Math.abs(i[0].z);h<=l&&(l=h,n.set(1,0,0)),c<=l&&(l=c,n.set(0,1,0)),u<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(i[e-1],i[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(ut(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(ut(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Vo extends Ho{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const n=e||new yt,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Vo.prototype.isEllipseCurve=!0;class Go extends Vo{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.type="ArcCurve"}}function Wo(){let t=0,e=0,n=0,i=0;function r(r,s,o,a){t=r,e=o,n=-3*r+3*s-2*o-a,i=2*r-2*s+o+a}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,h=(n-e)/o-(i-e)/(o+a)+(i-n)/a;l*=o,h*=o,r(e,n,l,h)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}Go.prototype.isArcCurve=!0;const jo=new Wt,qo=new Wo,Xo=new Wo,Yo=new Wo;class $o extends Ho{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new Wt){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let o,a,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?o=i[(l-1)%r]:(jo.subVectors(i[0],i[1]).add(i[0]),o=jo);const c=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?a=i[(l+2)%r]:(jo.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=jo),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),qo.initNonuniformCatmullRom(o.x,c.x,u.x,a.x,e,n,i),Xo.initNonuniformCatmullRom(o.y,c.y,u.y,a.y,e,n,i),Yo.initNonuniformCatmullRom(o.z,c.z,u.z,a.z,e,n,i)}else"catmullrom"===this.curveType&&(qo.initCatmullRom(o.x,c.x,u.x,a.x,this.tension),Xo.initCatmullRom(o.y,c.y,u.y,a.y,this.tension),Yo.initCatmullRom(o.z,c.z,u.z,a.z,this.tension));return n.set(qo.calc(h),Xo.calc(h),Yo.calc(h)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Wt).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ko(t,e,n,i,r){const s=.5*(i-e),o=.5*(r-n),a=t*t;return(2*n-2*i+s+o)*(t*a)+(-3*n+3*i-2*s-o)*a+s*t+n}function Zo(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function Jo(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}$o.prototype.isCatmullRomCurve3=!0;class Qo extends Ho{constructor(t=new yt,e=new yt,n=new yt,i=new yt){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new yt){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(Jo(t,i.x,r.x,s.x,o.x),Jo(t,i.y,r.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Qo.prototype.isCubicBezierCurve=!0;class ta extends Ho{constructor(t=new Wt,e=new Wt,n=new Wt,i=new Wt){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Wt){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(Jo(t,i.x,r.x,s.x,o.x),Jo(t,i.y,r.y,s.y,o.y),Jo(t,i.z,r.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}ta.prototype.isCubicBezierCurve3=!0;class ea extends Ho{constructor(t=new yt,e=new yt){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new yt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new yt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ea.prototype.isLineCurve=!0;class na extends Ho{constructor(t=new yt,e=new yt,n=new yt){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new yt){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Zo(t,i.x,r.x,s.x),Zo(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}na.prototype.isQuadraticBezierCurve=!0;class ia extends Ho{constructor(t=new Wt,e=new Wt,n=new Wt){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Wt){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Zo(t,i.x,r.x,s.x),Zo(t,i.y,r.y,s.y),Zo(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ia.prototype.isQuadraticBezierCurve3=!0;class ra extends Ho{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new yt){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),o=r-s,a=i[0===s?s:s-1],l=i[s],h=i[s>i.length-2?i.length-1:s+1],c=i[s>i.length-3?i.length-1:s+2];return n.set(Ko(o,a.x,l.x,h.x,c.x),Ko(o,a.y,l.y,h.y,c.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new yt).fromArray(n))}return this}}ra.prototype.isSplineCurve=!0;var sa=Object.freeze({__proto__:null,ArcCurve:Go,CatmullRomCurve3:$o,CubicBezierCurve:Qo,CubicBezierCurve3:ta,EllipseCurve:Vo,LineCurve:ea,LineCurve3:class extends Ho{constructor(t=new Wt,e=new Wt){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Wt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:na,QuadraticBezierCurve3:ia,SplineCurve:ra});class oa extends Ho{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ea(e,t))}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new sa[n.type]).fromJSON(n))}return this}}class aa extends oa{constructor(t){super(),this.type="Path",this.currentPoint=new yt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new ea(this.currentPoint.clone(),new yt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new na(this.currentPoint.clone(),new yt(t,e),new yt(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const o=new Qo(this.currentPoint.clone(),new yt(t,e),new yt(n,i),new yt(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new ra(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,o,a){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,n,i,r,s,o,a),this}absellipse(t,e,n,i,r,s,o,a){const l=new Vo(t,e,n,i,r,s,o,a);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class la extends wn{constructor(t=1,e=1,n=1,i=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const h=[],c=[],u=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,s=new yt,f=new Wt;let v=0;const y=!0===n?t:e,x=!0===n?1:-1;for(let t=1;t<=i;t++)c.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=i;t++){const e=t/i*a+o,n=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*x,f.z=y*n,c.push(f.x,f.y,f.z),u.push(0,x,0),s.x=.5*n+.5,s.y=.5*r*x+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?h.push(i,i+1,e):h.push(i+1,i,e),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new Wt,v=new Wt;let y=0;const x=(e-t)/n;for(let l=0;l<=r;l++){const h=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*a+o,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,c.push(v.x,v.y,v.z),s.set(l,x,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),h.push(p++)}f.push(h)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];h.push(n,i,s),h.push(i,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new pn(c,3)),this.setAttribute("normal",new pn(u,3)),this.setAttribute("uv",new pn(d,2))}static fromJSON(t){return new la(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ha extends wn{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function o(t,e,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const o=t.clone().lerp(n,i/r),a=e.clone().lerp(n,i/r),l=r-i;for(let t=0;t<=l;t++)s[i][t]=0===t&&i===r?o:o.clone().lerp(a,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(s[t][n+1]),a(s[t+1][n]),a(s[t][n])):(a(s[t][n+1]),a(s[t+1][n+1]),a(s[t+1][n]))}}function a(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function h(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new Wt,i=new Wt,r=new Wt;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],i),l(e[s+2],r),o(n,i,r,t)}(i),function(t){const e=new Wt;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Wt;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=c(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(i,1-o)}var e;(function(){const t=new Wt,e=new Wt,n=new Wt,i=new Wt,o=new yt,a=new yt,l=new yt;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=c(i);h(o,d+0,t,p),h(a,d+2,e,p),h(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),o=Math.min(e,n,i);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new pn(r,3)),this.setAttribute("normal",new pn(r.slice(),3)),this.setAttribute("uv",new pn(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new ha(t.vertices,t.indices,t.radius,t.details)}}new Wt,new Wt,new Wt,new rn;class ca extends aa{constructor(t){super(t),this.uuid=ct(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new aa).fromJSON(n))}return this}}function ua(t,e,n,i,r){let s,o;if(r===function(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)o=Ia(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=Ia(s,t[s],t[s+1],o);return o&&Ea(o,o.next)&&(Da(o),o=o.next),o}function da(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Ea(i,i.next)&&0!==Ta(i.prev,i,i.next))i=i.next;else{if(Da(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function pa(t,e,n,i,r,s,o){if(!t)return;!o&&s&&function(t,e,n,i){let r=t;do{null===r.z&&(r.z=wa(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,o,a,l,h=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<h&&(a++,i=i.nextZ,i);e++);for(l=h;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,h*=2}while(o>1)}(r)}(t,i,r,s);let a,l,h=t;for(;t.prev!==t.next;)if(a=t.prev,l=t.next,s?ma(t,i,r,s):fa(t))e.push(a.i/n),e.push(t.i/n),e.push(l.i/n),Da(t),t=l.next,h=l.next;else if((t=l)===h){o?1===o?pa(t=ga(da(t),e,n),e,n,i,r,s,2):2===o&&va(t,e,n,i,r,s):pa(da(t),e,n,i,r,s,1);break}}function fa(t){const e=t.prev,n=t,i=t.next;if(Ta(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Ma(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Ta(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ma(t,e,n,i){const r=t.prev,s=t,o=t.next;if(Ta(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,h=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,c=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=wa(a,l,e,n,i),d=wa(h,c,e,n,i);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&Ma(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Ta(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&Ma(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Ta(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&Ma(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Ta(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&Ma(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Ta(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function ga(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Ea(r,s)&&Aa(r,i,i.next,s)&&Ra(r,s)&&Ra(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),Da(i),Da(i.next),i=t=s),i=i.next}while(i!==t);return da(i)}function va(t,e,n,i,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Sa(o,t)){let a=La(o,t);return o=da(o,o.next),a=da(a,a.next),pa(o,e,n,i,r,s),void pa(a,e,n,i,r,s)}t=t.next}o=o.next}while(o!==t)}function ya(t,e){return t.x-e.x}function xa(t,e){if(e=function(t,e){let n=e;const i=t.x,r=t.y;let s,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o){if(o=t,t===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(i===o)return s;const a=s,l=s.x,h=s.y;let c,u=1/0;n=s;do{i>=n.x&&n.x>=l&&i!==n.x&&Ma(r<h?i:o,r,l,h,r<h?o:i,r,n.x,n.y)&&(c=Math.abs(r-n.y)/(i-n.x),Ra(n,t)&&(c<u||c===u&&(n.x>s.x||n.x===s.x&&ba(s,n)))&&(s=n,u=c)),n=n.next}while(n!==a);return s}(t,e),e){const n=La(e,t);da(e,e.next),da(n,n.next)}}function ba(t,e){return Ta(t.prev,t,e.prev)<0&&Ta(e.next,t,t.next)<0}function wa(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Ma(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function Sa(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Aa(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ra(t,e)&&Ra(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Ta(t.prev,t,e.prev)||Ta(t,e.prev,e))||Ea(t,e)&&Ta(t.prev,t,t.next)>0&&Ta(e.prev,e,e.next)>0)}function Ta(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ea(t,e){return t.x===e.x&&t.y===e.y}function Aa(t,e,n,i){const r=Pa(Ta(t,e,n)),s=Pa(Ta(t,e,i)),o=Pa(Ta(n,i,t)),a=Pa(Ta(n,i,e));return r!==s&&o!==a||!(0!==r||!Ca(t,n,e))||!(0!==s||!Ca(t,i,e))||!(0!==o||!Ca(n,t,i))||!(0!==a||!Ca(n,e,i))}function Ca(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Pa(t){return t>0?1:t<0?-1:0}function Ra(t,e){return Ta(t.prev,t,t.next)<0?Ta(t,e,t.next)>=0&&Ta(t,t.prev,e)>=0:Ta(t,e,t.prev)<0||Ta(t,t.next,e)<0}function La(t,e){const n=new Oa(t.i,t.x,t.y),i=new Oa(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Ia(t,e,n,i){const r=new Oa(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Da(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Oa(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Ba{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return Ba.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];Na(t),za(n,t);let s=t.length;e.forEach(Na);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,za(n,e[t]);const o=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=ua(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,h,c,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,o,a,l,h;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,h=ua(t,a,l,i,!1),h===h.next&&(h.steiner=!0),r.push(_a(h));for(r.sort(ya),s=0;s<r.length;s++)xa(r[s],n),n=da(n,n.next);return n}(t,e,s,n)),t.length>80*n){a=h=t[0],l=c=t[1];for(let e=n;e<r;e+=n)u=t[e],d=t[e+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-a,c-l),p=0!==p?1/p:0}return pa(s,o,n,a,l,p),o}(n,i);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function Na(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function za(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class ka extends wn{constructor(t=new ca([new yt(.5,.5),new yt(-.5,.5),new yt(-.5,-.5),new yt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++)s(t[e]);function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:c-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Fa;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,v,y,x,b,w=!1;f&&(g=f.getSpacedPoints(a),w=!0,h=!1,v=f.computeFrenetFrames(a,!1),y=new Wt,x=new Wt,b=new Wt),h||(p=0,c=0,u=0,d=0);const _=t.extractPoints(o);let M=_.shape;const S=_.holes;if(!Ba.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];Ba.isClockWise(e)&&(S[t]=e.reverse())}}const T=Ba.triangulateShape(M,S),E=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const C=M.length,P=T.length;function R(t,e,n){let i,r,s;const o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,h=n.y-t.y,c=o*o+a*a,u=o*h-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=e.x-a/u,f=e.y+o/u,m=((n.x-h/d-p)*h-(n.y+l/d-f)*l)/(o*h-a*l);i=p+o*m-t.x,r=f+a*m-t.y;const g=i*i+r*r;if(g<=2)return new yt(i,r);s=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(h)&&(t=!0),t?(i=-a,r=o,s=Math.sqrt(c)):(i=o,r=a,s=Math.sqrt(c/2))}return new yt(i/s,r/s)}const L=[];for(let t=0,e=E.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),L[t]=R(E[t],E[n],E[i]);const I=[];let D,O=L.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];D=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),D[t]=R(e[t],e[i],e[r]);I.push(D),O=O.concat(D)}for(let t=0;t<p;t++){const e=t/p,n=c*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],L[t],i);z(e.x,e.y,-n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],i);z(r.x,r.y,-n)}}}const B=u+d;for(let t=0;t<C;t++){const e=h?A(M[t],O[t],B):M[t];w?(x.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(x).add(y),z(b.x,b.y,b.z)):z(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<C;e++){const n=h?A(M[e],O[e],B):M[e];w?(x.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),b.copy(g[t]).add(x).add(y),z(b.x,b.y,b.z)):z(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=c*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],L[t],i);z(e.x,e.y,l+n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],i);w?z(r.x,r.y+g[a-1].y,g[a-1].x+n):z(r.x,r.y,l+n)}}}function N(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=a+2*p;t<n;t++){const n=C*t,s=C*(t+1);F(e+i+n,e+r+n,e+r+s,e+i+s)}}}function z(t,e,n){s.push(t),s.push(e),s.push(n)}function k(t,e,r){U(t),U(e),U(r);const s=i.length/3,o=m.generateTopUV(n,i,s-3,s-2,s-1);H(o[0]),H(o[1]),H(o[2])}function F(t,e,r,s){U(t),U(e),U(s),U(e),U(r),U(s);const o=i.length/3,a=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function U(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(h){let t=0,e=C*t;for(let t=0;t<P;t++){const n=T[t];k(n[2]+e,n[1]+e,n[0]+e)}t=a+2*p,e=C*t;for(let t=0;t<P;t++){const n=T[t];k(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<P;t++){const e=T[t];k(e[2],e[1],e[0])}for(let t=0;t<P;t++){const e=T[t];k(e[0]+C*a,e[1]+C*a,e[2]+C*a)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;N(E,e),e+=E.length;for(let t=0,n=S.length;t<n;t++){const n=S[t];N(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new pn(i,3)),this.setAttribute("uv",new pn(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new sa[i.type]).fromJSON(i)),new ka(n,t.options)}}const Fa={generateTopUV:function(t,e,n,i,r){const s=e[3*n],o=e[3*n+1],a=e[3*i],l=e[3*i+1],h=e[3*r],c=e[3*r+1];return[new yt(s,o),new yt(a,l),new yt(h,c)]},generateSideWallUV:function(t,e,n,i,r,s){const o=e[3*n],a=e[3*n+1],l=e[3*n+2],h=e[3*i],c=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-c)<Math.abs(o-h)?[new yt(o,1-l),new yt(h,1-u),new yt(d,1-f),new yt(m,1-v)]:[new yt(a,1-l),new yt(c,1-u),new yt(p,1-f),new yt(g,1-v)]}};class Ua extends ha{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ua(t.radius,t.detail)}}class Ha extends wn{constructor(t=new ca([new yt(0,.5),new yt(-.5,-.5),new yt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(o,a,e),o+=a,a=0;function l(t){const o=i.length/3,l=t.extractPoints(e);let h=l.shape;const c=l.holes;!1===Ba.isClockWise(h)&&(h=h.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===Ba.isClockWise(e)&&(c[t]=e.reverse())}const u=Ba.triangulateShape(h,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];h=h.concat(e)}for(let t=0,e=h.length;t<e;t++){const e=h[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+o,r=e[1]+o,s=e[2]+o;n.push(i,r,s),a+=3}}this.setIndex(n),this.setAttribute("position",new pn(i,3)),this.setAttribute("normal",new pn(r,3)),this.setAttribute("uv",new pn(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new Ha(n,t.curveSegments)}}class Va extends wn{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const h=[],c=new Wt,u=new Wt,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==s?y=.5/e:d==n&&a==Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;c.x=-t*Math.cos(i+a*r)*Math.sin(s+v*o),c.y=t*Math.cos(s+v*o),c.z=t*Math.sin(i+a*r)*Math.sin(s+v*o),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),m.push(a+y,1-v),g.push(l++)}h.push(g)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=h[t][i+1],r=h[t][i],o=h[t+1][i],l=h[t+1][i+1];(0!==t||s>0)&&d.push(e,r,l),(t!==n-1||a<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new pn(p,3)),this.setAttribute("normal",new pn(f,3)),this.setAttribute("uv",new pn(m,2))}static fromJSON(t){return new Va(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ga extends on{constructor(t){super(),this.type="ShadowMaterial",this.color=new It(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}Ga.prototype.isShadowMaterial=!0;class Wa extends jn{constructor(t){super(t),this.type="RawShaderMaterial"}}Wa.prototype.isRawShaderMaterial=!0;class ja extends on{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new It(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Z,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}ja.prototype.isMeshStandardMaterial=!0;class qa extends ja{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new yt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ut(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new It(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new It(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new It(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}qa.prototype.isMeshPhysicalMaterial=!0;class Xa extends on{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new It(16777215),this.specular=new It(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Z,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}Xa.prototype.isMeshPhongMaterial=!0;class Ya extends on{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new It(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Z,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Ya.prototype.isMeshToonMaterial=!0;class $a extends on{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Z,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}$a.prototype.isMeshNormalMaterial=!0;class Ka extends on{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new It(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Ka.prototype.isMeshLambertMaterial=!0;class Za extends on{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new It(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Z,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}Za.prototype.isMeshMatcapMaterial=!0;class Ja extends _o{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Ja.prototype.isLineDashedMaterial=!0;const Qa={ShadowMaterial:Ga,SpriteMaterial:Ws,RawShaderMaterial:Wa,ShaderMaterial:jn,PointsMaterial:Do,MeshPhysicalMaterial:qa,MeshStandardMaterial:ja,MeshPhongMaterial:Xa,MeshToonMaterial:Ya,MeshNormalMaterial:$a,MeshLambertMaterial:Ka,MeshDepthMaterial:Ms,MeshDistanceMaterial:Ss,MeshBasicMaterial:an,MeshMatcapMaterial:Za,LineDashedMaterial:Ja,LineBasicMaterial:_o,Material:on};on.fromType=function(t){return new Qa[t]};const tl={arraySlice:function(t,e,n){return tl.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[o++]=t[i+n]}return r},flattenJSON:function(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),n.push(o)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),l=[],h=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<n||s>=i)){l.push(e.times[t]);for(let n=0;n<a;++n)h.push(e.values[t*a+n])}}0!==l.length&&(e.times=tl.convertArray(l,e.times.constructor),e.values=tl.convertArray(h,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let e=0;e<r;++e){const i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find((function(t){return t.name===i.name&&t.ValueTypeName===r}));if(void 0===o)continue;let a=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let h=0;const c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);const u=i.times.length-1;let d;if(s<=i.times[0]){const t=a,e=l-a;d=tl.arraySlice(i.values,t,e)}else if(s>=i.times[u]){const t=u*l+a,e=t+l-a;d=tl.arraySlice(i.values,t,e)}else{const t=i.createInterpolant(),e=a,n=l-a;t.evaluate(s),d=tl.arraySlice(t.resultBuffer,e,n)}"quaternion"===r&&(new Gt).fromArray(d).normalize().conjugate().toArray(d);const p=o.times.length;for(let t=0;t<p;++t){const e=t*c+h;if("quaternion"===r)Gt.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else{const t=c-2*h;for(let n=0;n<t;++n)o.values[e+n]-=d[n]}}}return t.blendMode=2501,t}};class el{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const o=e[1];t<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}el.prototype.beforeStart_=el.prototype.copySampleValue_,el.prototype.afterEnd_=el.prototype.copySampleValue_;class nl extends el{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:G,endingEnd:G}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case W:r=t,o=2*e-n;break;case j:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case W:s=t,a=2*n-e;break;case j:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}const l=.5*(n-e),h=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let t=0;t!==o;++t)r[t]=g*s[h+t]+v*s[l+t]+y*s[a+t]+x*s[c+t];return r}}class il extends el{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,h=(n-e)/(i-e),c=1-h;for(let t=0;t!==o;++t)r[t]=s[l+t]*c+s[a+t]*h;return r}}class rl extends el{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class sl{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=tl.convertArray(e,this.TimeBufferType),this.values=tl.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:tl.convertArray(t.times,Array),values:tl.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new rl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new il(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new nl(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case U:e=this.InterpolantFactoryMethodDiscrete;break;case H:e=this.InterpolantFactoryMethodLinear;break;case V:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return U;case this.InterpolantFactoryMethodLinear:return H;case this.InterpolantFactoryMethodSmooth:return V}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=tl.arraySlice(n,r,s),this.values=tl.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&tl.isTypedArray(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=tl.arraySlice(this.times),e=tl.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===V,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const i=o*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,o=0;o!==n;++o)e[i+o]=e[t+o];++s}return s!==t.length?(this.times=tl.arraySlice(t,0,s),this.values=tl.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=tl.arraySlice(this.times,0),e=tl.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}sl.prototype.TimeBufferType=Float32Array,sl.prototype.ValueBufferType=Float32Array,sl.prototype.DefaultInterpolation=H;class ol extends sl{}ol.prototype.ValueTypeName="bool",ol.prototype.ValueBufferType=Array,ol.prototype.DefaultInterpolation=U,ol.prototype.InterpolantFactoryMethodLinear=void 0,ol.prototype.InterpolantFactoryMethodSmooth=void 0;class al extends sl{}al.prototype.ValueTypeName="color";class ll extends sl{}ll.prototype.ValueTypeName="number";class hl extends el{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(i-e);let l=t*o;for(let t=l+o;l!==t;l+=4)Gt.slerpFlat(r,0,s,l-o,s,l,a);return r}}class cl extends sl{InterpolantFactoryMethodLinear(t){return new hl(this.times,this.values,this.getValueSize(),t)}}cl.prototype.ValueTypeName="quaternion",cl.prototype.DefaultInterpolation=H,cl.prototype.InterpolantFactoryMethodSmooth=void 0;class ul extends sl{}ul.prototype.ValueTypeName="string",ul.prototype.ValueBufferType=Array,ul.prototype.DefaultInterpolation=U,ul.prototype.InterpolantFactoryMethodLinear=void 0,ul.prototype.InterpolantFactoryMethodSmooth=void 0;class dl extends sl{}dl.prototype.ValueTypeName="vector";class pl{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=ct(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(fl(n[t]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(sl.toJSON(n[t]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let t=0;t<r;t++){let o=[],a=[];o.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const l=tl.getKeyframeOrder(o);o=tl.sortedArray(o,1,l),a=tl.sortedArray(a,1,l),i||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new ll(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(r);if(s&&s.length>1){const t=s[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const s=[];for(const t in i)s.push(this.CreateFromMorphTargetSequence(t,i[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],o=[];tl.flattenJSON(n,s,o,i),0!==s.length&&r.push(new t(e,s,o))}},i=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new ll(".morphTargetInfluence["+n+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";n(dl,s+".position",r,"pos",i),n(cl,s+".quaternion",r,"rot",i),n(dl,s+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,a,i,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function fl(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ll;case"vector":case"vector2":case"vector3":case"vector4":return dl;case"color":return al;case"quaternion":return cl;case"bool":case"boolean":return ol;case"string":return ul}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];tl.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const ml={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class gl{constructor(t,e,n){const i=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const vl=new gl;class yl{constructor(t){this.manager=void 0!==t?t:vl,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const xl={};class bl extends yl{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=ml.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==xl[t])return void xl[t].push({onLoad:e,onProgress:n,onError:i});xl[t]=[],xl[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=xl[t],i=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(t){!function e(){i.read().then((({done:i,value:r})=>{if(i)t.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then((t=>i.decode(t)))}}})).then((e=>{ml.add(t,e);const n=xl[t];delete xl[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const n=xl[t];if(void 0===n)throw this.manager.itemError(t),e;delete xl[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class wl extends yl{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=ml.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=wt("img");function a(){h(),ml.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){h(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class _l extends yl{constructor(t){super(t)}load(t,e,n,i){const r=new Kn,s=new wl(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){r.images[n]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(let e=0;e<t.length;++e)a(e);return r}}class Ml extends yl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new po,o=new bl(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,(function(t){const n=r.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:y,s.wrapT=void 0!==n.wrapT?n.wrapT:y,s.magFilter=void 0!==n.magFilter?n.magFilter:M,s.minFilter=void 0!==n.minFilter?n.minFilter:M,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=T),1===n.mipmapCount&&(s.minFilter=M),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n))}),n,i),s}}class Sl extends yl{constructor(t){super(t)}load(t,e,n,i){const r=new kt,s=new wl(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}class Tl extends qe{constructor(t,e=1){super(),this.type="Light",this.color=new It(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Tl.prototype.isLight=!0;class El extends Tl{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(qe.DefaultUp),this.updateMatrix(),this.groundColor=new It(e)}copy(t){return Tl.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}El.prototype.isHemisphereLight=!0;const Al=new we,Cl=new Wt,Pl=new Wt;class Rl{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yt(512,512),this.map=null,this.mapPass=null,this.matrix=new we,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ri,this._frameExtents=new yt(1,1),this._viewportCount=1,this._viewports=[new Ft(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Cl.setFromMatrixPosition(t.matrixWorld),e.position.copy(Cl),Pl.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Pl),e.updateMatrixWorld(),Al.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Al),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Ll extends Rl{constructor(){super(new Xn(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*ht*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Ll.prototype.isSpotLightShadow=!0;class Il extends Tl{constructor(t,e,n=0,i=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(qe.DefaultUp),this.updateMatrix(),this.target=new qe,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new Ll}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Il.prototype.isSpotLight=!0;const Dl=new we,Ol=new Wt,Bl=new Wt;class Nl extends Rl{constructor(){super(new Xn(90,1,.5,500)),this._frameExtents=new yt(4,2),this._viewportCount=6,this._viewports=[new Ft(2,1,1,1),new Ft(0,1,1,1),new Ft(3,1,1,1),new Ft(1,1,1,1),new Ft(3,0,1,1),new Ft(1,0,1,1)],this._cubeDirections=[new Wt(1,0,0),new Wt(-1,0,0),new Wt(0,0,1),new Wt(0,0,-1),new Wt(0,1,0),new Wt(0,-1,0)],this._cubeUps=[new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,0,1),new Wt(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Ol.setFromMatrixPosition(t.matrixWorld),n.position.copy(Ol),Bl.copy(n.position),Bl.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Bl),n.updateMatrixWorld(),i.makeTranslation(-Ol.x,-Ol.y,-Ol.z),Dl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dl)}}Nl.prototype.isPointLightShadow=!0;class zl extends Tl{constructor(t,e,n=0,i=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Nl}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}zl.prototype.isPointLight=!0;class kl extends Rl{constructor(){super(new vi(-5,5,5,-5,.5,500))}}kl.prototype.isDirectionalLightShadow=!0;class Fl extends Tl{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(qe.DefaultUp),this.updateMatrix(),this.target=new qe,this.shadow=new kl}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Fl.prototype.isDirectionalLight=!0;class Ul extends Tl{constructor(t,e){super(t,e),this.type="AmbientLight"}}Ul.prototype.isAmbientLight=!0;(class extends Tl{constructor(t,e,n=10,i=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}).prototype.isRectAreaLight=!0;class Hl{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Wt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}Hl.prototype.isSphericalHarmonics3=!0;class Vl extends Tl{constructor(t=new Hl,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Vl.prototype.isLightProbe=!0;class Gl{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}(class extends wn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0;class Wl extends yl{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=ml.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){ml.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}let jl;Wl.prototype.isImageBitmapLoader=!0;class ql extends yl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new bl(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);(void 0===jl&&(jl=new(window.AudioContext||window.webkitAudioContext)),jl).decodeAudioData(t,(function(t){e(t)}))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}}(class extends Vl{constructor(t,e,n=1){super(void 0,n);const i=(new It).set(t),r=(new It).set(e),s=new Wt(i.r,i.g,i.b),o=new Wt(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0,class extends Vl{constructor(t,e=1){super(void 0,e);const n=(new It).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class Xl{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Yl(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Yl();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Yl(){return("undefined"==typeof performance?Date:performance).now()}class $l{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){o.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]}_slerp(t,e,n,i){Gt.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;Gt.multiplyQuaternionsFlat(t,s,t,e,t,n),Gt.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[n+o]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const Kl=new RegExp("[\\[\\]\\.:\\/]","g"),Zl="[^\\[\\]\\.:\\/]",Jl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ql=/((?:WC+[\/:])*)/.source.replace("WC",Zl),th=/(WCOD+)?/.source.replace("WCOD",Jl),eh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Zl),nh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Zl),ih=new RegExp("^"+Ql+th+eh+nh+"$"),rh=["material","materials","bones"];class sh{constructor(t,e,n){this.path=e,this.parsedPath=n||sh.parseTrackName(e),this.node=sh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new sh.Composite(t,e,n):new sh(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Kl,"")}static parseTrackName(t){const e=ih.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==rh.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=sh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}sh.Composite=class{constructor(t,e,n){const i=n||sh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},sh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},sh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},sh.prototype.GetterByBindingType=[sh.prototype._getValue_direct,sh.prototype._getValue_array,sh.prototype._getValue_arrayElement,sh.prototype._getValue_toArray],sh.prototype.SetterByBindingTypeAndVersioning=[[sh.prototype._setValue_direct,sh.prototype._setValue_direct_setNeedsUpdate,sh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[sh.prototype._setValue_array,sh.prototype._setValue_array_setNeedsUpdate,sh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[sh.prototype._setValue_arrayElement,sh.prototype._setValue_arrayElement_setNeedsUpdate,sh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[sh.prototype._setValue_fromArray,sh.prototype._setValue_fromArray_setNeedsUpdate,sh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class oh{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:G,endingEnd:G};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r?i:s&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=W,i.endingEnd=W):(i.endingStart=t?this.zeroSlopeAtStart?W:G:j,i.endingEnd=e?this.zeroSlopeAtEnd?W:G:j)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=n,this}}(class extends st{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let h=l[a];void 0===h&&(h={},l[a]=h);for(let t=0;t!==r;++t){const r=i[t],l=r.name;let c=h[l];if(void 0!==c)++c.referenceCount,s[t]=c;else{if(c=s[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,a,l));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;c=new $l(sh.create(n,l,i),r.ValueTypeName,r.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,a,l),s[t]=c}o[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,a[h]=l,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new il(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?pl.findByName(i,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:2500),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const h=new oh(this,s,e,n);return this._bindAction(h,l),this._addInactiveAction(h,o,r),h}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?pl.findByName(n,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==n;++o)e[o]._update(i,t,r,s);const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class ah{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new ah(void 0===this.value.clone?this.value:this.value.clone())}}(class extends Hs{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;class lh{constructor(t,e,n=0,i=1/0){this.ray=new be(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new Ie,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return ch(t,this,n,e),n.sort(hh),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)ch(t[i],this,n,e);return n.sort(hh),n}}function hh(t,e){return t.distance-e.distance}function ch(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)ch(i[t],e,n,!0)}}class uh{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(ut(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const dh=new yt;class ph{constructor(t=new yt(1/0,1/0),e=new yt(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=dh.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return dh.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}ph.prototype.isBox2=!0;const fh=new Wt,mh=new we,gh=new we;function vh(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,vh(t.children[n]));return e}const yh=new Wt,xh=new It,bh=new It;class wh extends qe{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Ua(e);i.rotateY(.5*Math.PI),this.material=new an({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new cn(s,3)),this.add(new Fn(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");xh.copy(this.light.color),bh.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?xh:bh;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(yh.setFromMatrixPosition(this.light.matrixWorld).negate())}}const _h=new Wt,Mh=new Wt,Sh=new Wt;class Th extends qe{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let i=new wn;i.setAttribute("position",new pn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new _o({fog:!1,toneMapped:!1});this.lightPlane=new Co(i,r),this.add(this.lightPlane),i=new wn,i.setAttribute("position",new pn([0,0,0,0,0,1],3)),this.targetLine=new Co(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){_h.setFromMatrixPosition(this.light.matrixWorld),Mh.setFromMatrixPosition(this.light.target.matrixWorld),Sh.subVectors(Mh,_h),this.lightPlane.lookAt(Mh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Mh),this.targetLine.scale.z=Sh.length()}}class Eh extends Lo{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new wn;n.setAttribute("position",new pn(e,3)),n.setAttribute("color",new pn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new _o({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new It,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ah{static toHalfFloat(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=ut(t,-65504,65504),Ph[0]=t;const e=Rh[0],n=e>>23&511;return Lh[n]+((8388607&e)>>Ih[n])}static fromHalfFloat(t){const e=t>>10;return Rh[0]=Dh[Bh[e]+(1023&t)]+Oh[e],Ph[0]}}const Ch=new ArrayBuffer(4),Ph=new Float32Array(Ch),Rh=new Uint32Array(Ch),Lh=new Uint32Array(512),Ih=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(Lh[t]=0,Lh[256|t]=32768,Ih[t]=24,Ih[256|t]=24):e<-14?(Lh[t]=1024>>-e-14,Lh[256|t]=1024>>-e-14|32768,Ih[t]=-e-1,Ih[256|t]=-e-1):e<=15?(Lh[t]=e+15<<10,Lh[256|t]=e+15<<10|32768,Ih[t]=13,Ih[256|t]=13):e<128?(Lh[t]=31744,Lh[256|t]=64512,Ih[t]=24,Ih[256|t]=24):(Lh[t]=31744,Lh[256|t]=64512,Ih[t]=13,Ih[256|t]=13)}const Dh=new Uint32Array(2048),Oh=new Uint32Array(64),Bh=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;0==(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,Dh[t]=e|n}for(let t=1024;t<2048;++t)Dh[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)Oh[t]=t<<23;Oh[31]=1199570944,Oh[32]=2147483648;for(let t=33;t<63;++t)Oh[t]=2147483648+(t-32<<23);Oh[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(Bh[t]=1024);Ho.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Ho.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},aa.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends Lo{constructor(t=10,e=10,n=4473924,i=8947848){n=new It(n),i=new It(i);const r=e/2,s=t/e,o=t/2,a=[],l=[];for(let t=0,h=0,c=-o;t<=e;t++,c+=s){a.push(-o,0,c,o,0,c),a.push(c,0,-o,c,0,o);const e=t===r?n:i;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const h=new wn;h.setAttribute("position",new pn(a,3)),h.setAttribute("color",new pn(l,3)),super(h,new _o({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Lo{constructor(t){const e=vh(t),n=new wn,i=[],r=[],s=new It(0,0,1),o=new It(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new pn(i,3)),n.setAttribute("color",new pn(r,3)),super(n,new _o({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");gh.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(mh.multiplyMatrices(gh,r.matrixWorld),fh.setFromMatrixPosition(mh),i.setXYZ(n,fh.x,fh.y,fh.z),mh.multiplyMatrices(gh,r.parent.matrixWorld),fh.setFromMatrixPosition(mh),i.setXYZ(n+1,fh.x,fh.y,fh.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},yl.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Gl.extractUrlBase(t)},yl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},ph.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},ph.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ph.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},ph.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Xt.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Xt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Xt.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Xt.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Xt.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},Le.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},de.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ri.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},xt.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},xt.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},xt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},xt.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},xt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},xt.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},we.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},we.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},we.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Wt).setFromMatrixColumn(this,3)},we.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},we.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},we.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},we.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},we.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},we.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},we.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},we.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},we.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},we.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},we.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},we.prototype.makeFrustum=function(t,e,n,i,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,s)},we.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},ei.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Gt.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Gt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},be.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},be.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},be.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},rn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},rn.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},rn.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},rn.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},rn.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},rn.barycoordFromPoint=function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),rn.getBarycoord(t,e,n,i,r)},rn.normal=function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),rn.getNormal(t,e,n,i)},ca.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},ca.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ka(this,t)},ca.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ha(this,t)},yt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},yt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},yt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wt.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Wt.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Wt.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Wt.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Wt.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Wt.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Wt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Wt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ft.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Ft.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},qe.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},qe.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},qe.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},qe.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},qe.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(qe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Fn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Fn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),co.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Xn.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Tl.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(cn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===nt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(nt)}}}),cn.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?nt:et),this},cn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},cn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},wn.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},wn.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new cn(arguments[1],arguments[2])))},wn.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},wn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},wn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},wn.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},wn.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(wn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Hs.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?nt:et),this},Hs.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ka.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ka.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ka.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Us.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},ah.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(on.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new It}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(jn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Ns.prototype.clearTarget=function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},Ns.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},Ns.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Ns.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Ns.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Ns.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Ns.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Ns.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Ns.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Ns.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Ns.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ns.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Ns.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Ns.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Ns.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},Ns.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Ns.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Ns.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Ns.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Ns.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Ns.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Ns.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Ns.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Ns.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Ns.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Ns.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?$:Y}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Ts.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ut.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),class extends qe{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new ql).load(t,(function(t){e.setBuffer(t)})),this},$n.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},$n.prototype.clear=function(t,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,i)},Ot.crossOrigin=void 0,Ot.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Sl;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Ot.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new _l;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Ot.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ot.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},542:(t,e,n)=>{"use strict";n.d(e,{DO:()=>r});const i=[];for(let t=0;t<256;t++)i[t]=(t<16?"0":"")+t.toString(16);function r(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255]+"-"+i[255&e]+i[e>>8&255]+"-"+i[e>>16&15|64]+i[e>>24&255]+"-"+i[63&n|128]+i[n>>8&255]+"-"+i[n>>16&255]+i[n>>24&255]+i[255&r]+i[r>>8&255]+i[r>>16&255]+i[r>>24&255]).toLowerCase()}Math.PI,Math.PI}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.amdO={},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i);var t={};n.r(t),n.d(t,{AsyncCompress:()=>xa,AsyncDecompress:()=>Ba,AsyncDeflate:()=>ua,AsyncGunzip:()=>Ma,AsyncGzip:()=>xa,AsyncInflate:()=>ma,AsyncUnzipInflate:()=>ll,AsyncUnzlib:()=>La,AsyncZipDeflate:()=>nl,AsyncZlib:()=>Aa,Compress:()=>ya,DecodeUTF8:()=>Ga,Decompress:()=>Oa,Deflate:()=>ca,EncodeUTF8:()=>Wa,Gunzip:()=>_a,Gzip:()=>ya,Inflate:()=>fa,Unzip:()=>hl,UnzipInflate:()=>al,UnzipPassThrough:()=>ol,Unzlib:()=>Ra,Zip:()=>il,ZipDeflate:()=>el,ZipPassThrough:()=>tl,Zlib:()=>Ea,compress:()=>ba,compressSync:()=>wa,decompress:()=>Na,decompressSync:()=>za,deflate:()=>da,deflateSync:()=>pa,gunzip:()=>Sa,gunzipSync:()=>Ta,gzip:()=>ba,gzipSync:()=>wa,inflate:()=>ga,inflateSync:()=>va,strFromU8:()=>qa,strToU8:()=>ja,unzip:()=>cl,unzipSync:()=>ul,unzlib:()=>Ia,unzlibSync:()=>Da,zip:()=>rl,zipSync:()=>sl,zlib:()=>Ca,zlibSync:()=>Pa});class e{static Default={envMap:"park",models:[]};static SpecialObjects={MeshDebug:{NamePrefix:"__mesh_debug",BodyTypes:{Static:{color:16711680},Kinematic:{color:65280},Dynamic:{color:255}},ShapeTypes:{Box:{},Sphere:{},Cylinder:{},Plane:{},Convex:{},Trimesh:{}}},Helpers:{NamePrefix:"__helper",Scene:{NamePrefix:"HelperScene"},WorldAxes:{NamePrefix:"__helper_world_axes"},ObjectAxes:{NamePrefix:"__helper_object_axes"}}};static Graphics={Scene:{GLTF:{NamePrefix:"__GLTF_scene"}},Light:{Shadow:{MapSize:4096,Bias:-1e-4}},Label:{NamePrefix:"__label_object"},ShapeMesh:{NameIncludes:"_Shape"}};static CustomProperties={Physics:{Key:"body_type",Types:{Static:"static",Kinematic:"kinematic",Dynamic:"dynamic",NonPhysics:"none"}},Graphics:{Key:"object_type",Types:{PhysicsShape:"shape",SingleMaterial:"sm",MultiMaterials:"mm"}}}}class r{listeners;constructor(){this.listeners={}}hasAnyEventListener(t){return void 0!==this.listeners[t]}hasEventListener(t,e){const n=this.listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){const n=this.listeners;if(void 0===n[t])return this;const i=n[t].indexOf(e);return-1!==i&&n[t].slice(i,1),this}addEventListener(t,e){const n=this.listeners;return void 0===n[t]&&(n[t]=[]),n[t].indexOf(e)&&n[t].push(e),this}dispatchEvent(t){const e=this.listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t)}return this}}var s,o,a,l,h=n(542);(l=s||(s={}))[l.Graphics=0]="Graphics",l[l.Camera=1]="Camera",l[l.Renderer=2]="Renderer",l[l.Controls=3]="Controls",l[l.CameraTexture=4]="CameraTexture",l[l.Label=5]="Label",l[l.Tween2D=6]="Tween2D",l[l.ReflectionObject=7]="ReflectionObject",l[l.Physics=8]="Physics",l[l.PhysicsDebug=9]="PhysicsDebug",(a=o||(o={}))[a.Graphics=0]="Graphics",a[a.Physics=1]="Physics",a[a.UI=2]="UI";class c extends r{type;category;name;constructor(t,e){super(),this.type=s[t],this.category=e,this.name=this.type+"-"+(0,h.DO)().substring(0,8)}}var u=n(477);class d{constructor(t){void 0===t&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z}getTrace(t){void 0===t&&(t=new f);const e=this.elements;return t.x=e[0],t.y=e[4],t.z=e[8],t}vmult(t,e){void 0===e&&(e=new f);const n=this.elements,i=t.x,r=t.y,s=t.z;return e.x=n[0]*i+n[1]*r+n[2]*s,e.y=n[3]*i+n[4]*r+n[5]*s,e.z=n[6]*i+n[7]*r+n[8]*s,e}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(t,e){void 0===e&&(e=new d);const n=this.elements,i=t.elements,r=e.elements,s=n[0],o=n[1],a=n[2],l=n[3],h=n[4],c=n[5],u=n[6],p=n[7],f=n[8],m=i[0],g=i[1],v=i[2],y=i[3],x=i[4],b=i[5],w=i[6],_=i[7],M=i[8];return r[0]=s*m+o*y+a*w,r[1]=s*g+o*x+a*_,r[2]=s*v+o*b+a*M,r[3]=l*m+h*y+c*w,r[4]=l*g+h*x+c*_,r[5]=l*v+h*b+c*M,r[6]=u*m+p*y+f*w,r[7]=u*g+p*x+f*_,r[8]=u*v+p*b+f*M,e}scale(t,e){void 0===e&&(e=new d);const n=this.elements,i=e.elements;for(let e=0;3!==e;e++)i[3*e+0]=t.x*n[3*e+0],i[3*e+1]=t.y*n[3*e+1],i[3*e+2]=t.z*n[3*e+2];return e}solve(t,e){void 0===e&&(e=new f);const n=[];let i,r;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(r=0;r<3;r++)n[i+4*r]=this.elements[i+3*r];n[3]=t.x,n[7]=t.y,n[11]=t.z;let s=3;const o=s;let a,l;do{if(i=o-s,0===n[i+4*i])for(r=i+1;r<o;r++)if(0!==n[i+4*r]){a=4;do{l=4-a,n[l+4*i]+=n[l+4*r]}while(--a);break}if(0!==n[i+4*i])for(r=i+1;r<o;r++){const t=n[i+4*r]/n[i+4*i];a=4;do{l=4-a,n[l+4*r]=l<=i?0:n[l+4*r]-n[l+4*i]*t}while(--a)}}while(--s);if(e.z=n[11]/n[10],e.y=(n[7]-n[6]*e.z)/n[5],e.x=(n[3]-n[2]*e.z-n[1]*e.y)/n[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw`Could not solve equation! Got x=[${e.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return e}e(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";for(let e=0;e<9;e++)t+=this.elements[e]+",";return t}reverse(t){void 0===t&&(t=new d);const e=p;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)e[n+6*i]=this.elements[n+3*i];e[3]=1,e[9]=0,e[15]=0,e[4]=0,e[10]=1,e[16]=0,e[5]=0,e[11]=0,e[17]=1;let r=3;const s=r;let o,a;do{if(n=s-r,0===e[n+6*n])for(i=n+1;i<s;i++)if(0!==e[n+6*i]){o=6;do{a=6-o,e[a+6*n]+=e[a+6*i]}while(--o);break}if(0!==e[n+6*n])for(i=n+1;i<s;i++){const t=e[n+6*i]/e[n+6*n];o=6;do{a=6-o,e[a+6*i]=a<=n?0:e[a+6*i]-e[a+6*n]*t}while(--o)}}while(--r);n=2;do{i=n-1;do{const t=e[n+6*i]/e[n+6*n];o=6;do{a=6-o,e[a+6*i]=e[a+6*i]-e[a+6*n]*t}while(--o)}while(i--)}while(--n);n=2;do{const t=1/e[n+6*n];o=6;do{a=6-o,e[a+6*n]=e[a+6*n]*t}while(--o)}while(n--);n=2;do{i=2;do{if(a=e[3+i+6*n],isNaN(a)||a===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(n,i,a)}while(i--)}while(n--);return t}setRotationFromQuaternion(t){const e=t.x,n=t.y,i=t.z,r=t.w,s=e+e,o=n+n,a=i+i,l=e*s,h=e*o,c=e*a,u=n*o,d=n*a,p=i*a,f=r*s,m=r*o,g=r*a,v=this.elements;return v[0]=1-(u+p),v[1]=h-g,v[2]=c+m,v[3]=h+g,v[4]=1-(l+p),v[5]=d-f,v[6]=c-m,v[7]=d+f,v[8]=1-(l+u),this}transpose(t){void 0===t&&(t=new d);const e=this.elements,n=t.elements;let i;return n[0]=e[0],n[4]=e[4],n[8]=e[8],i=e[1],n[1]=e[3],n[3]=i,i=e[2],n[2]=e[6],n[6]=i,i=e[5],n[5]=e[7],n[7]=i,t}}const p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class f{constructor(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}cross(t,e){void 0===e&&(e=new f);const n=t.x,i=t.y,r=t.z,s=this.x,o=this.y,a=this.z;return e.x=o*r-a*i,e.y=a*n-s*r,e.z=s*i-o*n,e}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(t,e){if(!e)return new f(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z}vsub(t,e){if(!e)return new f(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z}crossmat(){return new d([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,e=this.y,n=this.z,i=Math.sqrt(t*t+e*e+n*n);if(i>0){const t=1/i;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return i}unit(t){void 0===t&&(t=new f);const e=this.x,n=this.y,i=this.z;let r=Math.sqrt(e*e+n*n+i*i);return r>0?(r=1/r,t.x=e*r,t.y=n*r,t.z=i*r):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)}lengthSquared(){return this.dot(this)}distanceTo(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z;return Math.sqrt((r-e)*(r-e)+(s-n)*(s-n)+(o-i)*(o-i))}distanceSquared(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z;return(r-e)*(r-e)+(s-n)*(s-n)+(o-i)*(o-i)}scale(t,e){void 0===e&&(e=new f);const n=this.x,i=this.y,r=this.z;return e.x=t*n,e.y=t*i,e.z=t*r,e}vmul(t,e){return void 0===e&&(e=new f),e.x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e}addScaledVector(t,e,n){return void 0===n&&(n=new f),n.x=this.x+t*e.x,n.y=this.y+t*e.y,n.z=this.z+t*e.z,n}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(t){return void 0===t&&(t=new f),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,e){const n=this.length();if(n>0){const i=m,r=1/n;i.set(this.x*r,this.y*r,this.z*r);const s=g;Math.abs(i.x)<.9?(s.set(1,0,0),i.cross(s,t)):(s.set(0,1,0),i.cross(s,t)),i.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,e,n){const i=this.x,r=this.y,s=this.z;n.x=i+(t.x-i)*e,n.y=r+(t.y-r)*e,n.z=s+(t.z-s)*e}almostEquals(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}almostZero(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,e){return this.negate(v),v.almostEquals(t,e)}clone(){return new f(this.x,this.y,this.z)}}f.ZERO=new f(0,0,0),f.UNIT_X=new f(1,0,0),f.UNIT_Y=new f(0,1,0),f.UNIT_Z=new f(0,0,1);const m=new f,g=new f,v=new f;class y{constructor(t){void 0===t&&(t={}),this.lowerBound=new f,this.upperBound=new f,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,e,n,i){const r=this.lowerBound,s=this.upperBound,o=n;r.copy(t[0]),o&&o.vmult(r,r),s.copy(r);for(let e=1;e<t.length;e++){let n=t[e];o&&(o.vmult(n,x),n=x),n.x>s.x&&(s.x=n.x),n.x<r.x&&(r.x=n.x),n.y>s.y&&(s.y=n.y),n.y<r.y&&(r.y=n.y),n.z>s.z&&(s.z=n.z),n.z<r.z&&(r.z=n.z)}return e&&(e.vadd(r,r),e.vadd(s,s)),i&&(r.x-=i,r.y-=i,r.z-=i,s.x+=i,s.y+=i,s.z+=i),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return(new y).copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound,s=i.x<=n.x&&n.x<=r.x||e.x<=r.x&&r.x<=n.x,o=i.y<=n.y&&n.y<=r.y||e.y<=r.y&&r.y<=n.y,a=i.z<=n.z&&n.z<=r.z||e.z<=r.z&&r.z<=n.z;return s&&o&&a}volume(){const t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)}contains(t){const e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound;return e.x<=i.x&&n.x>=r.x&&e.y<=i.y&&n.y>=r.y&&e.z<=i.z&&n.z>=r.z}getCorners(t,e,n,i,r,s,o,a){const l=this.lowerBound,h=this.upperBound;t.copy(l),e.set(h.x,l.y,l.z),n.set(h.x,h.y,l.z),i.set(l.x,h.y,h.z),r.set(h.x,l.y,h.z),s.set(l.x,h.y,l.z),o.set(l.x,l.y,h.z),a.copy(h)}toLocalFrame(t,e){const n=b,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],h=n[6],c=n[7];this.getCorners(i,r,s,o,a,l,h,c);for(let e=0;8!==e;e++){const i=n[e];t.pointToLocal(i,i)}return e.setFromPoints(n)}toWorldFrame(t,e){const n=b,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],h=n[6],c=n[7];this.getCorners(i,r,s,o,a,l,h,c);for(let e=0;8!==e;e++){const i=n[e];t.pointToWorld(i,i)}return e.setFromPoints(n)}overlapsRay(t){const{direction:e,from:n}=t,i=1/e.x,r=1/e.y,s=1/e.z,o=(this.lowerBound.x-n.x)*i,a=(this.upperBound.x-n.x)*i,l=(this.lowerBound.y-n.y)*r,h=(this.upperBound.y-n.y)*r,c=(this.lowerBound.z-n.z)*s,u=(this.upperBound.z-n.z)*s,d=Math.max(Math.max(Math.min(o,a),Math.min(l,h)),Math.min(c,u)),p=Math.min(Math.min(Math.max(o,a),Math.max(l,h)),Math.max(c,u));return!(p<0||d>p)}}const x=new f,b=[new f,new f,new f,new f,new f,new f,new f,new f];class w{constructor(){this.matrix=[]}get(t,e){let{index:n}=t,{index:i}=e;if(i>n){const t=i;i=n,n=t}return this.matrix[(n*(n+1)>>1)+i-1]}set(t,e,n){let{index:i}=t,{index:r}=e;if(r>i){const t=r;r=i,i=t}this.matrix[(i*(i+1)>>1)+r-1]=n?1:0}reset(){for(let t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class _{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[t]&&(n[t]=[]),n[t].includes(e)||n[t].push(e),this}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[t]||!n[t].includes(e))}hasAnyEventListener(t){return void 0!==this._listeners&&void 0!==this._listeners[t]}removeEventListener(t,e){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[t])return this;const i=n[t].indexOf(e);return-1!==i&&n[t].splice(i,1),this}dispatchEvent(t){if(void 0===this._listeners)return this;const e=this._listeners[t.type];if(void 0!==e){t.target=this;for(let n=0,i=e.length;n<i;n++)e[n].call(this,t)}return this}}class M{constructor(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=t,this.y=e,this.z=n,this.w=i}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,e){const n=Math.sin(.5*e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e),this}toAxisAngle(t){void 0===t&&(t=new f),this.normalize();const e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]}setFromVectors(t,e){if(t.isAntiparallelTo(e)){const e=S,n=T;t.tangents(e,n),this.setFromAxisAngle(e,Math.PI)}else{const n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(t.length()**2*e.length()**2)+t.dot(e),this.normalize()}return this}mult(t,e){void 0===e&&(e=new M);const n=this.x,i=this.y,r=this.z,s=this.w,o=t.x,a=t.y,l=t.z,h=t.w;return e.x=n*h+s*o+i*l-r*a,e.y=i*h+s*a+r*o-n*l,e.z=r*h+s*l+n*a-i*o,e.w=s*h-n*o-i*a-r*l,e}inverse(t){void 0===t&&(t=new M);const e=this.x,n=this.y,i=this.z,r=this.w;this.conjugate(t);const s=1/(e*e+n*n+i*i+r*r);return t.x*=s,t.y*=s,t.z*=s,t.w*=s,t}conjugate(t){return void 0===t&&(t=new M),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,e){void 0===e&&(e=new f);const n=t.x,i=t.y,r=t.z,s=this.x,o=this.y,a=this.z,l=this.w,h=l*n+o*r-a*i,c=l*i+a*n-s*r,u=l*r+s*i-o*n,d=-s*n-o*i-a*r;return e.x=h*l+d*-s+c*-a-u*-o,e.y=c*l+d*-o+u*-s-h*-a,e.z=u*l+d*-a+h*-o-c*-s,e}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,e){let n,i,r;void 0===e&&(e="YZX");const s=this.x,o=this.y,a=this.z,l=this.w;if("YZX"!==e)throw new Error(`Euler order ${e} not supported yet.`);{const t=s*o+a*l;if(t>.499&&(n=2*Math.atan2(s,l),i=Math.PI/2,r=0),t<-.499&&(n=-2*Math.atan2(s,l),i=-Math.PI/2,r=0),void 0===n){const e=s*s,h=o*o,c=a*a;n=Math.atan2(2*o*l-2*s*a,1-2*h-2*c),i=Math.asin(2*t),r=Math.atan2(2*s*l-2*o*a,1-2*e-2*c)}}t.y=n,t.z=i,t.x=r}setFromEuler(t,e,n,i){void 0===i&&(i="XYZ");const r=Math.cos(t/2),s=Math.cos(e/2),o=Math.cos(n/2),a=Math.sin(t/2),l=Math.sin(e/2),h=Math.sin(n/2);return"XYZ"===i?(this.x=a*s*o+r*l*h,this.y=r*l*o-a*s*h,this.z=r*s*h+a*l*o,this.w=r*s*o-a*l*h):"YXZ"===i?(this.x=a*s*o+r*l*h,this.y=r*l*o-a*s*h,this.z=r*s*h-a*l*o,this.w=r*s*o+a*l*h):"ZXY"===i?(this.x=a*s*o-r*l*h,this.y=r*l*o+a*s*h,this.z=r*s*h+a*l*o,this.w=r*s*o-a*l*h):"ZYX"===i?(this.x=a*s*o-r*l*h,this.y=r*l*o+a*s*h,this.z=r*s*h-a*l*o,this.w=r*s*o+a*l*h):"YZX"===i?(this.x=a*s*o+r*l*h,this.y=r*l*o+a*s*h,this.z=r*s*h-a*l*o,this.w=r*s*o-a*l*h):"XZY"===i&&(this.x=a*s*o-r*l*h,this.y=r*l*o-a*s*h,this.z=r*s*h+a*l*o,this.w=r*s*o+a*l*h),this}clone(){return new M(this.x,this.y,this.z,this.w)}slerp(t,e,n){void 0===n&&(n=new M);const i=this.x,r=this.y,s=this.z,o=this.w;let a,l,h,c,u,d=t.x,p=t.y,f=t.z,m=t.w;return l=i*d+r*p+s*f+o*m,l<0&&(l=-l,d=-d,p=-p,f=-f,m=-m),1-l>1e-6?(a=Math.acos(l),h=Math.sin(a),c=Math.sin((1-e)*a)/h,u=Math.sin(e*a)/h):(c=1-e,u=e),n.x=c*i+u*d,n.y=c*r+u*p,n.z=c*s+u*f,n.w=c*o+u*m,n}integrate(t,e,n,i){void 0===i&&(i=new M);const r=t.x*n.x,s=t.y*n.y,o=t.z*n.z,a=this.x,l=this.y,h=this.z,c=this.w,u=.5*e;return i.x+=u*(r*c+s*h-o*l),i.y+=u*(s*c+o*a-r*h),i.z+=u*(o*c+r*l-s*a),i.w+=u*(-r*a-s*l-o*h),i}}const S=new f,T=new f;class E{constructor(t){void 0===t&&(t={}),this.id=E.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,e){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,e,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}E.idCounter=0,E.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class A{constructor(t){void 0===t&&(t={}),this.position=new f,this.quaternion=new M,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,e){return A.pointToLocalFrame(this.position,this.quaternion,t,e)}pointToWorld(t,e){return A.pointToWorldFrame(this.position,this.quaternion,t,e)}vectorToWorldFrame(t,e){return void 0===e&&(e=new f),this.quaternion.vmult(t,e),e}static pointToLocalFrame(t,e,n,i){return void 0===i&&(i=new f),n.vsub(t,i),e.conjugate(C),C.vmult(i,i),i}static pointToWorldFrame(t,e,n,i){return void 0===i&&(i=new f),e.vmult(n,i),i.vadd(t,i),i}static vectorToWorldFrame(t,e,n){return void 0===n&&(n=new f),t.vmult(e,n),n}static vectorToLocalFrame(t,e,n,i){return void 0===i&&(i=new f),e.w*=-1,e.vmult(n,i),e.w*=-1,i}}const C=new M;class P extends E{constructor(t){void 0===t&&(t={});const{vertices:e=[],faces:n=[],normals:i=[],axes:r,boundingSphereRadius:s}=t;super({type:E.types.CONVEXPOLYHEDRON}),this.vertices=e,this.faces=n,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),s?this.boundingSphereRadius=s:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const t=this.faces,e=this.vertices,n=this.uniqueEdges;n.length=0;const i=new f;for(let r=0;r!==t.length;r++){const s=t[r],o=s.length;for(let t=0;t!==o;t++){const r=(t+1)%o;e[s[t]].vsub(e[s[r]],i),i.normalize();let a=!1;for(let t=0;t!==n.length;t++)if(n[t].almostEquals(i)||n[t].almostEquals(i)){a=!0;break}a||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let t=0;t<this.faces.length;t++){for(let e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error(`Vertex ${this.faces[t][e]} not found!`);const e=this.faceNormals[t]||new f;this.getFaceNormal(t,e),e.negate(e),this.faceNormals[t]=e;const n=this.vertices[this.faces[t][0]];if(e.dot(n)<0){console.error(`.faceNormals[${t}] = Vec3(${e.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let e=0;e<this.faces[t].length;e++)console.warn(`.vertices[${this.faces[t][e]}] = Vec3(${this.vertices[this.faces[t][e]].toString()})`)}}}getFaceNormal(t,e){const n=this.faces[t],i=this.vertices[n[0]],r=this.vertices[n[1]],s=this.vertices[n[2]];P.computeNormal(i,r,s,e)}static computeNormal(t,e,n,i){const r=new f,s=new f;e.vsub(t,s),n.vsub(e,r),r.cross(s,i),i.isZero()||i.normalize()}clipAgainstHull(t,e,n,i,r,s,o,a,l){const h=new f;let c=-1,u=-Number.MAX_VALUE;for(let t=0;t<n.faces.length;t++){h.copy(n.faceNormals[t]),r.vmult(h,h);const e=h.dot(s);e>u&&(u=e,c=t)}const d=[];for(let t=0;t<n.faces[c].length;t++){const e=n.vertices[n.faces[c][t]],s=new f;s.copy(e),r.vmult(s,s),i.vadd(s,s),d.push(s)}c>=0&&this.clipFaceAgainstHull(s,t,e,d,o,a,l)}findSeparatingAxis(t,e,n,i,r,s,o,a){const l=new f,h=new f,c=new f,u=new f,d=new f,p=new f;let m=Number.MAX_VALUE;const g=this;if(g.uniqueAxes)for(let o=0;o!==g.uniqueAxes.length;o++){n.vmult(g.uniqueAxes[o],l);const a=g.testSepAxis(l,t,e,n,i,r);if(!1===a)return!1;a<m&&(m=a,s.copy(l))}else{const a=o?o.length:g.faces.length;for(let h=0;h<a;h++){const a=o?o[h]:h;l.copy(g.faceNormals[a]),n.vmult(l,l);const c=g.testSepAxis(l,t,e,n,i,r);if(!1===c)return!1;c<m&&(m=c,s.copy(l))}}if(t.uniqueAxes)for(let o=0;o!==t.uniqueAxes.length;o++){r.vmult(t.uniqueAxes[o],h);const a=g.testSepAxis(h,t,e,n,i,r);if(!1===a)return!1;a<m&&(m=a,s.copy(h))}else{const o=a?a.length:t.faces.length;for(let l=0;l<o;l++){const o=a?a[l]:l;h.copy(t.faceNormals[o]),r.vmult(h,h);const c=g.testSepAxis(h,t,e,n,i,r);if(!1===c)return!1;c<m&&(m=c,s.copy(h))}}for(let o=0;o!==g.uniqueEdges.length;o++){n.vmult(g.uniqueEdges[o],u);for(let o=0;o!==t.uniqueEdges.length;o++)if(r.vmult(t.uniqueEdges[o],d),u.cross(d,p),!p.almostZero()){p.normalize();const o=g.testSepAxis(p,t,e,n,i,r);if(!1===o)return!1;o<m&&(m=o,s.copy(p))}}return i.vsub(e,c),c.dot(s)>0&&s.negate(s),!0}testSepAxis(t,e,n,i,r,s){P.project(this,t,n,i,R),P.project(e,t,r,s,L);const o=R[0],a=R[1],l=L[0],h=L[1];if(o<h||l<a)return!1;const c=o-h,u=l-a;return c<u?c:u}calculateLocalInertia(t,e){const n=new f,i=new f;this.computeLocalAABB(i,n);const r=n.x-i.x,s=n.y-i.y,o=n.z-i.z;e.x=1/12*t*(2*s*2*s+2*o*2*o),e.y=1/12*t*(2*r*2*r+2*o*2*o),e.z=1/12*t*(2*s*2*s+2*r*2*r)}getPlaneConstantOfFace(t){const e=this.faces[t],n=this.faceNormals[t],i=this.vertices[e[0]];return-n.dot(i)}clipFaceAgainstHull(t,e,n,i,r,s,o){const a=new f,l=new f,h=new f,c=new f,u=new f,d=new f,p=new f,m=new f,g=this,v=i,y=[];let x=-1,b=Number.MAX_VALUE;for(let e=0;e<g.faces.length;e++){a.copy(g.faceNormals[e]),n.vmult(a,a);const i=a.dot(t);i<b&&(b=i,x=e)}if(x<0)return;const w=g.faces[x];w.connectedFaces=[];for(let t=0;t<g.faces.length;t++)for(let e=0;e<g.faces[t].length;e++)-1!==w.indexOf(g.faces[t][e])&&t!==x&&-1===w.connectedFaces.indexOf(t)&&w.connectedFaces.push(t);const _=w.length;for(let t=0;t<_;t++){const i=g.vertices[w[t]],r=g.vertices[w[(t+1)%_]];i.vsub(r,l),h.copy(l),n.vmult(h,h),e.vadd(h,h),c.copy(this.faceNormals[x]),n.vmult(c,c),e.vadd(c,c),h.cross(c,u),u.negate(u),d.copy(i),n.vmult(d,d),e.vadd(d,d);const s=w.connectedFaces[t];p.copy(this.faceNormals[s]);const o=this.getPlaneConstantOfFace(s);m.copy(p),n.vmult(m,m);const a=o-m.dot(e);for(this.clipFaceAgainstPlane(v,y,m,a);v.length;)v.shift();for(;y.length;)v.push(y.shift())}p.copy(this.faceNormals[x]);const M=this.getPlaneConstantOfFace(x);m.copy(p),n.vmult(m,m);const S=M-m.dot(e);for(let t=0;t<v.length;t++){let e=m.dot(v[t])+S;if(e<=r&&(console.log(`clamped: depth=${e} to minDist=${r}`),e=r),e<=s){const n=v[t];if(e<=1e-6){const t={point:n,normal:m,depth:e};o.push(t)}}}}clipFaceAgainstPlane(t,e,n,i){let r,s;const o=t.length;if(o<2)return e;let a=t[t.length-1],l=t[0];r=n.dot(a)+i;for(let h=0;h<o;h++){if(l=t[h],s=n.dot(l)+i,r<0)if(s<0){const t=new f;t.copy(l),e.push(t)}else{const t=new f;a.lerp(l,r/(r-s),t),e.push(t)}else if(s<0){const t=new f;a.lerp(l,r/(r-s),t),e.push(t),e.push(l)}a=l,r=s}return e}computeWorldVertices(t,e){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new f);const n=this.vertices,i=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)e.vmult(n[r],i[r]),t.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,e){const n=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const r=n[i];r.x<t.x?t.x=r.x:r.x>e.x&&(e.x=r.x),r.y<t.y?t.y=r.y:r.y>e.y&&(e.y=r.y),r.z<t.z?t.z=r.z:r.z>e.z&&(e.z=r.z)}}computeWorldFaceNormals(t){const e=this.faceNormals.length;for(;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new f);const n=this.faceNormals,i=this.worldFaceNormals;for(let r=0;r!==e;r++)t.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;const e=this.vertices;for(let n=0;n!==e.length;n++){const i=e[n].lengthSquared();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,i){const r=this.vertices;let s,o,a,l,h,c,u=new f;for(let n=0;n<r.length;n++){u.copy(r[n]),e.vmult(u,u),t.vadd(u,u);const i=u;(void 0===s||i.x<s)&&(s=i.x),(void 0===l||i.x>l)&&(l=i.x),(void 0===o||i.y<o)&&(o=i.y),(void 0===h||i.y>h)&&(h=i.y),(void 0===a||i.z<a)&&(a=i.z),(void 0===c||i.z>c)&&(c=i.z)}n.set(s,o,a),i.set(l,h,c)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t){void 0===t&&(t=new f);const e=this.vertices;for(let n=0;n<e.length;n++)t.vadd(e[n],t);return t.scale(1/e.length,t),t}transformAllPoints(t,e){const n=this.vertices.length,i=this.vertices;if(e){for(let t=0;t<n;t++){const n=i[t];e.vmult(n,n)}for(let t=0;t<this.faceNormals.length;t++){const n=this.faceNormals[t];e.vmult(n,n)}}if(t)for(let e=0;e<n;e++){const n=i[e];n.vadd(t,n)}}pointIsInside(t){const e=this.vertices,n=this.faces,i=this.faceNormals,r=new f;this.getAveragePointLocal(r);for(let s=0;s<this.faces.length;s++){let o=i[s];const a=e[n[s][0]],l=new f;t.vsub(a,l);const h=o.dot(l),c=new f;r.vsub(a,c);const u=o.dot(c);if(h<0&&u>0||h>0&&u<0)return!1}return-1}static project(t,e,n,i,r){const s=t.vertices.length,o=I;let a=0,l=0;const h=D,c=t.vertices;h.setZero(),A.vectorToLocalFrame(n,i,e,o),A.pointToLocalFrame(n,i,h,h);const u=h.dot(o);l=a=c[0].dot(o);for(let t=1;t<s;t++){const e=c[t].dot(o);e>a&&(a=e),e<l&&(l=e)}if(l-=u,a-=u,l>a){const t=l;l=a,a=t}r[0]=a,r[1]=l}}const R=[],L=[],I=(new f,new f),D=new f;class O extends E{constructor(t){super({type:E.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,i=f,r=[new i(-t,-e,-n),new i(t,-e,-n),new i(t,e,-n),new i(-t,e,-n),new i(-t,-e,n),new i(t,-e,n),new i(t,e,n),new i(-t,e,n)],s=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],o=new P({vertices:r,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:s});this.convexPolyhedronRepresentation=o,o.material=this.material}calculateLocalInertia(t,e){return void 0===e&&(e=new f),O.calculateInertia(this.halfExtents,t,e),e}static calculateInertia(t,e,n){const i=t;n.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(t,e){const n=t,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==e)for(let t=0;t!==n.length;t++)e.vmult(n[t],n[t]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,e,n){const i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let i=0;i<r.length;i++)B.set(r[i][0],r[i][1],r[i][2]),e.vmult(B,B),t.vadd(B,B),n(B.x,B.y,B.z)}calculateWorldAABB(t,e,n,i){const r=this.halfExtents;N[0].set(r.x,r.y,r.z),N[1].set(-r.x,r.y,r.z),N[2].set(-r.x,-r.y,r.z),N[3].set(-r.x,-r.y,-r.z),N[4].set(r.x,-r.y,-r.z),N[5].set(r.x,r.y,-r.z),N[6].set(-r.x,r.y,-r.z),N[7].set(r.x,-r.y,r.z);const s=N[0];e.vmult(s,s),t.vadd(s,s),i.copy(s),n.copy(s);for(let r=1;r<8;r++){const s=N[r];e.vmult(s,s),t.vadd(s,s);const o=s.x,a=s.y,l=s.z;o>i.x&&(i.x=o),a>i.y&&(i.y=a),l>i.z&&(i.z=l),o<n.x&&(n.x=o),a<n.y&&(n.y=a),l<n.z&&(n.z=l)}}}const B=new f,N=[new f,new f,new f,new f,new f,new f,new f,new f];class z extends _{constructor(t){void 0===t&&(t={}),super(),this.id=z.idCounter++,this.index=-1,this.world=null,this.vlambda=new f,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof t.collisionResponse||t.collisionResponse,this.position=new f,this.previousPosition=new f,this.interpolatedPosition=new f,this.initPosition=new f,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new f,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new f,this.force=new f;const e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?z.STATIC:z.DYNAMIC,typeof t.type==typeof z.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=z.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new f,this.quaternion=new M,this.initQuaternion=new M,this.previousQuaternion=new M,this.interpolatedQuaternion=new M,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new f,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new f,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new f,this.invInertia=new f,this.invInertiaWorld=new d,this.invMassSolve=0,this.invInertiaSolve=new f,this.invInertiaWorldSolve=new d,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new f(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new f(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new y,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new f,this.isTrigger=Boolean(t.isTrigger),t.shape&&this.addShape(t.shape),this.updateMassProperties()}wakeUp(){const t=this.sleepState;this.sleepState=z.AWAKE,this.wakeUpAfterNarrowphase=!1,t===z.SLEEPING&&this.dispatchEvent(z.wakeupEvent)}sleep(){this.sleepState=z.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(t){if(this.allowSleep){const e=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;e===z.AWAKE&&n<i?(this.sleepState=z.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(z.sleepyEvent)):e===z.SLEEPY&&n>i?this.wakeUp():e===z.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(z.sleepEvent))}}updateSolveMassProperties(){this.sleepState===z.SLEEPING||this.type===z.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(t,e){return void 0===e&&(e=new f),t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e}vectorToLocalFrame(t,e){return void 0===e&&(e=new f),this.quaternion.conjugate().vmult(t,e),e}pointToWorldFrame(t,e){return void 0===e&&(e=new f),this.quaternion.vmult(t,e),e.vadd(this.position,e),e}vectorToWorldFrame(t,e){return void 0===e&&(e=new f),this.quaternion.vmult(t,e),e}addShape(t,e,n){const i=new f,r=new M;return e&&i.copy(e),n&&r.copy(n),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this}removeShape(t){const e=this.shapes.indexOf(t);return-1===e?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeOrientations.splice(e,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=null,this)}updateBoundingRadius(){const t=this.shapes,e=this.shapeOffsets,n=t.length;let i=0;for(let r=0;r!==n;r++){const n=t[r];n.updateBoundingSphereRadius();const s=e[r].length(),o=n.boundingSphereRadius;s+o>i&&(i=s+o)}this.boundingRadius=i}updateAABB(){const t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,i=t.length,r=k,s=F,o=this.quaternion,a=this.aabb,l=U;for(let h=0;h!==i;h++){const i=t[h];o.vmult(e[h],r),r.vadd(this.position,r),o.mult(n[h],s),i.calculateWorldAABB(r,s,l.lowerBound,l.upperBound),0===h?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(t){const e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){const t=H,n=V;t.setRotationFromQuaternion(this.quaternion),t.transpose(n),t.scale(e,t),t.mmult(n,this.invInertiaWorld)}}applyForce(t,e){if(void 0===e&&(e=new f),this.type!==z.DYNAMIC)return;this.sleepState===z.SLEEPING&&this.wakeUp();const n=G;e.cross(t,n),this.force.vadd(t,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(t,e){if(void 0===e&&(e=new f),this.type!==z.DYNAMIC)return;const n=W,i=j;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,i),this.applyForce(n,i)}applyTorque(t){this.type===z.DYNAMIC&&(this.sleepState===z.SLEEPING&&this.wakeUp(),this.torque.vadd(t,this.torque))}applyImpulse(t,e){if(void 0===e&&(e=new f),this.type!==z.DYNAMIC)return;this.sleepState===z.SLEEPING&&this.wakeUp();const n=e,i=q;i.copy(t),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const r=X;n.cross(t,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}applyLocalImpulse(t,e){if(void 0===e&&(e=new f),this.type!==z.DYNAMIC)return;const n=Y,i=$;this.vectorToWorldFrame(t,n),this.vectorToWorldFrame(e,i),this.applyImpulse(n,i)}updateMassProperties(){const t=K;this.invMass=this.mass>0?1/this.mass:0;const e=this.inertia,n=this.fixedRotation;this.updateAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),O.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(t,e){const n=new f;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}integrate(t,e,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==z.DYNAMIC&&this.type!==z.KINEMATIC||this.sleepState===z.SLEEPING)return;const i=this.velocity,r=this.angularVelocity,s=this.position,o=this.force,a=this.torque,l=this.quaternion,h=this.invMass,c=this.invInertiaWorld,u=this.linearFactor,d=h*t;i.x+=o.x*d*u.x,i.y+=o.y*d*u.y,i.z+=o.z*d*u.z;const p=c.elements,f=this.angularFactor,m=a.x*f.x,g=a.y*f.y,v=a.z*f.z;r.x+=t*(p[0]*m+p[1]*g+p[2]*v),r.y+=t*(p[3]*m+p[4]*g+p[5]*v),r.z+=t*(p[6]*m+p[7]*g+p[8]*v),s.x+=i.x*t,s.y+=i.y*t,s.z+=i.z*t,l.integrate(this.angularVelocity,t,this.angularFactor,l),e&&(n?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}z.idCounter=0,z.COLLIDE_EVENT_NAME="collide",z.DYNAMIC=1,z.STATIC=2,z.KINEMATIC=4,z.AWAKE=0,z.SLEEPY=1,z.SLEEPING=2,z.wakeupEvent={type:"wakeup"},z.sleepyEvent={type:"sleepy"},z.sleepEvent={type:"sleep"};const k=new f,F=new M,U=new y,H=new d,V=new d,G=(new d,new f),W=new f,j=new f,q=new f,X=new f,Y=new f,$=new f,K=new f;class Z{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&z.STATIC)&&t.sleepState!==z.SLEEPING||0==(e.type&z.STATIC)&&e.sleepState!==z.SLEEPING)}intersectionTest(t,e,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,i):this.doBoundingSphereBroadphase(t,e,n,i)}doBoundingSphereBroadphase(t,e,n,i){const r=J;e.position.vsub(t.position,r);const s=(t.boundingRadius+e.boundingRadius)**2;r.lengthSquared()<s&&(n.push(t),i.push(e))}doBoundingBoxBroadphase(t,e,n,i){t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),i.push(e))}makePairsUnique(t,e){const n=Q,i=tt,r=et,s=t.length;for(let n=0;n!==s;n++)i[n]=t[n],r[n]=e[n];t.length=0,e.length=0;for(let t=0;t!==s;t++){const e=i[t].id,s=r[t].id,o=e<s?`${e},${s}`:`${s},${e}`;n[o]=t,n.keys.push(o)}for(let s=0;s!==n.keys.length;s++){const s=n.keys.pop(),o=n[s];t.push(i[o]),e.push(r[o]),delete n[s]}}setWorld(t){}static boundingSphereCheck(t,e){const n=new f;t.position.vsub(e.position,n);const i=t.shapes[0],r=e.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const J=new f;new f,new M,new f;const Q={keys:[]},tt=[],et=[];new f,new f,new f;class nt extends Z{constructor(){super()}collisionPairs(t,e,n){const i=t.bodies,r=i.length;let s,o;for(let t=0;t!==r;t++)for(let r=0;r!==t;r++)s=i[t],o=i[r],this.needBroadphaseCollision(s,o)&&this.intersectionTest(s,o,e,n)}aabbQuery(t,e,n){void 0===n&&(n=[]);for(let i=0;i<t.bodies.length;i++){const r=t.bodies[i];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&n.push(r)}return n}}class it{constructor(){this.rayFromWorld=new f,this.rayToWorld=new f,this.hitNormalWorld=new f,this.hitPointWorld=new f,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,e,n,i,r,s,o){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=s,this.distance=o}}let rt,st,ot,at,lt,ht,ct;rt=E.types.SPHERE,st=E.types.PLANE,ot=E.types.BOX,at=E.types.CYLINDER,lt=E.types.CONVEXPOLYHEDRON,ht=E.types.HEIGHTFIELD,ct=E.types.TRIMESH;class ut{get[rt](){return this._intersectSphere}get[st](){return this._intersectPlane}get[ot](){return this._intersectBox}get[at](){return this._intersectConvex}get[lt](){return this._intersectConvex}get[ht](){return this._intersectHeightfield}get[ct](){return this._intersectTrimesh}constructor(t,e){void 0===t&&(t=new f),void 0===e&&(e=new f),this.from=t.clone(),this.to=e.clone(),this.direction=new f,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ut.ANY,this.result=new it,this.hasHit=!1,this.callback=t=>{}}intersectWorld(t,e){return this.mode=e.mode||ut.ANY,this.result=e.result||new it,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===e.checkCollisionResponse||e.checkCollisionResponse,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(dt),pt.length=0,t.broadphase.aabbQuery(t,dt,pt),this.intersectBodies(pt),this.hasHit}intersectBody(t,e){e&&(this.result=e,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!t.collisionResponse)return;if(0==(this.collisionFilterGroup&t.collisionFilterMask)||0==(t.collisionFilterGroup&this.collisionFilterMask))return;const i=gt,r=vt;for(let e=0,s=t.shapes.length;e<s;e++){const s=t.shapes[e];if((!n||s.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[e],r),t.quaternion.vmult(t.shapeOffsets[e],i),i.vadd(t.position,i),this.intersectShape(s,r,i,t),this.result.shouldStop))break}}intersectBodies(t,e){e&&(this.result=e,this.updateDirection());for(let e=0,n=t.length;!this.result.shouldStop&&e<n;e++)this.intersectBody(t[e])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,e,n,i){const r=function(t,e,n){n.vsub(t,kt);const i=kt.dot(e);return e.scale(i,Ft),Ft.vadd(t,Ft),n.distanceTo(Ft)}(this.from,this.direction,n);if(r>t.boundingSphereRadius)return;const s=this[t.type];s&&s.call(this,t,e,n,i,t)}_intersectBox(t,e,n,i,r){return this._intersectConvex(t.convexPolyhedronRepresentation,e,n,i,r)}_intersectPlane(t,e,n,i,r){const s=this.from,o=this.to,a=this.direction,l=new f(0,0,1);e.vmult(l,l);const h=new f;s.vsub(n,h);const c=h.dot(l);if(o.vsub(n,h),c*h.dot(l)>0)return;if(s.distanceTo(o)<c)return;const u=l.dot(a);if(Math.abs(u)<this.precision)return;const d=new f,p=new f,m=new f;s.vsub(n,d);const g=-l.dot(d)/u;a.scale(g,p),s.vadd(p,m),this.reportIntersection(l,m,r,i,-1)}getAABB(t){const{lowerBound:e,upperBound:n}=t,i=this.to,r=this.from;e.x=Math.min(i.x,r.x),e.y=Math.min(i.y,r.y),e.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}_intersectHeightfield(t,e,n,i,r){t.data,t.elementSize;const s=St;s.from.copy(this.from),s.to.copy(this.to),A.pointToLocalFrame(n,e,s.from,s.from),A.pointToLocalFrame(n,e,s.to,s.to),s.updateDirection();const o=Tt;let a,l,h,c;a=l=0,h=c=t.data.length-1;const u=new y;s.getAABB(u),t.getIndexOfPosition(u.lowerBound.x,u.lowerBound.y,o,!0),a=Math.max(a,o[0]),l=Math.max(l,o[1]),t.getIndexOfPosition(u.upperBound.x,u.upperBound.y,o,!0),h=Math.min(h,o[0]+1),c=Math.min(c,o[1]+1);for(let o=a;o<h;o++)for(let a=l;a<c;a++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(o,a,u),u.overlapsRay(s)){if(t.getConvexTrianglePillar(o,a,!1),A.pointToWorldFrame(n,e,t.pillarOffset,Mt),this._intersectConvex(t.pillarConvex,e,Mt,i,r,_t),this.result.shouldStop)return;t.getConvexTrianglePillar(o,a,!0),A.pointToWorldFrame(n,e,t.pillarOffset,Mt),this._intersectConvex(t.pillarConvex,e,Mt,i,r,_t)}}}_intersectSphere(t,e,n,i,r){const s=this.from,o=this.to,a=t.radius,l=(o.x-s.x)**2+(o.y-s.y)**2+(o.z-s.z)**2,h=2*((o.x-s.x)*(s.x-n.x)+(o.y-s.y)*(s.y-n.y)+(o.z-s.z)*(s.z-n.z)),c=h**2-4*l*((s.x-n.x)**2+(s.y-n.y)**2+(s.z-n.z)**2-a**2),u=Et,d=At;if(!(c<0))if(0===c)s.lerp(o,c,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,r,i,-1);else{const t=(-h-Math.sqrt(c))/(2*l),e=(-h+Math.sqrt(c))/(2*l);if(t>=0&&t<=1&&(s.lerp(o,t,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,r,i,-1)),this.result.shouldStop)return;e>=0&&e<=1&&(s.lerp(o,e,u),u.vsub(n,d),d.normalize(),this.reportIntersection(d,u,r,i,-1))}}_intersectConvex(t,e,n,i,r,s){const o=Ct,a=Pt,l=s&&s.faceList||null,h=t.faces,c=t.vertices,u=t.faceNormals,d=this.direction,p=this.from,f=this.to,m=p.distanceTo(f),g=l?l.length:h.length,v=this.result;for(let t=0;!v.shouldStop&&t<g;t++){const s=l?l[t]:t,f=h[s],g=u[s],y=e,x=n;a.copy(c[f[0]]),y.vmult(a,a),a.vadd(x,a),a.vsub(p,a),y.vmult(g,o);const b=d.dot(o);if(Math.abs(b)<this.precision)continue;const w=o.dot(a)/b;if(!(w<0)){d.scale(w,yt),yt.vadd(p,yt),xt.copy(c[f[0]]),y.vmult(xt,xt),x.vadd(xt,xt);for(let t=1;!v.shouldStop&&t<f.length-1;t++){bt.copy(c[f[t]]),wt.copy(c[f[t+1]]),y.vmult(bt,bt),y.vmult(wt,wt),x.vadd(bt,bt),x.vadd(wt,wt);const e=yt.distanceTo(p);!ut.pointInTriangle(yt,xt,bt,wt)&&!ut.pointInTriangle(yt,bt,xt,wt)||e>m||this.reportIntersection(o,yt,r,i,s)}}}}_intersectTrimesh(t,e,n,i,r,s){const o=Rt,a=Nt,l=zt,h=Pt,c=Lt,u=It,d=Dt,p=Bt,f=Ot,m=t.indices;t.vertices;const g=this.from,v=this.to,y=this.direction;l.position.copy(n),l.quaternion.copy(e),A.vectorToLocalFrame(n,e,y,c),A.pointToLocalFrame(n,e,g,u),A.pointToLocalFrame(n,e,v,d),d.x*=t.scale.x,d.y*=t.scale.y,d.z*=t.scale.z,u.x*=t.scale.x,u.y*=t.scale.y,u.z*=t.scale.z,d.vsub(u,c),c.normalize();const x=u.distanceSquared(d);t.tree.rayQuery(this,l,a);for(let s=0,l=a.length;!this.result.shouldStop&&s!==l;s++){const l=a[s];t.getNormal(l,o),t.getVertex(m[3*l],xt),xt.vsub(u,h);const d=c.dot(o),g=o.dot(h)/d;if(g<0)continue;c.scale(g,yt),yt.vadd(u,yt),t.getVertex(m[3*l+1],bt),t.getVertex(m[3*l+2],wt);const v=yt.distanceSquared(u);!ut.pointInTriangle(yt,bt,xt,wt)&&!ut.pointInTriangle(yt,xt,bt,wt)||v>x||(A.vectorToWorldFrame(e,o,f),A.pointToWorldFrame(n,e,yt,p),this.reportIntersection(f,p,r,i,l))}a.length=0}reportIntersection(t,e,n,i,r){const s=this.from,o=this.to,a=s.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case ut.ALL:this.hasHit=!0,l.set(s,o,t,e,n,i,a),l.hasHit=!0,this.callback(l);break;case ut.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,i,a));break;case ut.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,i,a),l.shouldStop=!0}}static pointInTriangle(t,e,n,i){i.vsub(e,kt),n.vsub(e,ft),t.vsub(e,mt);const r=kt.dot(kt),s=kt.dot(ft),o=kt.dot(mt),a=ft.dot(ft),l=ft.dot(mt);let h,c;return(h=a*o-s*l)>=0&&(c=r*l-s*o)>=0&&h+c<r*a-s*s}}ut.CLOSEST=1,ut.ANY=2,ut.ALL=4;const dt=new y,pt=[],ft=new f,mt=new f,gt=new f,vt=new M,yt=new f,xt=new f,bt=new f,wt=new f;new f,new it;const _t={faceList:[0]},Mt=new f,St=new ut,Tt=[],Et=new f,At=new f,Ct=new f,Pt=(new f,new f,new f),Rt=new f,Lt=new f,It=new f,Dt=new f,Ot=new f,Bt=new f;new y;const Nt=[],zt=new A,kt=new f,Ft=new f;class Ut{static defaults(t,e){void 0===t&&(t={});for(let n in e)n in t||(t[n]=e[n]);return t}}class Ht{constructor(t,e,n){void 0===n&&(n={}),n=Ut.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=Ht.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!0}disable(){const t=this.equations;for(let e=0;e<t.length;e++)t[e].enabled=!1}}Ht.idCounter=0;class Vt{constructor(){this.spatial=new f,this.rotational=new f}multiplyElement(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)}multiplyVectors(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}}class Gt{constructor(t,e,n,i){void 0===n&&(n=-1e6),void 0===i&&(i=1e6),this.id=Gt.idCounter++,this.minForce=n,this.maxForce=i,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Vt,this.jacobianElementB=new Vt,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,e,n){const i=e,r=t,s=n;this.a=4/(s*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(s*s*r*(1+4*i))}computeB(t,e,n){const i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*n}computeGq(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,s=i.position;return t.spatial.dot(r)+e.spatial.dot(s)}computeGW(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,s=i.velocity,o=n.angularVelocity,a=i.angularVelocity;return t.multiplyVectors(r,o)+e.multiplyVectors(s,a)}computeGWlambda(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,s=i.vlambda,o=n.wlambda,a=i.wlambda;return t.multiplyVectors(r,o)+e.multiplyVectors(s,a)}computeGiMf(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,s=n.torque,o=i.force,a=i.torque,l=n.invMassSolve,h=i.invMassSolve;return r.scale(l,Wt),o.scale(h,jt),n.invInertiaWorldSolve.vmult(s,qt),i.invInertiaWorldSolve.vmult(a,Xt),t.multiplyVectors(Wt,qt)+e.multiplyVectors(jt,Xt)}computeGiMGt(){const t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,s=i.invMassSolve,o=n.invInertiaWorldSolve,a=i.invInertiaWorldSolve;let l=r+s;return o.vmult(t.rotational,Yt),l+=Yt.dot(t.rotational),a.vmult(e.rotational,Yt),l+=Yt.dot(e.rotational),l}addToWlambda(t){const e=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,s=$t;i.vlambda.addScaledVector(i.invMassSolve*t,e.spatial,i.vlambda),r.vlambda.addScaledVector(r.invMassSolve*t,n.spatial,r.vlambda),i.invInertiaWorldSolve.vmult(e.rotational,s),i.wlambda.addScaledVector(t,s,i.wlambda),r.invInertiaWorldSolve.vmult(n.rotational,s),r.wlambda.addScaledVector(t,s,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Gt.idCounter=0;const Wt=new f,jt=new f,qt=new f,Xt=new f,Yt=new f,$t=new f;class Kt extends Gt{constructor(t,e,n){void 0===n&&(n=1e6),super(t,e,0,n),this.restitution=0,this.ri=new f,this.rj=new f,this.ni=new f}computeB(t){const e=this.a,n=this.b,i=this.bi,r=this.bj,s=this.ri,o=this.rj,a=Zt,l=Jt,h=i.velocity,c=i.angularVelocity;i.force,i.torque;const u=r.velocity,d=r.angularVelocity;r.force,r.torque;const p=Qt,f=this.jacobianElementA,m=this.jacobianElementB,g=this.ni;s.cross(g,a),o.cross(g,l),g.negate(f.spatial),a.negate(f.rotational),m.spatial.copy(g),m.rotational.copy(l),p.copy(r.position),p.vadd(o,p),p.vsub(i.position,p),p.vsub(s,p);const v=g.dot(p),y=this.restitution+1;return-v*e-(y*u.dot(g)-y*h.dot(g)+d.dot(l)-c.dot(a))*n-t*this.computeGiMf()}getImpactVelocityAlongNormal(){const t=te,e=ee,n=ne,i=ie,r=re;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,r),this.ni.dot(r)}}const Zt=new f,Jt=new f,Qt=new f,te=new f,ee=new f,ne=new f,ie=new f,re=new f;new f,new f,new f,new f,new f,new f,new f,new f,new f,new f;class se extends Gt{constructor(t,e,n){super(t,e,-n,n),this.ri=new f,this.rj=new f,this.t=new f}computeB(t){this.a;const e=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,r=oe,s=ae,o=this.t;n.cross(o,r),i.cross(o,s);const a=this.jacobianElementA,l=this.jacobianElementB;return o.negate(a.spatial),r.negate(a.rotational),l.spatial.copy(o),l.rotational.copy(s),-this.computeGW()*e-t*this.computeGiMf()}}const oe=new f,ae=new f;class le{constructor(t,e,n){n=Ut.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=le.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}le.idCounter=0;class he{constructor(t){void 0===t&&(t={});let e="";"string"==typeof t&&(e=t,t={}),this.name=e,this.id=he.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}}he.idCounter=0,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new ut,new f,new f,new f,new f(1,0,0),new f(0,1,0),new f(0,0,1),new f,new f,new f,new f,new f,new f,new f,new f,new f,new f,new f;class ce extends E{constructor(t){if(super({type:E.types.SPHERE}),this.radius=void 0!==t?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(t,e){void 0===e&&(e=new f);const n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(t,e,n,i){const r=this.radius,s=["x","y","z"];for(let e=0;e<s.length;e++){const o=s[e];n[o]=t[o]-r,i[o]=t[o]+r}}}new f,new f,new f,new f,new f,new f,new f,new f,new f;class ue extends P{constructor(t,e,n,i){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=8),t<0)throw new Error("The cylinder radiusTop cannot be negative.");if(e<0)throw new Error("The cylinder radiusBottom cannot be negative.");const r=i,s=[],o=[],a=[],l=[],h=[],c=Math.cos,u=Math.sin;s.push(new f(-e*u(0),.5*-n,e*c(0))),l.push(0),s.push(new f(-t*u(0),.5*n,t*c(0))),h.push(1);for(let i=0;i<r;i++){const d=2*Math.PI/r*(i+1),p=2*Math.PI/r*(i+.5);i<r-1?(s.push(new f(-e*u(d),.5*-n,e*c(d))),l.push(2*i+2),s.push(new f(-t*u(d),.5*n,t*c(d))),h.push(2*i+3),a.push([2*i,2*i+1,2*i+3,2*i+2])):a.push([2*i,2*i+1,1,0]),(r%2==1||i<r/2)&&o.push(new f(-u(p),0,c(p)))}a.push(l),o.push(new f(0,1,0));const d=[];for(let t=0;t<h.length;t++)d.push(h[h.length-t-1]);a.push(d),super({vertices:s,faces:a,axes:o}),this.type=E.types.CYLINDER,this.radiusTop=t,this.radiusBottom=e,this.height=n,this.numSegments=i}}class de extends E{constructor(){super({type:E.types.PLANE}),this.worldNormal=new f,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(t){const e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(t,e){return void 0===e&&(e=new f),e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,i){pe.set(0,0,1),e.vmult(pe,pe);const r=Number.MAX_VALUE;n.set(-r,-r,-r),i.set(r,r,r),1===pe.x?i.x=t.x:-1===pe.x&&(n.x=t.x),1===pe.y?i.y=t.y:-1===pe.y&&(n.y=t.y),1===pe.z?i.z=t.z:-1===pe.z&&(n.z=t.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const pe=new f;class fe extends E{constructor(t,e){void 0===e&&(e={}),e=Ut.defaults(e,{maxValue:null,minValue:null,elementSize:1}),super({type:E.types.HEIGHTFIELD}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,this.pillarConvex=new P,this.pillarOffset=new f,this.updateBoundingSphereRadius(),this._cachedPillars={}}update(){this._cachedPillars={}}updateMinValue(){const t=this.data;let e=t[0][0];for(let n=0;n!==t.length;n++)for(let i=0;i!==t[n].length;i++){const r=t[n][i];r<e&&(e=r)}this.minValue=e}updateMaxValue(){const t=this.data;let e=t[0][0];for(let n=0;n!==t.length;n++)for(let i=0;i!==t[n].length;i++){const r=t[n][i];r>e&&(e=r)}this.maxValue=e}setHeightValueAtIndex(t,e,n){this.data[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)}getRectMinMax(t,e,n,i,r){void 0===r&&(r=[]);const s=this.data;let o=this.minValue;for(let r=t;r<=n;r++)for(let t=e;t<=i;t++){const e=s[r][t];e>o&&(o=e)}r[0]=this.minValue,r[1]=o}getIndexOfPosition(t,e,n,i){const r=this.elementSize,s=this.data;let o=Math.floor(t/r),a=Math.floor(e/r);return n[0]=o,n[1]=a,i&&(o<0&&(o=0),a<0&&(a=0),o>=s.length-1&&(o=s.length-1),a>=s[0].length-1&&(a=s[0].length-1)),!(o<0||a<0||o>=s.length-1||a>=s[0].length-1)}getTriangleAt(t,e,n,i,r,s){const o=me;this.getIndexOfPosition(t,e,o,n);let a=o[0],l=o[1];const h=this.data;n&&(a=Math.min(h.length-2,Math.max(0,a)),l=Math.min(h[0].length-2,Math.max(0,l)));const c=this.elementSize,u=(t/c-a)**2+(e/c-l)**2>(t/c-(a+1))**2+(e/c-(l+1))**2;return this.getTriangle(a,l,u,i,r,s),u}getNormalAt(t,e,n,i){const r=be,s=we,o=_e,a=Me,l=Se;this.getTriangleAt(t,e,n,r,s,o),s.vsub(r,a),o.vsub(r,l),a.cross(l,i),i.normalize()}getAabbAtIndex(t,e,n){let{lowerBound:i,upperBound:r}=n;const s=this.data,o=this.elementSize;i.set(t*o,e*o,s[t][e]),r.set((t+1)*o,(e+1)*o,s[t+1][e+1])}getHeightAt(t,e,n){const i=this.data,r=ve,s=ye,o=xe,a=me;this.getIndexOfPosition(t,e,a,n);let l=a[0],h=a[1];n&&(l=Math.min(i.length-2,Math.max(0,l)),h=Math.min(i[0].length-2,Math.max(0,h)));const c=this.getTriangleAt(t,e,n,r,s,o);!function(t,e,n,i,r,s,o,a,l){l.x=((s-a)*(t-o)+(o-r)*(e-a))/((s-a)*(n-o)+(o-r)*(i-a)),l.y=((a-i)*(t-o)+(n-o)*(e-a))/((s-a)*(n-o)+(o-r)*(i-a)),l.z=1-l.x-l.y}(t,e,r.x,r.y,s.x,s.y,o.x,o.y,ge);const u=ge;return c?i[l+1][h+1]*u.x+i[l][h+1]*u.y+i[l+1][h]*u.z:i[l][h]*u.x+i[l+1][h]*u.y+i[l][h+1]*u.z}getCacheConvexTrianglePillarKey(t,e,n){return`${t}_${e}_${n?1:0}`}getCachedConvexTrianglePillar(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]}setCachedConvexTrianglePillar(t,e,n,i,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:i,offset:r}}clearCachedConvexTrianglePillar(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]}getTriangle(t,e,n,i,r,s){const o=this.data,a=this.elementSize;n?(i.set((t+1)*a,(e+1)*a,o[t+1][e+1]),r.set(t*a,(e+1)*a,o[t][e+1]),s.set((t+1)*a,e*a,o[t+1][e])):(i.set(t*a,e*a,o[t][e]),r.set((t+1)*a,e*a,o[t+1][e]),s.set(t*a,(e+1)*a,o[t][e+1]))}getConvexTrianglePillar(t,e,n){let i=this.pillarConvex,r=this.pillarOffset;if(this.cacheEnabled){const s=this.getCachedConvexTrianglePillar(t,e,n);if(s)return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);i=new P,r=new f,this.pillarConvex=i,this.pillarOffset=r}const s=this.data,o=this.elementSize,a=i.faces;i.vertices.length=6;for(let t=0;t<6;t++)i.vertices[t]||(i.vertices[t]=new f);a.length=5;for(let t=0;t<5;t++)a[t]||(a[t]=[]);const l=i.vertices,h=(Math.min(s[t][e],s[t+1][e],s[t][e+1],s[t+1][e+1])-this.minValue)/2+this.minValue;n?(r.set((t+.75)*o,(e+.75)*o,h),l[0].set(.25*o,.25*o,s[t+1][e+1]-h),l[1].set(-.75*o,.25*o,s[t][e+1]-h),l[2].set(.25*o,-.75*o,s[t+1][e]-h),l[3].set(.25*o,.25*o,-Math.abs(h)-1),l[4].set(-.75*o,.25*o,-Math.abs(h)-1),l[5].set(.25*o,-.75*o,-Math.abs(h)-1),a[0][0]=0,a[0][1]=1,a[0][2]=2,a[1][0]=5,a[1][1]=4,a[1][2]=3,a[2][0]=2,a[2][1]=5,a[2][2]=3,a[2][3]=0,a[3][0]=3,a[3][1]=4,a[3][2]=1,a[3][3]=0,a[4][0]=1,a[4][1]=4,a[4][2]=5,a[4][3]=2):(r.set((t+.25)*o,(e+.25)*o,h),l[0].set(-.25*o,-.25*o,s[t][e]-h),l[1].set(.75*o,-.25*o,s[t+1][e]-h),l[2].set(-.25*o,.75*o,s[t][e+1]-h),l[3].set(-.25*o,-.25*o,-Math.abs(h)-1),l[4].set(.75*o,-.25*o,-Math.abs(h)-1),l[5].set(-.25*o,.75*o,-Math.abs(h)-1),a[0][0]=0,a[0][1]=1,a[0][2]=2,a[1][0]=5,a[1][1]=4,a[1][2]=3,a[2][0]=0,a[2][1]=2,a[2][2]=5,a[2][3]=3,a[3][0]=1,a[3][1]=0,a[3][2]=3,a[3][3]=4,a[4][0]=4,a[4][1]=5,a[4][2]=2,a[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,i,r)}calculateLocalInertia(t,e){return void 0===e&&(e=new f),e.set(0,0,0),e}volume(){return Number.MAX_VALUE}calculateWorldAABB(t,e,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){const t=this.data,e=this.elementSize;this.boundingSphereRadius=new f(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()}setHeightsFromImage(t,e){const{x:n,z:i,y:r}=e,s=document.createElement("canvas");s.width=t.width,s.height=t.height;const o=s.getContext("2d");o.drawImage(t,0,0);const a=o.getImageData(0,0,t.width,t.height),l=this.data;l.length=0,this.elementSize=Math.abs(n)/a.width;for(let t=0;t<a.height;t++){const e=[];for(let r=0;r<a.width;r++){const s=(a.data[4*(t*a.height+r)]+a.data[4*(t*a.height+r)+1]+a.data[4*(t*a.height+r)+2])/4/255*i;n<0?e.push(s):e.unshift(s)}r<0?l.unshift(e):l.push(e)}this.updateMaxValue(),this.updateMinValue(),this.update()}}const me=[],ge=new f,ve=new f,ye=new f,xe=new f,be=new f,we=new f,_e=new f,Me=new f,Se=new f;class Te{constructor(t){void 0===t&&(t={}),this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new y,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(t,e,n){void 0===n&&(n=0);const i=this.data;if(!this.aabb.contains(t))return!1;const r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let i=!1;r.length||(this.subdivide(),i=!0);for(let i=0;8!==i;i++)if(r[i].insert(t,e,n+1))return!0;i&&(r.length=0)}return i.push(e),!0}subdivide(){const t=this.aabb,e=t.lowerBound,n=t.upperBound,i=this.children;i.push(new Te({aabb:new y({lowerBound:new f(0,0,0)})}),new Te({aabb:new y({lowerBound:new f(1,0,0)})}),new Te({aabb:new y({lowerBound:new f(1,1,0)})}),new Te({aabb:new y({lowerBound:new f(1,1,1)})}),new Te({aabb:new y({lowerBound:new f(0,1,1)})}),new Te({aabb:new y({lowerBound:new f(0,0,1)})}),new Te({aabb:new y({lowerBound:new f(1,0,1)})}),new Te({aabb:new y({lowerBound:new f(0,1,0)})})),n.vsub(e,Ae),Ae.scale(.5,Ae);const r=this.root||this;for(let t=0;8!==t;t++){const n=i[t];n.root=r;const s=n.aabb.lowerBound;s.x*=Ae.x,s.y*=Ae.y,s.z*=Ae.z,s.vadd(e,s),s.vadd(Ae,n.aabb.upperBound)}}aabbQuery(t,e){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(n,i.children)}return e}rayQuery(t,e,n){return t.getAABB(Ce),Ce.toLocalFrame(e,Ce),this.aabbQuery(Ce,n),n}removeEmptyNodes(){for(let t=this.children.length-1;t>=0;t--)this.children[t].removeEmptyNodes(),this.children[t].children.length||this.children[t].data.length||this.children.splice(t,1)}}class Ee extends Te{constructor(t,e){void 0===e&&(e={}),super({root:null,aabb:t}),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}}const Ae=new f,Ce=new y;class Pe extends E{constructor(t,e){super({type:E.types.TRIMESH}),this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new y,this.edges=null,this.scale=new f(1,1,1),this.tree=new Ee,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const t=this.tree;t.reset(),t.aabb.copy(this.aabb);const e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;const n=new y,i=new f,r=new f,s=new f,o=[i,r,s];for(let e=0;e<this.indices.length/3;e++){const a=3*e;this._getUnscaledVertex(this.indices[a],i),this._getUnscaledVertex(this.indices[a+1],r),this._getUnscaledVertex(this.indices[a+2],s),n.setFromPoints(o),t.insert(n,e)}t.removeEmptyNodes()}getTrianglesInAABB(t,e){Le.copy(t);const n=this.scale,i=n.x,r=n.y,s=n.z,o=Le.lowerBound,a=Le.upperBound;return o.x/=i,o.y/=r,o.z/=s,a.x/=i,a.y/=r,a.z/=s,this.tree.aabbQuery(Le,e)}setScale(t){const e=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=t.x===t.y&&t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const t=Re,e=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,r=this.indices[i],s=this.indices[i+1],o=this.indices[i+2];this.getVertex(r,Ne),this.getVertex(s,ze),this.getVertex(o,ke),Pe.computeNormal(ze,Ne,ke,t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z}}updateEdges(){const t={},e=(e,n)=>{t[e<n?`${e}_${n}`:`${n}_${e}`]=!0};for(let t=0;t<this.indices.length/3;t++){const n=3*t,i=this.indices[n],r=this.indices[n+1],s=this.indices[n+2];e(i,r),e(r,s),e(s,i)}const n=Object.keys(t);this.edges=new Int16Array(2*n.length);for(let t=0;t<n.length;t++){const e=n[t].split("_");this.edges[2*t]=parseInt(e[0],10),this.edges[2*t+1]=parseInt(e[1],10)}}getEdgeVertex(t,e,n){const i=this.edges[2*t+(e?1:0)];this.getVertex(i,n)}getEdgeVector(t,e){const n=Ie,i=De;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,i),i.vsub(n,e)}static computeNormal(t,e,n,i){e.vsub(t,Be),n.vsub(e,Oe),Oe.cross(Be,i),i.isZero()||i.normalize()}getVertex(t,e){const n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e}_getUnscaledVertex(t,e){const n=3*t,i=this.vertices;return e.set(i[n],i[n+1],i[n+2])}getWorldVertex(t,e,n,i){return this.getVertex(t,i),A.pointToWorldFrame(e,n,i,i),i}getTriangleVertices(t,e,n,i){const r=3*t;this.getVertex(this.indices[r],e),this.getVertex(this.indices[r+1],n),this.getVertex(this.indices[r+2],i)}getNormal(t,e){const n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(t,e){this.computeLocalAABB(Fe);const n=Fe.upperBound.x-Fe.lowerBound.x,i=Fe.upperBound.y-Fe.lowerBound.y,r=Fe.upperBound.z-Fe.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*r*2*r),1/12*t*(2*n*2*n+2*r*2*r),1/12*t*(2*i*2*i+2*n*2*n))}computeLocalAABB(t){const e=t.lowerBound,n=t.upperBound,i=this.vertices.length;this.vertices;const r=Ue;this.getVertex(0,r),e.copy(r),n.copy(r);for(let t=0;t!==i;t++)this.getVertex(t,r),r.x<e.x?e.x=r.x:r.x>n.x&&(n.x=r.x),r.y<e.y?e.y=r.y:r.y>n.y&&(n.y=r.y),r.z<e.z?e.z=r.z:r.z>n.z&&(n.z=r.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let t=0;const e=this.vertices,n=new f;for(let i=0,r=e.length/3;i!==r;i++){this.getVertex(i,n);const e=n.lengthSquared();e>t&&(t=e)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,n,i){const r=He,s=Ve;r.position=t,r.quaternion=e,this.aabb.toWorldFrame(r,s),n.copy(s.lowerBound),i.copy(s.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(t,e,n,i,r){void 0===t&&(t=1),void 0===e&&(e=.5),void 0===n&&(n=8),void 0===i&&(i=6),void 0===r&&(r=2*Math.PI);const s=[],o=[];for(let o=0;o<=n;o++)for(let a=0;a<=i;a++){const l=a/i*r,h=o/n*Math.PI*2,c=(t+e*Math.cos(h))*Math.cos(l),u=(t+e*Math.cos(h))*Math.sin(l),d=e*Math.sin(h);s.push(c,u,d)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,s=(i+1)*(t-1)+e,a=(i+1)*t+e;o.push(n,r,a),o.push(r,s,a)}return new Pe(s,o)}}const Re=new f,Le=new y,Ie=new f,De=new f,Oe=new f,Be=new f,Ne=new f,ze=new f,ke=new f,Fe=new y,Ue=new f,He=new A,Ve=new y;class Ge{constructor(){this.equations=[]}solve(t,e){return 0}addEquation(t){!t.enabled||t.bi.isTrigger||t.bj.isTrigger||this.equations.push(t)}removeEquation(t){const e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)}removeAllEquations(){this.equations.length=0}}class We extends Ge{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(t,e){let n=0;const i=this.iterations,r=this.tolerance*this.tolerance,s=this.equations,o=s.length,a=e.bodies,l=a.length,h=t;let c,u,d,p,f,m;if(0!==o)for(let t=0;t!==l;t++)a[t].updateSolveMassProperties();const g=qe,v=Xe,y=je;g.length=o,v.length=o,y.length=o;for(let t=0;t!==o;t++){const e=s[t];y[t]=0,v[t]=e.computeB(h),g[t]=1/e.computeC()}if(0!==o){for(let t=0;t!==l;t++){const e=a[t],n=e.vlambda,i=e.wlambda;n.set(0,0,0),i.set(0,0,0)}for(n=0;n!==i;n++){p=0;for(let t=0;t!==o;t++){const e=s[t];c=v[t],u=g[t],m=y[t],f=e.computeGWlambda(),d=u*(c-f-e.eps*m),m+d<e.minForce?d=e.minForce-m:m+d>e.maxForce&&(d=e.maxForce-m),y[t]+=d,p+=d>0?d:-d,e.addToWlambda(d)}if(p*p<r)break}for(let t=0;t!==l;t++){const e=a[t],n=e.velocity,i=e.angularVelocity;e.vlambda.vmul(e.linearFactor,e.vlambda),n.vadd(e.vlambda,n),e.wlambda.vmul(e.angularFactor,e.wlambda),i.vadd(e.wlambda,i)}let t=s.length;const e=1/h;for(;t--;)s[t].multiplier=y[t]*e}return n}}const je=[],qe=[],Xe=[];z.STATIC;class Ye{constructor(){this.objects=[],this.type=Object}release(){const t=arguments.length;for(let e=0;e!==t;e++)this.objects.push(e<0||arguments.length<=e?void 0:arguments[e]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(t){const e=this.objects;for(;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}}class $e extends Ye{constructor(){super(...arguments),this.type=f}constructObject(){return new f}}const Ke=E.types.SPHERE,Ze=E.types.SPHERE|E.types.PLANE,Je=E.types.BOX|E.types.BOX,Qe=E.types.SPHERE|E.types.BOX,tn=E.types.PLANE|E.types.BOX,en=E.types.CONVEXPOLYHEDRON,nn=E.types.SPHERE|E.types.CONVEXPOLYHEDRON,rn=E.types.PLANE|E.types.CONVEXPOLYHEDRON,sn=E.types.BOX|E.types.CONVEXPOLYHEDRON,on=E.types.SPHERE|E.types.HEIGHTFIELD,an=E.types.BOX|E.types.HEIGHTFIELD,ln=E.types.CONVEXPOLYHEDRON|E.types.HEIGHTFIELD,hn=E.types.PARTICLE|E.types.SPHERE,cn=E.types.PLANE|E.types.PARTICLE,un=E.types.BOX|E.types.PARTICLE,dn=E.types.PARTICLE|E.types.CONVEXPOLYHEDRON,pn=E.types.CYLINDER,fn=E.types.SPHERE|E.types.CYLINDER,mn=E.types.PLANE|E.types.CYLINDER,gn=E.types.BOX|E.types.CYLINDER,vn=E.types.CONVEXPOLYHEDRON|E.types.CYLINDER,yn=E.types.HEIGHTFIELD|E.types.CYLINDER,xn=E.types.PARTICLE|E.types.CYLINDER,bn=E.types.SPHERE|E.types.TRIMESH,wn=E.types.PLANE|E.types.TRIMESH;class _n{get[Ke](){return this.sphereSphere}get[Ze](){return this.spherePlane}get[Je](){return this.boxBox}get[Qe](){return this.sphereBox}get[tn](){return this.planeBox}get[en](){return this.convexConvex}get[nn](){return this.sphereConvex}get[rn](){return this.planeConvex}get[sn](){return this.boxConvex}get[on](){return this.sphereHeightfield}get[an](){return this.boxHeightfield}get[ln](){return this.convexHeightfield}get[hn](){return this.sphereParticle}get[cn](){return this.planeParticle}get[un](){return this.boxParticle}get[dn](){return this.convexParticle}get[pn](){return this.convexConvex}get[fn](){return this.sphereConvex}get[mn](){return this.planeConvex}get[gn](){return this.boxConvex}get[vn](){return this.convexConvex}get[yn](){return this.heightfieldCylinder}get[xn](){return this.particleCylinder}get[bn](){return this.sphereTrimesh}get[wn](){return this.planeTrimesh}constructor(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new $e,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(t,e,n,i,r,s){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=t,o.bj=e):o=new Kt(t,e),o.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&i.collisionResponse;const a=this.currentContactMaterial;o.restitution=a.restitution,o.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=n.material||t.material,h=i.material||e.material;return l&&h&&l.restitution>=0&&h.restitution>=0&&(o.restitution=l.restitution*h.restitution),o.si=r||n,o.sj=s||i,o}createFrictionEquationsFromContact(t,e){const n=t.bi,i=t.bj,r=t.si,s=t.sj,o=this.world,a=this.currentContactMaterial;let l=a.friction;const h=r.material||n.material,c=s.material||i.material;if(h&&c&&h.friction>=0&&c.friction>=0&&(l=h.friction*c.friction),l>0){const r=l*o.gravity.length();let s=n.invMass+i.invMass;s>0&&(s=1/s);const h=this.frictionEquationPool,c=h.length?h.pop():new se(n,i,r*s),u=h.length?h.pop():new se(n,i,r*s);return c.bi=u.bi=n,c.bj=u.bj=i,c.minForce=u.minForce=-r*s,c.maxForce=u.maxForce=r*s,c.ri.copy(t.ri),c.rj.copy(t.rj),u.ri.copy(t.ri),u.rj.copy(t.rj),t.ni.tangents(c.t,u.t),c.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),u.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),c.enabled=u.enabled=t.enabled,e.push(c,u),!0}return!1}createFrictionFromAverage(t){let e=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(e,this.frictionResult)||1===t)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];Mn.setZero(),Sn.setZero(),Tn.setZero();const r=e.bi;e.bj;for(let n=0;n!==t;n++)e=this.result[this.result.length-1-n],e.bi!==r?(Mn.vadd(e.ni,Mn),Sn.vadd(e.ri,Sn),Tn.vadd(e.rj,Tn)):(Mn.vsub(e.ni,Mn),Sn.vadd(e.rj,Sn),Tn.vadd(e.ri,Tn));const s=1/t;Sn.scale(s,n.ri),Tn.scale(s,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),Mn.normalize(),Mn.tangents(n.t,i.t)}getContacts(t,e,n,i,r,s,o){this.contactPointPool=r,this.frictionEquationPool=o,this.result=i,this.frictionResult=s;const a=Cn,l=Pn,h=En,c=An;for(let i=0,r=t.length;i!==r;i++){const r=t[i],s=e[i];let o=null;r.material&&s.material&&(o=n.getContactMaterial(r.material,s.material)||null);const u=r.type&z.KINEMATIC&&s.type&z.STATIC||r.type&z.STATIC&&s.type&z.KINEMATIC||r.type&z.KINEMATIC&&s.type&z.KINEMATIC;for(let t=0;t<r.shapes.length;t++){r.quaternion.mult(r.shapeOrientations[t],a),r.quaternion.vmult(r.shapeOffsets[t],h),h.vadd(r.position,h);const e=r.shapes[t];for(let t=0;t<s.shapes.length;t++){s.quaternion.mult(s.shapeOrientations[t],l),s.quaternion.vmult(s.shapeOffsets[t],c),c.vadd(s.position,c);const i=s.shapes[t];if(!(e.collisionFilterMask&i.collisionFilterGroup&&i.collisionFilterMask&e.collisionFilterGroup))continue;if(h.distanceTo(c)>e.boundingSphereRadius+i.boundingSphereRadius)continue;let d=null;e.material&&i.material&&(d=n.getContactMaterial(e.material,i.material)||null),this.currentContactMaterial=d||o||n.defaultContactMaterial;const p=this[e.type|i.type];if(p){let t=!1;t=e.type<i.type?p.call(this,e,i,h,c,a,l,r,s,e,i,u):p.call(this,i,e,c,h,l,a,s,r,e,i,u),t&&u&&(n.shapeOverlapKeeper.set(e.id,i.id),n.bodyOverlapKeeper.set(r.id,s.id))}}}}}sphereSphere(t,e,n,i,r,s,o,a,l,h,c){if(c)return n.distanceSquared(i)<(t.radius+e.radius)**2;const u=this.createContactEquation(o,a,t,e,l,h);i.vsub(n,u.ni),u.ni.normalize(),u.ri.copy(u.ni),u.rj.copy(u.ni),u.ri.scale(t.radius,u.ri),u.rj.scale(-e.radius,u.rj),u.ri.vadd(n,u.ri),u.ri.vsub(o.position,u.ri),u.rj.vadd(i,u.rj),u.rj.vsub(a.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}spherePlane(t,e,n,i,r,s,o,a,l,h,c){const u=this.createContactEquation(o,a,t,e,l,h);if(u.ni.set(0,0,1),s.vmult(u.ni,u.ni),u.ni.negate(u.ni),u.ni.normalize(),u.ni.scale(t.radius,u.ri),n.vsub(i,Yn),u.ni.scale(u.ni.dot(Yn),$n),Yn.vsub($n,u.rj),-Yn.dot(u.ni)<=t.radius){if(c)return!0;const t=u.ri,e=u.rj;t.vadd(n,t),t.vsub(o.position,t),e.vadd(i,e),e.vsub(a.position,e),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}}boxBox(t,e,n,i,r,s,o,a,l,h,c){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,i,r,s,o,a,t,e,c)}sphereBox(t,e,n,i,r,s,o,a,l,h,c){const u=this.v3pool,d=ri;n.vsub(i,ti),e.getSideNormals(d,s);const p=t.radius;let f=!1;const m=oi,g=ai,v=li;let y=null,x=0,b=0,w=0,_=null;for(let t=0,e=d.length;t!==e&&!1===f;t++){const e=ei;e.copy(d[t]);const n=e.length();e.normalize();const i=ti.dot(e);if(i<n+p&&i>0){const r=ni,s=ii;r.copy(d[(t+1)%3]),s.copy(d[(t+2)%3]);const o=r.length(),a=s.length();r.normalize(),s.normalize();const l=ti.dot(r),h=ti.dot(s);if(l<o&&l>-o&&h<a&&h>-a){const t=Math.abs(i-n-p);if((null===_||t<_)&&(_=t,b=l,w=h,y=n,m.copy(e),g.copy(r),v.copy(s),x++,c))return!0}}}if(x){f=!0;const r=this.createContactEquation(o,a,t,e,l,h);m.scale(-p,r.ri),r.ni.copy(m),r.ni.negate(r.ni),m.scale(y,m),g.scale(b,g),m.vadd(g,m),v.scale(w,v),m.vadd(v,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}let M=u.get();const S=si;for(let r=0;2!==r&&!f;r++)for(let s=0;2!==s&&!f;s++)for(let u=0;2!==u&&!f;u++)if(M.set(0,0,0),r?M.vadd(d[0],M):M.vsub(d[0],M),s?M.vadd(d[1],M):M.vsub(d[1],M),u?M.vadd(d[2],M):M.vsub(d[2],M),i.vadd(M,S),S.vsub(n,S),S.lengthSquared()<p*p){if(c)return!0;f=!0;const r=this.createContactEquation(o,a,t,e,l,h);r.ri.copy(S),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(p,r.ri),r.rj.copy(M),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}u.release(M),M=null;const T=u.get(),E=u.get(),A=u.get(),C=u.get(),P=u.get(),R=d.length;for(let r=0;r!==R&&!f;r++)for(let s=0;s!==R&&!f;s++)if(r%3!=s%3){d[s].cross(d[r],T),T.normalize(),d[r].vadd(d[s],E),A.copy(n),A.vsub(E,A),A.vsub(i,A);const u=A.dot(T);T.scale(u,C);let m=0;for(;m===r%3||m===s%3;)m++;P.copy(n),P.vsub(C,P),P.vsub(E,P),P.vsub(i,P);const g=Math.abs(u),v=P.length();if(g<d[m].length()&&v<p){if(c)return!0;f=!0;const r=this.createContactEquation(o,a,t,e,l,h);E.vadd(C,r.rj),r.rj.copy(r.rj),P.negate(r.ni),r.ni.normalize(),r.ri.copy(r.rj),r.ri.vadd(i,r.ri),r.ri.vsub(n,r.ri),r.ri.normalize(),r.ri.scale(p,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}u.release(T,E,A,C,P)}planeBox(t,e,n,i,r,s,o,a,l,h,c){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,n,i,r,s,o,a,t,e,c)}convexConvex(t,e,n,i,r,s,o,a,l,h,c,u,d){const p=Mi;if(!(n.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,r,i,s,p,u,d)){const u=[],d=Si;t.clipAgainstHull(n,r,e,i,s,p,-100,100,u);let f=0;for(let r=0;r!==u.length;r++){if(c)return!0;const s=this.createContactEquation(o,a,t,e,l,h),m=s.ri,g=s.rj;p.negate(s.ni),u[r].normal.negate(d),d.scale(u[r].depth,d),u[r].point.vadd(d,m),g.copy(u[r].point),m.vsub(n,m),g.vsub(i,g),m.vadd(n,m),m.vsub(o.position,m),g.vadd(i,g),g.vsub(a.position,g),this.result.push(s),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(s,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(t,e,n,i,r,s,o,a,l,h,c){const u=this.v3pool;n.vsub(i,hi);const d=e.faceNormals,p=e.faces,f=e.vertices,m=t.radius;let g=!1;for(let r=0;r!==f.length;r++){const u=f[r],d=pi;s.vmult(u,d),i.vadd(d,d);const p=di;if(d.vsub(n,p),p.lengthSquared()<m*m){if(c)return!0;g=!0;const r=this.createContactEquation(o,a,t,e,l,h);return r.ri.copy(p),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(m,r.ri),d.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),void this.createFrictionEquationsFromContact(r,this.frictionResult)}}for(let r=0,v=p.length;r!==v&&!1===g;r++){const v=d[r],y=p[r],x=fi;s.vmult(v,x);const b=mi;s.vmult(f[y[0]],b),b.vadd(i,b);const w=gi;x.scale(-m,w),n.vadd(w,w);const _=vi;w.vsub(b,_);const M=_.dot(x),S=yi;if(n.vsub(b,S),M<0&&S.dot(x)>0){const r=[];for(let t=0,e=y.length;t!==e;t++){const e=u.get();s.vmult(f[y[t]],e),i.vadd(e,e),r.push(e)}if(Qn(r,x,n)){if(c)return!0;g=!0;const s=this.createContactEquation(o,a,t,e,l,h);x.scale(-m,s.ri),x.negate(s.ni);const d=u.get();x.scale(-M,d);const p=u.get();x.scale(-m,p),n.vsub(i,s.rj),s.rj.vadd(p,s.rj),s.rj.vadd(d,s.rj),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),u.release(d),u.release(p),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let t=0,e=r.length;t!==e;t++)u.release(r[t]);return}for(let d=0;d!==y.length;d++){const p=u.get(),g=u.get();s.vmult(f[y[(d+1)%y.length]],p),s.vmult(f[y[(d+2)%y.length]],g),i.vadd(p,p),i.vadd(g,g);const v=ci;g.vsub(p,v);const x=ui;v.unit(x);const b=u.get(),w=u.get();n.vsub(p,w);const _=w.dot(x);x.scale(_,b),b.vadd(p,b);const M=u.get();if(b.vsub(n,M),_>0&&_*_<v.lengthSquared()&&M.lengthSquared()<m*m){if(c)return!0;const s=this.createContactEquation(o,a,t,e,l,h);b.vsub(i,s.rj),b.vsub(n,s.ni),s.ni.normalize(),s.ni.scale(m,s.ri),s.rj.vadd(i,s.rj),s.rj.vsub(a.position,s.rj),s.ri.vadd(n,s.ri),s.ri.vsub(o.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(let t=0,e=r.length;t!==e;t++)u.release(r[t]);return u.release(p),u.release(g),u.release(b),u.release(M),void u.release(w)}u.release(p),u.release(g),u.release(b),u.release(M),u.release(w)}for(let t=0,e=r.length;t!==e;t++)u.release(r[t])}}}planeConvex(t,e,n,i,r,s,o,a,l,h,c){const u=xi,d=bi;d.set(0,0,1),r.vmult(d,d);let p=0;const f=wi;for(let r=0;r!==e.vertices.length;r++)if(u.copy(e.vertices[r]),s.vmult(u,u),i.vadd(u,u),u.vsub(n,f),d.dot(f)<=0){if(c)return!0;const r=this.createContactEquation(o,a,t,e,l,h),s=_i;d.scale(d.dot(f),s),u.vsub(s,s),s.vsub(n,r.ri),r.ni.copy(d),u.vsub(i,r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.vadd(i,r.rj),r.rj.vsub(a.position,r.rj),this.result.push(r),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(t,e,n,i,r,s,o,a,l,h,c){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e,c)}sphereHeightfield(t,e,n,i,r,s,o,a,l,h,c){const u=e.data,d=t.radius,p=e.elementSize,f=ki,m=zi;A.pointToLocalFrame(i,s,n,m);let g=Math.floor((m.x-d)/p)-1,v=Math.ceil((m.x+d)/p)+1,y=Math.floor((m.y-d)/p)-1,x=Math.ceil((m.y+d)/p)+1;if(v<0||x<0||g>u.length||y>u[0].length)return;g<0&&(g=0),v<0&&(v=0),y<0&&(y=0),x<0&&(x=0),g>=u.length&&(g=u.length-1),v>=u.length&&(v=u.length-1),x>=u[0].length&&(x=u[0].length-1),y>=u[0].length&&(y=u[0].length-1);const b=[];e.getRectMinMax(g,y,v,x,b);const w=b[0],_=b[1];if(m.z-d>_||m.z+d<w)return;const M=this.result;for(let l=g;l<v;l++)for(let h=y;h<x;h++){const u=M.length;let d=!1;if(e.getConvexTrianglePillar(l,h,!1),A.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(d=this.sphereConvex(t,e.pillarConvex,n,f,r,s,o,a,t,e,c)),c&&d)return!0;if(e.getConvexTrianglePillar(l,h,!0),A.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(d=this.sphereConvex(t,e.pillarConvex,n,f,r,s,o,a,t,e,c)),c&&d)return!0;if(M.length-u>2)return}}boxHeightfield(t,e,n,i,r,s,o,a,l,h,c){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e,c)}convexHeightfield(t,e,n,i,r,s,o,a,l,h,c){const u=e.data,d=e.elementSize,p=t.boundingSphereRadius,f=Bi,m=Ni,g=Oi;A.pointToLocalFrame(i,s,n,g);let v=Math.floor((g.x-p)/d)-1,y=Math.ceil((g.x+p)/d)+1,x=Math.floor((g.y-p)/d)-1,b=Math.ceil((g.y+p)/d)+1;if(y<0||b<0||v>u.length||x>u[0].length)return;v<0&&(v=0),y<0&&(y=0),x<0&&(x=0),b<0&&(b=0),v>=u.length&&(v=u.length-1),y>=u.length&&(y=u.length-1),b>=u[0].length&&(b=u[0].length-1),x>=u[0].length&&(x=u[0].length-1);const w=[];e.getRectMinMax(v,x,y,b,w);const _=w[0],M=w[1];if(!(g.z-p>M||g.z+p<_))for(let l=v;l<y;l++)for(let h=x;h<b;h++){let u=!1;if(e.getConvexTrianglePillar(l,h,!1),A.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(u=this.convexConvex(t,e.pillarConvex,n,f,r,s,o,a,null,null,c,m,null)),c&&u)return!0;if(e.getConvexTrianglePillar(l,h,!0),A.pointToWorldFrame(i,s,e.pillarOffset,f),n.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(u=this.convexConvex(t,e.pillarConvex,n,f,r,s,o,a,null,null,c,m,null)),c&&u)return!0}}sphereParticle(t,e,n,i,r,s,o,a,l,h,c){const u=Ci;if(u.set(0,0,1),i.vsub(n,u),u.lengthSquared()<=t.radius*t.radius){if(c)return!0;const n=this.createContactEquation(a,o,e,t,l,h);u.normalize(),n.rj.copy(u),n.rj.scale(t.radius,n.rj),n.ni.copy(u),n.ni.negate(n.ni),n.ri.set(0,0,0),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}planeParticle(t,e,n,i,r,s,o,a,l,h,c){const u=Ti;u.set(0,0,1),o.quaternion.vmult(u,u);const d=Ei;if(i.vsub(o.position,d),u.dot(d)<=0){if(c)return!0;const n=this.createContactEquation(a,o,e,t,l,h);n.ni.copy(u),n.ni.negate(n.ni),n.ri.set(0,0,0);const r=Ai;u.scale(u.dot(i),r),i.vsub(r,r),n.rj.copy(r),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}boxParticle(t,e,n,i,r,s,o,a,l,h,c){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e,c)}convexParticle(t,e,n,i,r,s,o,a,l,h,c){let u=-1;const d=Li,p=Di;let f=null;const m=Ri;if(m.copy(i),m.vsub(n,m),r.conjugate(Pi),Pi.vmult(m,m),t.pointIsInside(m)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,r),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(r);for(let e=0,n=t.faces.length;e!==n;e++){const n=[t.worldVertices[t.faces[e][0]]],r=t.worldFaceNormals[e];i.vsub(n[0],Ii);const s=-r.dot(Ii);if(null===f||Math.abs(s)<Math.abs(f)){if(c)return!0;f=s,u=e,d.copy(r)}}if(-1!==u){const r=this.createContactEquation(a,o,e,t,l,h);d.scale(f,p),p.vadd(i,p),p.vsub(n,p),r.rj.copy(p),d.negate(r.ni),r.ri.set(0,0,0);const s=r.ri,c=r.rj;s.vadd(i,s),s.vsub(a.position,s),c.vadd(n,c),c.vsub(o.position,c),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(t,e,n,i,r,s,o,a,l,h,c){return this.convexHeightfield(e,t,i,n,s,r,a,o,l,h,c)}particleCylinder(t,e,n,i,r,s,o,a,l,h,c){return this.convexParticle(e,t,i,n,s,r,a,o,l,h,c)}sphereTrimesh(t,e,n,i,r,s,o,a,l,h,c){const u=zn,d=kn,p=Fn,f=Un,m=Hn,g=Vn,v=qn,y=Nn,x=On,b=Xn;A.pointToLocalFrame(i,s,n,m);const w=t.radius;v.lowerBound.set(m.x-w,m.y-w,m.z-w),v.upperBound.set(m.x+w,m.y+w,m.z+w),e.getTrianglesInAABB(v,b);const _=Bn,M=t.radius*t.radius;for(let r=0;r<b.length;r++)for(let u=0;u<3;u++)if(e.getVertex(e.indices[3*b[r]+u],_),_.vsub(m,x),x.lengthSquared()<=M){if(y.copy(_),A.pointToWorldFrame(i,s,y,_),_.vsub(n,x),c)return!0;let r=this.createContactEquation(o,a,t,e,l,h);r.ni.copy(x),r.ni.normalize(),r.ri.copy(r.ni),r.ri.scale(t.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),r.rj.copy(_),r.rj.vsub(a.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}for(let r=0;r<b.length;r++)for(let v=0;v<3;v++){e.getVertex(e.indices[3*b[r]+v],u),e.getVertex(e.indices[3*b[r]+(v+1)%3],d),d.vsub(u,p),m.vsub(d,g);const y=g.dot(p);m.vsub(u,g);let x=g.dot(p);if(x>0&&y<0&&(m.vsub(u,g),f.copy(p),f.normalize(),x=g.dot(f),f.scale(x,g),g.vadd(u,g),g.distanceTo(m)<t.radius)){if(c)return!0;const r=this.createContactEquation(o,a,t,e,l,h);g.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(t.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),A.pointToWorldFrame(i,s,g,g),g.vsub(a.position,r.rj),A.vectorToWorldFrame(s,r.ni,r.ni),A.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}const S=Gn,T=Wn,E=jn,C=Dn;for(let r=0,u=b.length;r!==u;r++){e.getTriangleVertices(b[r],S,T,E),e.getNormal(b[r],C),m.vsub(S,g);let u=g.dot(C);if(C.scale(u,g),m.vsub(g,g),u=g.distanceTo(m),ut.pointInTriangle(g,S,T,E)&&u<t.radius){if(c)return!0;let r=this.createContactEquation(o,a,t,e,l,h);g.vsub(m,r.ni),r.ni.normalize(),r.ni.scale(t.radius,r.ri),r.ri.vadd(n,r.ri),r.ri.vsub(o.position,r.ri),A.pointToWorldFrame(i,s,g,g),g.vsub(a.position,r.rj),A.vectorToWorldFrame(s,r.ni,r.ni),A.vectorToWorldFrame(s,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}b.length=0}planeTrimesh(t,e,n,i,r,s,o,a,l,h,c){const u=new f,d=Rn;d.set(0,0,1),r.vmult(d,d);for(let r=0;r<e.vertices.length/3;r++){e.getVertex(r,u);const p=new f;p.copy(u),A.pointToWorldFrame(i,s,p,u);const m=Ln;if(u.vsub(n,m),d.dot(m)<=0){if(c)return!0;const n=this.createContactEquation(o,a,t,e,l,h);n.ni.copy(d);const i=In;d.scale(m.dot(d),i),u.vsub(i,i),n.ri.copy(i),n.ri.vsub(o.position,n.ri),n.rj.copy(u),n.rj.vsub(a.position,n.rj),this.result.push(n),this.createFrictionEquationsFromContact(n,this.frictionResult)}}}}const Mn=new f,Sn=new f,Tn=new f,En=new f,An=new f,Cn=new M,Pn=new M,Rn=new f,Ln=new f,In=new f,Dn=new f,On=new f;new f;const Bn=new f,Nn=new f,zn=new f,kn=new f,Fn=new f,Un=new f,Hn=new f,Vn=new f,Gn=new f,Wn=new f,jn=new f,qn=new y,Xn=[],Yn=new f,$n=new f,Kn=new f,Zn=new f,Jn=new f;function Qn(t,e,n){let i=null;const r=t.length;for(let s=0;s!==r;s++){const o=t[s],a=Kn;t[(s+1)%r].vsub(o,a);const l=Zn;a.cross(e,l);const h=Jn;n.vsub(o,h);const c=l.dot(h);if(!(null===i||c>0&&!0===i||c<=0&&!1===i))return!1;null===i&&(i=c>0)}return!0}const ti=new f,ei=new f,ni=new f,ii=new f,ri=[new f,new f,new f,new f,new f,new f],si=new f,oi=new f,ai=new f,li=new f,hi=new f,ci=new f,ui=new f,di=new f,pi=new f,fi=new f,mi=new f,gi=new f,vi=new f,yi=new f;new f,new f;const xi=new f,bi=new f,wi=new f,_i=new f,Mi=new f,Si=new f,Ti=new f,Ei=new f,Ai=new f,Ci=new f,Pi=new M,Ri=new f;new f;const Li=new f,Ii=new f,Di=new f,Oi=new f,Bi=new f,Ni=[0],zi=new f,ki=new f;class Fi{constructor(){this.current=[],this.previous=[]}getKey(t,e){if(e<t){const n=e;e=t,t=n}return t<<16|e}set(t,e){const n=this.getKey(t,e),i=this.current;let r=0;for(;n>i[r];)r++;if(n!==i[r]){for(let t=i.length-1;t>=r;t--)i[t+1]=i[t];i[r]=n}}tick(){const t=this.current;this.current=this.previous,this.previous=t,this.current.length=0}getDiff(t,e){const n=this.current,i=this.previous,r=n.length,s=i.length;let o=0;for(let e=0;e<r;e++){let r=!1;const s=n[e];for(;s>i[o];)o++;r=s===i[o],r||Ui(t,s)}o=0;for(let t=0;t<s;t++){let r=!1;const s=i[t];for(;s>n[o];)o++;r=n[o]===s,r||Ui(e,s)}}}function Ui(t,e){t.push((4294901760&e)>>16,65535&e)}const Hi=(t,e)=>t<e?`${t}-${e}`:`${e}-${t}`;class Vi{constructor(){this.data={keys:[]}}get(t,e){const n=Hi(t,e);return this.data[n]}set(t,e,n){const i=Hi(t,e);this.get(t,e)||this.data.keys.push(i),this.data[i]=n}delete(t,e){const n=Hi(t,e),i=this.data.keys.indexOf(n);-1!==i&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const t=this.data,e=t.keys;for(;e.length>0;)delete t[e.pop()]}}class Gi extends _{constructor(t){void 0===t&&(t={}),super(),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new f,t.gravity&&this.gravity.copy(t.gravity),this.broadphase=void 0!==t.broadphase?t.broadphase:new nt,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==t.solver?t.solver:new We,this.constraints=[],this.narrowphase=new _n(this),this.collisionMatrix=new w,this.collisionMatrixPrevious=new w,this.bodyOverlapKeeper=new Fi,this.shapeOverlapKeeper=new Fi,this.contactmaterials=[],this.contactMaterialTable=new Vi,this.defaultMaterial=new he("default"),this.defaultContactMaterial=new le(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(t,e){return this.contactMaterialTable.get(t.id,e.id)}collisionMatrixTick(){const t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(t){this.constraints.push(t)}removeConstraint(t){const e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)}rayTest(t,e,n){n instanceof it?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)}raycastAll(t,e,n,i){return void 0===n&&(n={}),n.mode=ut.ALL,n.from=t,n.to=e,n.callback=i,Wi.intersectWorld(this,n)}raycastAny(t,e,n,i){return void 0===n&&(n={}),n.mode=ut.ANY,n.from=t,n.to=e,n.result=i,Wi.intersectWorld(this,n)}raycastClosest(t,e,n,i){return void 0===n&&(n={}),n.mode=ut.CLOSEST,n.from=t,n.to=e,n.result=i,Wi.intersectWorld(this,n)}addBody(t){this.bodies.includes(t)||(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof z&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))}removeBody(t){t.world=null;const e=this.bodies.length-1,n=this.bodies,i=n.indexOf(t);if(-1!==i){n.splice(i,1);for(let t=0;t!==n.length;t++)n[t].index=t;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(t){return this.idToBodyMap[t]}getShapeById(t){const e=this.bodies;for(let n=0;n<e.length;n++){const i=e[n].shapes;for(let e=0;e<i.length;e++){const n=i[e];if(n.id===t)return n}}return null}addContactMaterial(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)}removeContactMaterial(t){const e=this.contactmaterials.indexOf(t);-1!==e&&(this.contactmaterials.splice(e,1),this.contactMaterialTable.delete(t.materials[0].id,t.materials[1].id))}fixedStep(t,e){void 0===t&&(t=1/60),void 0===e&&(e=10);const n=ji.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(t,i,e)}else this.step(t,void 0,e);this.lastCallTime=n}step(t,e,n){if(void 0===n&&(n=10),void 0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;const i=ji.now();let r=0;for(;this.accumulator>=t&&r<n&&(this.internalStep(t),this.accumulator-=t,r++,!(ji.now()-i>1e3*t)););this.accumulator=this.accumulator%t;const s=this.accumulator/t;for(let t=0;t!==this.bodies.length;t++){const e=this.bodies[t];e.previousPosition.lerp(e.position,s,e.interpolatedPosition),e.previousQuaternion.slerp(e.quaternion,s,e.interpolatedQuaternion),e.previousQuaternion.normalize()}this.time+=e}}internalStep(t){this.dt=t;const e=this.contacts,n=Zi,i=Ji,r=this.bodies.length,s=this.bodies,o=this.solver,a=this.gravity,l=this.doProfiling,h=this.profile,c=z.DYNAMIC;let u=-1/0;const d=this.constraints,p=Ki;a.length();const f=a.x,m=a.y,g=a.z;let v=0;for(l&&(u=ji.now()),v=0;v!==r;v++){const t=s[v];if(t.type===c){const e=t.force,n=t.mass;e.x+=n*f,e.y+=n*m,e.z+=n*g}}for(let t=0,e=this.subsystems.length;t!==e;t++)this.subsystems[t].update();l&&(u=ji.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),l&&(h.broadphase=ji.now()-u);let y=d.length;for(v=0;v!==y;v++){const t=d[v];if(!t.collideConnected)for(let e=n.length-1;e>=0;e-=1)(t.bodyA===n[e]&&t.bodyB===i[e]||t.bodyB===n[e]&&t.bodyA===i[e])&&(n.splice(e,1),i.splice(e,1))}this.collisionMatrixTick(),l&&(u=ji.now());const x=$i,b=e.length;for(v=0;v!==b;v++)x.push(e[v]);e.length=0;const w=this.frictionEquations.length;for(v=0;v!==w;v++)p.push(this.frictionEquations[v]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,e,x,this.frictionEquations,p),l&&(h.narrowphase=ji.now()-u),l&&(u=ji.now()),v=0;v<this.frictionEquations.length;v++)o.addEquation(this.frictionEquations[v]);const _=e.length;for(let t=0;t!==_;t++){const n=e[t],i=n.bi,r=n.bj,s=n.si,a=n.sj;let l;l=i.material&&r.material&&this.getContactMaterial(i.material,r.material)||this.defaultContactMaterial,l.friction,i.material&&r.material&&(i.material.friction>=0&&r.material.friction>=0&&(i.material.friction,r.material.friction),i.material.restitution>=0&&r.material.restitution>=0&&(n.restitution=i.material.restitution*r.material.restitution)),o.addEquation(n),i.allowSleep&&i.type===z.DYNAMIC&&i.sleepState===z.SLEEPING&&r.sleepState===z.AWAKE&&r.type!==z.STATIC&&r.velocity.lengthSquared()+r.angularVelocity.lengthSquared()>=2*r.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0),r.allowSleep&&r.type===z.DYNAMIC&&r.sleepState===z.SLEEPING&&i.sleepState===z.AWAKE&&i.type!==z.STATIC&&i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(r.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(i,r,!0),this.collisionMatrixPrevious.get(i,r)||(Yi.body=r,Yi.contact=n,i.dispatchEvent(Yi),Yi.body=i,r.dispatchEvent(Yi)),this.bodyOverlapKeeper.set(i.id,r.id),this.shapeOverlapKeeper.set(s.id,a.id)}for(this.emitContactEvents(),l&&(h.makeContactConstraints=ji.now()-u,u=ji.now()),v=0;v!==r;v++){const t=s[v];t.wakeUpAfterNarrowphase&&(t.wakeUp(),t.wakeUpAfterNarrowphase=!1)}for(y=d.length,v=0;v!==y;v++){const t=d[v];t.update();for(let e=0,n=t.equations.length;e!==n;e++){const n=t.equations[e];o.addEquation(n)}}o.solve(t,this),l&&(h.solve=ji.now()-u),o.removeAllEquations();const M=Math.pow;for(v=0;v!==r;v++){const e=s[v];if(e.type&c){const n=M(1-e.linearDamping,t),i=e.velocity;i.scale(n,i);const r=e.angularVelocity;if(r){const n=M(1-e.angularDamping,t);r.scale(n,r)}}}this.dispatchEvent(Xi),l&&(u=ji.now());const S=this.stepnumber%(this.quatNormalizeSkip+1)==0,T=this.quatNormalizeFast;for(v=0;v!==r;v++)s[v].integrate(t,S,T);this.clearForces(),this.broadphase.dirty=!0,l&&(h.integrate=ji.now()-u),this.stepnumber+=1,this.dispatchEvent(qi);let E=!0;if(this.allowSleep)for(E=!1,v=0;v!==r;v++){const t=s[v];t.sleepTick(this.time),t.sleepState!==z.SLEEPING&&(E=!0)}this.hasActiveBodies=E}emitContactEvents(){const t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(Qi,tr),t){for(let t=0,e=Qi.length;t<e;t+=2)er.bodyA=this.getBodyById(Qi[t]),er.bodyB=this.getBodyById(Qi[t+1]),this.dispatchEvent(er);er.bodyA=er.bodyB=null}if(e){for(let t=0,e=tr.length;t<e;t+=2)nr.bodyA=this.getBodyById(tr[t]),nr.bodyB=this.getBodyById(tr[t+1]),this.dispatchEvent(nr);nr.bodyA=nr.bodyB=null}Qi.length=tr.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(Qi,tr),n){for(let t=0,e=Qi.length;t<e;t+=2){const e=this.getShapeById(Qi[t]),n=this.getShapeById(Qi[t+1]);ir.shapeA=e,ir.shapeB=n,e&&(ir.bodyA=e.body),n&&(ir.bodyB=n.body),this.dispatchEvent(ir)}ir.bodyA=ir.bodyB=ir.shapeA=ir.shapeB=null}if(i){for(let t=0,e=tr.length;t<e;t+=2){const e=this.getShapeById(tr[t]),n=this.getShapeById(tr[t+1]);rr.shapeA=e,rr.shapeB=n,e&&(rr.bodyA=e.body),n&&(rr.bodyB=n.body),this.dispatchEvent(rr)}rr.bodyA=rr.bodyB=rr.shapeA=rr.shapeB=null}}clearForces(){const t=this.bodies,e=t.length;for(let n=0;n!==e;n++){const e=t[n];e.force,e.torque,e.force.set(0,0,0),e.torque.set(0,0,0)}}}new y;const Wi=new ut,ji=globalThis.performance||{};if(!ji.now){let t=Date.now();ji.timing&&ji.timing.navigationStart&&(t=ji.timing.navigationStart),ji.now=()=>Date.now()-t}new f;const qi={type:"postStep"},Xi={type:"preStep"},Yi={type:z.COLLIDE_EVENT_NAME,body:null,contact:null},$i=[],Ki=[],Zi=[],Ji=[],Qi=[],tr=[],er={type:"beginContact",bodyA:null,bodyB:null},nr={type:"endContact",bodyA:null,bodyB:null},ir={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},rr={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};n(521);var sr=n(670);const or={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class ar{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const lr=new u.iKG(-1,1,1,-1,0,1),hr=new u.u9r;hr.setAttribute("position",new u.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),hr.setAttribute("uv",new u.a$l([0,2,0,0,2,0],2));class cr{constructor(t){this._mesh=new u.Kj0(hr,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,lr)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class ur extends ar{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof u.jyz?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=u.rDY.clone(t.uniforms),this.material=new u.jyz({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new cr(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class dr extends ar{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const i=t.getContext(),r=t.state;let s,o;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),r.buffers.stencil.setClear(o),r.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class pr extends ar{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class fr{constructor(t,e){if(this.renderer=t,void 0===e){const n=t.getSize(new u.FM8);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(e=new u.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===or&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===ur&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ur(or),this.clock=new u.SUY}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let e=0,i=this.passes.length;e<i;e++){const i=this.passes[e];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),i.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),i.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==dr&&(i instanceof dr?n=!0:i instanceof pr&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new u.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(n,i)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new u.iKG(-1,1,1,-1,0,1);const mr=new u.u9r;mr.setAttribute("position",new u.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),mr.setAttribute("uv",new u.a$l([0,2,0,0,2,0],2));const gr={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tColor;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float maxblur; // max blur amount\n\t\tuniform float aperture; // aperture - bigger values for shallower depth of field\n\n\t\tuniform float nearClip;\n\t\tuniform float farClip;\n\n\t\tuniform float focus;\n\t\tuniform float aspect;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, nearClip, farClip );\n\t\t\t#endif\n\t\t}\n\n\n\t\tvoid main() {\n\n\t\t\tvec2 aspectcorrect = vec2( 1.0, aspect );\n\n\t\t\tfloat viewZ = getViewZ( getDepth( vUv ) );\n\n\t\t\tfloat factor = ( focus + viewZ ); // viewZ is <= 0, so this is a difference equation\n\n\t\t\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\n\n\t\t\tvec2 dofblur9 = dofblur * 0.9;\n\t\t\tvec2 dofblur7 = dofblur * 0.7;\n\t\t\tvec2 dofblur4 = dofblur * 0.4;\n\n\t\t\tvec4 col = vec4( 0.0 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\n\n\t\t\tgl_FragColor = col / 41.0;\n\t\t\tgl_FragColor.a = 1.0;\n\n\t\t}"};class vr extends ar{constructor(t,e,n){super(),this.scene=t,this.camera=e;const i=void 0!==n.focus?n.focus:1,r=void 0!==n.aspect?n.aspect:e.aspect,s=void 0!==n.aperture?n.aperture:.025,o=void 0!==n.maxblur?n.maxblur:1,a=n.width||window.innerWidth||1,l=n.height||window.innerHeight||1;this.renderTargetDepth=new u.dd2(a,l,{minFilter:u.TyD,magFilter:u.TyD}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new u.lRF,this.materialDepth.depthPacking=u.mSO,this.materialDepth.blending=u.jFi,void 0===gr&&console.error("THREE.BokehPass relies on BokehShader");const h=gr,c=u.rDY.clone(h.uniforms);c.tDepth.value=this.renderTargetDepth.texture,c.focus.value=i,c.aspect.value=r,c.aperture.value=s,c.maxblur.value=o,c.nearClip.value=e.near,c.farClip.value=e.far,this.materialBokeh=new u.jyz({defines:Object.assign({},h.defines),uniforms:c,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}),this.uniforms=c,this.needsSwap=!1,this.fsQuad=new cr(this.materialBokeh),this._oldClearColor=new u.Ilk}render(t,e,n){this.scene.overrideMaterial=this.materialDepth,t.getClearColor(this._oldClearColor);const i=t.getClearAlpha(),r=t.autoClear;t.autoClear=!1,t.setClearColor(16777215),t.setClearAlpha(1),t.setRenderTarget(this.renderTargetDepth),t.clear(),t.render(this.scene,this.camera),this.uniforms.tColor.value=n.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),t.clear(),this.fsQuad.render(t)),this.scene.overrideMaterial=null,t.setClearColor(this._oldClearColor),t.setClearAlpha(i),t.autoClear=r}}class yr extends ar{constructor(t,e,n,i){super(),this.renderScene=e,this.renderCamera=n,this.selectedObjects=void 0!==i?i:[],this.visibleEdgeColor=new u.Ilk(1,1,1),this.hiddenEdgeColor=new u.Ilk(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==t?new u.FM8(t.x,t.y):new u.FM8(256,256);const r=Math.round(this.resolution.x/this.downSampleRatio),s=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new u.dd2(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new u.lRF,this.depthMaterial.side=u.ehD,this.depthMaterial.depthPacking=u.mSO,this.depthMaterial.blending=u.jFi,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=u.ehD,this.prepareMaskMaterial.fragmentShader=function(t,e){const n=e.isPerspectiveCamera?"perspective":"orthographic";return t.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new u.dd2(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new u.dd2(r,s),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new u.dd2(r,s),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new u.dd2(Math.round(r/2),Math.round(s/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new u.dd2(r,s),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new u.dd2(Math.round(r/2),Math.round(s/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(r,s),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(r/2),Math.round(s/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===or&&console.error("THREE.OutlinePass relies on CopyShader");const o=or;this.copyUniforms=u.rDY.clone(o.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new u.jyz({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:u.jFi,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new u.Ilk,this.oldClearAlpha=1,this.fsQuad=new cr(null),this.tempPulseColor1=new u.Ilk,this.tempPulseColor2=new u.Ilk,this.textureMatrix=new u.yGw}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(t,e){this.renderTargetMaskBuffer.setSize(t,e),this.renderTargetDepthBuffer.setSize(t,e);let n=Math.round(t/this.downSampleRatio),i=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,i),this.renderTargetBlurBuffer1.setSize(n,i),this.renderTargetEdgeBuffer1.setSize(n,i),this.separableBlurMaterial1.uniforms.texSize.value.set(n,i),n=Math.round(n/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(n,i),this.renderTargetEdgeBuffer2.setSize(n,i),this.separableBlurMaterial2.uniforms.texSize.value.set(n,i)}changeVisibilityOfSelectedObjects(t){const e=this._visibilityCache;function n(n){n.isMesh&&(!0===t?n.visible=e.get(n):(e.set(n,n.visible),n.visible=t))}for(let t=0;t<this.selectedObjects.length;t++)this.selectedObjects[t].traverse(n)}changeVisibilityOfNonSelectedObjects(t){const e=this._visibilityCache,n=[];function i(t){t.isMesh&&n.push(t)}for(let t=0;t<this.selectedObjects.length;t++)this.selectedObjects[t].traverse(i);this.renderScene.traverse((function(i){if(i.isMesh||i.isSprite){let r=!1;for(let t=0;t<n.length;t++)if(n[t].id===i.id){r=!0;break}if(!1===r){const n=i.visible;!1!==t&&!0!==e.get(i)||(i.visible=t),e.set(i,n)}}else(i.isPoints||i.isLine)&&(!0===t?i.visible=e.get(i):(e.set(i,i.visible),i.visible=t))}))}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(t,e,n,i,r){if(this.selectedObjects.length>0){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const e=t.autoClear;t.autoClear=!1,r&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const i=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=i,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const t=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(t),this.tempPulseColor2.multiplyScalar(t)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=yr.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=yr.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=yr.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=yr.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(n),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=e}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,t.setRenderTarget(null),this.fsQuad.render(t))}getPrepareMaskMaterial(){return new u.jyz({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new u.FM8(.5,.5)},textureMatrix:{value:null}},vertexShader:"#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tuniform mat4 textureMatrix;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <morphtarget_vertex>\n\t\t\t\t\t#include <skinning_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t\tvPosition = mvPosition;\n\t\t\t\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t\t\t\t\tprojTexCoord = textureMatrix * worldPosition;\n\n\t\t\t\t}",fragmentShader:"#include <packing>\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tuniform sampler2D depthTexture;\n\t\t\t\tuniform vec2 cameraNearFar;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\n\t\t\t\t\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );\n\t\t\t\t\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\n\t\t\t\t\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\n\n\t\t\t\t}"})}getEdgeDetectionMaterial(){return new u.jyz({uniforms:{maskTexture:{value:null},texSize:{value:new u.FM8(.5,.5)},visibleEdgeColor:{value:new u.Pa4(1,1,1)},hiddenEdgeColor:{value:new u.Pa4(1,1,1)}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec3 visibleEdgeColor;\n\t\t\t\tuniform vec3 hiddenEdgeColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\n\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\n\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\n\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\n\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\n\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\n\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\n\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\n\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\n\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\n\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\n\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\n\t\t\t\t}"})}getSeperableBlurMaterial(t){return new u.jyz({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new u.FM8(.5,.5)},direction:{value:new u.FM8(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float kernelRadius;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\n\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\n\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\n\t\t\t\t\tvec2 uvOffset = delta;\n\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\n\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\t\t\tuvOffset += delta;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\n\t\t\t\t}"})}getOverlayMaterial(){return new u.jyz({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform sampler2D edgeTexture1;\n\t\t\t\tuniform sampler2D edgeTexture2;\n\t\t\t\tuniform sampler2D patternTexture;\n\t\t\t\tuniform float edgeStrength;\n\t\t\t\tuniform float edgeGlow;\n\t\t\t\tuniform bool usePatternTexture;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\n\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\n\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\n\t\t\t\t\tif(usePatternTexture)\n\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\n\t\t\t\t\tgl_FragColor = finalColor;\n\t\t\t\t}",blending:u.WMw,depthTest:!1,depthWrite:!1,transparent:!0})}}yr.BlurDirectionX=new u.FM8(1,0),yr.BlurDirectionY=new u.FM8(0,1);class xr extends ar{constructor(t,e,n,i,r){super(),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new u.Ilk}render(t,e,n){const i=t.autoClear;let r,s;t.autoClear=!1,void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),t.autoClear=i}}const br={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new u.Ilk(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class wr extends ar{constructor(t,e,n,i){super(),this.strength=void 0!==e?e:1,this.radius=n,this.threshold=i,this.resolution=void 0!==t?new u.FM8(t.x,t.y):new u.FM8(256,256),this.clearColor=new u.Ilk(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let r=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new u.dd2(r,s),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let t=0;t<this.nMips;t++){const e=new u.dd2(r,s);e.texture.name="UnrealBloomPass.h"+t,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const n=new u.dd2(r,s);n.texture.name="UnrealBloomPass.v"+t,n.texture.generateMipmaps=!1,this.renderTargetsVertical.push(n),r=Math.round(r/2),s=Math.round(s/2)}void 0===br&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const o=br;this.highPassUniforms=u.rDY.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new u.jyz({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const a=[3,5,7,9,11];r=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let t=0;t<this.nMips;t++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(a[t])),this.separableBlurMaterials[t].uniforms.texSize.value=new u.FM8(r,s),r=Math.round(r/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new u.Pa4(1,1,1),new u.Pa4(1,1,1),new u.Pa4(1,1,1),new u.Pa4(1,1,1),new u.Pa4(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===or&&console.error("THREE.UnrealBloomPass relies on CopyShader");const l=or;this.copyUniforms=u.rDY.clone(l.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new u.jyz({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:u.WMw,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new u.Ilk,this.oldClearAlpha=1,this.basic=new u.vBJ,this.fsQuad=new cr(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}setSize(t,e){let n=Math.round(t/2),i=Math.round(e/2);this.renderTargetBright.setSize(n,i);for(let t=0;t<this.nMips;t++)this.renderTargetsHorizontal[t].setSize(n,i),this.renderTargetsVertical[t].setSize(n,i),this.separableBlurMaterials[t].uniforms.texSize.value=new u.FM8(n,i),n=Math.round(n/2),i=Math.round(i/2)}render(t,e,n,i,r){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const s=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),r&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let o=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[e].uniforms.direction.value=wr.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=wr.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),o=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=s}getSeperableBlurMaterial(t){return new u.jyz({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new u.FM8(.5,.5)},direction:{value:new u.FM8(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(t){return new u.jyz({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}wr.BlurDirectionX=new u.FM8(1,0),wr.BlurDirectionY=new u.FM8(0,1);class _r{static createButton(t,e){e&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');const n=document.createElement("button");function i(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function r(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",r(n),navigator.xr.isSessionSupported("immersive-vr").then((function(e){e?function(){let e=null;async function i(i){i.addEventListener("end",r),await t.xr.setSession(i),n.textContent="EXIT VR",e=i}function r(){e.removeEventListener("end",r),n.textContent="ENTER VR",e=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(null===e){const t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",t).then(i)}else e.end()}}():(i(),n.textContent="VR NOT SUPPORTED"),e&&_r.xrSessionIsGranted&&n.click()})).catch((function(t){i(),console.warn("Exception when trying to call xr.isSessionSupported",t),n.textContent="VR NOT ALLOWED"})),n;{const t=document.createElement("a");return!1===window.isSecureContext?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",r(t),t}}static xrSessionIsGranted=!1;static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{_r.xrSessionIsGranted=!0}))}}}_r.registerSessionGrantedListener();class Mr extends u.aNw{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new Pr(t)})),this.register((function(t){return new Br(t)})),this.register((function(t){return new Nr(t)})),this.register((function(t){return new Rr(t)})),this.register((function(t){return new Lr(t)})),this.register((function(t){return new Ir(t)})),this.register((function(t){return new Dr(t)})),this.register((function(t){return new Cr(t)})),this.register((function(t){return new Or(t)})),this.register((function(t){return new Er(t)})),this.register((function(t){return new zr(t)}))}load(t,e,n,i){const r=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:u.Zp0.extractUrlBase(t),this.manager.itemStart(t);const o=function(e){i?i(e):console.error(e),r.manager.itemError(t),r.manager.itemEnd(t)},a=new u.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(n){try{r.parse(n,s,(function(n){e(n),r.manager.itemEnd(t)}),o)}catch(t){o(t)}}),n,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let r;const s={},o={};if("string"==typeof t)r=t;else if(u.Zp0.decodeText(new Uint8Array(t,0,4))===kr){try{s[Tr.KHR_BINARY_GLTF]=new Fr(t)}catch(t){return void(i&&i(t))}r=s[Tr.KHR_BINARY_GLTF].content}else r=u.Zp0.decodeText(new Uint8Array(t));const a=JSON.parse(r);if(void 0===a.asset||a.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new as(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](l);o[e.name]=e,s[e.name]=!0}if(a.extensionsUsed)for(let t=0;t<a.extensionsUsed.length;++t){const e=a.extensionsUsed[t],n=a.extensionsRequired||[];switch(e){case Tr.KHR_MATERIALS_UNLIT:s[e]=new Ar;break;case Tr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[e]=new Gr;break;case Tr.KHR_DRACO_MESH_COMPRESSION:s[e]=new Ur(a,this.dracoLoader);break;case Tr.KHR_TEXTURE_TRANSFORM:s[e]=new Hr;break;case Tr.KHR_MESH_QUANTIZATION:s[e]=new Wr;break;default:n.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(n,i)}parseAsync(t,e){const n=this;return new Promise((function(i,r){n.parse(t,e,i,r)}))}}function Sr(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Tr={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Er{constructor(t){this.parser=t,this.name=Tr.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const r=e.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let o;const a=new u.Ilk(16777215);void 0!==s.color&&a.fromArray(s.color);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new u.Ox3(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new u.cek(a),o.distance=l;break;case"spot":o=new u.PMe(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,void 0!==s.intensity&&(o.intensity=s.intensity),o.name=e.createUniqueName(s.name||"light_"+t),i=Promise.resolve(o),e.cache.add(n,i),i}createNodeAttachment(t){const e=this,n=this.parser,i=n.json.nodes[t],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(t){return n._getNodeRef(e.cache,r,t)}))}}class Ar{constructor(){this.name=Tr.KHR_MATERIALS_UNLIT}getMaterialType(){return u.vBJ}extendParams(t,e,n){const i=[];t.color=new u.Ilk(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture,u.knz))}return Promise.all(i)}}class Cr{constructor(t){this.parser=t,this.name=Tr.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(e.emissiveIntensity=i),Promise.resolve()}}class Pr{constructor(t){this.parser=t,this.name=Tr.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?u.EJi:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(e.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(n.assignTexture(e,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(e.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(n.assignTexture(e,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(n.assignTexture(e,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const t=s.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new u.FM8(t,t)}return Promise.all(r)}}class Rr{constructor(t){this.parser=t,this.name=Tr.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?u.EJi:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new u.Ilk(0,0,0),e.sheenRoughness=0,e.sheen=1;const s=i.extensions[this.name];return void 0!==s.sheenColorFactor&&e.sheenColor.fromArray(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&(e.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(n.assignTexture(e,"sheenColorMap",s.sheenColorTexture,u.knz)),void 0!==s.sheenRoughnessTexture&&r.push(n.assignTexture(e,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class Lr{constructor(t){this.parser=t,this.name=Tr.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?u.EJi:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class Ir{constructor(t){this.parser=t,this.name=Tr.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?u.EJi:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(n.assignTexture(e,"thicknessMap",s.thicknessTexture)),e.attenuationDistance=s.attenuationDistance||0;const o=s.attenuationColor||[1,1,1];return e.attenuationColor=new u.Ilk(o[0],o[1],o[2]),Promise.all(r)}}class Dr{constructor(t){this.parser=t,this.name=Tr.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?u.EJi:null}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return e.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Or{constructor(t){this.parser=t,this.name=Tr.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?u.EJi:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];e.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(n.assignTexture(e,"specularIntensityMap",s.specularTexture));const o=s.specularColorFactor||[1,1,1];return e.specularColor=new u.Ilk(o[0],o[1],o[2]),void 0!==s.specularColorTexture&&r.push(n.assignTexture(e,"specularColorMap",s.specularColorTexture,u.knz)),Promise.all(r)}}class Br{constructor(t){this.parser=t,this.name=Tr.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,s)}}class Nr{constructor(t){this.parser=t,this.name=Tr.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(t,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class zr{constructor(t){this.name=Tr.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then((function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,o=t.byteStride,a=new ArrayBuffer(s*o),l=new Uint8Array(e[0],n,i);return r.decodeGltfBuffer(new Uint8Array(a),s,o,l,t.mode,t.filter),a}))}return null}}const kr="glTF";class Fr{constructor(t){this.name=Tr.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:u.Zp0.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==kr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(t,12);let r=0;for(;r<n;){const e=i.getUint32(r,!0);r+=4;const n=i.getUint32(r,!0);if(r+=4,1313821514===n){const n=new Uint8Array(t,12+r,e);this.content=u.Zp0.decodeText(n)}else if(5130562===n){const n=12+r;this.body=t.slice(n,n+e)}r+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ur{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Tr.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},l={};for(const t in s){const e=Jr[t]||t.toLowerCase();o[e]=s[t]}for(const e in t.attributes){const i=Jr[e]||e.toLowerCase();if(void 0!==s[e]){const r=n.accessors[t.attributes[e]],s=Yr[r.componentType];l[i]=s,a[i]=!0===r.normalized}}return e.getDependency("bufferView",r).then((function(t){return new Promise((function(e){i.decodeDracoFile(t,(function(t){for(const e in t.attributes){const n=t.attributes[e],i=a[e];void 0!==i&&(n.normalized=i)}e(t)}),o,l)}))}))}}class Hr{constructor(){this.name=Tr.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class Vr extends u.Wid{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new u.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(t){for(const e in o)t.uniforms[e]=o[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(t){o.specular.value=t}},specularMap:{get:function(){return o.specularMap.value},set:function(t){o.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(t){o.glossiness.value=t}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(t){o.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Gr{constructor(){this.name=Tr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Vr}extendParams(t,e,n){const i=e.extensions[this.name];t.color=new u.Ilk(1,1,1),t.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const e=i.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(t,"map",i.diffuseTexture,u.knz)),t.emissive=new u.Ilk(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new u.Ilk(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const e=i.specularGlossinessTexture;r.push(n.assignTexture(t,"glossinessMap",e)),r.push(n.assignTexture(t,"specularMap",e,u.knz))}return Promise.all(r)}createMaterial(t){const e=new Vr(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=void 0===t.emissiveIntensity?1:t.emissiveIntensity,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=u.IOt,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e}}class Wr{constructor(){this.name=Tr.KHR_MESH_QUANTIZATION}}class jr extends u._C8{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let t=0;t!==i;t++)e[t]=n[r+t];return e}}jr.prototype.beforeStart_=jr.prototype.copySampleValue_,jr.prototype.afterEnd_=jr.prototype.copySampleValue_,jr.prototype.interpolate_=function(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,h=i-e,c=(n-e)/h,u=c*c,d=u*c,p=t*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+c;for(let t=0;t!==o;t++){const e=s[f+t+o],n=s[f+t+a]*h,i=s[p+t+o],l=s[p+t]*h;r[t]=v*e+y*n+m*i+g*l}return r};const qr=new u._fP;class Xr extends jr{interpolate_(t,e,n,i){const r=super.interpolate_(t,e,n,i);return qr.fromArray(r).normalize().toArray(r),r}}const Yr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$r={9728:u.TyD,9729:u.wem,9984:u.YLQ,9985:u.qyh,9986:u.aH4,9987:u.D1R},Kr={33071:u.uWy,33648:u.OoA,10497:u.rpg},Zr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Jr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Qr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ts={CUBICSPLINE:void 0,LINEAR:u.NMF,STEP:u.Syv};function es(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function ns(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function is(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rs(t){const e=t.extensions&&t.extensions[Tr.KHR_DRACO_MESH_COMPRESSION];let n;return n=e?"draco:"+e.bufferView+":"+e.indices+":"+ss(e.attributes):t.indices+":"+ss(t.attributes)+":"+t.mode,n}function ss(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function os(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class as{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Sr,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||n||i&&r<98?this.textureLoader=new u.dpR(this.options.manager):this.textureLoader=new u.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new u.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};es(r,s,i),ns(s,i),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n].joints;for(let e=0,n=i.length;e<n;e++)t[i[e]].isBone=!0}for(let e=0,i=t.length;e<i;e++){const i=t[e];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),r=(t,e)=>{const n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(const[n,i]of t.children.entries())r(i,e.children[n])};return r(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&n.push(r)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((function(e,i){return n.getDependency(t,i)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[Tr.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(t,r){n.load(u.Zp0.resolveURL(e.uri,i.path),t,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)}))}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(t){const r=t[0],s=Zr[i.type],o=Yr[i.componentType],a=o.BYTES_PER_ELEMENT,l=a*s,h=i.byteOffset||0,c=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;let p,f;if(c&&c!==l){const t=Math.floor(h/c),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let l=e.cache.get(n);l||(p=new o(r,t*c,i.count*c/a),l=new u.vpT(p,c/a),e.cache.add(n,l)),f=new u.kB5(l,s,h%c/a,d)}else p=null===r?new o(i.count*s):new o(r,h,i.count*s),f=new u.TlE(p,s,d);if(void 0!==i.sparse){const e=Zr.SCALAR,n=Yr[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,h=new n(t[1],a,i.sparse.count*e),c=new o(t[2],l,i.sparse.count*s);null!==r&&(f=new u.TlE(f.array.slice(),f.itemSize,f.normalized));for(let t=0,e=h.length;t<e;t++){const e=h[t];if(f.setX(e,c[t*s]),s>=2&&f.setY(e,c[t*s+1]),s>=3&&f.setZ(e,c[t*s+2]),s>=4&&f.setW(e,c[t*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t].source,r=e.images[i];let s=this.textureLoader;if(r.uri){const t=n.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,i,s)}loadTextureImage(t,e,n){const i=this,r=this.json,s=r.textures[t],o=r.images[e],a=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(e,n).then((function(e){e.flipY=!1,s.name&&(e.name=s.name);const n=(r.samplers||{})[s.sampler]||{};return e.magFilter=$r[n.magFilter]||u.wem,e.minFilter=$r[n.minFilter]||u.D1R,e.wrapS=Kr[n.wrapS]||u.rpg,e.wrapT=Kr[n.wrapT]||u.rpg,i.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(t,e){const n=this.json,i=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const r=n.images[t],s=self.URL||self.webkitURL;let o=r.uri||"",a=!1;if(void 0!==r.bufferView)o=this.getDependency("bufferView",r.bufferView).then((function(t){a=!0;const e=new Blob([t],{type:r.mimeType});return o=s.createObjectURL(e),o}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const l=Promise.resolve(o).then((function(t){return new Promise((function(n,r){let s=n;!0===e.isImageBitmapLoader&&(s=function(t){const e=new u.xEZ(t);e.needsUpdate=!0,n(e)}),e.load(u.Zp0.resolveURL(t,i.path),s,void 0,r)}))})).then((function(t){var e;return!0===a&&s.revokeObjectURL(o),t.userData.mimeType=r.mimeType||((e=r.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),t}));return this.sourceCache[t]=l,l}assignTexture(t,e,n,i){const r=this;return this.getDependency("texture",n.index).then((function(s){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),r.extensions[Tr.KHR_TEXTURE_TRANSFORM]){const t=void 0!==n.extensions?n.extensions[Tr.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=r.associations.get(s);s=r.extensions[Tr.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),r.associations.set(s,e)}}return void 0!==i&&(s.encoding=i),t[e]=s,s}))}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0===e.attributes.tangent,r=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new u.UY4,u.F5T.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new u.nls,u.F5T.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(t,e)),n=e}if(i||r||s){let t="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),i&&(t+="derivative-tangents:"),r&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),r&&(e.vertexColors=!0),s&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return u.Wid}loadMaterial(t){const e=this,n=this.json,i=this.extensions,r=n.materials[t];let s;const o={},a=r.extensions||{},l=[];if(a[Tr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=i[Tr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=t.getMaterialType(),l.push(t.extendParams(o,r,e))}else if(a[Tr.KHR_MATERIALS_UNLIT]){const t=i[Tr.KHR_MATERIALS_UNLIT];s=t.getMaterialType(),l.push(t.extendParams(o,r,e))}else{const n=r.pbrMetallicRoughness||{};if(o.color=new u.Ilk(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;o.color.fromArray(t),o.opacity=t[3]}void 0!==n.baseColorTexture&&l.push(e.assignTexture(o,"map",n.baseColorTexture,u.knz)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(e.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===r.doubleSided&&(o.side=u.ehD);const h=r.alphaMode||"OPAQUE";if("BLEND"===h?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,"MASK"===h&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==u.vBJ&&(l.push(e.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new u.FM8(1,1),void 0!==r.normalTexture.scale)){const t=r.normalTexture.scale;o.normalScale.set(t,t)}return void 0!==r.occlusionTexture&&s!==u.vBJ&&(l.push(e.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==u.vBJ&&(o.emissive=(new u.Ilk).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&s!==u.vBJ&&l.push(e.assignTexture(o,"emissiveMap",r.emissiveTexture,u.knz)),Promise.all(l).then((function(){let n;return n=s===Vr?i[Tr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new s(o),r.name&&(n.name=r.name),ns(n,r),e.associations.set(n,{materials:t}),r.extensions&&es(i,n,r),n}))}createUniqueName(t){const e=u.iUV.sanitizeNodeName(t||"");let n=e;for(let t=1;this.nodeNamesUsed[n];++t)n=e+"_"+t;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function r(t){return n[Tr.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return hs(n,t,e)}))}const s=[];for(let n=0,o=t.length;n<o;n++){const o=t[n],a=rs(o),l=i[a];if(l)s.push(l.promise);else{let t;t=o.extensions&&o.extensions[Tr.KHR_DRACO_MESH_COMPRESSION]?r(o):hs(new u.u9r,o,e),i[a]={primitive:o,promise:t},s.push(t)}}return Promise.all(s)}loadMesh(t){const e=this,n=this.json,i=this.extensions,r=n.meshes[t],s=r.primitives,o=[];for(let t=0,e=s.length;t<e;t++){const e=void 0===s[t].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new u.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:u.Wl3})),a.DefaultMaterial):this.getDependency("material",s[t].material);o.push(e)}var a;return o.push(e.loadGeometries(s)),Promise.all(o).then((function(n){const o=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let n=0,h=a.length;n<h;n++){const h=a[n],c=s[n];let d;const p=o[n];if(4===c.mode||5===c.mode||6===c.mode||void 0===c.mode)d=!0===r.isSkinnedMesh?new u.TUv(h,p):new u.Kj0(h,p),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),5===c.mode?d.geometry=cs(d.geometry,u.UlW):6===c.mode&&(d.geometry=cs(d.geometry,u.z$h));else if(1===c.mode)d=new u.ejS(h,p);else if(3===c.mode)d=new u.x12(h,p);else if(2===c.mode)d=new u.blk(h,p);else{if(0!==c.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);d=new u.woe(h,p)}Object.keys(d.geometry.morphAttributes).length>0&&is(d,r),d.name=e.createUniqueName(r.name||"mesh_"+t),ns(d,r),c.extensions&&es(i,d,c),e.assignFinalMaterial(d),l.push(d)}for(let n=0,i=l.length;n<i;n++)e.associations.set(l[n],{meshes:t,primitives:n});if(1===l.length)return l[0];const h=new u.ZAu;e.associations.set(h,{meshes:t});for(let t=0,e=l.length;t<e;t++)h.add(l[t]);return h}))}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new u.cPb(u.M8C.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new u.iKG(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),ns(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))}loadAnimation(t){const e=this.json.animations[t],n=[],i=[],r=[],s=[],o=[];for(let t=0,a=e.channels.length;t<a;t++){const a=e.channels[t],l=e.samplers[a.sampler],h=a.target,c=void 0!==h.node?h.node:h.id,u=void 0!==e.parameters?e.parameters[l.input]:l.input,d=void 0!==e.parameters?e.parameters[l.output]:l.output;n.push(this.getDependency("node",c)),i.push(this.getDependency("accessor",u)),r.push(this.getDependency("accessor",d)),s.push(l),o.push(h)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o)]).then((function(n){const i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],n=r[t],h=s[t],c=o[t],d=a[t];if(void 0===e)continue;let p;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,Qr[d.path]){case Qr.weights:p=u.dUE;break;case Qr.rotation:p=u.iLg;break;default:p=u.yC1}const f=e.name?e.name:e.uuid,m=void 0!==c.interpolation?ts[c.interpolation]:u.NMF,g=[];Qr[d.path]===Qr.weights?e.traverse((function(t){t.morphTargetInfluences&&g.push(t.name?t.name:t.uuid)})):g.push(f);let v=h.array;if(h.normalized){const t=os(v.constructor),e=new Float32Array(v.length);for(let n=0,i=v.length;n<i;n++)e[n]=v[n]*t;v=e}for(let t=0,e=g.length;t<e;t++){const e=new p(g[t]+"."+Qr[d.path],n.array,v,m);"CUBICSPLINE"===c.interpolation&&(e.createInterpolant=function(t){return new(this instanceof u.iLg?Xr:jr)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const h=e.name?e.name:"animation_"+t;return new u.m7l(h,void 0,l)}))}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]})),e}))}loadNode(t){const e=this.json,n=this.extensions,i=this,r=e.nodes[t],s=r.name?i.createUniqueName(r.name):"";return function(){const e=[],n=i._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return n&&e.push(n),void 0!==r.camera&&e.push(i.getDependency("camera",r.camera).then((function(t){return i._getNodeRef(i.cameraCache,r.camera,t)}))),i._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let o;if(o=!0===r.isBone?new u.N$j:e.length>1?new u.ZAu:1===e.length?e[0]:new u.Tme,o!==e[0])for(let t=0,n=e.length;t<n;t++)o.add(e[t]);if(r.name&&(o.userData.name=r.name,o.name=s),ns(o,r),r.extensions&&es(n,o,r),void 0!==r.matrix){const t=new u.yGw;t.fromArray(r.matrix),o.applyMatrix4(t)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=t,o}))}loadScene(t){const e=this.json,n=this.extensions,i=this.json.scenes[t],r=this,s=new u.ZAu;i.name&&(s.name=r.createUniqueName(i.name)),ns(s,i),i.extensions&&es(n,s,i);const o=i.nodes||[],a=[];for(let t=0,n=o.length;t<n;t++)a.push(ls(o[t],s,e,r));return Promise.all(a).then((function(){return r.associations=(t=>{const e=new Map;for(const[t,n]of r.associations)(t instanceof u.F5T||t instanceof u.xEZ)&&e.set(t,n);return t.traverse((t=>{const n=r.associations.get(t);null!=n&&e.set(t,n)})),e})(s),s}))}}function ls(t,e,n,i){const r=n.nodes[t];return i.getDependency("node",t).then((function(t){if(void 0===r.skin)return t;let e;return i.getDependency("skin",r.skin).then((function(t){e=t;const n=[];for(let t=0,r=e.joints.length;t<r;t++)n.push(i.getDependency("node",e.joints[t]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(!t.isMesh)return;const i=[],r=[];for(let t=0,s=n.length;t<s;t++){const s=n[t];if(s){i.push(s);const n=new u.yGw;void 0!==e.inverseBindMatrices&&n.fromArray(e.inverseBindMatrices.array,16*t),r.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}t.bind(new u.OdW(i,r),t.matrixWorld)})),t}))})).then((function(t){e.add(t);const s=[];if(r.children){const e=r.children;for(let r=0,o=e.length;r<o;r++){const o=e[r];s.push(ls(o,t,n,i))}}return Promise.all(s)}))}function hs(t,e,n){const i=e.attributes,r=[];function s(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(const e in i){const n=Jr[e]||e.toLowerCase();n in t.attributes||r.push(s(i[e],n))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));r.push(i)}return ns(t,e),function(t,e,n){const i=e.attributes,r=new u.ZzF;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,s=t.max;if(void 0===e||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new u.Pa4(e[0],e[1],e[2]),new u.Pa4(s[0],s[1],s[2])),t.normalized){const e=os(Yr[t.componentType]);r.min.multiplyScalar(e),r.max.multiplyScalar(e)}}const s=e.targets;if(void 0!==s){const t=new u.Pa4,e=new u.Pa4;for(let i=0,r=s.length;i<r;i++){const r=s[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const t=os(Yr[i.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(t)}t.boundingBox=r;const o=new u.aLr;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=o}(t,e,n),Promise.all(r).then((function(){return void 0!==e.targets?function(t,e,n){let i=!1,r=!1,s=!1;for(let t=0,n=e.length;t<n;t++){const n=e[t];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const o=[],a=[],l=[];for(let h=0,c=e.length;h<c;h++){const c=e[h];if(i){const e=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):t.attributes.position;o.push(e)}if(r){const e=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):t.attributes.normal;a.push(e)}if(s){const e=void 0!==c.COLOR_0?n.getDependency("accessor",c.COLOR_0):t.attributes.color;l.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(e){const n=e[0],o=e[1],a=e[2];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=o),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function cs(t,e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,r=[];if(e===u.z$h)for(let t=1;t<=i;t++)r.push(n.getX(0)),r.push(n.getX(t)),r.push(n.getX(t+1));else for(let t=0;t<i;t++)t%2==0?(r.push(n.getX(t)),r.push(n.getX(t+1)),r.push(n.getX(t+2))):(r.push(n.getX(t+2)),r.push(n.getX(t+1)),r.push(n.getX(t)));r.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(r),s}Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"});const us=Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"});Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"});us.DEFAULT;const ds={uniforms:{tDiffuse:{value:null},resolution:{value:new u.FM8(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\tprecision highp float;\n\n\tuniform sampler2D tDiffuse;\n\n\tuniform vec2 resolution;\n\n\tvarying vec2 vUv;\n\n\t// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n\t//----------------------------------------------------------------------------------\n\t// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n\t// SDK Version: v3.00\n\t// Email:       gameworks@nvidia.com\n\t// Site:        http://developer.nvidia.com/\n\t//\n\t// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n\t//\n\t// Redistribution and use in source and binary forms, with or without\n\t// modification, are permitted provided that the following conditions\n\t// are met:\n\t//  * Redistributions of source code must retain the above copyright\n\t//    notice, this list of conditions and the following disclaimer.\n\t//  * Redistributions in binary form must reproduce the above copyright\n\t//    notice, this list of conditions and the following disclaimer in the\n\t//    documentation and/or other materials provided with the distribution.\n\t//  * Neither the name of NVIDIA CORPORATION nor the names of its\n\t//    contributors may be used to endorse or promote products derived\n\t//    from this software without specific prior written permission.\n\t//\n\t// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY\n\t// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\t// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n\t// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n\t// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n\t// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n\t// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n\t// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n\t// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n\t// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\t// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\t//\n\t//----------------------------------------------------------------------------------\n\n\t#ifndef FXAA_DISCARD\n\t\t\t//\n\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t//\n\t\t\t// 1 = Use discard on pixels which don't need AA.\n\t\t\t//     For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t// 0 = Return unchanged color on pixels which don't need AA.\n\t\t\t//\n\t\t\t#define FXAA_DISCARD 0\n\t#endif\n\n\t/*--------------------------------------------------------------------------*/\n\t#define FxaaTexTop(t, p) texture2D(t, p, -100.0)\n\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)\n\t/*--------------------------------------------------------------------------*/\n\n\t#define NUM_SAMPLES 5\n\n\t// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha\n\tfloat contrast( vec4 a, vec4 b ) {\n\t\t\tvec4 diff = abs( a - b );\n\t\t\treturn max( max( max( diff.r, diff.g ), diff.b ), diff.a );\n\t}\n\n\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\tFXAA3 QUALITY - PC\n\n\t============================================================================*/\n\n\t/*--------------------------------------------------------------------------*/\n\tvec4 FxaaPixelShader(\n\t\t\tvec2 posM,\n\t\t\tsampler2D tex,\n\t\t\tvec2 fxaaQualityRcpFrame,\n\t\t\tfloat fxaaQualityEdgeThreshold,\n\t\t\tfloat fxaaQualityinvEdgeThreshold\n\t) {\n\t\t\tvec4 rgbaM = FxaaTexTop(tex, posM);\n\t\t\tvec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\t// . S .\n\t\t\t// W M E\n\t\t\t// . N .\n\n\t\t\tbool earlyExit = max( max( max(\n\t\t\t\t\tcontrast( rgbaM, rgbaN ),\n\t\t\t\t\tcontrast( rgbaM, rgbaS ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaE ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaW ) )\n\t\t\t\t\t< fxaaQualityEdgeThreshold;\n\t\t\t// . 0 .\n\t\t\t// 0 0 0\n\t\t\t// . 0 .\n\n\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\tif(earlyExit) FxaaDiscard;\n\t\t\t#else\n\t\t\t\t\tif(earlyExit) return rgbaM;\n\t\t\t#endif\n\n\t\t\tfloat contrastN = contrast( rgbaM, rgbaN );\n\t\t\tfloat contrastS = contrast( rgbaM, rgbaS );\n\t\t\tfloat contrastE = contrast( rgbaM, rgbaE );\n\t\t\tfloat contrastW = contrast( rgbaM, rgbaW );\n\n\t\t\tfloat relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );\n\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\tbool horzSpan = relativeVContrast > 0.;\n\t\t\t// . 1 .\n\t\t\t// 0 0 0\n\t\t\t// . 1 .\n\n\t\t\t// 45 deg edge detection and corners of objects, aka V/H contrast is too similar\n\t\t\tif( abs( relativeVContrast ) < .3 ) {\n\t\t\t\t\t// locate the edge\n\t\t\t\t\tvec2 dirToEdge;\n\t\t\t\t\tdirToEdge.x = contrastE > contrastW ? 1. : -1.;\n\t\t\t\t\tdirToEdge.y = contrastS > contrastN ? 1. : -1.;\n\t\t\t\t\t// . 2 .      . 1 .\n\t\t\t\t\t// 1 0 2  ~=  0 0 1\n\t\t\t\t\t// . 1 .      . 0 .\n\n\t\t\t\t\t// tap 2 pixels and see which ones are \"outside\" the edge, to\n\t\t\t\t\t// determine if the edge is vertical or horizontal\n\n\t\t\t\t\tvec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongH = contrast( rgbaM, rgbaAlongH );\n\t\t\t\t\t// . 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 H\n\n\t\t\t\t\tvec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongV = contrast( rgbaM, rgbaAlongV );\n\t\t\t\t\t// V 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 .\n\n\t\t\t\t\trelativeVContrast = matchAlongV - matchAlongH;\n\t\t\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\t\t\tif( abs( relativeVContrast ) < .3 ) { // 45 deg edge\n\t\t\t\t\t\t\t// 1 1 .\n\t\t\t\t\t\t\t// 0 0 1\n\t\t\t\t\t\t\t// . 0 1\n\n\t\t\t\t\t\t\t// do a simple blur\n\t\t\t\t\t\t\treturn mix(\n\t\t\t\t\t\t\t\t\trgbaM,\n\t\t\t\t\t\t\t\t\t(rgbaN + rgbaS + rgbaE + rgbaW) * .25,\n\t\t\t\t\t\t\t\t\t.4\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\thorzSpan = relativeVContrast > 0.;\n\t\t\t}\n\n\t\t\tif(!horzSpan) rgbaN = rgbaW;\n\t\t\tif(!horzSpan) rgbaS = rgbaE;\n\t\t\t// . 0 .      1\n\t\t\t// 1 0 1  ->  0\n\t\t\t// . 0 .      1\n\n\t\t\tbool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );\n\t\t\tif(!pairN) rgbaN = rgbaS;\n\n\t\t\tvec2 offNP;\n\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\n\t\t\tbool doneN = false;\n\t\t\tbool doneP = false;\n\n\t\t\tfloat nDist = 0.;\n\t\t\tfloat pDist = 0.;\n\n\t\t\tvec2 posN = posM;\n\t\t\tvec2 posP = posM;\n\n\t\t\tint iterationsUsed = 0;\n\t\t\tint iterationsUsedN = 0;\n\t\t\tint iterationsUsedP = 0;\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i++ ) {\n\t\t\t\t\titerationsUsed = i;\n\n\t\t\t\t\tfloat increment = float(i + 1);\n\n\t\t\t\t\tif(!doneN) {\n\t\t\t\t\t\t\tnDist += increment;\n\t\t\t\t\t\t\tposN = posM + offNP * nDist;\n\t\t\t\t\t\t\tvec4 rgbaEndN = FxaaTexTop(tex, posN.xy);\n\t\t\t\t\t\t\tdoneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );\n\t\t\t\t\t\t\titerationsUsedN = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!doneP) {\n\t\t\t\t\t\t\tpDist += increment;\n\t\t\t\t\t\t\tposP = posM - offNP * pDist;\n\t\t\t\t\t\t\tvec4 rgbaEndP = FxaaTexTop(tex, posP.xy);\n\t\t\t\t\t\t\tdoneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );\n\t\t\t\t\t\t\titerationsUsedP = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(doneN || doneP) break;\n\t\t\t}\n\n\n\t\t\tif ( !doneP && !doneN ) return rgbaM; // failed to find end of edge\n\n\t\t\tfloat dist = min(\n\t\t\t\t\tdoneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,\n\t\t\t\t\tdoneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.\n\t\t\t);\n\n\t\t\t// hacky way of reduces blurriness of mostly diagonal edges\n\t\t\t// but reduces AA quality\n\t\t\tdist = pow(dist, .5);\n\n\t\t\tdist = 1. - dist;\n\n\t\t\treturn mix(\n\t\t\t\t\trgbaM,\n\t\t\t\t\trgbaN,\n\t\t\t\t\tdist * .5\n\t\t\t);\n\t}\n\n\tvoid main() {\n\t\t\tconst float edgeDetectionQuality = .2;\n\t\t\tconst float invEdgeDetectionQuality = 1. / edgeDetectionQuality;\n\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\t\tvUv,\n\t\t\t\t\ttDiffuse,\n\t\t\t\t\tresolution,\n\t\t\t\t\tedgeDetectionQuality, // [0,1] contrast needed, otherwise early discard\n\t\t\t\t\tinvEdgeDetectionQuality\n\t\t\t);\n\n\t}\n\t"},ps=(new u.Pa4,new u.Pa4,new u.Ilk(16772608),new u.Ilk(0),sr),fs=n(312).n;class ms{static toMB=t=>t/1048576;static getJsHeapSizeLimit(){return this.toMB(fs.jsHeapSizeLimit())}static getTotalJSHeapSize(){return this.toMB(fs.totalJSHeapSize())}static getUsedJSHeapSize(){return this.toMB(fs.usedJSHeapSize())}}const gs="keydown",vs="keyup",ys="keypress",xs="mousedown",bs="mouseup",ws="mousemove",_s="click",Ms="dblclick",Ss="mousedrag";class Ts extends r{static instance;keyDownFlag=!1;mouseDownFlag=!1;keyChar=void 0;keyCode=void 0;constructor(){super()}static getInstance(){return Ts.instance||(Ts.instance=new Ts,Ts.initEvents()),Ts.instance}static initEvents(){const t=Ts.getInstance(),e=["F1","F2","F3","F4","F6","F7","F8","F9"],n=t=>{for(let n=0;n<e.length;n++)if(e[n]===t.key)return t.preventDefault(),void t.stopPropagation()};window.addEventListener("keydown",(e=>{n(e),t.keyDownFlag=!0,t.keyChar=e.key,t.keyCode=e.code,t.dispatchEvent({type:gs,keyEvent:e})})),window.addEventListener("keypress",(e=>{n(e),t.dispatchEvent({type:ys,keyEvent:e})})),window.addEventListener("keyup",(e=>{n(e),t.keyDownFlag=!1,t.keyChar=void 0,t.keyCode=void 0,t.dispatchEvent({type:vs,keyEvent:e})})),window.addEventListener("mousedown",(e=>{n(e),t.mouseDownFlag=!0,t.dispatchEvent({type:xs,mouseEvent:e})})),window.addEventListener("mouseup",(e=>{n(e),t.mouseDownFlag=!1,t.dispatchEvent({type:bs,mouseEvent:e})})),window.addEventListener("mousemove",(e=>{t.dispatchEvent({type:ws,mouseEvent:e}),!0===t.mouseDownFlag&&t.dispatchEvent({type:Ss,mouseEvent:e})})),window.addEventListener("click",(e=>{n(e),t.dispatchEvent({type:_s,mouseEvent:e})})),window.addEventListener("dblclick",(e=>{n(e),t.dispatchEvent({type:Ms,mouseEvent:e})}))}}class Es{static WKD=0;static WKU=1;static state=0;static keyDownOnce(t){if(Es.state===Es.WKD){if(!0===t)return Es.state=Es.WKU,!0}else Es.state===Es.WKU&&!1===t&&(Es.state=Es.WKD);return!1}}class As{static WAIT_KEY_DOWN=0;static WAIT_KEY_UP=1;static state=As.WAIT_KEY_DOWN;static check(t,e,n){return As.state===As.WAIT_KEY_DOWN&&!0===n&&t===e?(As.state=As.WAIT_KEY_UP,!0):(As.state===As.WAIT_KEY_UP&&!1===n&&(As.state=As.WAIT_KEY_DOWN),!1)}}class Cs{static winEvent=Ts.getInstance();constructor(){}static checkKeyOnce(t){return As.check(t,Cs.winEvent.keyChar,Cs.winEvent.keyDownFlag)}static checkCodeOnce(t){return As.check(t,Cs.winEvent.keyCode,Cs.winEvent.keyDownFlag)}static getKeyOnce(){if(Es.keyDownOnce(Cs.winEvent.keyDownFlag))return Cs.winEvent.keyChar}static getCodeOnce(){if(Es.keyDownOnce(Cs.winEvent.keyDownFlag))return Cs.winEvent.keyCode}static readKey(){if(Cs.isKeyDown())return Cs.winEvent.keyChar}static readCode(){if(Cs.isKeyDown())return Cs.winEvent.keyCode}static isKeyDown(){return Cs.winEvent.keyDownFlag}static isKeyUp(){return!Cs.winEvent.keyDownFlag}static onKeyDown(t){Cs.winEvent.addEventListener(gs,t)}static onKeyPress(t){Cs.winEvent.addEventListener(ys,t)}static onKeyUp(t){Cs.winEvent.addEventListener(vs,t)}static onMouseDown(t){Cs.winEvent.addEventListener(xs,t)}static onMouseUp(t){Cs.winEvent.addEventListener(bs,t)}static onMouseClick(t){Cs.winEvent.addEventListener(_s,t)}static onMouseDoubleClick(t){Cs.winEvent.addEventListener(Ms,t)}static onMouseMove(t){Cs.winEvent.addEventListener(ws,t)}static onMouseDrag(t){Cs.winEvent.addEventListener(Ss,t)}static keyListener={};static onKey(t,e){return 0===Object.keys(Cs.keyListener).length&&Cs.onKeyDown((t=>{Object.keys(Cs.keyListener).filter((e=>e===t.keyEvent.key)).forEach((e=>{Cs.keyListener[e].forEach((e=>e(t.keyEvent.ctrlKey,t.keyEvent.altKey,t.keyEvent.shiftKey)))}))})),Cs.keyListener[t]||(Cs.keyListener[t]=[]),Cs.keyListener[t].push(e),this}static Keys={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowDown:"ArrowDown",ArrowUp:"ArrowUp",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",h:"h",i:"i",j:"j",k:"k",l:"l",m:"m",n:"n",o:"o",p:"p",q:"q",r:"r",s:"s",t:"t",u:"u",v:"v",w:"w",x:"x",y:"y",z:"z",A:"A",B:"B",C:"C",D:"D",E:"E",F:"F",G:"G",H:"H",I:"I",J:"J",K:"K",L:"L",M:"M",N:"N",O:"O",P:"P",Q:"Q",R:"R",S:"S",T:"T",U:"U",V:"V",W:"W",X:"X",Y:"Y",Z:"Z"}}var Ps;!function(t){t[t.Disposed=0]="Disposed",t[t.Stopped=1]="Stopped",t[t.Running=2]="Running",t[t.Paused=3]="Paused"}(Ps||(Ps={}));class Rs extends r{static stats={frames:0,fps:0,delta:0,gload:0,pload:0,uload:0,tload:0,time:0,proc:0};static instance;static state=Ps.Disposed;static timeoutId;static children=[];static callbacks=[];static tickInterval=1e3;static frameListeners=[];static onFrame(t){-1===this.frameListeners.lastIndexOf(t)&&this.frameListeners.push(t)}static cancelOnFrameListener(t){const e=this.frameListeners.lastIndexOf(t);this.frameListeners.splice(e,1)}static SHOW_ADD_REMOVE_CALLBACK_EVENT=!1;static addCallback(t){-1===Rs.callbacks.indexOf(t)&&(Rs.callbacks.push(t),Rs.SHOW_ADD_REMOVE_CALLBACK_EVENT&&Rs._event_log(`@EngineLoop.addCallback: Callback #${t.id} added (${Rs.callbacks.length})`))}static removeCallback(t){const e=Rs.callbacks.indexOf(t);-1!==e&&(Rs.callbacks.splice(e,1),Rs.SHOW_ADD_REMOVE_CALLBACK_EVENT&&Rs._event_log(`@EngineLoop.removeCallback: Callback #${t.id} removed (${Rs.callbacks.length})`))}constructor(){super(),Ls.enable(!1),Is.enable(!1),window.addEventListener("resize",(t=>{Rs.children.forEach((t=>{t.resize(window.innerWidth,window.innerHeight)}))}));let t=0;Cs.onMouseClick((e=>{e.mouseEvent.ctrlKey&&(0===t?(Ls.enabled=!Ls.enabled,t=1):1===t&&(Is.enabled=!Is.enabled,t=0))}))}static _event_log=(t,e="#8f8")=>{console.log(`%c${t}`,`color: ${e}`)};static showMemoryStats(t){Ls.enable(t)}static showEngineStats(t){Is.enable(t)}static getInstance(){return Rs.instance||(Rs.instance=new Rs,this._event_log("@EngineLoop.getInstance: EngineLoop.instance is created.","#8f8")),Rs.instance}static addObject(t){-1===Rs.children.indexOf(t)&&(Rs.children.push(t),this._event_log(`@EngineLoop.addObject: "${t.type}" object is added.`))}static removeObject(t){const e=Rs.children.indexOf(t);e>=0&&(Rs.children.splice(e,1),this._event_log(`@EngineLoop.removeObject: "${t.type}" object is removed.`))}static desiredFps=60;static timeComp=0;static frameCount=0;static ts=window.performance.now();static te=Rs.ts;static tms=Rs.ts;static frameAnimator;static USE_DEFAULT_ANIMATION_FRAME=!0;loop(){!0===Rs.USE_DEFAULT_ANIMATION_FRAME&&(Rs.frameAnimator=requestAnimationFrame(this.loop.bind(this))),Rs.stats.time=window.performance.now(),Rs.te=Rs.stats.time;const t=Rs.te-Rs.ts;Rs.stats.delta=.5*(Rs.stats.delta+t),Rs.ts=Rs.te,Rs.stats.frames+=1,Rs.stats.fps=1e3/Rs.stats.delta;const e=Rs.te;let n=0,i=0,r=0;Rs.children.forEach((e=>{!0===e.needsEngineUpdate&&(e.category===o.Graphics?n+=e.update(t):e.category===o.Physics?i+=e.update(t):r+=e.update(t))}));const s=window.performance.now();Rs.callbacks.map((t=>{t.listener(Rs.stats)})),r+=window.performance.now()-s,Rs.frameListeners.forEach((t=>{const e=window.performance.now();t(Rs.stats),r+=window.performance.now()-e}));const a=window.performance.now()-e,l=1e3/Rs.desiredFps;if(Rs.stats.tload=a/l*100,Rs.stats.proc=a,Rs.stats.gload=n/l*100,Rs.stats.pload=i/l*100,Rs.stats.uload=r/l*100,Rs.tms+=t,Rs.frameCount++,Rs.tms>=Rs.tickInterval&&(Rs.stats.fps=1e3*Rs.frameCount/Rs.tms,Rs.frameCount=0,Rs.tms=Rs.tms-Rs.tickInterval,this.dispatchEvent({type:"tick",stats:Rs.stats,target:this}),Is.getInstance().updateStats(Rs.stats),Ls.getInstance().updateMemory(Rs.stats)),this.dispatchEvent({type:"frame",stats:Rs.stats,target:this}),!1===Rs.USE_DEFAULT_ANIMATION_FRAME){const e=t/20;Rs.timeComp+=Rs.stats.fps<Rs.desiredFps?+e:-e;let n=(1e3-Rs.timeComp)/Rs.desiredFps;n=n<=0?1:n,n=n>=20?20:n,Rs.timeoutId=setTimeout(this.loop.bind(this),n)}}setTickInterval(t){return t=(t=t<20?20:t)>5e4?5e3:t,Rs.tickInterval=t,this}getStats(){return Rs.stats}setFrameRate(t){if(!0===Rs.USE_DEFAULT_ANIMATION_FRAME)throw new Error("@EngineLoop.setFrameRate: The engine loop is executed by requestAnimationFrame. The frame rate is fixed at 60pfs.");return t=(t=t<.5?1:t)>200?200:t,Rs.desiredFps=t,this}getDesiredFrameRate(){return Rs.desiredFps}useRequestAnimationFrame(t){Rs.USE_DEFAULT_ANIMATION_FRAME=t}resetStats(){return Rs.stats={frames:0,fps:0,delta:0,gload:0,pload:0,uload:0,tload:0,time:0,proc:0},this}start(t){return Rs.state!==Ps.Stopped&&Rs.state!==Ps.Disposed||(Rs._event_log("@EngineLoop.start: EngineLoop started.","#8f8"),t&&(Rs.addCallback({id:"engine_00000000",listener:t}),Rs._event_log(`EngineLoop.start: Callback added (${Rs.callbacks.length})`)),this.resetStats(),Rs.state=Ps.Running,this.loop()),this}resume(){return Rs.state===Ps.Paused&&(Rs._event_log("@EngineLoop.resume: EngineLoop resumed.","#8f8"),Rs.state=Ps.Running,this.loop()),this}pause(){return Rs.state===Ps.Running&&(Rs._event_log("@EngineLoop.pause: EngineLoop paused.","#8f8"),Rs.state=Ps.Paused,clearInterval(Rs.timeoutId)),this}stop(){return Rs.state!==Ps.Running&&Rs.state!==Ps.Paused||(Rs._event_log("@EngineLoop.stop: EngineLoop stopped.","#8f8"),Rs.state=Ps.Stopped,cancelAnimationFrame(Rs.timeoutId)),this}restart(){return this.stop(),this.start(),this}}class Ls{static enabled;static instance;static container;static pgBars=[];static pgVals=[];static displayMode=!1;static getInstance(){return void 0===Ls.instance&&(Ls.instance=new Ls,Ls.initElements()),Ls.instance}static enable(t){Ls.enabled=t}static initElements(){const t=Ls;t.container=document.createElement("div");const e=t.container;e.id="engine_memory_container",e.style.position="relative",e.style.display="inline-block",e.style.backgroundColor=`${ps("black").alpha(.5)}`,e.style.padding="4px",e.style.borderRadius="4px",e.style.float="left",e.style.fontFamily="IBM Plex Mono",e.style.userSelect="none",e.style.zIndex="10000",document.body.appendChild(e);const n=["Limit","Alloc","Using"];let i="<table>";n.forEach((t=>{i+="<tr>",i+=`<td><span style="padding-right: 6px">${t}:</span></td>`,i+="<td>",i+=`<progress style="width: 100px; height: 10px"; id="engine_mem_prg_${t}"></progress>`,i+="</td>",i+='<td style="width: 90px; text-align: right;">',i+=`<span id="engine_mem_val_${t}" style="width:100%; text-align: right; userSelect: none;">12.3%</span>`,i+="</td>",i+="</tr>"})),i+="</table>",e.innerHTML=i,n.forEach((e=>{t.pgBars.push(document.getElementById(`engine_mem_prg_${e}`)),t.pgVals.push(document.getElementById(`engine_mem_val_${e}`))})),t.pgBars[0].max=ms.getJsHeapSizeLimit(),t.pgBars[0].value=ms.getJsHeapSizeLimit(),t.pgVals[0].innerHTML=`${Math.ceil(t.pgBars[0].value)} MB`,t.pgBars[1].max=100,t.pgBars[2].max=100,e.addEventListener("mousedown",(()=>{t.displayMode=!t.displayMode,!1===t.displayMode?(t.pgBars[1].max=100,t.pgBars[2].max=100):(t.pgBars[1].max=ms.getJsHeapSizeLimit(),t.pgBars[2].max=ms.getTotalJSHeapSize()),this.getInstance().updateMemory()}))}updateMemory(t){if(!1===Ls.enabled)return void(Ls.container.style.display="none");Ls.container.style.display="block";const e=Ls,n=ms.getJsHeapSizeLimit(),i=ms.getTotalJSHeapSize(),r=ms.getUsedJSHeapSize();e.pgBars[0].value=n,!1===e.displayMode?(e.pgBars[1].value=i/n*100,e.pgBars[2].value=r/i*100,e.pgBars[2].max=100,e.pgVals[0].innerHTML=`${e.pgBars[0].value.toFixed(0)} MB`,e.pgVals[1].innerHTML=`${e.pgBars[1].value.toFixed(2)} %`,e.pgVals[2].innerHTML=`${e.pgBars[2].value.toFixed(2)} %`):(e.pgBars[1].value=i,e.pgBars[2].value=r,e.pgBars[2].max=i,e.pgVals[0].innerHTML=`${e.pgBars[0].value.toFixed(0)} MB`,e.pgVals[1].innerHTML=`${e.pgBars[1].value.toFixed(1)} MB`,e.pgVals[2].innerHTML=`${e.pgBars[2].value.toFixed(1)} MB`)}}class Is{static enabled;static instance;static container;static pgBars=[];static pgVals=[];static getInstance(){return void 0===Is.instance&&(Is.instance=new Is,Is.initElements()),Is.instance}static enable(t){Is.enabled=t}static initElements(){const t=Is;t.container=document.createElement("div");const e=t.container;e.id="engine_stats_container",e.style.display="inline-block",e.style.position="relative",e.style.backgroundColor=`${ps("black").alpha(.5)}`,e.style.padding="4px",e.style.borderRadius="4px",e.style.float="right",e.style.userSelect="none",e.style.zIndex="10000",document.body.appendChild(e);const n=["FPS","GLD","PLD","ULD","TLD"];let i="<table style=\"font-family: 'IBM Plex Mono'; min-width: 220px; max-width: 220px\">";n.forEach((t=>{i+='<tr">',i+=`<td>${t}: </td>`,i+='<td style="text-align: center;">',i+=`<progress style="width: 100px; height: 10px;" id=engine_pgb_${t}></progress>`,i+="</td>",i+='<td style="width: 60px; text-align: right;">',i+=`<span style="width:100%; text-align: right; userSelect: none;" id=engine_val_${t}>0.00%</span>`,i+="</td>",i+="</tr>"})),i+="</table>",e.innerHTML=i,n.forEach((e=>{t.pgBars.push(document.getElementById(`engine_pgb_${e}`)),t.pgVals.push(document.getElementById(`engine_val_${e}`))})),t.pgBars[0].max=Rs.getInstance().getDesiredFrameRate(),t.pgBars[1].max=100,t.pgBars[2].max=100,t.pgBars[3].max=100,t.pgBars[4].max=100,t.pgBars[0].style.color="#8f8"}updateStats(t){if(!1===Is.enabled)return void(Is.container.style.display="none");Is.container.style.display="block";const e=Is;e.pgBars[0].max=Rs.getInstance().getDesiredFrameRate(),e.pgBars[0].value=t.fps,e.pgVals[0].innerHTML=`${t.fps.toFixed(2)}`,e.pgBars[1].value=t.gload,e.pgVals[1].innerHTML=`${t.gload.toFixed(2)}%`,e.pgBars[2].value=t.pload,e.pgVals[2].innerHTML=`${t.pload.toFixed(2)}%`,e.pgBars[3].value=t.uload,e.pgVals[3].innerHTML=`${t.uload.toFixed(2)}%`,e.pgBars[4].value=t.tload,e.pgVals[4].innerHTML=`${t.tload.toFixed(2)}%`}}class Ds extends c{constructor(t,e){super(t,e),Rs.addObject(this)}register(){Rs.addObject(this)}unregister(){Rs.removeObject(this)}}class Os{static toMesh(t){return t}static toMaterial(t){return t}static getBoundingBox(t){if(!this.isMesh(t)&&!this.isGroup(t))throw new Error(`The "${t.name}" is type of "${t.type}" is not supported by the getBoundingBox().`);if(this.isMesh(t)){const e=t;return e.geometry.boundingBox||e.geometry.computeBoundingBox(),e.geometry.boundingBox?e.geometry.boundingBox:void 0}const e=[];try{t.children.forEach((t=>{const n=t;e.push(n.geometry.boundingBox)}))}catch(e){console.error(`Model Name: ${t.name}, Model Type: ${t.type}`),console.error(e)}const n=(t,e)=>t>e?t:e,i=(t,e)=>t<e?t:e;let r=0,s=0,o=0,a=0,l=0,h=0;e.map(((t,e)=>{r=n(r,t.max.x),s=i(s,t.min.x),o=n(o,t.max.y),a=i(a,t.min.y),l=n(l,t.max.z),h=i(h,t.min.z)}));const c=new u.Pa4(s,a,h),d=new u.Pa4(r,o,l);return new u.ZzF(c,d)}static makeUid(t,e){if(!t&&!e)return(0,h.DO)();let n="";return t&&(n+=`${t}_`),n+=(0,h.DO)().substring(0,5),e&&(n+=`${e}`),n}static disposeObject(t){const e=t=>{const e=t.parent;if(console.log(`%cDISPOSE MESH => name: "${t.name}" type: "${t.type}" parent: "${e?.name}"`,"color:orange"),"Mesh"===t.type){const e=t;e.geometry.dispose();const n=e.material;n&&(n.dispose(),n.map&&n.map.dispose(),n.lightMap&&n.lightMap.dispose(),n.aoMap&&n.aoMap.dispose(),n.emissiveMap&&n.emissiveMap.dispose(),n.bumpMap&&n.bumpMap.dispose(),n.normalMap&&n.normalMap.dispose(),n.displacementMap&&n.displacementMap.dispose(),n.roughnessMap&&n.roughnessMap.dispose(),n.metalnessMap&&n.metalnessMap.dispose(),n.alphaMap&&n.alphaMap.dispose(),n.envMap&&n.envMap.dispose())}console.log(`%cREMOVE => name: "${t.name}" type: "${t.type}" parent: "${e?.name}"`,"color:yellow"),e&&e.remove(t)},n=t=>{t.children.slice().forEach((t=>{t.children.length>0&&n(t),e(t)})),e(t)};n(t)}static isObject3D(t){return"Object3D"===t.type}static isMesh(t){return t instanceof u.Kj0}static isGroup(t){return t instanceof u.ZAu}static isScene(t){return t instanceof u.xsS}static isGLTFScene(t){return t instanceof u.ZAu&&0===t.name.indexOf(e.Graphics.Scene.GLTF.NamePrefix)}static isLight(t){return t instanceof u._kC}static isPoints(t){return t instanceof u.woe}static isObjectAxesHelper(t){return t instanceof u.y8_&&0===t.name.indexOf(e.SpecialObjects.Helpers.ObjectAxes.NamePrefix)}static isWorldAxesHelper(t){return t instanceof u.y8_&&0===t.name.indexOf(e.SpecialObjects.Helpers.WorldAxes.NamePrefix)}static isCamera(t){return t instanceof u.V1s||t instanceof u._am}static isChildOfMesh=t=>{let e=!1;const n=t.parent;return n&&n instanceof u.Kj0&&(e=!0),e};static isChildOfGroup=t=>{let e=!1;const n=t.parent;return n&&n instanceof u.ZAu&&(e=!0),e};static isShapeMesh(t){return this.isMesh(t)&&t.name.includes(e.Graphics.ShapeMesh.NameIncludes)&&("Mesh"===t.parent?.type||"Group"===t.parent?.type)}static isSingleShapeObject(t){if(this.isMesh(t)||this.isGroup(t)){const e=t.children.filter((t=>this.isMesh(t)&&this.isShapeMesh(t)));return 1==e.length}return!1}static isCustomShapeObject(t){return!(!this.isMesh(t)&&!this.isGroup(t))&&t.children.filter((t=>this.isMesh(t)&&this.isShapeMesh(t))).length>0}static isMultiShapesObject(t){if(this.isMesh(t)||this.isGroup(t)){const e=t.children.filter((t=>this.isMesh(t)&&this.isShapeMesh(t)));return e.length>1}return!1}static isMultiMaterialsObject=t=>{let e=!1;if(t instanceof u.ZAu){const n=[],i={};if(t.children.forEach((t=>{t instanceof u.Kj0&&(n.push(t.name.split("_")[0]),i[t.material.name]=t.name)})),n.length>=2){const t=n[0];let r=1;for(let e=1;e<n.length;e++)n[e]===t&&r++;n.length===r&&Object.keys(i).length===r&&(e=!0)}}return e};static isSubFace=t=>{let e=!1;if(t instanceof u.Kj0){const n=t.parent;n&&n instanceof u.ZAu&&(e=this.getSiblingFaces(t).length>1)}return e};static getSiblingFaces(t){const e=[];if(t instanceof u.Kj0){const n=t.parent;if(n&&n instanceof u.ZAu){const t=n.children.filter((t=>"Mesh"===t.type)),i=[];if(t.forEach((t=>i.push(t.name.split("_")[0]))),i.length>0){const n=i[0];e.push(t[0]);for(let r=1;r<i.length;r++)i[r]===n&&e.push(t[r])}}}return e}static hasParent(t){return null!==t.parent||void 0!==t.parent}static hasChildren(t){return t.children.length>0}static isDebugMesh(t){return this.isMesh(t)&&0===t.name.indexOf(e.SpecialObjects.MeshDebug.NamePrefix)}static isHelper(t){return 0===t.name.indexOf(e.SpecialObjects.Helpers.NamePrefix)||this.isWorldAxesHelper(t)||this.isObjectAxesHelper(t)}static isLabel(t){return 0===t.name.indexOf(e.Graphics.Label.NamePrefix)}static isParticle(t){return""===t.name&&t instanceof u.woe&&t.material instanceof u.jyz}static isSpecialObject(t){return this.isDebugMesh(t)||this.isHelper(t)||this.isParticle(t)||this.isLabel(t)}static isLabelAttached(t){if(t.children)for(let e=0;e<t.children.length;e++){const n=t.children[e];if(this.isLabel(n))return!0}return!1}static makeUniqueName(t,e){let n=(0,h.DO)().substring(0,5);return t&&(n=`${t}_${n}`),e&&(n=`${n}_${e}`),n}}class Bs extends u.Tme{constructor(t=document.createElement("div")){super(),this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}Bs.prototype.isCSS2DObject=!0;const Ns=new u.Pa4,zs=new u.yGw,ks=new u.yGw,Fs=new u.Pa4,Us=new u.Pa4;class Hs{constructor(t={}){const e=this;let n,i,r,s;const o={objects:new WeakMap},a=void 0!==t.element?t.element:document.createElement("div");function l(t,n,i){if(t.isCSS2DObject){Ns.setFromMatrixPosition(t.matrixWorld),Ns.applyMatrix4(ks);const l=!0===t.visible&&Ns.z>=-1&&Ns.z<=1&&!0===t.layers.test(i.layers);if(t.element.style.display=!0===l?"":"none",!0===l){t.onBeforeRender(e,n,i);const o=t.element;/apple/i.test(navigator.vendor)?o.style.transform="translate(-50%,-50%) translate("+Math.round(Ns.x*r+r)+"px,"+Math.round(-Ns.y*s+s)+"px)":o.style.transform="translate(-50%,-50%) translate("+(Ns.x*r+r)+"px,"+(-Ns.y*s+s)+"px)",o.parentNode!==a&&a.appendChild(o),t.onAfterRender(e,n,i)}const u={distanceToCameraSquared:(h=i,c=t,Fs.setFromMatrixPosition(h.matrixWorld),Us.setFromMatrixPosition(c.matrixWorld),Fs.distanceToSquared(Us))};o.objects.set(t,u)}var h,c;for(let e=0,r=t.children.length;e<r;e++)l(t.children[e],n,i)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:n,height:i}},this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),zs.copy(e.matrixWorldInverse),ks.multiplyMatrices(e.projectionMatrix,zs),l(t,t,e),function(t){const e=function(t){const e=[];return t.traverse((function(t){t.isCSS2DObject&&e.push(t)})),e}(t).sort((function(t,e){return t.renderOrder!==e.renderOrder?e.renderOrder-t.renderOrder:o.objects.get(t).distanceToCameraSquared-o.objects.get(e).distanceToCameraSquared})),n=e.length;for(let t=0,i=e.length;t<i;t++)e[t].element.style.zIndex=n-t}(t)},this.setSize=function(t,e){n=t,i=e,r=n/2,s=i/2,a.style.width=t+"px",a.style.height=e+"px"}}}class Vs extends Hs{graphics;constructor(t){super(),this.graphics=t,this.setSize(window.innerWidth,window.innerHeight),this.domElement.id=Os.makeUid("__gLabel_div"),this.domElement.style.position="absolute",this.domElement.style.top="0px",document.body.appendChild(this.domElement)}update(){this.render(this.graphics.scene,this.graphics.camera)}resize(t,e){this.setSize(t,e)}getTopPosition(t){const e=new u.Pa4;if(Os.isMesh(t)){const n=t,i=Os.getBoundingBox(n);i&&(e.y=i.max.y)}return e}toggleLabel(t){Os.isLabelAttached(t)?this.hideLabel(t):this.showLabel(t)}hideLabel(t){t.children.slice().forEach((e=>{Os.isLabel(e)&&t.remove(e)}))}showLabel(t,n){if(Os.isLabelAttached(t))return this;n=n||t.name;const i=document.createElement("div");i.className="label",i.style.marginTop="0px",i.style.borderRadius="4px",i.style.padding="4px 10px 4px 10px",i.style.position="absolute",i.style.display="block",i.style.fontFamily="IBM Plex Mono",i.style.backgroundColor="rgba(0, 0, 0, 0.5)",i.innerHTML=`<i>${n}</i>`;const r=new Bs(i);r.name=`${Os.makeUid(e.Graphics.Label.NamePrefix)}_${t.name}`;const s=this.getTopPosition(t);return s.y+=.2,r.position.copy(s),t.add(r),this}}class Gs{static createAmbientLight(t){const e=new u.Mig;return e.intensity=t||.05,e}static createDirectionalLight(){const t=new u.Ox3;return t.position.set(2,5,-2),t.intensity=1,t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.camera.near=.5,t.shadow.camera.far=100,t.shadow.bias=-5e-4,t}static createDirectionalLightHelper(t){return new u.cBI(t)}static createHemisphereLight(t){const e=new u.vmT;return e.color=new u.Ilk(16772784),e.groundColor=new u.Ilk(8421408),e.intensity=t||.025,e}static createHemisphereLightHelper(t){return new u.Qpg(t,5)}}var Ws={},js=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},qs=function(t){return new Worker(t)};try{URL.revokeObjectURL(js(""))}catch(t){js=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)},qs=function(t){return new Worker(t,{type:"module"})}}var Xs=Uint8Array,Ys=Uint16Array,$s=Uint32Array,Ks=new Xs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Zs=new Xs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Js=new Xs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qs=function(t,e){for(var n=new Ys(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var r=new $s(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},to=Qs(Ks,2),eo=to[0],no=to[1];eo[28]=258,no[258]=28;for(var io=Qs(Zs,0),ro=io[0],so=io[1],oo=new Ys(32768),ao=0;ao<32768;++ao){var lo=(43690&ao)>>>1|(21845&ao)<<1;lo=(61680&(lo=(52428&lo)>>>2|(13107&lo)<<2))>>>4|(3855&lo)<<4,oo[ao]=((65280&lo)>>>8|(255&lo)<<8)>>>1}var ho=function(t,e,n){for(var i=t.length,r=0,s=new Ys(e);r<i;++r)++s[t[r]-1];var o,a=new Ys(e);for(r=0;r<e;++r)a[r]=a[r-1]+s[r-1]<<1;if(n){o=new Ys(1<<e);var l=15-e;for(r=0;r<i;++r)if(t[r])for(var h=r<<4|t[r],c=e-t[r],u=a[t[r]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)o[oo[u]>>>l]=h}else for(o=new Ys(i),r=0;r<i;++r)t[r]&&(o[r]=oo[a[t[r]-1]++]>>>15-t[r]);return o},co=new Xs(288);for(ao=0;ao<144;++ao)co[ao]=8;for(ao=144;ao<256;++ao)co[ao]=9;for(ao=256;ao<280;++ao)co[ao]=7;for(ao=280;ao<288;++ao)co[ao]=8;var uo=new Xs(32);for(ao=0;ao<32;++ao)uo[ao]=5;var po=ho(co,9,0),fo=ho(co,9,1),mo=ho(uo,5,0),go=ho(uo,5,1),vo=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},yo=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},xo=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},bo=function(t){return(t/8|0)+(7&t&&1)},wo=function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var i=new(t instanceof Ys?Ys:t instanceof $s?$s:Xs)(n-e);return i.set(t.subarray(e,n)),i},_o=function(t,e,n){var i=t.length;if(!i||n&&!n.l&&i<5)return e||new Xs(0);var r=!e||n,s=!n||n.i;n||(n={}),e||(e=new Xs(3*i));var o=function(t){var n=e.length;if(t>n){var i=new Xs(Math.max(2*n,t));i.set(e),e=i}},a=n.f||0,l=n.p||0,h=n.b||0,c=n.l,u=n.d,d=n.m,p=n.n,f=8*i;do{if(!c){n.f=a=yo(t,l,1);var m=yo(t,l+1,3);if(l+=3,!m){var g=t[(A=bo(l)+4)-4]|t[A-3]<<8,v=A+g;if(v>i){if(s)throw"unexpected EOF";break}r&&o(h+g),e.set(t.subarray(A,v),h),n.b=h+=g,n.p=l=8*v;continue}if(1==m)c=fo,u=go,d=9,p=5;else{if(2!=m)throw"invalid block type";var y=yo(t,l,31)+257,x=yo(t,l+10,15)+4,b=y+yo(t,l+5,31)+1;l+=14;for(var w=new Xs(b),_=new Xs(19),M=0;M<x;++M)_[Js[M]]=yo(t,l+3*M,7);l+=3*x;var S=vo(_),T=(1<<S)-1,E=ho(_,S,1);for(M=0;M<b;){var A,C=E[yo(t,l,T)];if(l+=15&C,(A=C>>>4)<16)w[M++]=A;else{var P=0,R=0;for(16==A?(R=3+yo(t,l,3),l+=2,P=w[M-1]):17==A?(R=3+yo(t,l,7),l+=3):18==A&&(R=11+yo(t,l,127),l+=7);R--;)w[M++]=P}}var L=w.subarray(0,y),I=w.subarray(y);d=vo(L),p=vo(I),c=ho(L,d,1),u=ho(I,p,1)}if(l>f){if(s)throw"unexpected EOF";break}}r&&o(h+131072);for(var D=(1<<d)-1,O=(1<<p)-1,B=l;;B=l){var N=(P=c[xo(t,l)&D])>>>4;if((l+=15&P)>f){if(s)throw"unexpected EOF";break}if(!P)throw"invalid length/literal";if(N<256)e[h++]=N;else{if(256==N){B=l,c=null;break}var z=N-254;if(N>264){var k=Ks[M=N-257];z=yo(t,l,(1<<k)-1)+eo[M],l+=k}var F=u[xo(t,l)&O],U=F>>>4;if(!F)throw"invalid distance";if(l+=15&F,I=ro[U],U>3&&(k=Zs[U],I+=xo(t,l)&(1<<k)-1,l+=k),l>f){if(s)throw"unexpected EOF";break}r&&o(h+131072);for(var H=h+z;h<H;h+=4)e[h]=e[h-I],e[h+1]=e[h+1-I],e[h+2]=e[h+2-I],e[h+3]=e[h+3-I];h=H}}n.l=c,n.p=B,n.b=h,c&&(a=1,n.m=d,n.d=u,n.n=p)}while(!a);return h==e.length?e:wo(e,0,h)},Mo=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8},So=function(t,e,n){n<<=7&e;var i=e/8|0;t[i]|=n,t[i+1]|=n>>>8,t[i+2]|=n>>>16},To=function(t,e){for(var n=[],i=0;i<t.length;++i)t[i]&&n.push({s:i,f:t[i]});var r=n.length,s=n.slice();if(!r)return[Io,0];if(1==r){var o=new Xs(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(t,e){return t.f-e.f})),n.push({s:-1,f:25001});var a=n[0],l=n[1],h=0,c=1,u=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};c!=r-1;)a=n[n[h].f<n[u].f?h++:u++],l=n[h!=c&&n[h].f<n[u].f?h++:u++],n[c++]={s:-1,f:a.f+l.f,l:a,r:l};var d=s[0].s;for(i=1;i<r;++i)s[i].s>d&&(d=s[i].s);var p=new Ys(d+1),f=Eo(n[c-1],p,0);if(f>e){i=0;var m=0,g=f-e,v=1<<g;for(s.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));i<r;++i){var y=s[i].s;if(!(p[y]>e))break;m+=v-(1<<f-p[y]),p[y]=e}for(m>>>=g;m>0;){var x=s[i].s;p[x]<e?m-=1<<e-p[x]++-1:++i}for(;i>=0&&m;--i){var b=s[i].s;p[b]==e&&(--p[b],++m)}f=e}return[new Xs(p),f]},Eo=function(t,e,n){return-1==t.s?Math.max(Eo(t.l,e,n+1),Eo(t.r,e,n+1)):e[t.s]=n},Ao=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Ys(++e),i=0,r=t[0],s=1,o=function(t){n[i++]=t},a=1;a<=e;++a)if(t[a]==r&&a!=e)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(r);s=1,r=t[a]}return[n.subarray(0,i),e]},Co=function(t,e){for(var n=0,i=0;i<e.length;++i)n+=t[i]*e[i];return n},Po=function(t,e,n){var i=n.length,r=bo(e+2);t[r]=255&i,t[r+1]=i>>>8,t[r+2]=255^t[r],t[r+3]=255^t[r+1];for(var s=0;s<i;++s)t[r+s+4]=n[s];return 8*(r+4+i)},Ro=function(t,e,n,i,r,s,o,a,l,h,c){Mo(e,c++,n),++r[256];for(var u=To(r,15),d=u[0],p=u[1],f=To(s,15),m=f[0],g=f[1],v=Ao(d),y=v[0],x=v[1],b=Ao(m),w=b[0],_=b[1],M=new Ys(19),S=0;S<y.length;++S)M[31&y[S]]++;for(S=0;S<w.length;++S)M[31&w[S]]++;for(var T=To(M,7),E=T[0],A=T[1],C=19;C>4&&!E[Js[C-1]];--C);var P,R,L,I,D=h+5<<3,O=Co(r,co)+Co(s,uo)+o,B=Co(r,d)+Co(s,m)+o+14+3*C+Co(M,E)+(2*M[16]+3*M[17]+7*M[18]);if(D<=O&&D<=B)return Po(e,c,t.subarray(l,l+h));if(Mo(e,c,1+(B<O)),c+=2,B<O){P=ho(d,p,0),R=d,L=ho(m,g,0),I=m;var N=ho(E,A,0);for(Mo(e,c,x-257),Mo(e,c+5,_-1),Mo(e,c+10,C-4),c+=14,S=0;S<C;++S)Mo(e,c+3*S,E[Js[S]]);c+=3*C;for(var z=[y,w],k=0;k<2;++k){var F=z[k];for(S=0;S<F.length;++S){var U=31&F[S];Mo(e,c,N[U]),c+=E[U],U>15&&(Mo(e,c,F[S]>>>5&127),c+=F[S]>>>12)}}}else P=po,R=co,L=mo,I=uo;for(S=0;S<a;++S)if(i[S]>255){U=i[S]>>>18&31,So(e,c,P[U+257]),c+=R[U+257],U>7&&(Mo(e,c,i[S]>>>23&31),c+=Ks[U]);var H=31&i[S];So(e,c,L[H]),c+=I[H],H>3&&(So(e,c,i[S]>>>5&8191),c+=Zs[H])}else So(e,c,P[i[S]]),c+=R[i[S]];return So(e,c,P[256]),c+R[256]},Lo=new $s([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Io=new Xs(0),Do=function(t,e,n,i,r,s){var o=t.length,a=new Xs(i+o+5*(1+Math.ceil(o/7e3))+r),l=a.subarray(i,a.length-r),h=0;if(!e||o<8)for(var c=0;c<=o;c+=65535){var u=c+65535;u<o?h=Po(l,h,t.subarray(c,u)):(l[c]=s,h=Po(l,h,t.subarray(c,o)))}else{for(var d=Lo[e-1],p=d>>>13,f=8191&d,m=(1<<n)-1,g=new Ys(32768),v=new Ys(m+1),y=Math.ceil(n/3),x=2*y,b=function(e){return(t[e]^t[e+1]<<y^t[e+2]<<x)&m},w=new $s(25e3),_=new Ys(288),M=new Ys(32),S=0,T=0,E=(c=0,0),A=0,C=0;c<o;++c){var P=b(c),R=32767&c,L=v[P];if(g[R]=L,v[P]=R,A<=c){var I=o-c;if((S>7e3||E>24576)&&I>423){h=Ro(t,l,0,w,_,M,T,E,C,c-C,h),E=S=T=0,C=c;for(var D=0;D<286;++D)_[D]=0;for(D=0;D<30;++D)M[D]=0}var O=2,B=0,N=f,z=R-L&32767;if(I>2&&P==b(c-z))for(var k=Math.min(p,I)-1,F=Math.min(32767,c),U=Math.min(258,I);z<=F&&--N&&R!=L;){if(t[c+O]==t[c+O-z]){for(var H=0;H<U&&t[c+H]==t[c+H-z];++H);if(H>O){if(O=H,B=z,H>k)break;var V=Math.min(z,H-2),G=0;for(D=0;D<V;++D){var W=c-z+D+32768&32767,j=W-g[W]+32768&32767;j>G&&(G=j,L=W)}}}z+=(R=L)-(L=g[R])+32768&32767}if(B){w[E++]=268435456|no[O]<<18|so[B];var q=31&no[O],X=31&so[B];T+=Ks[q]+Zs[X],++_[257+q],++M[X],A=c+O,++S}else w[E++]=t[c],++_[t[c]]}}h=Ro(t,l,s,w,_,M,T,E,C,c-C,h),!s&&7&h&&(h=Po(l,h+1,Io))}return wo(a,0,i+bo(h)+r)},Oo=function(){for(var t=new $s(256),e=0;e<256;++e){for(var n=e,i=9;--i;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),Bo=function(){var t=-1;return{p:function(e){for(var n=t,i=0;i<e.length;++i)n=Oo[255&n^e[i]]^n>>>8;t=n},d:function(){return~t}}},No=function(){var t=1,e=0;return{p:function(n){for(var i=t,r=e,s=n.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)r+=i+=n[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}t=i,e=r},d:function(){return(255&(t%=65521))<<24|t>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},zo=function(t,e,n,i,r){return Do(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,i,!r)},ko=function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},Fo=function(t,e,n){for(var i=t(),r=t.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=s[o];if("function"==typeof a){e+=";"+l+"=";var h=a.toString();if(a.prototype)if(-1!=h.indexOf("[native code]")){var c=h.indexOf(" ",8)+1;e+=h.slice(c,h.indexOf("(",c))}else for(var u in e+=h,a.prototype)e+=";"+l+".prototype."+u+"="+a.prototype[u].toString();else e+=h}else n[l]=a}return[e,n]},Uo=[],Ho=function(t,e,n,i){var r;if(!Uo[n]){for(var s="",o={},a=t.length-1,l=0;l<a;++l)s=(r=Fo(t[l],s,o))[0],o=r[1];Uo[n]=Fo(t[a],s,o)}var h=ko({},Uo[n][1]);return function(t,e,n,i,r){var s=qs(Ws[e]||(Ws[e]=js(t)));return s.onerror=function(t){return r(t.error,null)},s.onmessage=function(t){return r(null,t.data)},s.postMessage(n,i),s}(Uo[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,h,function(t){var e=[];for(var n in t)(t[n]instanceof Xs||t[n]instanceof Ys||t[n]instanceof $s)&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e}(h),i)},Vo=function(){return[Xs,Ys,$s,Ks,Zs,Js,eo,ro,fo,go,oo,ho,vo,yo,xo,bo,wo,_o,va,Yo,$o]},Go=function(){return[Xs,Ys,$s,Ks,Zs,Js,no,so,po,co,mo,uo,oo,Lo,Io,ho,Mo,So,To,Eo,Ao,Co,Po,Ro,bo,wo,Do,zo,pa,Yo]},Wo=function(){return[ia,oa,na,Bo,Oo]},jo=function(){return[ra,sa]},qo=function(){return[aa,na,No]},Xo=function(){return[la]},Yo=function(t){return postMessage(t,[t.buffer])},$o=function(t){return t&&t.size&&new Xs(t.size)},Ko=function(t,e,n,i,r,s){var o=Ho(n,i,r,(function(t,e){o.terminate(),s(t,e)}));return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}},Zo=function(t){return t.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(e){return t.push(e.data[0],e.data[1])}},Jo=function(t,e,n,i,r){var s,o=Ho(t,i,r,(function(t,n){t?(o.terminate(),e.ondata.call(e,t)):(n[1]&&o.terminate(),e.ondata.call(e,t,n[0],n[1]))}));o.postMessage(n),e.push=function(t,n){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([t,s=n],[t.buffer])},e.terminate=function(){o.terminate()}},Qo=function(t,e){return t[e]|t[e+1]<<8},ta=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},ea=function(t,e){return ta(t,e)+4294967296*ta(t,e+4)},na=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},ia=function(t,e){var n=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&na(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),n){t[3]=8;for(var i=0;i<=n.length;++i)t[i+10]=n.charCodeAt(i)}},ra=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var e=t[3],n=10;4&e&&(n+=t[10]|2+(t[11]<<8));for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[n++]);return n+(2&e)},sa=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},oa=function(t){return 10+(t.filename&&t.filename.length+1||0)},aa=function(t,e){var n=e.level,i=0==n?0:n<6?1:9==n?3:2;t[0]=120,t[1]=i<<6|(i?32-2*i:1)},la=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function ha(t,e){return e||"function"!=typeof t||(e=t,t={}),this.ondata=e,t}var ca=function(){function t(t,e){e||"function"!=typeof t||(e=t,t={}),this.ondata=e,this.o=t||{}}return t.prototype.p=function(t,e){this.ondata(zo(t,this.o,0,0,!e),e)},t.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},t}(),ua=function(){return function(t,e){Jo([Go,function(){return[Zo,ca]}],this,ha.call(this,t,e),(function(t){var e=new ca(t.data);onmessage=Zo(e)}),6)}}();function da(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Ko(t,e,[Go],(function(t){return Yo(pa(t.data[0],t.data[1]))}),0,n)}function pa(t,e){return zo(t,e||{},0,0)}var fa=function(){function t(t){this.s={},this.p=new Xs(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,n=new Xs(e+t.length);n.set(this.p),n.set(t,e),this.p=n},t.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,n=_o(this.p,this.o,this.s);this.ondata(wo(n,e,this.s.b),this.d),this.o=wo(n,this.s.b-32768),this.s.b=this.o.length,this.p=wo(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,e){this.e(t),this.c(e)},t}(),ma=function(){return function(t){this.ondata=t,Jo([Vo,function(){return[Zo,fa]}],this,0,(function(){var t=new fa;onmessage=Zo(t)}),7)}}();function ga(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Ko(t,e,[Vo],(function(t){return Yo(va(t.data[0],$o(t.data[1])))}),1,n)}function va(t,e){return _o(t,e)}var ya=function(){function t(t,e){this.c=Bo(),this.l=0,this.v=1,ca.call(this,t,e)}return t.prototype.push=function(t,e){ca.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var n=zo(t,this.o,this.v&&oa(this.o),e&&8,!e);this.v&&(ia(n,this.o),this.v=0),e&&(na(n,n.length-8,this.c.d()),na(n,n.length-4,this.l)),this.ondata(n,e)},t}(),xa=function(){return function(t,e){Jo([Go,Wo,function(){return[Zo,ca,ya]}],this,ha.call(this,t,e),(function(t){var e=new ya(t.data);onmessage=Zo(e)}),8)}}();function ba(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Ko(t,e,[Go,Wo,function(){return[wa]}],(function(t){return Yo(wa(t.data[0],t.data[1]))}),2,n)}function wa(t,e){e||(e={});var n=Bo(),i=t.length;n.p(t);var r=zo(t,e,oa(e),8),s=r.length;return ia(r,e),na(r,s-8,n.d()),na(r,s-4,i),r}var _a=function(){function t(t){this.v=1,fa.call(this,t)}return t.prototype.push=function(t,e){if(fa.prototype.e.call(this,t),this.v){var n=this.p.length>3?ra(this.p):4;if(n>=this.p.length&&!e)return;this.p=this.p.subarray(n),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}fa.prototype.c.call(this,e)},t}(),Ma=function(){return function(t){this.ondata=t,Jo([Vo,jo,function(){return[Zo,fa,_a]}],this,0,(function(){var t=new _a;onmessage=Zo(t)}),9)}}();function Sa(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Ko(t,e,[Vo,jo,function(){return[Ta]}],(function(t){return Yo(Ta(t.data[0]))}),3,n)}function Ta(t,e){return _o(t.subarray(ra(t),-8),e||new Xs(sa(t)))}var Ea=function(){function t(t,e){this.c=No(),this.v=1,ca.call(this,t,e)}return t.prototype.push=function(t,e){ca.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t);var n=zo(t,this.o,this.v&&2,e&&4,!e);this.v&&(aa(n,this.o),this.v=0),e&&na(n,n.length-4,this.c.d()),this.ondata(n,e)},t}(),Aa=function(){return function(t,e){Jo([Go,qo,function(){return[Zo,ca,Ea]}],this,ha.call(this,t,e),(function(t){var e=new Ea(t.data);onmessage=Zo(e)}),10)}}();function Ca(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Ko(t,e,[Go,qo,function(){return[Pa]}],(function(t){return Yo(Pa(t.data[0],t.data[1]))}),4,n)}function Pa(t,e){e||(e={});var n=No();n.p(t);var i=zo(t,e,2,4);return aa(i,e),na(i,i.length-4,n.d()),i}var Ra=function(){function t(t){this.v=1,fa.call(this,t)}return t.prototype.push=function(t,e){if(fa.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}fa.prototype.c.call(this,e)},t}(),La=function(){return function(t){this.ondata=t,Jo([Vo,Xo,function(){return[Zo,fa,Ra]}],this,0,(function(){var t=new Ra;onmessage=Zo(t)}),11)}}();function Ia(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return Ko(t,e,[Vo,Xo,function(){return[Da]}],(function(t){return Yo(Da(t.data[0],$o(t.data[1])))}),5,n)}function Da(t,e){return _o((la(t),t.subarray(2,-4)),e)}var Oa=function(){function t(t){this.G=_a,this.I=fa,this.Z=Ra,this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var n=new Xs(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(r):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,e),this.p=null}}},t}(),Ba=function(){function t(t){this.G=Ma,this.I=ma,this.Z=La,this.ondata=t}return t.prototype.push=function(t,e){Oa.prototype.push.call(this,t,e)},t}();function Na(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return 31==t[0]&&139==t[1]&&8==t[2]?Sa(t,e,n):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?ga(t,e,n):Ia(t,e,n)}function za(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?Ta(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?va(t,e):Da(t,e)}var ka=function(t,e,n,i){for(var r in t){var s=t[r],o=e+r;s instanceof Xs?n[o]=[s,i]:Array.isArray(s)?n[o]=[s[0],ko(i,s[1])]:ka(s,o+"/",n,i)}},Fa="undefined"!=typeof TextEncoder&&new TextEncoder,Ua="undefined"!=typeof TextDecoder&&new TextDecoder,Ha=0;try{Ua.decode(Io,{stream:!0}),Ha=1}catch(t){}var Va=function(t){for(var e="",n=0;;){var i=t[n++],r=(i>127)+(i>223)+(i>239);if(n+r>t.length)return[e,wo(t,n-1)];r?3==r?(i=((15&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=1&r?String.fromCharCode((31&i)<<6|63&t[n++]):String.fromCharCode((15&i)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(i)}},Ga=function(){function t(t){this.ondata=t,Ha?this.t=new TextDecoder:this.p=Io}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new Xs(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length);var i=Va(n),r=i[0],s=i[1];if(e){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,e)}},t}(),Wa=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(ja(t),this.d=e||!1)},t}();function ja(t,e){if(e){for(var n=new Xs(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}if(Fa)return Fa.encode(t);var r=t.length,s=new Xs(t.length+(t.length>>1)),o=0,a=function(t){s[o++]=t};for(i=0;i<r;++i){if(o+5>s.length){var l=new Xs(o+8+(r-i<<1));l.set(s),s=l}var h=t.charCodeAt(i);h<128||e?a(h):h<2048?(a(192|h>>6),a(128|63&h)):h>55295&&h<57344?(a(240|(h=65536+(1047552&h)|1023&t.charCodeAt(++i))>>18),a(128|h>>12&63),a(128|h>>6&63),a(128|63&h)):(a(224|h>>12),a(128|h>>6&63),a(128|63&h))}return wo(s,0,o)}function qa(t,e){if(e){for(var n="",i=0;i<t.length;i+=16384)n+=String.fromCharCode.apply(null,t.subarray(i,i+16384));return n}if(Ua)return Ua.decode(t);var r=Va(t),s=r[0];if(r[1].length)throw"invalid utf-8 data";return s}var Xa=function(t){return 1==t?3:t<6?2:9==t?1:0},Ya=function(t,e){return e+30+Qo(t,e+26)+Qo(t,e+28)},$a=function(t,e,n){var i=Qo(t,e+28),r=qa(t.subarray(e+46,e+46+i),!(2048&Qo(t,e+8))),s=e+46+i,o=ta(t,e+20),a=n&&4294967295==o?Ka(t,s):[o,ta(t,e+24),ta(t,e+42)],l=a[0],h=a[1],c=a[2];return[Qo(t,e+10),l,h,r,s+Qo(t,e+30)+Qo(t,e+32),c]},Ka=function(t,e){for(;1!=Qo(t,e);e+=4+Qo(t,e+2));return[ea(t,e+12),ea(t,e+4),ea(t,e+20)]},Za=function(t){var e=0;if(t)for(var n in t){var i=t[n].length;if(i>65535)throw"extra field too long";e+=i+4}return e},Ja=function(t,e,n,i,r,s,o,a){var l=i.length,h=n.extra,c=a&&a.length,u=Za(h);na(t,e,null!=o?33639248:67324752),e+=4,null!=o&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(null==s&&8),t[e++]=r&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(na(t,e,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),e+=4,null!=s&&(na(t,e,n.crc),na(t,e+4,s),na(t,e+8,n.size)),na(t,e+12,l),na(t,e+14,u),e+=16,null!=o&&(na(t,e,c),na(t,e+6,n.attrs),na(t,e+10,o),e+=14),t.set(i,e),e+=l,u)for(var f in h){var m=h[f],g=m.length;na(t,e,+f),na(t,e+2,g),t.set(m,e+4),e+=4+g}return c&&(t.set(a,e),e+=c),e},Qa=function(t,e,n,i,r){na(t,e,101010256),na(t,e+8,n),na(t,e+10,n),na(t,e+12,i),na(t,e+16,r)},tl=function(){function t(t){this.filename=t,this.c=Bo(),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),el=function(){function t(t,e){var n=this;e||(e={}),tl.call(this,t),this.d=new ca(e,(function(t,e){n.ondata(null,t,e)})),this.compression=8,this.flag=Xa(e.level)}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(t){this.ondata(t,null,e)}},t.prototype.push=function(t,e){tl.prototype.push.call(this,t,e)},t}(),nl=function(){function t(t,e){var n=this;e||(e={}),tl.call(this,t),this.d=new ua(e,(function(t,e,i){n.ondata(t,e,i)})),this.compression=8,this.flag=Xa(e.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,e){this.d.push(t,e)},t.prototype.push=function(t,e){tl.prototype.push.call(this,t,e)},t}(),il=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var e=this;if(2&this.d)throw"stream finished";var n=ja(t.filename),i=n.length,r=t.comment,s=r&&ja(r),o=i!=t.filename.length||s&&r.length!=s.length,a=i+Za(t.extra)+30;if(i>65535)throw"filename too long";var l=new Xs(a);Ja(l,0,t,n,o);var h=[l],c=function(){for(var t=0,n=h;t<n.length;t++){var i=n[t];e.ondata(null,i,!1)}h=[]},u=this.d;this.d=0;var d=this.u.length,p=ko(t,{f:n,u:o,o:s,t:function(){t.terminate&&t.terminate()},r:function(){if(c(),u){var t=e.u[d+1];t?t.r():e.d=1}u=1}}),f=0;t.ondata=function(n,i,r){if(n)e.ondata(n,i,r),e.terminate();else if(f+=i.length,h.push(i),r){var s=new Xs(16);na(s,0,134695760),na(s,4,t.crc),na(s,8,f),na(s,12,t.size),h.push(s),p.c=f,p.b=a+f+16,p.crc=t.crc,p.size=t.size,u&&p.r(),u=1}else u&&c()},this.u.push(p)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,e=0,n=0,i=0,r=this.u;i<r.length;i++)n+=46+(l=r[i]).f.length+Za(l.extra)+(l.o?l.o.length:0);for(var s=new Xs(n+22),o=0,a=this.u;o<a.length;o++){var l=a[o];Ja(s,t,l,l.f,l.u,l.c,e,l.o),t+=46+l.f.length+Za(l.extra)+(l.o?l.o.length:0),e+=l.b}Qa(s,t,this.u.length,n,e),this.ondata(null,s,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++)e[t].t();this.d=2},t}();function rl(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";var i={};ka(t,"",i,e);var r=Object.keys(i),s=r.length,o=0,a=0,l=s,h=new Array(s),c=[],u=function(){for(var t=0;t<c.length;++t)c[t]()},d=function(){var t=new Xs(a+22),e=o,i=a-o;a=0;for(var r=0;r<l;++r){var s=h[r];try{var c=s.c.length;Ja(t,a,s,s.f,s.u,c);var u=30+s.f.length+Za(s.extra),d=a+u;t.set(s.c,d),Ja(t,o,s,s.f,s.u,c,a,s.m),o+=16+u+(s.m?s.m.length:0),a=d+c}catch(t){return n(t,null)}}Qa(t,o,h.length,i,e),n(null,t)};s||d();for(var p=function(t){var e=r[t],l=i[e],p=l[0],f=l[1],m=Bo(),g=p.length;m.p(p);var v=ja(e),y=v.length,x=f.comment,b=x&&ja(x),w=b&&b.length,_=Za(f.extra),M=0==f.level?0:8,S=function(i,r){if(i)u(),n(i,null);else{var l=r.length;h[t]=ko(f,{size:g,crc:m.d(),c:r,f:v,m:b,u:y!=e.length||b&&x.length!=w,compression:M}),o+=30+y+_+l,a+=76+2*(y+_)+(w||0)+l,--s||d()}};if(y>65535&&S("filename too long",null),M)if(g<16e4)try{S(null,pa(p,f))}catch(t){S(t,null)}else c.push(da(p,f,S));else S(null,p)},f=0;f<l;++f)p(f);return u}function sl(t,e){e||(e={});var n={},i=[];ka(t,"",n,e);var r=0,s=0;for(var o in n){var a=n[o],l=a[0],h=a[1],c=0==h.level?0:8,u=(M=ja(o)).length,d=h.comment,p=d&&ja(d),f=p&&p.length,m=Za(h.extra);if(u>65535)throw"filename too long";var g=c?pa(l,h):l,v=g.length,y=Bo();y.p(l),i.push(ko(h,{size:l.length,crc:y.d(),c:g,f:M,m:p,u:u!=o.length||p&&d.length!=f,o:r,compression:c})),r+=30+u+m+v,s+=76+2*(u+m)+(f||0)+v}for(var x=new Xs(s+22),b=r,w=s-r,_=0;_<i.length;++_){var M=i[_];Ja(x,M.o,M,M.f,M.u,M.c.length);var S=30+M.f.length+Za(M.extra);x.set(M.c,M.o+S),Ja(x,r,M,M.f,M.u,M.c.length,M.o,M.m),r+=16+S+(M.m?M.m.length:0)}return Qa(x,r,i.length,w,b),x}var ol=function(){function t(){}return t.prototype.push=function(t,e){this.ondata(null,t,e)},t.compression=0,t}(),al=function(){function t(){var t=this;this.i=new fa((function(e,n){t.ondata(null,e,n)}))}return t.prototype.push=function(t,e){try{this.i.push(t,e)}catch(n){this.ondata(n,t,e)}},t.compression=8,t}(),ll=function(){function t(t,e){var n=this;e<32e4?this.i=new fa((function(t,e){n.ondata(null,t,e)})):(this.i=new ma((function(t,e,i){n.ondata(t,e,i)})),this.terminate=this.i.terminate)}return t.prototype.push=function(t,e){this.i.terminate&&(t=wo(t,0)),this.i.push(t,e)},t.compression=8,t}(),hl=function(){function t(t){this.onfile=t,this.k=[],this.o={0:ol},this.p=Io}return t.prototype.push=function(t,e){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,t.length),r=t.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),(t=t.subarray(i)).length)return this.push(t,e)}else{var s=0,o=0,a=void 0,l=void 0;this.p.length?t.length?((l=new Xs(this.p.length+t.length)).set(this.p),l.set(t,this.p.length)):l=this.p:l=t;for(var h=l.length,c=this.c,u=c&&this.d,d=function(){var t,e=ta(l,o);if(67324752==e){s=1,a=o,p.d=null,p.c=0;var i=Qo(l,o+6),r=Qo(l,o+8),u=2048&i,d=8&i,f=Qo(l,o+26),m=Qo(l,o+28);if(h>o+30+f+m){var g=[];p.k.unshift(g),s=2;var v,y=ta(l,o+18),x=ta(l,o+22),b=qa(l.subarray(o+30,o+=30+f),!u);4294967295==y?(t=d?[-2]:Ka(l,o),y=t[0],x=t[1]):d&&(y=-1),o+=m,p.c=y;var w={name:b,compression:r,start:function(){if(!w.ondata)throw"no callback";if(y){var t=n.o[r];if(!t)throw"unknown compression type "+r;(v=y<0?new t(b):new t(b,y,x)).ondata=function(t,e,n){w.ondata(t,e,n)};for(var e=0,i=g;e<i.length;e++){var s=i[e];v.push(s,!1)}n.k[0]==g&&n.c?n.d=v:v.push(Io,!0)}else w.ondata(null,Io,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(w.size=y,w.originalSize=x),p.onfile(w)}return"break"}if(c){if(134695760==e)return a=o+=12+(-2==c&&8),s=3,p.c=0,"break";if(33639248==e)return a=o-=4,s=3,p.c=0,"break"}},p=this;o<h-4&&"break"!==d();++o);if(this.p=Io,c<0){var f=s?l.subarray(0,a-12-(-2==c&&8)-(134695760==ta(l,a-16)&&4)):l.subarray(0,o);u?u.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(o),e);this.p=l.subarray(o)}if(e){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();function cl(t,e){if("function"!=typeof e)throw"no callback";for(var n=[],i=function(){for(var t=0;t<n.length;++t)n[t]()},r={},s=t.length-22;101010256!=ta(t,s);--s)if(!s||t.length-s>65558)return void e("invalid zip file",null);var o=Qo(t,s+8);o||e(null,{});var a=o,l=ta(t,s+16),h=4294967295==l;if(h){if(s=ta(t,s-12),101075792!=ta(t,s))return void e("invalid zip file",null);a=o=ta(t,s+32),l=ta(t,s+48)}for(var c=function(s){var a=$a(t,l,h),c=a[0],u=a[1],d=a[2],p=a[3],f=a[4],m=a[5],g=Ya(t,m);l=f;var v=function(t,n){t?(i(),e(t,null)):(r[p]=n,--o||e(null,r))};if(c)if(8==c){var y=t.subarray(g,g+u);if(u<32e4)try{v(null,va(y,new Xs(d)))}catch(t){v(t,null)}else n.push(ga(y,{size:d},v))}else v("unknown compression type "+c,null);else v(null,wo(t,g,g+u))},u=0;u<a;++u)c();return i}function ul(t){for(var e={},n=t.length-22;101010256!=ta(t,n);--n)if(!n||t.length-n>65558)throw"invalid zip file";var i=Qo(t,n+8);if(!i)return{};var r=ta(t,n+16),s=4294967295==r;if(s){if(n=ta(t,n-12),101075792!=ta(t,n))throw"invalid zip file";i=ta(t,n+32),r=ta(t,n+48)}for(var o=0;o<i;++o){var a=$a(t,r,s),l=a[0],h=a[1],c=a[2],u=a[3],d=a[4],p=a[5],f=Ya(t,p);if(r=d,l){if(8!=l)throw"unknown compression type "+l;e[u]=va(t.subarray(f,f+h),new Xs(c))}else e[u]=wo(t,f,f+h)}return e}class dl extends u.yxD{constructor(t){super(t),this.type=u.cLu}parse(e){const n=65536,i=14,r=65537,s=Math.pow(2.7182818,2.2),o={l:0,c:0,lc:0};function a(t,e,n,i,r){for(;n<t;)e=e<<8|F(i,r),n+=8;n-=t,o.l=e>>n&(1<<t)-1,o.c=e,o.lc=n}const l=new Array(59);function h(t){return 63&t}function c(t){return t>>6}const d={c:0,lc:0};function p(t,e,n,i){t=t<<8|F(n,i),e+=8,d.c=t,d.lc=e}const f={c:0,lc:0};function m(t,e,n,i,r,s,o,a,l){if(t==e){i<8&&(p(n,i,r,s),n=d.c,i=d.lc);let t=n>>(i-=8);if(t=new Uint8Array([t])[0],a.value+t>l)return!1;const e=o[a.value-1];for(;t-- >0;)o[a.value++]=e}else{if(!(a.value<l))return!1;o[a.value++]=t}f.c=n,f.lc=i}function g(t){return 65535&t}function v(t){const e=g(t);return e>32767?e-65536:e}const y={a:0,b:0};function x(t,e){const n=v(t),i=v(e),r=n+(1&i)+(i>>1),s=r,o=r-i;y.a=s,y.b=o}function b(t,e){const n=g(t),i=g(e),r=n-(i>>1)&65535,s=i+r-32768&65535;y.a=s,y.b=r}function w(t,e,n,i,r,s,o){const a=o<16384,l=n>r?r:n;let h,c,u=1;for(;u<=l;)u<<=1;for(u>>=1,h=u,u>>=1;u>=1;){c=0;const o=c+s*(r-h),l=s*u,d=s*h,p=i*u,f=i*h;let m,g,v,w;for(;c<=o;c+=d){let r=c;const s=c+i*(n-h);for(;r<=s;r+=f){const n=r+p,i=r+l,s=i+p;a?(x(t[r+e],t[i+e]),m=y.a,v=y.b,x(t[n+e],t[s+e]),g=y.a,w=y.b,x(m,g),t[r+e]=y.a,t[n+e]=y.b,x(v,w),t[i+e]=y.a,t[s+e]=y.b):(b(t[r+e],t[i+e]),m=y.a,v=y.b,b(t[n+e],t[s+e]),g=y.a,w=y.b,b(m,g),t[r+e]=y.a,t[n+e]=y.b,b(v,w),t[i+e]=y.a,t[s+e]=y.b)}if(n&u){const n=r+l;a?x(t[r+e],t[n+e]):b(t[r+e],t[n+e]),m=y.a,t[n+e]=y.b,t[r+e]=m}}if(r&u){let r=c;const s=c+i*(n-h);for(;r<=s;r+=f){const n=r+p;a?x(t[r+e],t[n+e]):b(t[r+e],t[n+e]),m=y.a,t[n+e]=y.b,t[r+e]=m}}h=u,u>>=1}return c}function _(t,e,n,s,u,g){const v=n.value,y=k(e,n),x=k(e,n);n.value+=4;const b=k(e,n);if(n.value+=4,y<0||y>=r||x<0||x>=r)throw new Error("Something wrong with HUF_ENCSIZE");const w=new Array(r),_=new Array(16384);if(function(t){for(let e=0;e<16384;e++)t[e]={},t[e].len=0,t[e].lit=0,t[e].p=null}(_),function(t,e,n,i,s,h){const c=e;let u=0,d=0;for(;i<=s;i++){if(c.value-e.value>n)return!1;a(6,u,d,t,c);const r=o.l;if(u=o.c,d=o.lc,h[i]=r,63==r){if(c.value-e.value>n)throw new Error("Something wrong with hufUnpackEncTable");a(8,u,d,t,c);let r=o.l+6;if(u=o.c,d=o.lc,i+r>s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;r--;)h[i++]=0;i--}else if(r>=59){let t=r-59+2;if(i+t>s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;t--;)h[i++]=0;i--}}!function(t){for(let t=0;t<=58;++t)l[t]=0;for(let e=0;e<r;++e)l[t[e]]+=1;let e=0;for(let t=58;t>0;--t){const n=e+l[t]>>1;l[t]=e,e=n}for(let e=0;e<r;++e){const n=t[e];n>0&&(t[e]=n|l[n]++<<6)}}(h)}(t,n,s-(n.value-v),y,x,w),b>8*(s-(n.value-v)))throw new Error("Something wrong with hufUncompress");!function(t,e,n,r){for(;e<=n;e++){const n=c(t[e]),s=h(t[e]);if(n>>s)throw new Error("Invalid table entry");if(s>i){const t=r[n>>s-i];if(t.len)throw new Error("Invalid table entry");if(t.lit++,t.p){const e=t.p;t.p=new Array(t.lit);for(let n=0;n<t.lit-1;++n)t.p[n]=e[n]}else t.p=new Array(1);t.p[t.lit-1]=e}else if(s){let t=0;for(let o=1<<i-s;o>0;o--){const o=r[(n<<i-s)+t];if(o.len||o.p)throw new Error("Invalid table entry");o.len=s,o.lit=e,t++}}}}(w,y,x,_),function(t,e,n,r,s,o,a,l,u){let g=0,v=0;const y=a,x=Math.trunc(r.value+(s+7)/8);for(;r.value<x;)for(p(g,v,n,r),g=d.c,v=d.lc;v>=i;){const s=e[g>>v-i&16383];if(s.len)v-=s.len,m(s.lit,o,g,v,n,r,l,u,y),g=f.c,v=f.lc;else{if(!s.p)throw new Error("hufDecode issues");let e;for(e=0;e<s.lit;e++){const i=h(t[s.p[e]]);for(;v<i&&r.value<x;)p(g,v,n,r),g=d.c,v=d.lc;if(v>=i&&c(t[s.p[e]])==(g>>v-i&(1<<i)-1)){v-=i,m(s.p[e],o,g,v,n,r,l,u,y),g=f.c,v=f.lc;break}}if(e==s.lit)throw new Error("hufDecode issues")}}const b=8-s&7;for(g>>=b,v-=b;v>0;){const t=e[g<<i-v&16383];if(!t.len)throw new Error("hufDecode issues");v-=t.len,m(t.lit,o,g,v,n,r,l,u,y),g=f.c,v=f.lc}}(w,_,t,n,b,x,g,u,{value:0})}function M(t){for(let e=1;e<t.length;e++){const n=t[e-1]+t[e]-128;t[e]=n}}function S(t,e){let n=0,i=Math.floor((t.length+1)/2),r=0;const s=t.length-1;for(;!(r>s||(e[r++]=t[n++],r>s));)e[r++]=t[i++]}function T(t){let e=t.byteLength;const n=new Array;let i=0;const r=new DataView(t);for(;e>0;){const t=r.getInt8(i++);if(t<0){const s=-t;e-=s+1;for(let t=0;t<s;t++)n.push(r.getUint8(i++))}else{const s=t;e-=2;const o=r.getUint8(i++);for(let t=0;t<s+1;t++)n.push(o)}}return n}function E(t,e,n){let i,r=1;for(;r<64;)i=e[t.value],65280==i?r=64:i>>8==255?r+=255&i:(n[r]=i,r++),t.value++}function A(t){const e=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),i=.5*Math.cos(3.14159/8),r=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625),l=new Array(4),h=new Array(4),c=new Array(4),u=new Array(4);for(let d=0;d<8;++d){const p=8*d;l[0]=i*t[p+2],l[1]=o*t[p+2],l[2]=i*t[p+6],l[3]=o*t[p+6],h[0]=n*t[p+1]+r*t[p+3]+s*t[p+5]+a*t[p+7],h[1]=r*t[p+1]-a*t[p+3]-n*t[p+5]-s*t[p+7],h[2]=s*t[p+1]-n*t[p+3]+a*t[p+5]+r*t[p+7],h[3]=a*t[p+1]-s*t[p+3]+r*t[p+5]-n*t[p+7],c[0]=e*(t[p+0]+t[p+4]),c[3]=e*(t[p+0]-t[p+4]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],t[p+0]=u[0]+h[0],t[p+1]=u[1]+h[1],t[p+2]=u[2]+h[2],t[p+3]=u[3]+h[3],t[p+4]=u[3]-h[3],t[p+5]=u[2]-h[2],t[p+6]=u[1]-h[1],t[p+7]=u[0]-h[0]}for(let d=0;d<8;++d)l[0]=i*t[16+d],l[1]=o*t[16+d],l[2]=i*t[48+d],l[3]=o*t[48+d],h[0]=n*t[8+d]+r*t[24+d]+s*t[40+d]+a*t[56+d],h[1]=r*t[8+d]-a*t[24+d]-n*t[40+d]-s*t[56+d],h[2]=s*t[8+d]-n*t[24+d]+a*t[40+d]+r*t[56+d],h[3]=a*t[8+d]-s*t[24+d]+r*t[40+d]-n*t[56+d],c[0]=e*(t[d]+t[32+d]),c[3]=e*(t[d]-t[32+d]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],t[0+d]=u[0]+h[0],t[8+d]=u[1]+h[1],t[16+d]=u[2]+h[2],t[24+d]=u[3]+h[3],t[32+d]=u[3]-h[3],t[40+d]=u[2]-h[2],t[48+d]=u[1]-h[1],t[56+d]=u[0]-h[0]}function C(t){for(let e=0;e<64;++e){const n=t[0][e],i=t[1][e],r=t[2][e];t[0][e]=n+1.5747*r,t[1][e]=n-.1873*i-.4682*r,t[2][e]=n+1.8556*i}}function P(t,e,n){for(let r=0;r<64;++r)e[n+r]=u.A5E.toHalfFloat((i=t[r])<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(s,Math.abs(i)-1));var i}function R(t){return new DataView(t.array.buffer,t.offset.value,t.size)}function L(t){const e=t.viewer.buffer.slice(t.offset.value,t.offset.value+t.size),n=new Uint8Array(T(e)),i=new Uint8Array(n.length);return M(n),S(n,i),new DataView(i.buffer)}function I(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===t&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const i=Da(n),r=new Uint8Array(i.length);return M(i),S(i,r),new DataView(r.buffer)}function D(t){const e=t.viewer,i={value:t.offset.value},r=new Uint16Array(t.width*t.scanlineBlockSize*(t.channels*t.type)),s=new Uint8Array(8192);let o=0;const a=new Array(t.channels);for(let e=0;e<t.channels;e++)a[e]={},a[e].start=o,a[e].end=a[e].start,a[e].nx=t.width,a[e].ny=t.lines,a[e].size=t.type,o+=a[e].nx*a[e].ny*a[e].size;const l=j(e,i),h=j(e,i);if(h>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=h)for(let t=0;t<h-l+1;t++)s[t+l]=U(e,i);const c=new Uint16Array(n),u=function(t,e){let i=0;for(let r=0;r<n;++r)(0==r||t[r>>3]&1<<(7&r))&&(e[i++]=r);const r=i-1;for(;i<n;)e[i++]=0;return r}(s,c),d=k(e,i);_(t.array,e,i,d,r,o);for(let e=0;e<t.channels;++e){const t=a[e];for(let n=0;n<a[e].size;++n)w(r,t.start+n,t.nx,t.size,t.ny,t.nx*t.size,u)}!function(t,e,n){for(let i=0;i<n;++i)e[i]=t[e[i]]}(c,r,o);let p=0;const f=new Uint8Array(r.buffer.byteLength);for(let e=0;e<t.lines;e++)for(let e=0;e<t.channels;e++){const t=a[e],n=t.nx*t.size,i=new Uint8Array(r.buffer,2*t.end,2*n);f.set(i,p),p+=2*n,t.end+=n}return new DataView(f.buffer)}function O(e){const n=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===t&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const i=Da(n),r=e.lines*e.channels*e.width,s=1==e.type?new Uint16Array(r):new Uint32Array(r);let o=0,a=0;const l=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:l[0]=o,l[1]=l[0]+e.width,o=l[1]+e.width;for(let n=0;n<e.width;++n)t+=i[l[0]++]<<8|i[l[1]++],s[a]=t,a++;break;case 2:l[0]=o,l[1]=l[0]+e.width,l[2]=l[1]+e.width,o=l[2]+e.width;for(let n=0;n<e.width;++n)t+=i[l[0]++]<<24|i[l[1]++]<<16|i[l[2]++]<<8,s[a]=t,a++}}return new DataView(s.buffer)}function B(t){const e=t.viewer,n={value:t.offset.value},i=new Uint8Array(t.width*t.lines*(t.channels*t.type*2)),r={version:H(e,n),unknownUncompressedSize:H(e,n),unknownCompressedSize:H(e,n),acCompressedSize:H(e,n),dcCompressedSize:H(e,n),rleCompressedSize:H(e,n),rleUncompressedSize:H(e,n),rleRawSize:H(e,n),totalAcUncompressedCount:H(e,n),totalDcUncompressedCount:H(e,n),acCompression:H(e,n)};if(r.version<2)throw new Error("EXRLoader.parse: "+Z.compression+" version "+r.version+" is unsupported");const s=new Array;let o=j(e,n)-2;for(;o>0;){const t=N(e.buffer,n),i=U(e,n),r=i>>2&3,a=new Int8Array([(i>>4)-1])[0],l=U(e,n);s.push({name:t,index:a,type:l,compression:r}),o-=t.length+3}const a=Z.channels,l=new Array(t.channels);for(let e=0;e<t.channels;++e){const n=l[e]={},i=a[e];n.name=i.name,n.compression=0,n.decoded=!1,n.type=i.pixelType,n.pLinear=i.pLinear,n.width=t.width,n.height=t.lines}const h={idx:new Array(3)};for(let e=0;e<t.channels;++e){const t=l[e];for(let n=0;n<s.length;++n){const i=s[n];t.name==i.name&&(t.compression=i.compression,i.index>=0&&(h.idx[i.index]=e),t.offset=e)}}let c,u,d;if(r.acCompressedSize>0)switch(r.acCompression){case 0:c=new Uint16Array(r.totalAcUncompressedCount),_(t.array,e,n,r.acCompressedSize,c,r.totalAcUncompressedCount);break;case 1:const i=Da(t.array.slice(n.value,n.value+r.totalAcUncompressedCount));c=new Uint16Array(i.buffer),n.value+=r.totalAcUncompressedCount}if(r.dcCompressedSize>0){const e={array:t.array,offset:n,size:r.dcCompressedSize};u=new Uint16Array(I(e).buffer),n.value+=r.dcCompressedSize}r.rleRawSize>0&&(d=T(Da(t.array.slice(n.value,n.value+r.rleCompressedSize)).buffer),n.value+=r.rleCompressedSize);let p=0;const f=new Array(l.length);for(let t=0;t<f.length;++t)f[t]=new Array;for(let e=0;e<t.lines;++e)for(let e=0;e<l.length;++e)f[e].push(p),p+=l[e].width*t.type*2;!function(t,e,n,i,r,s){let o=new DataView(s.buffer);const a=n[t.idx[0]].width,l=n[t.idx[0]].height,h=Math.floor(a/8),c=Math.ceil(a/8),u=Math.ceil(l/8),d=a-8*(c-1),p=l-8*(u-1),f={value:0},m=new Array(3),g=new Array(3),v=new Array(3),y=new Array(3),x=new Array(3);for(let n=0;n<3;++n)x[n]=e[t.idx[n]],m[n]=n<1?0:m[n-1]+c*u,g[n]=new Float32Array(64),v[n]=new Uint16Array(64),y[n]=new Uint16Array(64*c);for(let e=0;e<u;++e){let s=8;e==u-1&&(s=p);let a=8;for(let t=0;t<c;++t){t==c-1&&(a=d);for(let t=0;t<3;++t)v[t].fill(0),v[t][0]=r[m[t]++],E(f,i,v[t]),b=v[t],(w=g[t])[0]=W(b[0]),w[1]=W(b[1]),w[2]=W(b[5]),w[3]=W(b[6]),w[4]=W(b[14]),w[5]=W(b[15]),w[6]=W(b[27]),w[7]=W(b[28]),w[8]=W(b[2]),w[9]=W(b[4]),w[10]=W(b[7]),w[11]=W(b[13]),w[12]=W(b[16]),w[13]=W(b[26]),w[14]=W(b[29]),w[15]=W(b[42]),w[16]=W(b[3]),w[17]=W(b[8]),w[18]=W(b[12]),w[19]=W(b[17]),w[20]=W(b[25]),w[21]=W(b[30]),w[22]=W(b[41]),w[23]=W(b[43]),w[24]=W(b[9]),w[25]=W(b[11]),w[26]=W(b[18]),w[27]=W(b[24]),w[28]=W(b[31]),w[29]=W(b[40]),w[30]=W(b[44]),w[31]=W(b[53]),w[32]=W(b[10]),w[33]=W(b[19]),w[34]=W(b[23]),w[35]=W(b[32]),w[36]=W(b[39]),w[37]=W(b[45]),w[38]=W(b[52]),w[39]=W(b[54]),w[40]=W(b[20]),w[41]=W(b[22]),w[42]=W(b[33]),w[43]=W(b[38]),w[44]=W(b[46]),w[45]=W(b[51]),w[46]=W(b[55]),w[47]=W(b[60]),w[48]=W(b[21]),w[49]=W(b[34]),w[50]=W(b[37]),w[51]=W(b[47]),w[52]=W(b[50]),w[53]=W(b[56]),w[54]=W(b[59]),w[55]=W(b[61]),w[56]=W(b[35]),w[57]=W(b[36]),w[58]=W(b[48]),w[59]=W(b[49]),w[60]=W(b[57]),w[61]=W(b[58]),w[62]=W(b[62]),w[63]=W(b[63]),A(g[t]);C(g);for(let e=0;e<3;++e)P(g[e],y[e],64*t)}let l=0;for(let i=0;i<3;++i){const r=n[t.idx[i]].type;for(let t=8*e;t<8*e+s;++t){l=x[i][t];for(let e=0;e<h;++e){const n=64*e+8*(7&t);o.setUint16(l+0*r,y[i][n+0],!0),o.setUint16(l+2*r,y[i][n+1],!0),o.setUint16(l+4*r,y[i][n+2],!0),o.setUint16(l+6*r,y[i][n+3],!0),o.setUint16(l+8*r,y[i][n+4],!0),o.setUint16(l+10*r,y[i][n+5],!0),o.setUint16(l+12*r,y[i][n+6],!0),o.setUint16(l+14*r,y[i][n+7],!0),l+=16*r}}if(h!=c)for(let t=8*e;t<8*e+s;++t){const e=x[i][t]+8*h*2*r,n=64*h+8*(7&t);for(let t=0;t<a;++t)o.setUint16(e+2*t*r,y[i][n+t],!0)}}}var b,w;const _=new Uint16Array(a);o=new DataView(s.buffer);for(let e=0;e<3;++e){n[t.idx[e]].decoded=!0;const i=n[t.idx[e]].type;if(2==n[e].type)for(let t=0;t<l;++t){const n=x[e][t];for(let t=0;t<a;++t)_[t]=o.getUint16(n+2*t*i,!0);for(let t=0;t<a;++t)o.setFloat32(n+2*t*i,W(_[t]),!0)}}}(h,f,l,c,u,i);for(let e=0;e<l.length;++e){const n=l[e];if(!n.decoded){if(2!==n.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let r=0,s=0;for(let o=0;o<t.lines;++o){let t=f[e][r];for(let e=0;e<n.width;++e){for(let e=0;e<2*n.type;++e)i[t++]=d[s+e*n.width*n.height];s++}r++}}}}return new DataView(i.buffer)}function N(t,e){const n=new Uint8Array(t);let i=0;for(;0!=n[e.value+i];)i+=1;const r=(new TextDecoder).decode(n.slice(e.value,e.value+i));return e.value=e.value+i+1,r}function z(t,e){const n=t.getInt32(e.value,!0);return e.value=e.value+4,n}function k(t,e){const n=t.getUint32(e.value,!0);return e.value=e.value+4,n}function F(t,e){const n=t[e.value];return e.value=e.value+1,n}function U(t,e){const n=t.getUint8(e.value);return e.value=e.value+1,n}const H=function(t,e){let n;return n="getBigInt64"in DataView.prototype?Number(t.getBigInt64(e.value,!0)):t.getUint32(e.value+4,!0)+Number(t.getUint32(e.value,!0)<<32),e.value+=8,n};function V(t,e){const n=t.getFloat32(e.value,!0);return e.value+=4,n}function G(t,e){return u.A5E.toHalfFloat(V(t,e))}function W(t){const e=(31744&t)>>10,n=1023&t;return(t>>15?-1:1)*(e?31===e?n?NaN:1/0:Math.pow(2,e-15)*(1+n/1024):n/1024*6103515625e-14)}function j(t,e){const n=t.getUint16(e.value,!0);return e.value+=2,n}function q(t,e){return W(j(t,e))}function X(t,e,n,i,r){return"string"===i||"stringvector"===i||"iccProfile"===i?function(t,e,n){const i=(new TextDecoder).decode(new Uint8Array(t).slice(e.value,e.value+n));return e.value=e.value+n,i}(e,n,r):"chlist"===i?function(t,e,n,i){const r=n.value,s=[];for(;n.value<r+i-1;){const i=N(e,n),r=z(t,n),o=U(t,n);n.value+=3;const a=z(t,n),l=z(t,n);s.push({name:i,pixelType:r,pLinear:o,xSampling:a,ySampling:l})}return n.value+=1,s}(t,e,n,r):"chromaticities"===i?function(t,e){return{redX:V(t,e),redY:V(t,e),greenX:V(t,e),greenY:V(t,e),blueX:V(t,e),blueY:V(t,e),whiteX:V(t,e),whiteY:V(t,e)}}(t,n):"compression"===i?function(t,e){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][U(t,e)]}(t,n):"box2i"===i?function(t,e){return{xMin:k(t,e),yMin:k(t,e),xMax:k(t,e),yMax:k(t,e)}}(t,n):"lineOrder"===i?function(t,e){return["INCREASING_Y"][U(t,e)]}(t,n):"float"===i?V(t,n):"v2f"===i?function(t,e){return[V(t,e),V(t,e)]}(t,n):"v3f"===i?function(t,e){return[V(t,e),V(t,e),V(t,e)]}(t,n):"int"===i?z(t,n):"rational"===i?function(t,e){return[z(t,e),k(t,e)]}(t,n):"timecode"===i?function(t,e){return[k(t,e),k(t,e)]}(t,n):"preview"===i?(n.value+=r,"skipped"):void(n.value+=r)}const Y=new DataView(e),$=new Uint8Array(e),K={value:0},Z=function(t,e,n){const i={};if(20000630!=t.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");i.version=t.getUint8(4);const r=t.getUint8(5);i.spec={singleTile:!!(2&r),longName:!!(4&r),deepFormat:!!(8&r),multiPart:!!(16&r)},n.value=8;let s=!0;for(;s;){const r=N(e,n);if(0==r)s=!1;else{const s=N(e,n),o=X(t,e,n,s,k(t,n));void 0===o?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):i[r]=o}}if(0!=r)throw console.error("EXRHeader:",i),new Error("THREE.EXRLoader: provided file is currently unsupported.");return i}(Y,e,K),J=function(t,e,n,i,r){const s={size:0,viewer:e,array:n,offset:i,width:t.dataWindow.xMax-t.dataWindow.xMin+1,height:t.dataWindow.yMax-t.dataWindow.yMin+1,channels:t.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:t.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(t.compression){case"NO_COMPRESSION":s.lines=1,s.uncompress=R;break;case"RLE_COMPRESSION":s.lines=1,s.uncompress=L;break;case"ZIPS_COMPRESSION":s.lines=1,s.uncompress=I;break;case"ZIP_COMPRESSION":s.lines=16,s.uncompress=I;break;case"PIZ_COMPRESSION":s.lines=32,s.uncompress=D;break;case"PXR24_COMPRESSION":s.lines=16,s.uncompress=O;break;case"DWAA_COMPRESSION":s.lines=32,s.uncompress=B;break;case"DWAB_COMPRESSION":s.lines=256,s.uncompress=B;break;default:throw new Error("EXRLoader.parse: "+t.compression+" is unsupported")}if(s.scanlineBlockSize=s.lines,1==s.type)switch(r){case u.VzW:s.getter=q,s.inputSize=2;break;case u.cLu:s.getter=j,s.inputSize=2}else{if(2!=s.type)throw new Error("EXRLoader.parse: unsupported pixelType "+s.type+" for "+t.compression+".");switch(r){case u.VzW:s.getter=V,s.inputSize=4;break;case u.cLu:s.getter=G,s.inputSize=4}}s.blockCount=(t.dataWindow.yMax+1)/s.scanlineBlockSize;for(let t=0;t<s.blockCount;t++)H(e,i);s.outputChannels=3==s.channels?4:s.channels;const o=s.width*s.height*s.outputChannels;switch(r){case u.VzW:s.byteArray=new Float32Array(o),s.channels<s.outputChannels&&s.byteArray.fill(1,0,o);break;case u.cLu:s.byteArray=new Uint16Array(o),s.channels<s.outputChannels&&s.byteArray.fill(15360,0,o);break;default:console.error("THREE.EXRLoader: unsupported type: ",r)}return s.bytesPerLine=s.width*s.inputSize*s.channels,4==s.outputChannels?(s.format=u.wk1,s.encoding=u.rnI):(s.format=u.hEm,s.encoding=u.rnI),s}(Z,Y,$,K,this.type),Q={value:0},tt={R:0,G:1,B:2,A:3,Y:0};for(let t=0;t<J.height/J.scanlineBlockSize;t++){const e=k(Y,K);J.size=k(Y,K),J.lines=e+J.scanlineBlockSize>J.height?J.height-e:J.scanlineBlockSize;const n=J.size<J.lines*J.bytesPerLine?J.uncompress(J):R(J);K.value+=J.size;for(let e=0;e<J.scanlineBlockSize;e++){const i=e+t*J.scanlineBlockSize;if(i>=J.height)break;for(let t=0;t<J.channels;t++){const r=tt[Z.channels[t].name];for(let s=0;s<J.width;s++){Q.value=(e*(J.channels*J.width)+t*J.width+s)*J.inputSize;const o=(J.height-1-i)*(J.width*J.outputChannels)+s*J.outputChannels+r;J.byteArray[o]=J.getter(n,Q)}}}}return{header:Z,width:J.width,height:J.height,data:J.byteArray,format:J.format,encoding:J.encoding,type:this.type}}setDataType(t){return this.type=t,this}load(t,e,n,i){return super.load(t,(function(t,n){t.encoding=n.encoding,t.minFilter=u.wem,t.magFilter=u.wem,t.generateMipmaps=!1,t.flipY=!1,e&&e(t,n)}),n,i)}}class pl{static CONSOLE_LOG_ENABLED=!1;static GltfUrlList=[];constructor(){console.error("The GLoader class is implemented as static class!!")}static randomColor(){return(8355711+Math.floor(8355711*Math.random())).toString(16)}static log(t,e,n,i,r){pl.CONSOLE_LOG_ENABLED&&console.log(`%c${t} ${e} ${(100*n/i).toFixed(2)}%`,`color: ${r}`)}static progContainer;static showing=!1;static timerInterval;static showProgress(t,e,n,i,r){if(!pl.progContainer){const t=500;pl.progContainer=document.createElement("div"),pl.progContainer.style.backgroundColor=`${ps("black").alpha(.5)}`,pl.progContainer.style.position="absolute",pl.progContainer.style.display="inline-block",pl.progContainer.style.color="yellow",pl.progContainer.style.width=`${t}px`,pl.progContainer.style.textAlign="center",pl.progContainer.style.padding="50px 10px 50px 10px",pl.progContainer.style.borderRadius="10px",pl.progContainer.style.color="white",pl.progContainer.style.fontFamily="IBM Plex Mono",document.body.appendChild(pl.progContainer);const e=()=>{pl.progContainer.style.top=window.innerHeight/2-100+"px",pl.progContainer.style.left=window.innerWidth/2-t/2+"px"};window.addEventListener("resize",(()=>{!0===pl.showing&&e()})),e()}if("start"===t&&(pl.showing=!0,clearInterval(pl.timerInterval),pl.progContainer.style.opacity="1"),!0===pl.showing&&"prog"===t&&(pl.progContainer.innerHTML=`Loading ${e} ${(r/1048576).toFixed(2)} MB`),!0===pl.showing&&"done"===t){pl.progContainer.innerHTML=`${(r/1048576).toFixed(2)} MB loaded`;let t=100,e=parseInt(pl.progContainer.style.top);const n=2*e/t;pl.timerInterval=setInterval((()=>{pl.progContainer.style.opacity=""+t/100,pl.progContainer.style.top=`${e}px`,e-=n,t-=1,t<=0&&(pl.showing=!1,-1!==Array.prototype.slice.call(document.body.children).indexOf(pl.progContainer)&&document.body.removeChild(pl.progContainer),clearInterval(pl.timerInterval))}),1e3/60)}}static async loadGLTF(t,e){let n=0,i=0,r=0;return new Promise(((s,o)=>{if(-1!==pl.GltfUrlList.indexOf(t)){const e=`\nThe GLTF model "${t}" is previously download!`;throw console.log(`%c${e}`,"color: red"),new Error(e)}pl.GltfUrlList.push(t);const a="GLoader.loadGLTF";pl.randomColor(),pl.showProgress("start",t,1,100,0),new Mr(new u.lLk((()=>{pl.showProgress("done",t,n,i,r)}),((t,e,s)=>{n=e,i=s,pl.showProgress(a,t,n,i,r)}),(t=>{const e=`${a}: error loading ${t}`;console.error(e),o(e)}))).load(t,(t=>{t.scene.traverse((t=>{t.isMesh&&(t.receiveShadow=!0,t.castShadow=!0)})),e&&e(t),s(t)}),(e=>{r=e.loaded,pl.showProgress("prog",t,n,i,r)}))}))}static async loadTexture(t,e){let n=0,i=0,r=0;return new Promise(((s,o)=>{const a="GLoader.loadTexture";pl.randomColor(),pl.showProgress("start",t,1,100,0),new u.dpR(new u.lLk((()=>{pl.showProgress("done",t,n,i,r)}),((t,e,s)=>{n=e,i=s,pl.showProgress(a,t,n,i,r)}),(t=>{const e=`${a}: error loading ${t}`;console.error(e),o(e)}))).load(t,(t=>{t.encoding=u.knz,e&&e(t),s(t),t.dispose()}),(e=>{r=e.loaded,pl.showProgress("prog",t,n,i,r)}))}))}static async loadExrTexture(t,e){return new Promise(((n,i)=>{const r="GLoader.loadExrTexture",s=pl.randomColor();new dl(new u.lLk((()=>{}),((t,e,n)=>{pl.log(`${r}`,t,e,n,`#${s}`)}),(t=>{const e=`${r}: error loading ${t}`;console.error(e),i(e)}))).load(t,(t=>{e&&e(t),n(t),t.dispose()}))}))}static async loadCubeEnvTexture(t,e,n){let i=0,r=0,s=0;return new Promise(((o,a)=>{const l="GLoader.loadCubeEnvTexture";pl.randomColor(),pl.showProgress("start",t,1,100,0),new u.cBK(new u.lLk((()=>{pl.showProgress("done",t,i,r,s)}),((t,e,n)=>{i=e,r=n,pl.showProgress(l,t,i,r,s)}),(t=>{const e=`${l}: error loading ${t}`;console.error(e),a(e)}))).setPath(t).load(e,(t=>{n&&n(t),o(t),t.dispose()}),(e=>{s=e.loaded,pl.showProgress("prog",t,i,r,s)}))}))}static async loadPngCubeEnvTexture(t,e){return this.loadCubeEnvTexture(t,["posx.png","negx.png","posy.png","negy.png","posz.png","negz.png"],e)}static async loadJpgCubeEnvTexture(t,e){return this.loadCubeEnvTexture(t,["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"],e)}static async loadDefaultCubeEnvTexture(t,e){return this.loadCubeEnvTexture(`textures/cube/${t}/`,["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"],e)}static loadCubeTextureSync(t){const e=`textures/cube/${t}/`;return(new u.cBK).setPath(e).load(["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"])}}const fl={type:"change"},ml={type:"start"},gl={type:"end"};class vl extends u.pBf{constructor(t,e){super(),void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new u.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:u.RsA.ROTATE,MIDDLE:u.RsA.DOLLY,RIGHT:u.RsA.PAN},this.touches={ONE:u.QmN.ROTATE,TWO:u.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",W),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(fl),n.update(),r=i.NONE},this.update=function(){const e=new u.Pa4,d=(new u._fP).setFromUnitVectors(t.up,new u.Pa4(0,1,0)),p=d.clone().invert(),f=new u.Pa4,m=new u._fP,g=2*Math.PI;return function(){const t=n.object.position;e.copy(t).sub(n.target),e.applyQuaternion(d),o.setFromVector3(e),n.autoRotate&&r===i.NONE&&S(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(o.theta+=a.theta*n.dampingFactor,o.phi+=a.phi*n.dampingFactor):(o.theta+=a.theta,o.phi+=a.phi);let u=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(u)&&isFinite(v)&&(u<-Math.PI?u+=g:u>Math.PI&&(u-=g),v<-Math.PI?v+=g:v>Math.PI&&(v-=g),o.theta=u<=v?Math.max(u,Math.min(v,o.theta)):o.theta>(u+v)/2?Math.max(u,o.theta):Math.min(v,o.theta)),o.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=l,o.radius=Math.max(n.minDistance,Math.min(n.maxDistance,o.radius)),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),e.setFromSpherical(o),e.applyQuaternion(p),t.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(a.theta*=1-n.dampingFactor,a.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(a.set(0,0,0),h.set(0,0,0)),l=1,!!(c||f.distanceToSquared(n.object.position)>s||8*(1-m.dot(n.object.quaternion))>s)&&(n.dispatchEvent(fl),f.copy(n.object.position),m.copy(n.object.quaternion),c=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",j),n.domElement.removeEventListener("pointerdown",F),n.domElement.removeEventListener("pointercancel",V),n.domElement.removeEventListener("wheel",G),n.domElement.removeEventListener("pointermove",U),n.domElement.removeEventListener("pointerup",H),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",W)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const s=1e-6,o=new u.$V,a=new u.$V;let l=1;const h=new u.Pa4;let c=!1;const d=new u.FM8,p=new u.FM8,f=new u.FM8,m=new u.FM8,g=new u.FM8,v=new u.FM8,y=new u.FM8,x=new u.FM8,b=new u.FM8,w=[],_={};function M(){return Math.pow(.95,n.zoomSpeed)}function S(t){a.theta-=t}function T(t){a.phi-=t}const E=function(){const t=new u.Pa4;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),h.add(t)}}(),A=function(){const t=new u.Pa4;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),h.add(t)}}(),C=function(){const t=new u.Pa4;return function(e,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;t.copy(s).sub(n.target);let o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),E(2*e*o/r.clientHeight,n.object.matrix),A(2*i*o/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(E(e*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),A(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function P(t){n.object.isPerspectiveCamera?l/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(t){n.object.isPerspectiveCamera?l*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(t){d.set(t.clientX,t.clientY)}function I(t){m.set(t.clientX,t.clientY)}function D(){if(1===w.length)d.set(w[0].pageX,w[0].pageY);else{const t=.5*(w[0].pageX+w[1].pageX),e=.5*(w[0].pageY+w[1].pageY);d.set(t,e)}}function O(){if(1===w.length)m.set(w[0].pageX,w[0].pageY);else{const t=.5*(w[0].pageX+w[1].pageX),e=.5*(w[0].pageY+w[1].pageY);m.set(t,e)}}function B(){const t=w[0].pageX-w[1].pageX,e=w[0].pageY-w[1].pageY,n=Math.sqrt(t*t+e*e);y.set(0,n)}function N(t){if(1==w.length)p.set(t.pageX,t.pageY);else{const e=Y(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);p.set(n,i)}f.subVectors(p,d).multiplyScalar(n.rotateSpeed);const e=n.domElement;S(2*Math.PI*f.x/e.clientHeight),T(2*Math.PI*f.y/e.clientHeight),d.copy(p)}function z(t){if(1===w.length)g.set(t.pageX,t.pageY);else{const e=Y(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);g.set(n,i)}v.subVectors(g,m).multiplyScalar(n.panSpeed),C(v.x,v.y),m.copy(g)}function k(t){const e=Y(t),i=t.pageX-e.x,r=t.pageY-e.y,s=Math.sqrt(i*i+r*r);x.set(0,s),b.set(0,Math.pow(x.y/y.y,n.zoomSpeed)),P(b.y),y.copy(x)}function F(t){!1!==n.enabled&&(0===w.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",U),n.domElement.addEventListener("pointerup",H)),function(t){w.push(t)}(t),"touch"===t.pointerType?function(t){switch(X(t),w.length){case 1:switch(n.touches.ONE){case u.QmN.ROTATE:if(!1===n.enableRotate)return;D(),r=i.TOUCH_ROTATE;break;case u.QmN.PAN:if(!1===n.enablePan)return;O(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case u.QmN.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&B(),n.enablePan&&O(),r=i.TOUCH_DOLLY_PAN;break;case u.QmN.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&B(),n.enableRotate&&D(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(ml)}(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case u.RsA.DOLLY:if(!1===n.enableZoom)return;!function(t){y.set(t.clientX,t.clientY)}(t),r=i.DOLLY;break;case u.RsA.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;I(t),r=i.PAN}else{if(!1===n.enableRotate)return;L(t),r=i.ROTATE}break;case u.RsA.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;L(t),r=i.ROTATE}else{if(!1===n.enablePan)return;I(t),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(ml)}(t))}function U(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(X(t),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;N(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;z(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&k(t),n.enablePan&&z(t)}(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&k(t),n.enableRotate&&N(t)}(t),n.update();break;default:r=i.NONE}}(t):function(t){if(!1!==n.enabled)switch(r){case i.ROTATE:if(!1===n.enableRotate)return;!function(t){p.set(t.clientX,t.clientY),f.subVectors(p,d).multiplyScalar(n.rotateSpeed);const e=n.domElement;S(2*Math.PI*f.x/e.clientHeight),T(2*Math.PI*f.y/e.clientHeight),d.copy(p),n.update()}(t);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(t){x.set(t.clientX,t.clientY),b.subVectors(x,y),b.y>0?P(M()):b.y<0&&R(M()),y.copy(x),n.update()}(t);break;case i.PAN:if(!1===n.enablePan)return;!function(t){g.set(t.clientX,t.clientY),v.subVectors(g,m).multiplyScalar(n.panSpeed),C(v.x,v.y),m.copy(g),n.update()}(t)}}(t))}function H(t){q(t),0===w.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",U),n.domElement.removeEventListener("pointerup",H)),n.dispatchEvent(gl),r=i.NONE}function V(t){q(t)}function G(t){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(t.preventDefault(),n.dispatchEvent(ml),function(t){t.deltaY<0?R(M()):t.deltaY>0&&P(M()),n.update()}(t),n.dispatchEvent(gl))}function W(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:C(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:C(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:C(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:C(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function j(t){!1!==n.enabled&&t.preventDefault()}function q(t){delete _[t.pointerId];for(let e=0;e<w.length;e++)if(w[e].pointerId==t.pointerId)return void w.splice(e,1)}function X(t){let e=_[t.pointerId];void 0===e&&(e=new u.FM8,_[t.pointerId]=e),e.set(t.pageX,t.pageY)}function Y(t){const e=t.pointerId===w[0].pointerId?w[1]:w[0];return _[e.pointerId]}n.domElement.addEventListener("contextmenu",j),n.domElement.addEventListener("pointerdown",F),n.domElement.addEventListener("pointercancel",V),n.domElement.addEventListener("wheel",G,{passive:!1}),this.update()}}class yl extends vl{constructor(t,e){super(t,e),this.minDistance=0,this.maxDistance=1/0,this.zoomSpeed=1,this.enableDamping=!0,this.dampingFactor=.2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,Cs.onMouseDown((t=>{1===t.mouseEvent.button&&(this.zoomSpeed=.1)})),Cs.onMouseUp((t=>{1===t.mouseEvent.button&&(this.zoomSpeed=1)}))}}class xl extends u.cPb{controls;constructor(t){t?(super(t.fov,t.aspect,t.near,t.far),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.name=`${t.name}_blender`):(super(70,window.innerWidth/window.innerHeight,.1,1e3),this.name=Os.makeUid("Camera"),this.lookAt(0,0,0),this.position.set(0,2,15))}createOwnControls(t){return this.controls&&this.controls.dispose(),this.controls=new yl(this,t),this.controls}disableControls(){if(!this.controls)throw new Error(`The camera ${this.name} has no controls!`);this.controls.enabled=!1}enableControls(){if(!this.controls)throw new Error(`The camera ${this.name} has no controls!`);this.controls.enabled=!0}toggleControls(){if(!this.controls)throw new Error(`The camera ${this.name} has no controls!`);this.controls.enabled=!this.controls.enabled}resize(t,e){this.aspect=t/e,this.updateProjectionMatrix()}setAspect(t,e){t=t||window.innerWidth,e=e||window.innerHeight,this.aspect=t/e}setPosition(t,e,n){if(t instanceof u.Pa4)this.position.copy(t);else{const i=this.position;this.position.set(t,void 0!==e?e:i.y,void 0!==n?n:i.z)}}setLookAt(t,e,n){t instanceof u.Pa4?this.lookAt(t):this.lookAt(new u.Pa4(t,void 0!==e?e:0,void 0!==n?n:0))}}class bl extends u.b5g{scene;camera;constructor(t,e){super({alpha:!0,antialias:!0}),this.scene=t,this.camera=e,this.resize(window.innerWidth,window.innerHeight),this.setClearColor(0,0),this.outputEncoding=u.knz,this.shadowMap.enabled=!0,this.shadowMap.type=u.dwk,this.toneMapping=u.CdI,this.toneMappingExposure=1,document.body.appendChild(this.domElement)}update(){this.render(this.scene,this.camera)}resize(t,e){this.setSize(t,e),this.setPixelRatio(t/e)}cleanRenderList(){this.renderLists.dispose()}getDomElement(){return this.domElement}setScene(t){this.scene=t}setCamera(t){this.camera=t}}class wl extends u.xsS{constructor(){super(),this.background=new u.Ilk(0),this.name=Os.makeUid("MainScene")}setEnvironment(t){this.environment=t}setBackground(t){this.background=t}getEnvironment(){return this.environment}getBackground(){return this.background}showFog(t=8947882,e=.025){console.log(this.fog),this.fog=new u.yo9(t,e)}hideFog(){this.fog=null}}var _l;!function(t){t[t.Object=0]="Object",t[t.Mesh=1]="Mesh",t[t.Group=2]="Group",t[t.Scene=3]="Scene",t[t.Points=4]="Points",t[t.AmbientLight=5]="AmbientLight",t[t.PointLight=6]="PointLight",t[t.SpotLight=7]="SpotLight",t[t.HemisphereLight=8]="HemisphereLight"}(_l||(_l={}));class Ml{target;constructor(t){this.target=t}setTarget(t){this.target=t}get(t){return t&&"Object"!==t?this.target.children.filter((e=>e.type===t)):this.target.children}getChildren(){return this.get()}getMeshes(){return this.get("Mesh")}getGroups(){return this.get("Group")}getScenes(){return this.get("Scene")}getParent(){return this.target.parent}getObject(t){return this.extract().filter((e=>e.name===t))[0]}extract(){const t=[];return this.target.traverse((e=>t.push(e))),t}find(t){const e=this.extract();return t&&"Object"!==t?e.filter((e=>e.type===t)):e}findObjects(){return this.extract().filter((t=>!Os.isSpecialObject(t))).filter((t=>Os.isMesh(t)||Os.isGroup(t))).filter((t=>!Os.isScene(t))).filter((t=>!Os.isSubFace(t))).filter((t=>!Os.isGLTFScene(t)))}findMeshesAndGroups(){return this.extract().filter((t=>Os.isMesh(t)||Os.isGroup(t))).filter((t=>!Os.isGLTFScene(t))).filter((t=>!Os.isScene(t))).filter((t=>!Os.isLight(t))).filter((t=>!Os.isCamera(t))).filter((t=>!Os.isSubFace(t))).filter((t=>!Os.isShapeMesh(t))).filter((t=>!Os.isObject3D(t)))}findSingleMaterialObjects(){return this.findMeshesAndGroups().filter((t=>!Os.isCustomShapeObject(t))).filter((t=>!Os.isMultiMaterialsObject(t)))}findCustomShapeObjects(){const t=this.extract().filter((t=>!1===Os.isSpecialObject(t))).filter((t=>Os.isCustomShapeObject(t)));return t}findSingleShapeObjects(){return this.extract().filter((t=>!1===Os.isSpecialObject(t))).filter((t=>!0===Os.isSingleShapeObject(t)))}findMultiShapesObjects(){return this.extract().filter((t=>!1===Os.isSpecialObject(t))).filter((t=>Os.isMultiShapesObject(t)))}findMultiMaterialsObjects(){return this.extract().filter((t=>!1===Os.isSpecialObject(t))).filter((t=>!0===Os.isMultiMaterialsObject(t))).filter((t=>!1===Os.isGLTFScene(t)))}getMaterialOwners(t){return this.extract().filter((t=>Os.isMesh(t))).filter((e=>e.material.name===t))}dispose(){const t=e=>{e.children.slice().forEach((e=>{e.children.length>0&&t(e),(t=>{if("Mesh"===t.type){t.geometry.dispose();const e=t.material;e&&(e.dispose(),e.map&&e.map.dispose(),e.lightMap&&e.lightMap.dispose(),e.aoMap&&e.aoMap.dispose(),e.emissiveMap&&e.emissiveMap.dispose(),e.bumpMap&&e.bumpMap.dispose(),e.normalMap&&e.normalMap.dispose(),e.displacementMap&&e.displacementMap.dispose(),e.roughnessMap&&e.roughnessMap.dispose(),e.metalnessMap&&e.metalnessMap.dispose(),e.alphaMap&&e.alphaMap.dispose(),e.envMap&&e.envMap.dispose())}t.parent?.remove(t)})(e)}))};t(this.target)}}class Sl{scene;manager;worldAxesShown=!1;graphics;constructor(t){this.graphics=t,this.scene=new u.xsS,this.scene.name=Os.makeUid(e.SpecialObjects.Helpers.Scene.NamePrefix),t.scene.add(this.scene),this.manager=new Ml(this.scene)}showWorldAxes(t=10){!0===this.worldAxesShown&&this.hideWorldAxes();const n=new u.y8_(t);n.name=Os.makeUid(e.SpecialObjects.Helpers.WorldAxes.NamePrefix),this.scene.add(n),this.worldAxesShown=!0}hideWorldAxes(){if(!1===this.worldAxesShown)return;const t=e.SpecialObjects.Helpers.WorldAxes.NamePrefix,n=this.manager.extract().filter((e=>0===e.name.indexOf(t)))[0];n&&(this.scene.remove(n),n.dispose()),this.worldAxesShown=!1}toggleWorldAxes(t=10){!0===this.worldAxesShown?this.hideWorldAxes():this.showWorldAxes(t)}showObjectAxes(t,n=2){if(t.children.filter((t=>Os.isObjectAxesHelper(t))).length>0)return;const i=new u.y8_(n);i.name=Os.makeUid(e.SpecialObjects.Helpers.ObjectAxes.NamePrefix),t.add(i)}hideObjectAxes(t){t.children.filter((t=>Os.isObjectAxesHelper(t))).map((e=>{t.remove(e),e.dispose()}))}toggleObjectAxes(t,e=2){t.children.filter((t=>Os.isObjectAxesHelper(t))).length>0?this.hideObjectAxes(t):this.showObjectAxes(t,e)}showLocalAxes(){this.graphics.manager.findObjects().map((t=>this.showObjectAxes(t)))}hideLocalAxes(){this.graphics.manager.findObjects().map((t=>this.hideObjectAxes(t)))}toggleLocalAxes(){const t=this.graphics.manager.findObjects().filter((t=>t.children.length>0))[0];if(t){const e=t.children.filter((t=>Os.isObjectAxesHelper(t))).length;if(e>0)return this.hideLocalAxes(),this}return this.showLocalAxes(),this}}var Tl={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-Tl.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Tl.Bounce.In(2*t):.5*Tl.Bounce.Out(2*t-1)+.5}}},El="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},Al=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=El()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var r=this._tweens[n[i]],s=!e;r&&!1===r.update(t,s)&&!e&&delete this._tweens[n[i]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),Cl={Linear:function(t,e){var n=t.length-1,i=n*e,r=Math.floor(i),s=Cl.Utils.Linear;return e<0?s(t[0],t[1],i):e>1?s(t[n],t[n-1],n-i):s(t[r],t[r+1>n?n:r+1],i-r)},Bezier:function(t,e){for(var n=0,i=t.length-1,r=Math.pow,s=Cl.Utils.Bernstein,o=0;o<=i;o++)n+=r(1-e,i-o)*r(e,o)*t[o]*s(i,o);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,r=Math.floor(i),s=Cl.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(r=Math.floor(i=n*(1+e))),s(t[(r-1+n)%n],t[r],t[(r+1)%n],t[(r+2)%n],i-r)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[n]-(s(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):s(t[r?r-1:0],t[r],t[n<r+1?n:r+1],t[n<r+2?n:r+2],i-r)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=Cl.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var n=1;if(t[e])return t[e];for(var i=e;i>1;i--)n*=i;return t[e]=n,n}}(),CatmullRom:function(t,e,n,i,r){var s=.5*(n-t),o=.5*(i-e),a=r*r;return(2*e-2*n+s+o)*(r*a)+(-3*e+3*n-2*s-o)*a+s*r+e}}},Pl=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),Rl=new Al,Ll=function(){function t(t,e){void 0===e&&(e=Rl),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Tl.Linear.None,this._interpolationFunction=Cl.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Pl.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?El()+parseFloat(t):t:El(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,i){for(var r in n){var s=t[r],o=Array.isArray(s),a=o?"array":typeof s,l=!o&&Array.isArray(n[r]);if("undefined"!==a&&"function"!==a){if(l){var h=n[r];if(0===h.length)continue;h=h.map(this._handleRelativeValue.bind(this,s)),n[r]=[s].concat(h)}if("object"!==a&&!o||!s||l)void 0===e[r]&&(e[r]=s),o||(e[r]*=1),i[r]=l?n[r].slice().reverse():e[r]||0;else{for(var c in e[r]=o?[]:{},s)e[r][c]=s[c];i[r]=o?[]:{},this._setupProperties(s,e[r],n[r],i[r])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=El()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=El()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=El()),void 0===e&&(e=!0),this._isPaused)return!0;var n,i,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>r)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var s=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,s),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,a=this._chainedTweens.length;o<a;o++)this._chainedTweens[o].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,i){for(var r in n)if(void 0!==e[r]){var s=e[r]||0,o=n[r],a=Array.isArray(t[r]),l=Array.isArray(o);!a&&l?t[r]=this._interpolationFunction(o,i):"object"==typeof o&&o?this._updateProperties(t[r],s,o,i):"number"==typeof(o=this._handleRelativeValue(s,o))&&(t[r]=s+(o-s)*i)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),Il=(Pl.nextId,Rl),Dl=(Il.getAll.bind(Il),Il.removeAll.bind(Il),Il.add.bind(Il),Il.remove.bind(Il),Il.update.bind(Il));class Ol{listeners;constructor(){this.listeners={}}connect(t,e){return this.addEventListener(t,e)}emit(t,e){return this.dispatchEvent(t,e)}hasAnyEventListener(t){return void 0!==this.listeners[t]}hasEventListener(t,e){const n=this.listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){const n=this.listeners;if(void 0===n[t])return this;const i=n[t].indexOf(e);return-1!==i&&n[t].slice(i,1),this}addEventListener(t,e){const n=this.listeners;return void 0===n[t]&&(n[t]=[]),n[t].indexOf(e)&&n[t].push(e),this}dispatchEvent(t,e){const n=this.listeners;if(void 0===n[t])return this;if(n[t])for(let i=0,r=n[t].length;i<r;i++)n[t][i].call(this,e);return this}}const Bl=sr,Nl={normal:"normal",info:"info",success:"success",warning:"warning",error:"error",highlight:"highlight",focus:"focus",random:"random"},zl={normal:"#fcfcfa",info:"#31a5f7",success:"#4aff53",warning:"#ff7403",error:"#ff2212",highlight:"#ff47ea",focus:"#dfff12"};class kl{static wrapper;static lines=[];static maxLines=20;static logTimer=void 0;constructor(){kl.init()}static init(){return kl.wrapper?this:(kl.wrapper=document.createElement("div"),kl.wrapper.className="ui__log_container",kl.wrapper.id="ui__log_container",document.body.appendChild(kl.wrapper),kl.log(kl.getTime(),Nl.success),kl)}static makeLogLine(t,e,n=.4,i){const r=document.createElement("div");return r.className="ui__log_line",r.id=`ui__log_line_${e}_${kl.lines.length}`,r.innerHTML+=`${t}`,r.style.display="block",r.style.color=zl.normal,r.style.borderColor=zl[e],r.style.backgroundColor=i?`${Bl(i).alpha(n)}`:`${Bl.hsl(360*Math.random(),1,.6).alpha(n)}`,r}static removeLine(t){let e;return t?t>=0&&t<kl.lines.length&&(e=kl.lines.splice(t,1)[0]):e=kl.lines.shift(),e&&e.parentNode==kl.wrapper&&kl.wrapper.removeChild(e),kl}static log(t,e=Nl.normal){kl.wrapper||(kl.clog("@UILog.log: The UILog.init() is called internally.",Nl.warning),kl.init(),kl.log("@UILog.init() self init.",Nl.warning));const n=kl.makeLogLine(t,e);kl.wrapper.appendChild(n),kl.lines.push(n),kl.lines.length>kl.maxLines&&kl.removeLine()}static setMaxLine(t){for(kl.maxLines=t;kl.lines.length>t;)kl.removeLine();return kl}static clearLines(){for(;kl.lines.length>0;)kl.removeLine();return kl}static getTime(){const t=t=>t<10?`0${t}`:`${t}`,e=new Date,n=e.getHours(),i=e.getMinutes(),r=e.getSeconds(),s=e.getMilliseconds();return`${t(n)}:${t(i)}:${t(r)}:${(t=>t<10?`00${t}`:t<100?`0${t}`:`${t}`)(s)}`}static startLogTime(){if(void 0!==kl.logTimer)return kl;let t=0;const e=Object.keys(Nl);return kl.logTimer=setInterval((()=>{kl.log(kl.getTime(),e[t]),t=(t+1)%e.length}),1e3),kl}static stopLogTime(){return clearInterval(kl.logTimer),kl.logTimer=void 0,kl}static clog(t,e=Nl.normal,n=!0){return!0===n?console.log(`%c %c[${kl.getTime()}] %c${t}`,"color:#ff0","color:gray",`color:${zl[e]}`):console.log(`%c %c${t}`,"color:#ff0",`color:${zl[e]}`),kl}static glog(t,e,n=Nl.normal,i=!1){const r=zl[n];return!0===i?console.group(`%c[${kl.getTime()}] %c %c${t}`,"color:gray","color:#ff0",`color:${r}`):console.group(`%c %c${t}`,"color:#ff0",`color:${r}`),console.log(`%c %c${e}`,"color:#ff0",`color:${r}`),console.groupEnd(),kl}}const Fl=Ll,Ul="ui__object",Hl="ui__node",Vl="ui__box",Gl="ui__drag",Wl={vector_x:"ui_theme_vector_x",vector_y:"ui_theme_vector_y",vector_z:"ui_theme_vector_z",vector_w:"ui_theme_vector_w",default:"ui_theme_default"},jl="block",ql="inline-block",Xl="relative",Yl="absolute";class $l extends Ol{displayMode=jl;element;constructor(){super(),this.element=$l.createElement("div"),this.setId(this.generateId(Ul)).setClass(Ul),this.setPositionMode(Xl).setDisplayMode(jl).fillBackground().showOutline().useBorderBox()}domRectToObject(t){return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}log(t,e){if(!e){const t=Object.keys(Nl);e=t[Math.floor(Math.random()*t.length)]}let n="";if("object"==typeof t){t instanceof DOMRect?(n="<span><i>DOMRect:</i></span><br/>",t=this.domRectToObject(t)):t instanceof DOMRectList&&(n="<span><i>DOMRectList[0]:</i></span><br/>",t=this.domRectToObject(t[0]));const e=Object.keys(t);for(let i=0;i<e.length;i++)n+=`${e[i]}: ${t[e[i]]}<br/>`}else n=t.toString();kl.log(n,e)}logNormal(t){kl.log(t,Nl.normal)}logInfo(t){kl.log(t,Nl.info)}logSuccess(t){kl.log(t,Nl.success)}logWarning(t){kl.log(t,Nl.warning)}logError(t){kl.log(t,Nl.error)}logHighlight(t){kl.log(t,Nl.highlight)}logFocus(t){kl.log(t,Nl.focus)}logSetMaxLines(t){kl.setMaxLine(t)}logRemoveLines(t){kl.removeLine(t)}logClear(){kl.clearLines()}getElement(){return this.element}getParent(){return this.element.parentNode}setId(t){return this.element.id=t,this}getId(){return this.element.id}generateId(t,e){let n=`${t}_${this.generateUUID()}`;return n+=e?`_${e}`:"",n}generateUUID(t=!1){return $l.generateUUID(t)}setHtml(t){return this.element.innerHTML=t,this}appendHtml(t){return this.element.innerHTML+=t,this}clearHtml(){return this.element.innerHTML="",this}getHtml(){return this.element.innerHTML}static createElement(t){return document.createElement(t)}static generateId(t,e){let n=`${t}_${$l.generateUUID().substring(0,8)}`;return n+=e?`_${e}`:"",n}static generateUUID(t=!1){let e="";const n="01234567890abcdef",i=n.length-1,r=[8,4,4,12];for(let t=0;t<r.length;t++){for(let s=0;s<r[t];s++)e+=n[Math.round(Math.random()*i)]+"";e+="-"}return e=e.substring(0,e.length-1),!1===t&&(e=e.substring(0,8)),e}static takeElement(t){return t instanceof $l?t.element:t}appendChild(t){const e=$l.takeElement(t);return this.element.appendChild(e),this}appendTo(t){return $l.takeElement(t).appendChild(this.element),this}appendToBody(){return document.body.appendChild(this.element),this}removeFromParent(){return this.element.parentNode?.removeChild(this.element),this}destroy(){return this.clearHtml(),this.removeChildren(),this.removeFromParent(),this}dispose(){return this.clearHtml(),this.removeChildren(),this.removeFromParent(),this}removeChild(t){const e=$l.takeElement(t);return this.element.removeChild(e),this}clearChildren(){return Array.prototype.slice.call(this.element.children).map((t=>this.element.removeChild(t))),this}removeChildren(){return Array.prototype.slice.call(this.element.children).map((t=>this.element.removeChild(t))),this}appendClass(t){return this.element.classList.add(t),this}getClass(){return this.element.className}getClassList(){return this.element.classList}setClass(t){return this.element.className=t,this}removeClass(t){return this.element.classList.remove(t),this}replaceClass(t,e){return this.element.classList.replace(t,e),this}removeTheme(){return Object.values(Wl).forEach((t=>{this.removeClass(t)})),this}setTheme(t){return this.removeTheme(),this.appendClass(t),this}setAttribute(t,e){return this.element.setAttribute(t,e),this}removeAttribute(t){return this.element.removeAttribute(t),this}removeStyle(){return this.removeAttribute("style"),this}clearStyle(){return this.removeAttribute("style"),this}getClientRects(){return this.element.getClientRects()}getBoundingClientRect(){const t=this.element.getBoundingClientRect();return 0===t.width&&0===t.height&&console.log(`%c@UIObject.getBoundingClientRect: The "${this.getId()} has ZERO width and height!"`,"color: orange"),t}getParentBoundingClientRect(){const t=this.getParent(),e=t.getBoundingClientRect();return"BODY"===t.nodeName&&(e.width=window.innerWidth,e.height=window.innerHeight),e}setProperty(t,e){return this.element.style.setProperty(t,e),this}applyProperties(t){return Object.keys(t).forEach((e=>{Object.entries(t).map((([t,e])=>{this.setProperty(t,e)}))})),this}removeProperty(t){return this.element.style.removeProperty(t)}getProperty(t){return this.element.style.getPropertyValue(t)}getPropertyPriority(t){return this.element.style.getPropertyPriority(t)}clearPositionProperties(){return this.removeProperty("top"),this.removeProperty("right"),this.removeProperty("bottom"),this.removeProperty("left"),this.removeProperty("margin"),this}convertToDefaultBox(){return this.applyProperties({position:"fixed",display:"inline-block"}),this}moveToTop(){return this.convertToDefaultBox(),this.removeProperty("bottom"),this.setProperty("top","0px"),this}lockCurrentSize(){const t=this.getBoundingClientRect();if(0!==t.width&&0!==t.height)return this.applyProperties({width:`${t.width}px`,height:`${t.height}px`}),this;console.log(`%c@UIObject.lockCurrentSize: Operation is ignored. The width and height values are "${t.width}px", "${t.height}px"`,"color: orange")}moveToRight(){return this.convertToDefaultBox(),this.removeProperty("left"),this.setProperty("right","0px"),this}moveToBottom(){return this.convertToDefaultBox(),this.removeProperty("top"),this.setProperty("bottom","0px"),this}moveToLeft(){return this.convertToDefaultBox(),this.removeProperty("right"),this.setProperty("left","0px"),this}moveToCenterHorizontal(){this.convertToDefaultBox(),this.removeProperty("left"),this.removeProperty("right");const t=this.getParentBoundingClientRect(),e=this.getBoundingClientRect(),n=t.width/2-e.width/2;return this.setProperty("left",`${n}px`),this}moveToCenterVertical(){this.convertToDefaultBox(),this.removeProperty("top"),this.removeProperty("bottom");const t=this.getParentBoundingClientRect(),e=this.getBoundingClientRect(),n=t.height/2-e.height/2;return this.setProperty("top",`${n}px`),this}moveToCenter(){return this.moveToCenterHorizontal().moveToCenterVertical(),this}moveToPreDefinedLocation(t){return this.convertToDefaultBox().clearPositionProperties(),"top"===t?this.moveToTop():"right"===t?this.moveToRight():"bottom"===t?this.moveToBottom():"left"===t?this.moveToLeft():"top-left"===t?this.moveToTop().moveToLeft():"top-right"===t||"bottom-right"===t?this.moveToBottom().moveToRight():"bottom-left"===t?this.moveToBottom().moveToLeft():"center"===t?this.moveToCenter():"center_h"===t&&this.moveToCenterHorizontal(),this}moveToPosition(t,e){return this.convertToDefaultBox().clearPositionProperties(),this.setProperty("left",`${t}px`),this.setProperty("top",`${e}px`),this}setDisplayMode(t){return this.setProperty("display",t),this}setPositionMode(t){return this.setProperty("position",t),this}show(){return this.setProperty("display",`${this.displayMode}`),this}hide(){return this.displayMode=this.getProperty("display"),this.setProperty("display","none"),this}setVisible(t){return this.setProperty("visibility",!0===t?"visible":"hidden"),this}setOpacity(t){return this.setProperty("opacity",`${t}`),this}removePaddings(){return this.element.style.removeProperty("padding"),this}removeBorders(){return this.element.style.removeProperty("border"),this}removeMargins(){return this.element.style.removeProperty("margin"),this}zeroPaddings(){return this.setProperty("padding","0px"),this}zeroBorders(){return this.setProperty("border","0px"),this}zeroMargin(){return this.setProperty("margin","0px"),this}setZindex(t){return this.setProperty("z-index",`${t}`),this}showOutline(t=1,e="red"){return this.setProperty("outline",`${t}px ${e} solid`),this}hideOutline(){return this.setProperty("outline","none"),this}useBorderBox(){return this.setProperty("box-sizing","border-box"),this}hex8ToRgba(t){const e=[];for(let n=0;n<4;n++)e.push(t%256),t=Math.floor(t/256);return`rgba(${e[3]},${e[2]},${e[1]},${(e[0]/255).toFixed(2)})`}setBackgroundColor(t){const e="string"==typeof t?t:this.hex8ToRgba(t);return this.setProperty("background-color",e),console.log(e),this}fillBackground(t){const e="string"==typeof(t=t||"rgba(0,0,0,0.5)")?t:this.hex8ToRgba(t);return this.setProperty("background-color",e),this}removeBackground(){return this.setProperty("background-color","rgba(0,0,0,0)"),this}setForegroundColor(t){const e="string"==typeof t?t:this.hex8ToRgba(t);return this.setProperty("color",e),this}setPaddings(t){if("string"==typeof t)this.setProperty("padding",t);else if(Array.isArray(t)){let e="";t.forEach((t=>{e+=`${t}px `})),e.substring(0,e.length-1),this.setProperty("padding",e)}else isNaN(t)||this.setProperty("padding",`${t}px`);return this}setMargins(t){if("string"==typeof t)this.setProperty("margin",t);else if(Array.isArray(t)){let e="";t.forEach((t=>{e+=`${t}px `})),e.substring(0,e.length-1),this.setProperty("margin",e)}else isNaN(t)||this.setProperty("margin",`${t}px`);return this}setBorderRadius(t){if("string"==typeof t)this.setProperty("border-radius",t);else if(Array.isArray(t)){let e="";t.forEach((t=>{e+=`${t}px `})),e.substring(0,e.length-1),this.setProperty("border-radius",e)}else isNaN(t)||this.setProperty("border-radius",`${t}px`);return this}hasProperties(t){if(Array.isArray(t)){for(let e=0;e<t.length;e++)if(""!==this.getProperty(t[e]))return!0}else if(""!==this.getProperty(t))return!0;return!1}hasMargins(){return this.hasProperties(["margin","margin-top","margin-right","margin-bottom","margin-left"])}hasBorders(){return this.hasProperties(["border","border-top","border-right","border-bottom","border-left"])}hasPaddings(){return this.hasProperties(["padding","padding-top","padding-right","padding-bottom","padding-left"])}}const Kl={keyup:"keyup",keydown:"keydown",keypress:"keypress",mousedown:"mousedown",mouseup:"mouseup",mouseover:"mouseover",mousemove:"mousemove",mouseout:"mouseout",wheel:"wheel",click:"click",dblclick:"dblclick"};class Zl extends $l{preventedEvents=[];dragPosition={x:0,y:0};mouseDown=!1;constructor(){super(),this.setId(this.generateId(Hl)).appendClass(Hl),this.clearStyle(),window.addEventListener("contextmenu",(t=>{this._evt(t)})),window.addEventListener("focus",(t=>{this.dispatchEvent("focus",t)})),document.addEventListener("visibilitychange",(t=>{"hidden"===document.visibilityState?this.dispatchEvent("hidden",t):"visible"===document.visibilityState&&this.dispatchEvent("visible",t)})),window.addEventListener("resize",(t=>{t.preventDefault(),t.stopPropagation(),this.dispatchEvent("resize",t)})),this.preventAllEvents(),this.removePreventingEvent(Kl.wheel),this.enableMouseEvents()}preventAllEvents(){Object.values(Kl).filter((t=>"string"==typeof t)).map((t=>this.addPreventingEvent(t)))}addPreventingEvent(t){-1===this.preventedEvents.indexOf(t)&&this.preventedEvents.push(t)}removePreventingEvent(t){const e=this.preventedEvents.indexOf(t);-1!==e&&this.preventedEvents.splice(e,1)}_evt=t=>{this.preventedEvents.map((e=>{e===t.type&&t.preventDefault()}))};onClick=t=>{this._evt(t),this.dispatchEvent("click",t)};onDoubleClick=t=>{this._evt(t),this.dispatchEvent("dblclick",t)};onMouseDown=t=>{this._evt(t),this.mouseDown=!0,this.dragPosition.x=t.clientX,this.dragPosition.y=t.clientY,window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),this.dispatchEvent("mousedown",t)};onMouseMove=t=>{this._evt(t),this.dispatchEvent("mousedrag",t)};onMouseOut=t=>{this._evt(t),this.element.removeEventListener("mousedown",this.onMouseDown),this.element.removeEventListener("click",this.onDoubleClick),this.element.removeEventListener("dblclick",this.onClick),this.element.removeEventListener("mouseout",this.onMouseOut),this.element.removeEventListener("wheel",this.onMouseWheel),this.dispatchEvent("mouseout",t)};onMouseOver=t=>{this._evt(t),this.element.addEventListener("mousedown",this.onMouseDown),this.element.addEventListener("click",this.onClick),this.element.addEventListener("dblclick",this.onDoubleClick),this.element.addEventListener("mouseout",this.onMouseOut),this.element.addEventListener("wheel",this.onMouseWheel),this.dispatchEvent("mouseover",t)};onMouseUp=t=>{this._evt(t),this.mouseDown=!1,window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),this.dispatchEvent("mouseup",t)};onMouseWheel=t=>{this._evt(t),this.dispatchEvent("wheel",t)};disableMouseEvents(){this.element.removeEventListener("mouseover",this.onMouseOver),this.setProperty("cursor","auto")}enableMouseEvents(){this.element.addEventListener("mouseover",this.onMouseOver),this.setProperty("cursor","pointer")}}class Jl extends Zl{constructor(){super(),this.setId(this.generateId(Vl)).setClass(Vl),this.clearStyle(),this.setDisplayMode(ql).setPositionMode(Xl).useBorderBox(),this.applyProperties({"font-family":"IBM Plex Mono"}),this.setHtml(this.getId())}clampPosition(t,e){const n=this.getParent(),i=this.getSize();let r=0,s=0;if("BODY"===n.nodeName)r=window.innerWidth-i.width,s=window.innerHeight-i.height;else{if("DIV"!==n.nodeName)throw new Error('The parent of UIBox must be "document.body" of "div".');{const t=n.getBoundingClientRect();r=t.width-i.width,s=t.height-i.height}}return{x:t=(t=t>=r?r:t)<0?0:t,y:e=(e=e>=s?s:e)<0?0:e}}getSize(){const t=this.getBoundingClientRect();return{width:t.width,height:t.height}}setSize(t,e){return this.setProperty("width",`${t}px`),this.setProperty("height",`${e}px`),this}autoSize(){return this.removeProperty("height"),this.removeProperty("width"),this}showVScroll(){return this.setProperty("overflow-y","scroll"),this}hideVScroll(){return this.setProperty("overflow-y","hidden"),this}showHScroll(){return this.setProperty("overflow-x","scroll"),this}hideHScroll(){return this.setProperty("overflow-x","hidden"),this}getPosition(){const t=this.getBoundingClientRect();return{x:t.x,y:t.y}}setPosition(t,e){const n=this.clampPosition(t,e);return this.setProperty("left",`${n.x}px`),this.setProperty("top",`${n.y}px`),this}fillParent(t){return this.getParent()||this.appendToBody(),this.setPositionMode(Yl),this.setDisplayMode(ql),this.setPosition(0,0),this.applyProperties({width:"100%",height:"100%"}),this}}class Ql extends Fl{static USE_ENGINE_CALLBACK=!0;static SHOW_START_STOP_EVENT=!1;static SHOW_DONE_EVENT=!1;static animator=-1;static isRunning=!1;static classId=$l.generateId("_UITween");id="";static enginCallback={id:Ql.classId,listener:()=>{}};static tweenObjects=[];constructor(t,e,n,i,r){super(t),this.id=$l.generateId("_tween_item"),this.easing(Tl.Elastic.InOut),this.to(e,r).onUpdate((t=>n(t))).onComplete((t=>{s(),i(t)})),Ql.tweenObjects.push(this);const s=()=>{const t=Ql.tweenObjects.indexOf(this);Ql.tweenObjects.splice(t,1),Ql.SHOW_DONE_EVENT&&Ql._event_log("UITween DONE",`${this.id} (${Ql.tweenObjects.length})`)}}static _event_log(t,e){console.log(`%c${t}: %c${e}`,"color: #ff8","color: #8ff")}static _engine_callback_operation=()=>{Dl(),0===Ql.tweenObjects.filter((t=>t.isPlaying())).length&&(Ql.isRunning=!1,Rs.removeCallback(Ql.enginCallback),Ql.SHOW_START_STOP_EVENT&&Ql._event_log("UITween END",`${Ql.classId} (${Ql.tweenObjects.length})`))};static _request_animation_frame=()=>{Dl(),Ql.animator=requestAnimationFrame(this._request_animation_frame),0===Ql.tweenObjects.filter((t=>t.isPlaying())).length&&(Ql.isRunning=!1,cancelAnimationFrame(Ql.animator),Ql.SHOW_START_STOP_EVENT&&Ql._event_log("UITween END",`${Ql.classId} (${Ql.tweenObjects.length})`))};play(){this.start(),!1===Ql.isRunning&&(Ql.isRunning=!0,!0===Ql.USE_ENGINE_CALLBACK?(Ql.enginCallback.listener=Ql._engine_callback_operation,Rs.addCallback(Ql.enginCallback)):Ql._request_animation_frame(),Ql.SHOW_START_STOP_EVENT&&Ql._event_log("UITween START",`${Ql.classId} (${Ql.tweenObjects.length})`))}kill(){this.stop(),Ql.isRunning=!1}}class th extends Jl{constructor(){super(),this.applyProperties({}).showOutline(),this.getParent()||this.appendToBody()}_updateProps(t){this.getParent()&&this.setOpacity(t.opacity)}async fadeIn(t=1e3){return new Promise(((e,n)=>{new Ql({opacity:0},{opacity:1},(t=>this._updateProps(t)),(t=>e(this)),t).play()}))}async fadeOut(t=1e3){return new Promise(((e,n)=>{new Ql({opacity:1},{opacity:0},(t=>this._updateProps(t)),(t=>{e(this),this.dispose()}),t).play()}))}async delay(t=1e3){return new Promise(((e,n)=>{setTimeout((()=>{e(this)}),t)}))}async popup(t=500,e=2e3,n=1e3){return await this.fadeIn(t),await this.delay(e),this.fadeOut(n)}}const eh="#0f2",nh="#0af";class ih extends th{constructor(t,e){super(),this.useBorderBox().setHtml(` ${t}`).useBorderBox().hideOutline().setDisplayMode(jl).setPositionMode(Xl).applyProperties({border:`2px solid ${e}`,"border-width":"0px 0px 0px 2px","background-color":"rgba(0, 0, 0, 0.5)",padding:"0px 12px 0px 12px","border-radius":"0px 6px 6px 0px","font-family":"IBM Plex Mono",margin:"4px 0px 4px 0px","user-select":"none",color:`${e}`})}}class rh extends Jl{alertItems=[];static instance;constructor(){super(),this.appendToBody().useBorderBox().clearHtml().setZindex(1).setDisplayMode(ql).setPositionMode(Yl).moveToBottom().moveToLeft().applyProperties({})}static getInstance(){return rh.instance||(rh.instance=new rh),rh.instance}async alert(t,e="#0af",n=250,i=5e3,r=1e3){rh.instance||(rh.instance=rh.getInstance()),this.alertItems.length>20&&this.alertItems.splice(0,1)[0].removeFromParent();const s=new ih(t,e);this.alertItems.push(s),s.appendTo(this),await s.popup(n,i,r),this.moveToBottom().moveToLeft()}static alert(t,e=250,n=5e3,i=1e3){this.getInstance().alert(t,eh,e,n,i)}static normal(t,e=250,n=5e3,i=1e3){this.getInstance().alert(t,"#eee",e,n,i)}static info(t,e=250,n=5e3,i=1e3){this.getInstance().alert(t,nh,e,n,i)}static success(t,e=250,n=5e3,i=1e3){this.getInstance().alert(t,eh,e,n,i)}static warn(t,e=250,n=5e3,i=1e3){this.getInstance().alert(t,"#fb2",e,n,i)}static error(t,e=250,n=5e3,i=1e3){this.getInstance().alert(t,"#f50",e,n,i)}}class sh extends Jl{static dragItems=[];allowDrag=!0;childrenCanDrag;dragTarget;constructor(t){super(),this.setId(this.generateId(Gl)).setClass(Gl),this.clearStyle(),this.setDisplayMode(jl).setPositionMode(Yl).useBorderBox().fillBackground("rgba(0, 0, 0, 0.5)"),this.applyProperties({"font-family":"IBM Plex Mono"}),this.dragTarget=this.element,this.childrenCanDrag=t||!1,this.setHtml(`${this.getId()}`);let e=!1;const n={x:0,y:0};this.addEventListener("mousedown",(t=>{const i=t.target;(1==this.childrenCanDrag||i.id===this.dragTarget.id)&&(e=!0),n.x=t.clientX,n.y=t.clientY,sh.sendToTop(this)})),this.addEventListener("mouseup",(t=>{e=!1})),this.addEventListener("mousedrag",(t=>{!0===this.allowDrag&&!0===e&&this.setPositionDelta(t.clientX-n.x,t.clientY-n.y),n.x=t.clientX,n.y=t.clientY})),this.addEventListener("mouseover",(t=>{const e=t.target;!0===this.childrenCanDrag||e.id===this.dragTarget.id?this.setProperty("cursor","move"):this.setProperty("cursor","auto")})),sh.dragItems.push(this)}static sendToTop(t){sh.dragItems.map(((t,e)=>t.setProperty("z-index",`${50+e}`)));const e=sh.dragItems.indexOf(t);return sh.dragItems[e].setProperty("z-index","99"),this}allowChildDragging(t){return this.childrenCanDrag=t,this}disableDragging(){return this.allowDrag=!1,this}enableDragging(){return this.allowDrag=!0,this}setDragTarget(t){return this.dragTarget=t,this}setPositionDelta(t,e){const n=this.getPosition();n.x+=t,n.y+=e;const i=this.element.parentNode;if("DIV"==i.nodeName){const t=i.getBoundingClientRect();n.x-=t.left,n.y-=t.top}else if("BODY"!=i.nodeName)throw new Error(`The UIDrag "${this.getId()}" must a child of DIV or BODY`);return this.setPosition(n.x,n.y),this}toggleDragging(){return this.allowDrag=!this.allowDrag,this}}class oh{static container;static progressItems=[];graphics;loadingManager;gltfLoader;loadingPath;loadedBytes=0;loadedItems=0;totalItems=1;constructor(t){this.graphics=t,this.loadingManager=new u.lLk(this.onLoad,this.onProgress,this.onError),this.gltfLoader=new Mr(this.loadingManager),oh.container||(oh.container=new Jl,oh.container.fillParent(),oh.container.applyProperties({opacity:"0","text-align":"center","border-radius":"20px","background-color":"rgba(0, 0, 0, 0.5)"}),oh.container.clearHtml().setSize(500,100).moveToCenter(),oh.container.removeFromParent())}onBytes=(t,e)=>{const n=oh.progressItems.findIndex((e=>e.path===t));oh.progressItems[n].element.setHtml(`Downloading ${t} ${(e/1970176).toFixed(2)} MB`)};onLoad=()=>{};onProgress=(t,e,n)=>{this.loadedItems=e,this.totalItems=n};onError=t=>{};updateAlignment(){if(oh.progressItems.length<=0)return;const t=oh.progressItems[0].element.getSize().height,e=.5*oh.container.getSize().height-.5*t*oh.progressItems.length;oh.progressItems.map(((t,n)=>{t.element.setPosition(0,e)}))}downloadStart(t){oh.container.getParent()||(oh.container.appendToBody().setOpacity(0),this.fadeIn(oh.container,500));const e={path:t,element:new Jl};oh.progressItems.push(e),e.element.setHtml(t).setPositionMode(Xl).setDisplayMode(jl),e.element.applyProperties({"font-family":"IBM Plex Mono",padding:"0px",margin:"0px"}).useBorderBox().setOpacity(0),e.element.appendTo(oh.container),this.fadeIn(e.element,2e3),this.updateAlignment()}async fadeOut(t,e){return new Promise(((n,i)=>{const r=new Fl({op:1}).to({op:0},e).onUpdate((e=>{t.setOpacity(e.op)})).onComplete((()=>{clearInterval(s),n(t)})).start(),s=setInterval((()=>{r.update()}),1e3/60)}))}async fadeIn(t,e){return new Promise(((n,i)=>{const r=new Fl({op:0}).to({op:1},e).onUpdate((e=>{t.setOpacity(e.op)})).onComplete((()=>{clearInterval(s),n(t)})).start(),s=setInterval((()=>{r.update()}),1e3/60)}))}async delay(t){return new Promise(((e,n)=>{setTimeout((()=>{e(t)}),t)}))}async downloadCompleted(t){let e=Object.values(oh.progressItems).findIndex((e=>e.path===t));-1!==e&&(await this.delay(1e3),e=Object.values(oh.progressItems).findIndex((e=>e.path===t)),-1!==e&&await this.fadeOut(oh.progressItems.slice()[e].element,1e3),e=Object.values(oh.progressItems).findIndex((e=>e.path===t)),-1!==e&&(oh.container.removeChild(oh.progressItems.slice()[e].element),oh.progressItems.splice(e,1)),0===oh.progressItems.length&&(await this.fadeOut(oh.container,500),oh.container.removeFromParent())),this.updateAlignment()}async loadModel(t,n=!1){const i=new Ml(this.graphics.scene);return new Promise(((r,s)=>{if(-1===Object.values(oh.progressItems).findIndex((e=>e.path===t)))this.downloadStart(t);else if(!n){const e=`The "${t}" is previously downloaded!`;throw console.log(`%c${e}`,"color: #f55"),s(e),new Error(e)}this.loadingPath=t,this.gltfLoader.load(t,(n=>{n.scene.name=Os.makeUid(e.Graphics.Scene.GLTF.NamePrefix);const s=this.graphics.manager.extract();i.setTarget(n.scene);const o=i.getChildren();s.map((t=>{o.map((e=>{if(t.name===e.name){console.log(`%cThe object named "${e.name}" is previously added to the main scene. The same name is not allowed.`,"color: #f85");const t=Os.makeUid(e.name);console.log(`%cThe object named "${e.name}" is renamed to "${t}"`,"color: #f85"),e.name=t}}))})),n.scene.traverse((t=>{t.isMesh&&(t.receiveShadow=!0,t.castShadow=!0)})),this.graphics.scene.add(n.scene),this.graphics.updateCamerasLightsMaterials(n.scene),this.graphics.adjustLights(),this.downloadCompleted(t),r(n)}),(e=>{this.loadedBytes=e.loaded,this.onBytes(t,e.loaded)}))}))}async loadModels(t,e=!1){return new Promise(((n,i)=>{const r=[];let s=0;t.length<1&&n(r),t.map((i=>{this.loadModel(i,e).then((e=>{r.push(e),++s===t.length&&n(r)}))}))}))}}class ah{static instance;container;scene=new u.xsS;constructor(){this.container=new sh(!0).appendToBody().clearHtml().setDisplayMode(ql).setPositionMode(Yl).useBorderBox().applyProperties({"font-family":"IBM Plex Mono","font-size":"14px",padding:"10px","border-radius":"10px",background:"rgba(0, 0, 0, 0.6)"}).setPosition(0,100).removeFromParent(),this.container.addEventListener("dblclick",(()=>this.refresh()))}static getInstance(){return this.instance||(this.instance=new ah),this.instance}setTargetScene(t){return this.scene=t,this}showSceneGraph(){this.analysis(this.scene),this.container.getParent()||this.container.appendToBody(),this.container.autoSize();const t=this.container.getBoundingClientRect();t.bottom>window.innerHeight?(this.container.setSize(t.width+20,t.height-(t.bottom-window.innerHeight)-10),this.container.showVScroll()):this.container.hideVScroll(),rh.info(`GAnalyzer updated (${this.container.getElement().children.length} items)`)}hideSceneGraph(){return this.container.dispose(),this}toggleSceneGraph(){return this.container.getParent()?this.hideSceneGraph():this.showSceneGraph(),this}refresh(){return this.container.getParent()&&(this.hideSceneGraph(),this.showSceneGraph()),this}level=0;analysis(t,e=!1){this.createLineItem(this.level,t,e),this.level++,t.children.length>0&&t.children.map(((e,n)=>{const i=n===t.children.length-1;this.analysis(e,i)})),this.level--}createLineItem=(t,e,n)=>{const i="padding-right: 8px;",r="color: #888;";let s="";for(let e=0;e<t;e++)s+=`<span style="${r} padding-right: 32px">|</span>`;s+=0!==t?n?`<span style="${i} ${r}"></span>`:`<span style="${i} ${r}"></span>`:`<span style="${i} color: #fff"></span>`;const o=(t,e)=>`<span style="${i} color:${e};">${t}</span>`;s+=o(`lv.${t}`,"#aaa"),s+=o(`${e.name}`,"#8f8"),s+=o(`&lt;${e.type}&gt;`,this.getTypeColor(e)),s+=o(`${e.parent?e.parent.name:"<i>null</i>"}`,e.parent?"#28f":"#aaa"),s+=o(`&lt;${e.parent?e.parent.type:"<i>null</i>"}&gt;`,e.parent?this.getTypeColor(e.parent):"#aaa"),(new Jl).appendTo(this.container).setHtml(s).useBorderBox().setDisplayMode(jl).applyProperties({})};getTypeColor=t=>{const e={Mesh:"#dd89f5",Group:"#ecf02b",Object3D:"#c830f2",PerspectiveCamera:"#6aaff7",OrthographicCamera:"#278bf5",AmbientLight:"#f7f7b5",HemisphereLight:"#f5f57f",PointLight:"#f7f743",DirectionalLight:"#eded13",Scene:"#ff841f",Points:"#38c1fc",AxesHelper:"#21b0db",default:"#a16b42"},n=Object.keys(e);for(let i=0;i<n.length;i++)if(n[i]==t.type)return Object.values(e)[i];const i=Object.values(e).length;return Object.values(e)[i-1]}}class lh{isEnabled=!1;composer;renderPass;unrealBloomPass;previousExposure;bokehPass;renderer;scene;camera;constructor(t,e,n){this.renderer=t,this.scene=e,this.camera=n;const i=new u.dd2(1024,1024,{minFilter:u.wem,magFilter:u.wem,format:u.wk1,encoding:u.knz});this.previousExposure=t.toneMappingExposure,t.toneMapping=u.LY2,this.composer=new fr(t,i),this.composer.setPixelRatio(window.devicePixelRatio),this.composer.setSize(window.innerWidth,window.innerHeight),this.renderPass=new xr(e,n),this.composer.addPass(this.renderPass),this.bokehPass=new vr(this.scene,this.camera,{focus:2,aperture:.001,maxblur:.005,width:window.innerWidth,height:window.innerHeight}),this.bokehPass.renderToScreen=!0,this.unrealBloomPass=new wr(new u.FM8(1024,1024),0,.12,.95),this.composer.addPass(new ur(ds))}activate(t){this.isEnabled=t,this.renderer.toneMappingExposure=t?2.5:this.previousExposure}setExposure(t){this.renderer.toneMappingExposure=t}useBokehPass(t){!0===t?-1===this.composer.passes.indexOf(this.bokehPass)&&this.composer.addPass(this.bokehPass):this.composer.removePass(this.bokehPass)}useUnrealBloomPass(t){!0===t?-1===this.composer.passes.indexOf(this.unrealBloomPass)&&this.composer.addPass(this.unrealBloomPass):this.composer.removePass(this.unrealBloomPass)}render(){this.composer.render()}}class hh extends Ds{needsEngineUpdate=!0;needsEngineResize=!0;postProcessing;manager;analyzer;gltfLoader;helper;label;controls;camera;scene;renderer;cameraList=[];lightList=[];envMap=pl.loadCubeTextureSync(e.Default.envMap);normalMaterial=new u.RSm({side:u.ehD});constructor(){super(s.Graphics,o.Graphics),this.gltfLoader=new oh(this),this.scene=new wl,this.analyzer=ah.getInstance().setTargetScene(this.scene),this.helper=new Sl(this),this.manager=new Ml(this.scene),this.scene.background=this.envMap,this.scene.environment=this.envMap,this.camera=new xl,this.cameraList.push(this.camera),this.camera=this.cameraList[0],this.lightList.push(Gs.createAmbientLight(.25)),this.scene.add(this.lightList[this.lightList.length-1]),this.lightList.push(Gs.createHemisphereLight(.25)),this.scene.add(this.lightList[this.lightList.length-1]),this.renderer=new bl(this.scene,this.camera),this.label=new Vs(this),this.controls=this.camera.createOwnControls(this.label.domElement),this.processSceneComponents(),this.adjustLights(),this.postProcessing=new lh(this.renderer,this.scene,this.camera)}setCamera(t,e=!0){this.controls.enabled=!1,t.controls||t.createOwnControls(this.label.domElement),this.controls=t.controls,this.controls.enabled=e,console.log(this.controls.enabled),this.camera=t,this.renderer.setCamera(t),this.camera.setAspect(),this.camera.updateProjectionMatrix(),rh.success(`Camera: "${t.name}" is selected.`)}nextCamera(t=!0){let e=this.cameraList.indexOf(this.camera);e=(e+1)%this.cameraList.length,this.setCamera(this.cameraList[e],t)}previousCamera(t=!0){let e=this.cameraList.indexOf(this.camera);e=0===e?this.cameraList.length-1:e-1,this.setCamera(this.cameraList[e],t)}async init(t,e){return new Promise(((n,i)=>{pl.loadDefaultCubeEnvTexture(t).then((t=>{this.envMap=t,this.scene.setBackground(this.envMap),this.scene.setEnvironment(this.envMap),this.fullScreen(),this.render(),this.gltfLoader.loadModels(e).then((t=>{const e={env:this.envMap,models:t};n(e)})).catch((t=>{console.error(t),i(t)}))}))}))}loadModel(t,e=!1){return this.gltfLoader.loadModel(t,e)}loadModels(t,e=!1){return this.gltfLoader.loadModels(t,e)}render(){return this.controls.enabled&&this.controls.update(),!0===this.postProcessing.isEnabled?this.postProcessing.render():this.renderer.update(),this.label.update(),this}setRenderSize(t,e){return this.camera.resize(t,e),this.renderer.resize(t,e),this.postProcessing.renderer.setSize(t,e),this.label.resize(t,e),this.render(),this}update(t){const e=window.performance.now();return this.render(),window.performance.now()-e}resize(t,e){this.setRenderSize(t,e)}dispose(){throw new Error("Method not implemented.")}fullScreen(){return this.setRenderPosition(0,0),this.setRenderSize(window.innerWidth,window.innerHeight),this}setRenderPosition(t,e){return this.renderer.getDomElement().style.position="absolute",this.renderer.getDomElement().style.left=`${t}px`,this.renderer.getDomElement().style.top=`${e}px`,this}getCamera(){return this.camera}getScene(){return this.scene}getCameraList(){return this.cameraList}getRenderer(){return this.renderer}getManager(){return this.manager}getHelper(){return this.helper}updateCamerasLightsMaterials(t){const e=new Ml(t).extract();return e.filter((t=>t instanceof u.cPb)).map((t=>{const e=t;this.cameraList.push(new xl(e))})),e.filter((t=>t instanceof u._kC)).map((t=>{const e=t;this.lightList.push(e)})),e.filter((t=>"Mesh"===t.type)).forEach((t=>{const e=t,n=e.material;n&&""===n.name&&null===n.map&&(e.material=this.normalMaterial)})),this}setSceneEnvironment(t,e){return e=void 0===e,this.scene.setEnvironment(t),!0===e&&this.scene.setBackground(t),this.render(),this}loadAndSetEnvironmentFromCubeTexture(t,e){return new Promise(((n,i)=>{this.loadAndCreateEnvMapFromCubeTexture(t).then((t=>{this.setSceneEnvironment(t,e),n(t)})).catch((t=>console.error(t)))}))}loadAndSetEnvironmentFromEquiTexture(t,e){return new Promise(((n,i)=>{this.loadAndCreateEnvMapFromEquiTexture(t).then((t=>{this.setSceneEnvironment(t,e),n(t)})).catch((t=>console.error(t)))}))}loadAndSetEnvironmentFromExrTexture(t,e){return new Promise(((n,i)=>{this.loadAndCreateEnvMapFromExrTexture(t).then((t=>{this.setSceneEnvironment(t,e),n(t)})).catch((t=>console.error(t)))}))}loadAndCreateEnvMapFromCubeTexture(t){return new Promise(((e,n)=>{const i=new u.anP(this.renderer);i.compileEquirectangularShader(),pl.loadDefaultCubeEnvTexture(t).then((t=>{const n=i.fromCubemap(t).texture;e(n),t.dispose(),i.dispose()})).catch((t=>console.error(t)))}))}loadAndCreateEnvMapFromEquiTexture(t){return new Promise(((e,n)=>{const i=new u.anP(this.renderer);i.compileEquirectangularShader(),pl.loadTexture(t).then((t=>{const n=i.fromEquirectangular(t).texture;e(n),t.dispose(),i.dispose()})).catch((t=>console.error(t)))}))}loadAndCreateEnvMapFromExrTexture(t){return new Promise(((e,n)=>{const i=new u.anP(this.renderer);i.compileEquirectangularShader(),pl.loadExrTexture(t).then((t=>{const n=i.fromEquirectangular(t).texture;e(n),t.dispose(),i.dispose()})).catch((t=>console.error(t)))}))}setSceneBackground(t,e=!0){return this.scene.setBackground(t),e&&this.render(),this}setSceneBackgroundColor(t,e=!0){return t instanceof u.Ilk?this.scene.setBackground(t):this.scene.setBackground(new u.Ilk(t)),e&&this.render(),this}applyEnvMapToMaterial(t,e,n=!0){return t.envMap=e,n&&this.render(),this}applyEnvMapToMesh(t,e,n){const i=t.material;return this.applyEnvMapToMaterial(i,e,n),this}applyEnvMapToScene(t,e,n){return e=e||this.scene,!0===(n=n||!0)&&this.setSceneBackground(t),e.traverse((e=>{const n=e;n.isMesh&&this.applyEnvMapToMesh(n,t)})),this.render(),this}loadAndApplyCubeEnvMapToScene(t,e){return new Promise(((e,n)=>{this.loadAndCreateEnvMapFromCubeTexture(t).then((t=>{this.applyEnvMapToScene(t),this.setSceneBackground(t),e(t)})).catch((t=>console.error(t)))}))}loadAndApplyExrEnvMapToScene(t){return new Promise(((e,n)=>{this.loadAndCreateEnvMapFromExrTexture(t).then((t=>{this.applyEnvMapToScene(t),this.setSceneBackground(t),e(t)})).catch((t=>console.error(t)))}))}getMeshes(t,n=!0){t=t||this.scene;const i=[];return t.traverse((t=>{if(Os.isMesh(t)){if(!0===n&&0===t.name.lastIndexOf(e.SpecialObjects.MeshDebug.NamePrefix))return;i.push(t)}})),i}getLights(t){t=t||this.scene;const e=[];return t.traverse((t=>{const n=t;n.isLight&&e.push(n)})),e}printSceneGraph(t){t=t||this.scene,console.group("%cGraphics.printSceneGraph","color: #ee5");const e=(t,e,n,i)=>{let r=0===t.name.indexOf("__helper")?"#3d9bb8":"#b4ff9c";r=0===t.name.indexOf("__label")?"#a65aa6":r,console.log(`%c${((t,e)=>{let n="";if(0==t)return"";for(let e=0;e<t;e++)n+="|  ";return n+=e?"":"",n})(n,i)} %clv.${n}  %c${t.name} %c<${t.type}> %c{${e.name}}`,"color: gray","color: #67d6ac",`color: ${r}`,`${(t=>{const e={Mesh:"#dd89f5",Group:"#ecf02b",Object3D:"#c830f2",PerspectiveCamera:"#6aaff7",OrthographicCamera:"#278bf5",AmbientLight:"#f7f7b5",HemisphereLight:"#f5f57f",PointLight:"#f7f743",DirectionalLight:"#eded13",Scene:"#ff841f",Points:"#38c1fc",AxesHelper:"#21b0db",default:"#a16b42"},n=Object.keys(e);for(let i=0;i<n.length;i++)if(n[i]==t.type)return"color:"+Object.values(e)[i];const i=Object.values(e).length;return"color:"+Object.values(e)[i-1]})(t)}`,"color: green")};let n=0;const i=t=>{if(t.children&&t.children.length>0){n++;let r=0,s=!1;t.children.forEach((o=>{s=++r>=t.children.length,e(o,t,n,s),i(o)})),n--}};return e(t,t,n,!1),i(t),console.groupEnd(),this}processSceneComponents(t){return(t=t||this.scene).traverse((t=>{if(t.parent&&(!t.name||""==t.name)){const e=`${Os.makeUid(t.type)}`;console.log(`%cNew name of "${t.type}" object is "${e}".`,"color: #ff8"),t.name=e}})),this}adjustLights(){return this.getLights().forEach((t=>{const n=e.Graphics.Light.Shadow.MapSize;t.shadow&&(t.castShadow=!0,t.shadow.mapSize.width=n,t.shadow.mapSize.height=n,t.shadow.bias=-2e-4)})),this}_getObjects(){return this.manager.extract().filter((t=>!Os.isSpecialObject(t))).filter((t=>Os.isMesh(t)||Os.isGroup(t))).filter((t=>!Os.isGLTFScene(t))).filter((t=>!Os.isSubFace(t)))}showLabels(){this._getObjects().map((t=>this.label.showLabel(t)))}hideLabels(){this._getObjects().map((t=>this.label.hideLabel(t)))}toggleLabels(){this._getObjects().map((t=>this.label.toggleLabel(t)))}Vector2(t=0,e=0){return new u.FM8(t,e)}Vector3(t=0,e=0,n=0){return new u.Pa4(t,e,n)}Vector4(t=0,e=0,n=0,i=0){return new u.Ltg(t,e,n,i)}Quaternion(t=0,e=0,n=0,i=0){return new u._fP(t,e,n,i)}}const ch=e.SpecialObjects.MeshDebug.NamePrefix;class uh{static DebugMeshScaleFactor=1.01;NumOfBodies=0;debugScene=new u.xsS;scene;world;_meshes;_debugMats=[];_particleMaterial=new u.UY4;_sphereGeometry;_boxGeometry;_cylinderGeometry;_planeGeometry;_particleGeometry;tmpVec0=new f;tmpVec1=new f;tmpVec2=new f;tmpQuat0=new M;constructor(t,e,n){n=n||{},this.scene=t,this.world=e,this.debugScene.name="PhysicsDebugScene",this._meshes=[],this.scene.add(this.debugScene);const i=[16711680,65280,255];for(let t=0;t<3;t++)this._debugMats.push(new u.vBJ({color:i[t],wireframe:!0,transparent:!0,opacity:1}));this._particleMaterial=new u.UY4({color:16711680,size:10,sizeAttenuation:!1,depthTest:!1}),this._sphereGeometry=new u.xo$(1),this._boxGeometry=new u.DvJ(1,1,1),this._cylinderGeometry=new u.fHI(1,1,2,8),this._planeGeometry=new u._12(10,10,10,10),this._particleGeometry=new u.u9r,this._particleGeometry.setFromPoints([new u.Pa4(0,0,0)])}getDebugMeshes(){return this._meshes}getDebugScene(){return this.debugScene}reset(){const t=[];this.debugScene.traverse((n=>{const i=n;i&&0===i.name.indexOf(e.SpecialObjects.MeshDebug.NamePrefix)&&t.push(i)})),t.forEach((t=>{t.parent?.remove(t)})),this._meshes=[]}update(){this.NumOfBodies!==this.world.bodies.length&&(this.NumOfBodies=this.world.bodies.length,this.reset());const t=this.world.bodies,e=this._meshes,n=this.tmpVec0,i=this.tmpQuat0;let r=0;for(let s=0;s!==t.length;s++){const o=t[s];for(let t=0;t!==o.shapes.length;t++){const s=o.shapes[t];this._updateMesh(r,o,s);const a=e[r];a&&(o.quaternion.vmult(o.shapeOffsets[t],n),o.position.vadd(n,n),o.quaternion.mult(o.shapeOrientations[t],i),a.position.x=n.x,a.position.y=n.y,a.position.z=n.z,a.quaternion.x=i.x,a.quaternion.y=i.y,a.quaternion.z=i.z,a.quaternion.w=i.w),r++}}for(let t=r;t<e.length;t++){const n=e[t];n&&this.debugScene.remove(n)}e.length=r}_updateMesh(t,e,n){let i=this._meshes[t];this._typeMatch(i,n)||(i&&this.debugScene.remove(i),i=this._meshes[t]=this._createMesh(n,e)),this._scaleMesh(i,n)}_typeMatch(t,e){if(!t)return!1;const n=t.geometry;return n instanceof u.xo$&&e instanceof ce||n instanceof u.DvJ&&e instanceof O||n instanceof u.fHI&&e instanceof ue||n instanceof u._12&&e instanceof de||e instanceof P||n.id===e.id&&e instanceof Pe||n.id===e.id&&e instanceof fe}_getMaterial=t=>{let e=0;return t.type===z.DYNAMIC?e=0:t.type===z.KINEMATIC?e=1:t.type===z.STATIC&&(e=2),this._debugMats[e]};_createMesh(t,e){let n,i,r,s,o;const a=this._getMaterial(e);let l=[];switch(t.type){case E.types.SPHERE:n=new u.Kj0(this._sphereGeometry,a);break;case E.types.BOX:n=new u.Kj0(this._boxGeometry,a);break;case E.types.CYLINDER:const e=t;i=new u.fHI(e.radiusTop,e.radiusBottom,e.height,e.numSegments),n=new u.Kj0(i,a);break;case E.types.PLANE:n=new u.Kj0(this._planeGeometry,a);break;case E.types.PARTICLE:n=new u.woe(this._particleGeometry,this._particleMaterial);break;case E.types.CONVEXPOLYHEDRON:i=new u.u9r,t.id=i.id,l=[];for(let e=0;e<t.vertices.length;e+=1){const n=t.vertices[e];l.push(new u.Pa4(n.x,n.y,n.z))}i.setFromPoints(l);const h=[];for(let e=0;e<t.faces.length;e++){const n=t.faces[e],i=n[0];for(let t=1;t<n.length-1;t++){const e=n[t],r=n[t+1];h.push(i,e,r)}}i.setIndex(h),n=new u.Kj0(i,a);break;case E.types.TRIMESH:i=new u.u9r,t.id=i.id,l=[];for(let e=0;e<t.vertices.length;e+=3)l.push(new u.Pa4(t.vertices[e],t.vertices[e+1],t.vertices[e+2]));i.setFromPoints(l),n=new u.Kj0(i,a);break;case E.types.HEIGHTFIELD:i=new u.u9r,r=this.tmpVec0,s=this.tmpVec1,o=this.tmpVec2;for(let e=0;e<t.data.length-1;e++)for(let n=0;n<t.data[e].length-1;n++)for(let i=0;i<2;i++)t.getConvexTrianglePillar(e,n,0===i),r.copy(t.pillarConvex.vertices[0]),s.copy(t.pillarConvex.vertices[1]),o.copy(t.pillarConvex.vertices[2]),r.vadd(t.pillarOffset,r),s.vadd(t.pillarOffset,s),o.vadd(t.pillarOffset,o),l.push(new u.Pa4(r.x,r.y,r.z),new u.Pa4(s.x,s.y,s.z),new u.Pa4(o.x,o.y,o.z));i.setFromPoints(l),n=new u.Kj0(i,a),t.id=i.id;break;default:n=new u.Kj0}return n&&n.geometry&&(this.debugScene.add(n),n.name=`${ch}_${this._getTypeString(t.type)}_id_${Math.floor(1e4*Math.random())}`),n}_getTypeString(t){switch(t){case E.types.SPHERE:return"SPHERE";case E.types.PLANE:return"PLANE";case E.types.BOX:return"BOX";case E.types.COMPOUND:return"COMPOUND";case E.types.CONVEXPOLYHEDRON:return"CONVEXPOLYHEDRON";case E.types.HEIGHTFIELD:return"HEIGHTFIELD";case E.types.PARTICLE:return"PARTICLE";case E.types.CYLINDER:return"CYLINDER";case E.types.TRIMESH:return"TRIMESH"}}_scaleMesh(t,e){let n,i,r;const s=uh.DebugMeshScaleFactor;switch(e.type){case E.types.SPHERE:n=e.radius*s,t.scale.set(n,n,n);break;case E.types.BOX:i=e.halfExtents.scale(s),t.scale.copy(new u.Pa4(i.x,i.y,i.z)),t.scale.multiplyScalar(2);break;case E.types.CONVEXPOLYHEDRON:t.scale.set(1*s,1*s,1*s);break;case E.types.TRIMESH:r=e.scale,t.scale.copy(new u.Pa4(r.x*s,r.y*s,r.z*s));break;case E.types.HEIGHTFIELD:t.scale.set(1*s,1*s,1*s)}}}class dh extends Ds{needsEngineUpdate=!0;needsEngineResize=!1;world;scene;debug;enabled=!0;constructor(t,e){super(s.PhysicsDebug,o.Physics),this.scene=t,this.world=e,this.debug=new uh(this.scene,this.world)}update(t){const e=window.performance.now();return!0===this.enabled&&this.debug.update(),window.performance.now()-e}resize(t,e){}dispose(){throw new Error("Method not implemented.")}setVisible(t){return!1===t&&this.debug.reset(),this}showDebug(){return this.enabled=!0,this.setVisible(this.enabled),this}hideDebug(){return this.enabled=!1,this.setVisible(this.enabled),this}toggleDebug(){return this.enabled=!this.enabled,this.setVisible(this.enabled),this}}class ph{physics;constructor(t){this.physics=t}getObjects(){return this.physics.physicObjects}getObject(t){return this.getObjects().filter((e=>e.getMesh().name===t))[0]}getBodies(){const t=[];return this.getObjects().map((e=>t.push(e.getBody()))),t}getBody(t){return this.getObject(t).getBody()}}class fh extends Ds{needsEngineUpdate=!0;needsEngineResize=!1;static MAX_DISTANCE=50;enabled=!1;world;graphics;scene;physicsDebug;physicObjects=[];manager;constructor(t){super(s.Physics,o.Physics),this.graphics=t,this.scene=t.scene,this.manager=new ph(this),this.world=new Gi,this.world.gravity.set(0,-9.82,0),this.world.broadphase=new nt,this.world.allowSleep=!0,this.world.solver.iterations=10,this.physicsDebug=new dh(this.scene,this.world),Cs.onKeyDown((t=>{!0===t.keyEvent.shiftKey&&(this.enabled=!this.enabled)}))}start(){this.enabled=!0}stop(){this.enabled=!1}async init(){return new Promise(((t,e)=>{t(this)}))}update(t){const e=window.performance.now();if(!0===this.enabled){t=t>2e3/60?2e3/60:t,t/=1e3;const e=1/60;this.world.step(e,t,4),this.physicObjects.slice().map((t=>t.updateMeshPositionAndQuaternion())),this.removeLongRangeObjects()}return window.performance.now()-e}resize(t,e){}dispose(){throw new Error("Method not implemented.")}removeLongRangeObjects(){const t=fh.MAX_DISTANCE,e=[],n=this.physicObjects.slice();for(let i=0;i<n.length;i++){const r=n[i].getBody().position;(Math.abs(r.x)>t||Math.abs(r.y)>t||Math.abs(r.z)>t)&&e.push(i)}for(let t=0;t<e.length;t++){const i=n[e[t]],r=i.getMesh();r.parent&&console.log(`@Physics.removeLongRangeObjects: ${r.name} is removed.`),Os.disposeObject(r),this.removeObjectFromWorld(i)}e.length>0&&this.graphics.renderer.renderLists.dispose()}addObjectToWorld(t){let e=!1;const n=t.getMesh().name,i=this.physicObjects.slice().filter((t=>t.getMesh().name===n))[0];i&&(console.log(`%cThe previous object and body of "${n}" are updated.`,"color:#ff0"),this.world.removeBody(i.getBody()),e=!0),e&&(this.physicObjects=this.physicObjects.slice().filter((t=>t.getMesh().name!==n))),this.physicObjects.push(t),this.world.addBody(t.getBody()),e&&console.log(`%cPhysicsObjects and Bodies of "${n}" are updated => #objects: ${this.physicObjects.length}, #bodies: ${this.world.bodies.length}`,"color:#fc0")}removeObjectFromWorld(t){const e=this.physicObjects.slice(),n=e.indexOf(t),i=e.splice(n,1)[0];this.physicObjects=e,this.world.removeBody(i.getBody())}getBody(t){for(let e=0;e<this.physicObjects.length;e++){const n=this.physicObjects[e];if(n.getMesh().name===t)return n.getBody()}}getBodies(t){const e=[];return void 0===t?this.physicObjects.forEach((t=>{e.push(t.getBody())})):this.physicObjects.forEach((n=>{n.getBody().type===t&&e.push(n.getBody())})),e}toggleDebug(){this.physicsDebug.toggleDebug()}testWorld(){}Vec3(t=0,e=0,n=0){return new f(t,e,n)}Quaternion(t=0,e=0,n=0,i=0){return new M(t,e,n,i)}}const mh=class{static CreateTrimesh(t){let e;e=null===t.index?t.attributes.position.array:t.clone().toNonIndexed().attributes.position.array;const n=Object.keys(e).map(Number);return new Pe(e,n)}static CreateConvexPolyhedron(t){const e=t.attributes.position,n=t.attributes.normal,i=[];for(let t=0;t<e.count;t++)i.push((new u.Pa4).fromBufferAttribute(e,t));const r=[];for(let t=0;t<e.count;t+=3){const e={a:t,b:t+1,c:t+2,normals:void 0===n?[]:[(new u.Pa4).fromBufferAttribute(n,t),(new u.Pa4).fromBufferAttribute(n,t+1),(new u.Pa4).fromBufferAttribute(n,t+2)]};r.push(e)}const s={},o=[],a=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],n=Math.round(100*e.x)+"_"+Math.round(100*e.y)+"_"+Math.round(100*e.z);void 0===s[n]?(s[n]=t,o.push(new f(i[t].x,i[t].y,i[t].z)),a[t]=o.length-1):a[t]=a[s[n]]}const l=[];for(let t=0,e=r.length;t<e;t++){const e=r[t];e.a=a[e.a],e.b=a[e.b],e.c=a[e.c];const n=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(n[e]===n[(e+1)%3]){l.push(t);break}}for(let t=l.length-1;t>=0;t--){const e=l[t];r.splice(e,1)}const h=r.map((function(t){return[t.a,t.b,t.c]}));return new P({vertices:o,faces:h})}static offsetCenterOfMass(t,e){t.shapeOffsets.forEach((function(t){e.vadd(t,e)})),e.scale(1/t.shapes.length,e),t.shapeOffsets.forEach((function(t){t.vsub(e,t)}));const n=new f;t.vectorToWorldFrame(e,n),t.position.vadd(n,t.position)}};class gh{static assertNoBounding(t){return console.assert(t.geometry.boundingBox,`BoundingBox of the "${t.name}" is not defined.`),!!t.geometry.boundingBox}static getOrigin(t,e=!1){this.assertNoBounding(t);const n=new u.Pa4,i=t.geometry.boundingBox;return i&&(n.x=i.min.x+(i.max.x-i.min.x)/2,n.y=i.min.y+(i.max.y-i.min.y)/2,n.z=i.min.z+(i.max.z-i.min.z)/2),!0===e?new f(n.x,n.y,n.z):n}static getCenter(t,e=!1){this.assertNoBounding(t);const n=new u.Pa4,i=t.geometry.boundingBox;return i&&(n.x=(i.max.x-i.min.x)/2,n.y=(i.max.y-i.min.y)/2,n.z=(i.max.z-i.min.z)/2),!0===e?new f(n.x,n.y,n.z):n}static getCustomProperties(t){return t.userData}static getProperty(t,e){const n=this.getCustomProperties(t);return n[Object.keys(n).filter((t=>t===e))[0]]}static getObjectType(t){return this.getProperty(t,e.CustomProperties.Graphics.Key)}static getPropBodyType(t){return this.getProperty(t,e.CustomProperties.Physics.Key)}static isPropDynamicType(t){return this.getPropBodyType(t)===e.CustomProperties.Physics.Types.Dynamic}static isPropKinematicType(t){return this.getPropBodyType(t)===e.CustomProperties.Physics.Types.Kinematic}static isPropStaticType(t){return this.getPropBodyType(t)===e.CustomProperties.Physics.Types.Static}static isPropNonPhysicsType(t){return this.getPropBodyType(t)===e.CustomProperties.Physics.Types.NonPhysics}}class vh{static isPlane(t){return 0===(t=t.toLowerCase()).indexOf("plane")}static isFloor(t){return 0===(t=t.toLowerCase()).indexOf("floor")||0===t.indexOf("wall")||0===t.indexOf("ground")||0===t.indexOf("platform")}static isCube(t){return 0===(t=t.toLowerCase()).indexOf("cube")||0===t.indexOf("box")}static isSphere(t){return 0===(t=t.toLowerCase()).indexOf("sphere")||0===t.indexOf("ball")}static isCylinder(t){return 0===(t=t.toLowerCase()).indexOf("cylinder")}static isCone(t){return 0===(t=t.toLowerCase()).indexOf("cone")}static isIcosphere(t){return 0===(t=t.toLowerCase()).indexOf("icosphere")}static isTorus(t){return 0===(t=t.toLowerCase()).indexOf("torus")}static isCapsule(t){return 0===(t=t.toLowerCase()).indexOf("capsule")}static isSuzanne(t){return 0===(t=t.toLowerCase()).indexOf("suzanne")}static isPlayer(t){return 0===(t=t.toLowerCase()).indexOf("player")}}class yh{static cylinderNumSegments=12;static forceIcosphereAsSphere=!0;static forceUnknownAsCube=!0;static getBodyType(t){return gh.getProperty(t,e.CustomProperties.Physics.Key)||(vh.isFloor(t.name)?e.CustomProperties.Physics.Types.Static:e.CustomProperties.Physics.Types.Dynamic)}static getSphereRadius=t=>{const e=t.geometry.boundingSphere;if(e)return e.radius;throw new Error('The provided mesh not contains the "boundingSphere" property.!')};static getBoundingBox(t){const e=[];if("Mesh"===t.type){const n=t;n.geometry.boundingBox&&e.push(n.geometry.boundingBox)}else{if("Group"!==t.type)throw new Error("getBoundingBox supports only Mesh and Group!");t.children.forEach((t=>{if("Mesh"===t.type){const n=t;n&&n.geometry.boundingBox&&e.push(n.geometry.boundingBox)}}))}const n=(t,e)=>t>e?t:e,i=(t,e)=>t<e?t:e;let r=0,s=0,o=0,a=0,l=0,h=0;return e.map(((t,e)=>{r=n(r,t.max.x),s=i(s,t.min.x),o=n(o,t.max.y),a=i(a,t.min.y),l=n(l,t.max.z),h=i(h,t.min.z)})),new f(r-s,o-a,l-h)}static computeMass(t){const e=this.getBoundingBox(t);return e.x*e.y*e.z/3}static getPosition(t){const e=t.position;return new f(e.x,e.y,e.z)}static getQuaternion(t){const e=t.quaternion;return new M(e.x,e.y,e.z,e.w)}static copyPosition=(t,e)=>{t.position.set(e.position.x,e.position.y,e.position.z)};static copyQuaternion=(t,e)=>{t.quaternion.set(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w)};static copyPnQ(t,e){this.copyPosition(t,e),this.copyQuaternion(t,e)}static createBody(t=z.DYNAMIC,e=1){const n=new z({mass:e});return n.type=t,t===z.STATIC?n.mass=0:t===z.KINEMATIC&&(n.velocity.setZero(),n.angularVelocity.setZero()),n.updateMassProperties(),n.aabbNeedsUpdate=!0,n}static createCubeShape(t){const e=this.getBoundingBox(t).scale(.5);return new O(e)}static createCubeBody(t,e){const n=this.createCubeShape(t),i=new z({mass:e||this.computeMass(t)});return this.copyPnQ(i,t),i.addShape(n,gh.getOrigin(t)),i}static createSphereShape(t){const e=this.getSphereRadius(t)/1.7320499128373052;return new ce(e)}static createSphereBody(t,e){const n=this.createSphereShape(t),i=new z({mass:e||this.computeMass(t)});return this.copyPnQ(i,t),i.addShape(n,gh.getOrigin(t,!0)),i}static createCylinderShape(t,e=this.cylinderNumSegments){const n=this.getBoundingBox(t).scale(.5),i=n.x,r=n.z,s=2*n.y;return new ue(i,r,s,e)}static createTorusShape(t){return this.createCylinderShape(t)}static createCapsuleShape(t){const e=this.getBoundingBox(t),n=e.y,i=e.x/2;return new ue(i,i,n,this.cylinderNumSegments)}static createSuzanneShape(t){const e=this.getBoundingBox(t),n=e.y,i=e.x/2;return new ue(i,i,n,this.cylinderNumSegments)}static createSpecialCylinderShape(t,e=.5,n=1,i=this.cylinderNumSegments){const r=this.getBoundingBox(t).scale(.5),s=r.x*e,o=r.z*n,a=2*r.y;return new ue(s,o,a,i)}static createCylinderBody(t,e){const n=this.createCylinderShape(t),i=new z({mass:e||this.computeMass(t)});return this.copyPnQ(i,t),i.addShape(n,gh.getOrigin(t,!0)),i}static createSpecialCylinderBody(t,e=.5,n=1,i){const r=this.createSpecialCylinderShape(t,e,n),s=new z({mass:i||this.computeMass(t)});return this.copyPnQ(s,t),s.addShape(r,gh.getOrigin(t,!0)),s}static createConeBody(t,e){const n=this.createSpecialCylinderShape(t,.001,1),i=new z({mass:e||this.computeMass(t)});return this.copyPnQ(i,t),i.addShape(n,gh.getOrigin(t,!0)),i}static createCannonPlaneShape(){return new de}static createCannonPlaneBody(t=0){const e=this.createCannonPlaneShape(),n=new z({mass:t});return n.quaternion.setFromAxisAngle(new f(1,0,0),-Math.PI/2),n.addShape(e),n}static createPlaneShape(t){const e=this.getBoundingBox(t).scale(.5);return e.y<=0&&(e.y=.01),new O(e)}static createPlaneBody(t,e=0){const n=this.createPlaneShape(t),i=new z({mass:e});return this.copyPnQ(i,t),i.addShape(n,gh.getOrigin(t,!0)),i}static createTrimeshShape(t){return mh.CreateTrimesh(t.geometry)}static createTrimeshBody(t,e){const n=mh.CreateTrimesh(t.geometry),i=new z({mass:e||this.computeMass(t)});return this.copyPnQ(i,t),i.addShape(n,gh.getOrigin(t,!0)),i}static createIcosahedronShape(t){return mh.CreateConvexPolyhedron(t.geometry)}static createIcosahedronBody(t,e){const n=mh.CreateConvexPolyhedron(t.geometry),i=new z({mass:e||this.computeMass(t)});return this.copyPnQ(i,t),i.addShape(n,gh.getOrigin(t,!0)),i}static createCapsuleBodyMultiShapes(t,e){const n=this.getBoundingBox(t),i=n.x/2,r=n.y-2*i,s=new ue(i,i,r,this.cylinderNumSegments),o=new ce(i),a=new ce(i),l=new z({mass:e||this.computeMass(t)}),h=gh.getOrigin(t,!0),c=new f(0,0,0),u=h.vadd(new f(0,+r/2,0)),d=h.vadd(new f(0,-r/2,0));return l.addShape(s,h),l.addShape(o,u.vadd(c)),l.addShape(a,d.vsub(c)),this.copyPnQ(l,t),l}static createSuzanneBodyMultiShapes(t,e){const n=this.getBoundingBox(t).x/2,i=new ce(.62*n),r=new ce(.2*n),s=new ce(.25*n),o=new ce(.25*n),a=new z({mass:e||this.computeMass(t)}),l=gh.getOrigin(t,!0),h=n,c=new f(0,.19*h,.12*h);a.addShape(i,l.vadd(c));const u=new f(0,-.5*h,.4*h);a.addShape(r,l.vadd(u));const d=new f(.8*h,.15*h,-.32*h);a.addShape(s,l.vadd(d));const p=new f(-.8*h,.15*h,-.32*h);return a.addShape(o,l.vadd(p)),this.copyPnQ(a,t),a}static makeStaticBody(t){return t.type=z.STATIC,t.mass=0,t.updateMassProperties(),t.aabbNeedsUpdate=!0,t}static getInferredType(t){const e=t.name.toLowerCase();return vh.isPlane(e)||vh.isFloor(e)?z.STATIC:vh.isPlayer(e)?z.KINEMATIC:z.DYNAMIC}static createInferredShape(t){const e=t.name.toLowerCase();let n;if(vh.isPlane(e)||vh.isFloor(e))n=this.createPlaneShape(t);else if(vh.isCube(e))n=this.createCubeShape(t);else if(vh.isSphere(e))n=this.createSphereShape(t);else{if(vh.isCylinder(e))return this.createCylinderShape(t);vh.isCone(e)?n=this.createSpecialCylinderShape(t,.001,1):vh.isTorus(e)?n=this.createTorusShape(t):vh.isCapsule(e)?n=this.createCapsuleShape(t):vh.isSuzanne(e)?n=this.createSuzanneShape(t):vh.isIcosphere(e)?!0===this.forceIcosphereAsSphere?(console.log(`%cThe shape of "${e}" will be a sphere-shape.`,"color:yellow"),n=this.createSphereShape(t)):n=this.createTrimeshShape(t):!0===this.forceUnknownAsCube?(console.log(`%cThe unknown object "${t.name}" will be applied by box-shape.`,"color:orange"),n=this.createCubeShape(t)):(console.log(`%cThe unknown object "${t.name}" will be applied by Trimesh-shape.`,"color:orange"),n=this.createTrimeshShape(t))}return n}static createInferredBody(t,e,n){let i;if(e=e||z.DYNAMIC,n=n||this.computeMass(t),vh.isCapsule(t.name))i=this.createCapsuleBodyMultiShapes(t,n);else if(vh.isSuzanne(t.name))i=this.createSuzanneBodyMultiShapes(t,n);else{i=new z({mass:n});const e=this.createInferredShape(t);i.addShape(e,gh.getOrigin(t,!0)),this.copyPnQ(i,t)}const r=t.name.toLowerCase();if(vh.isPlane(r)||vh.isFloor(r)?(this.makeStaticBody(i),console.log(`%cThe object "${t.name}" is converted to STATIC BODY.`,"color:orange")):i.type=e,t.userData.type){const e=t.userData.type.toLowerCase();"static"===e?this.makeStaticBody(i):"dynamic"===e||"rigid"===e?i.type=z.DYNAMIC:"kinematic"===e?i.type=z.KINEMATIC:console.log(`%cThe type "${t.userData.type}" provided in the "userData.type" is ignored`,"color:orange")}return i}}class xh{object;shapes=[];physics;body;constructor(t,e){if("Mesh"!==t.type&&"Group"!==t.type)throw new Error('The object type must be "Mesh" or "Group".');this.physics=e,this.object=t}addToPhysicsSystem(t){this.physics.addObjectToWorld(t)}updateObjectPosition(){const t=this.body;this.object.position.set(t.position.x,t.position.y,t.position.z)}updateObjectQuaternion(){const t=this.body;this.object.quaternion.set(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w)}updateMeshPositionAndQuaternion(){this.updateObjectPosition(),this.updateObjectQuaternion()}getBody(){return this.body}getMesh(){return this.object}getShapes(){return this.shapes}getMass(){return this.body.mass}getType(){return this.body.type}getTypeString(){const t=this.body.type;return t==z.DYNAMIC?"Dynamic":t==z.STATIC?"Static":t==z.KINEMATIC?"Kinematic":"Unknown"}setMass(t){this.body.mass=t,this.body.updateMassProperties()}changeToStatic(){const t=this.body;t.type=z.STATIC,t.mass=0,t.updateMassProperties(),t.aabbNeedsUpdate=!0}changeToKinematic(){const t=this.body;t.type=z.KINEMATIC,t.velocity.setZero(),t.angularVelocity.setZero(),t.updateMassProperties(),t.aabbNeedsUpdate=!0}changeToDynamic(t){const e=this.body;t=t||yh.computeMass(this.object),e.type=z.DYNAMIC,e.mass=0==e.mass?t:e.mass,e.updateMassProperties(),e.aabbNeedsUpdate=!0}computeMass(t){const e=Os.getBoundingBox(t);return e?(e.max.x-e.min.x)*(e.max.y-e.min.y)*(e.max.z-e.min.z):1}updateBodyType(t){const n=e.CustomProperties.Physics.Types;let i=yh.getBodyType(t);i||vh.isFloor(t.name)&&(i=n.Static),i===n.Static?this.changeToStatic():i===n.Kinematic?this.changeToKinematic():i===n.Dynamic?this.changeToDynamic():i===n.NonPhysics?this.shapes.forEach((t=>this.body.removeShape(t))):this.changeToDynamic()}Vec3(t,e,n){return new f(t,e,n)}Quat(t,e,n,i){return new M(t,e,n,i)}makeCannonVec3(t,e,n){return t instanceof f?t:t instanceof u.Pa4?new f(t.x,t.y,t.z):new f(t,e,n)}makeCannonQuaternion(t,e,n,i){return t instanceof M?t:t instanceof u._fP?new M(t.x,t.y,t.z,t.w):new M(t,e,n,i)}setAngularVelocity(t,e,n){this.body.angularVelocity=this.makeCannonVec3(t,e,n)}setAngularFactor(t,e,n){this.body.angularFactor=this.makeCannonVec3(t,e,n)}setAngularDamping(t){this.body.angularDamping=t}setLinearDamping(t){this.body.linearDamping=t}setLinearFactor(t,e,n){this.body.linearFactor=this.makeCannonVec3(t,e,n)}setVelocity(t,e,n){this.body.velocity=this.makeCannonVec3(t,e,n)}setPosition(t,e,n){this.body.position=this.makeCannonVec3(t,e,n),this.body.wakeUp()}setQuaternion(t,e,n,i){this.body.quaternion=this.makeCannonQuaternion(t,e,n,i)}applyForce(t,e){this.body.applyForce(this.makeCannonVec3(t),this.makeCannonVec3(e))}applyLocalForce(t,e){this.body.applyLocalForce(this.makeCannonVec3(t),this.makeCannonVec3(e))}applyImpulse(t,e){this.body.applyImpulse(this.makeCannonVec3(t),this.makeCannonVec3(e))}applyLocalImpulse(t,e){this.body.applyLocalImpulse(this.makeCannonVec3(t),this.makeCannonVec3(e))}fixedRotation(t=!0){this.body.fixedRotation=t,this.body.updateMassProperties()}}class bh extends xh{constructor(t,n){if(super(t,n),yh.getBodyType(t)!==e.CustomProperties.Physics.Types.NonPhysics){if("Mesh"!==t.type)throw new Error(`The object is not Mesh. The PMeshObject constructor accepts only Mesh object.\r\n            Name: "${t.name}" ("${t.type}")\r\n            Parent: "${t.parent?.name}" ("${t.parent?.type}")\n`);this.body=this.createInferredBody(t),this.body.shapes.forEach((t=>{this.shapes.push(t)})),this.updateBodyType(t),this.addSelfToPhysicsSystem()}else console.log(`%cThe "${t.name}" is defined as a non-physics object.`,"color: yellow")}addSelfToPhysicsSystem(){this.addToPhysicsSystem(this)}createInferredBody(t){return this.object=t,this.body=yh.createInferredBody(t),this.body}createInferredShape(t){this.object=t;const e=yh.createInferredShape(t);return this.shapes.push(e),e}}class wh extends xh{constructor(t,n,i){if(super(t,n),yh.getBodyType(t)!==e.CustomProperties.Physics.Types.NonPhysics){if(t.children.filter((t=>t.name.includes(e.Graphics.ShapeMesh.NameIncludes))).length<=0)throw new Error(`The "${t.name} ("${t.type}") is not multi-shape or custom-shape object."`);this.body=yh.createBody(),this.body.mass=yh.computeMass(t),console.log(this.body.mass),t.children.filter((t=>t.name.includes(e.Graphics.ShapeMesh.NameIncludes))).forEach((t=>{const e=t;if(!e)return;const n=yh.createInferredShape(e),i=yh.getPosition(e),r=yh.getQuaternion(e),s=gh.getOrigin(e,!0);gh.getCenter(e,!0),this.body.addShape(n,i.vadd(s),r),this.shapes.push(n)})),t.children.slice().filter((t=>t.name.includes(e.Graphics.ShapeMesh.NameIncludes))).forEach((t=>{Os.disposeObject(t)})),yh.copyPnQ(this.body,t),i.scene.add(t),this.updateBodyType(t),this.addSelfToPhysicsSystem()}else console.log(`%cThe "${t.name}" is non-physics object.`,"color: yellow")}addSelfToPhysicsSystem(){this.addToPhysicsSystem(this)}}class _h extends xh{constructor(t,n,i){if(super(t,n),!Os.isMultiMaterialsObject(t))throw new Error(`The "${t.name} ("${t.type}") is not multiple materials/faces object."`);if(yh.getBodyType(t)===e.CustomProperties.Physics.Types.NonPhysics)return void console.log(`%cThe "${t.name}" is defined as a non-physics object.`,"color: yellow");const r=Os.getBoundingBox(t),s=r.min.x,o=r.min.y,a=r.min.z,l=r.max.x,h=r.max.y,c=r.max.z,d=(t,e)=>t-e<.01?.01:t-e,p=d(l,s),m=d(h,o),g=d(c,a),v=new u.DvJ(p,m,g);v.computeBoundingBox(),v.computeBoundingSphere();const y=new u.Kj0(v);let x;const b=t.name.toLowerCase();vh.isSphere(b)?x=yh.createSphereShape(y):(vh.isCube(b)||console.log(`%cA box-shape is assigned to "${b}".`,"color:pink"),x=yh.createCubeShape(y)),v.dispose(),this.shapes.push(x);const w=gh.getCenter(y,!0);this.body=yh.createBody(),this.body.addShape(x,w.vadd(new f(s,o,a))),yh.copyPnQ(this.body,t),i.scene.add(t),this.updateBodyType(t),this.addSelfToPhysicsSystem()}addSelfToPhysicsSystem(){this.addToPhysicsSystem(this)}}class Mh{listeners={};constructor(){}addEventListener(t,e){this.listeners[t]||(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e)}removeEventListener(t,e){if(!this.listeners[t])return;const n=this.listeners[t].indexOf(e);-1!==n&&this.listeners[t].splice(n,1)}dispatchEvent(t){this.listeners[t.type]&&this.listeners[t.type].slice().map((e=>e.call(this,t)))}hasAnyEventListener(t){return void 0!==this.listeners[t]}hasEventListener(t,e){return void 0!==this.listeners[t]&&-1!==this.listeners[t].indexOf(e)}}const Sh=new class extends Mh{target;constructor(t){super(),this.target=t||window}initTouchStart(){this.target.addEventListener("touchstart",(t=>this.dispatchEvent(t))),console.log("initTouchStart")}initTouchMove(){this.target.addEventListener("touchmove",(t=>this.dispatchEvent(t)))}initTouchEnd(){this.target.addEventListener("touchend",(t=>this.dispatchEvent(t)))}initTouchCancel(){this.target.addEventListener("touchcancel",(t=>this.dispatchEvent(t)))}_initTouchEvent(t,e){if(!1===this.hasAnyEventListener(t))switch(t){case"touchstart":this.initTouchStart();break;case"touchmove":this.initTouchMove();break;case"touchend":this.initTouchEnd();break;case"touchcancel":this.initTouchCancel();break;default:throw new Error(`Unknown event type "${t}"`)}this.addEventListener(t,e)}onTouchStart(t){this._initTouchEvent("touchstart",t)}onTouchMove(t){this._initTouchEvent("touchmove",t)}onTouchEnd(t){this._initTouchEvent("touchend",t)}onTouchCancel(t){this._initTouchEvent("touchcancel",t)}};Sh.onTouchStart((t=>console.log(t.type))),Sh.onTouchMove((t=>console.log(t.type))),Sh.onTouchEnd((t=>console.log(t.type))),Sh.onTouchCancel((t=>console.log(t.type)));class Th extends Mh{target;keyStates={};keyListeners={};lastKey=void 0;lastCode=void 0;isCtrlKey=!1;isAltKey=!1;isShiftKey=!1;preventingKeys=["Alt","Control","ContextMenu","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10"];constructor(t){super(),this.target=t||document,this._initEvents()}_initEvents=()=>{this.target.addEventListener("keydown",(t=>{this._onKeyDown(t),this.dispatchEvent(t)})),this.target.addEventListener("keypress",(t=>{this._onKeyPress(t),this.dispatchEvent(t)})),this.target.addEventListener("keyup",(t=>{this._onKeyUp(t),this.dispatchEvent(t)}))};_prevent=t=>(-1===this.preventingKeys.indexOf(t.key)&&-1===this.preventingKeys.indexOf(t.code)||t.preventDefault(),this);_onKeyDown=t=>{const e=t;this._prevent(e),this.keyStates[e.key]=!0,this.lastKey=e.key,this.lastCode=e.code,this.isCtrlKey=e.ctrlKey,this.isAltKey=e.altKey,this.isShiftKey=e.shiftKey,this.keyListeners[e.key]?this.keyListeners[e.key].map((t=>t(e))):this.keyListeners[e.code]&&this.keyListeners[e.code].map((t=>t(e)))};_onKeyPress=t=>{};_onKeyUp=t=>{const e=t;this._prevent(e),this.keyStates[e.key]=!1,this.lastKey=void 0,this.lastCode=void 0,this.isCtrlKey=e.ctrlKey,this.isAltKey=e.altKey,this.isShiftKey=e.shiftKey};getKey(){return this.lastKey}getCode(){return this.lastCode}isKey(t){return void 0!==this.keyStates[t]&&this.keyStates[t]}onKey(t,e){return this.keyListeners[t]||(this.keyListeners[t]=[]),-1===this.keyListeners[t].indexOf(e)&&this.keyListeners[t].push(e),this}addPreventingKey(t){return-1===this.preventingKeys.indexOf(t)&&this.preventingKeys.push(t),this}removePreventingKey(t){const e=this.preventingKeys.indexOf(t);return-1!==e&&this.preventingKeys.splice(e,1),this}isCtrl(){return this.isCtrlKey}isAlt(){return this.isAltKey}isShift(){return this.isShiftKey}onKeyDown(t){this.addEventListener("keydown",t)}onKeyPress(t){this.addEventListener("keypress",t)}onKeyUp(t){this.addEventListener("keyup",t)}}class Eh extends Mh{target;constructor(t){super(),this.target=t||window}initPointerDown(){this.target.addEventListener("pointerdown",(t=>this.dispatchEvent(t)))}initPointerUp(){this.target.addEventListener("pointerup",(t=>this.dispatchEvent(t)))}initPointerMove(){this.target.addEventListener("pointermove",(t=>this.dispatchEvent(t)))}initPointerEnter(){this.target.addEventListener("pointerenter",(t=>this.dispatchEvent(t)))}initPointerOver(){this.target.addEventListener("pointerover",(t=>this.dispatchEvent(t)))}initPointerLeave(){this.target.addEventListener("pointerleave",(t=>this.dispatchEvent(t)))}initPointerOut(){this.target.addEventListener("pointerout",(t=>this.dispatchEvent(t)))}initPointerCancel(){this.target.addEventListener("pointercancel",(t=>this.dispatchEvent(t)))}_initPointerEvent(t,e){if(!1===this.hasAnyEventListener(t))switch(t){case"pointerdown":this.initPointerDown();break;case"pointerup":this.initPointerUp();break;case"pointermove":this.initPointerMove();break;case"pointerenter":this.initPointerEnter();break;case"pointerover":this.initPointerOver();break;case"pointerleave":this.initPointerLeave();break;case"pointerout":this.initPointerOut();break;case"pointercancel":this.initPointerCancel();break;default:throw new Error(`Unknown pointer event type "${t}"`)}this.addEventListener(t,e)}onPointerDown(t){this._initPointerEvent("pointerdown",t)}onPointerUp(t){this._initPointerEvent("pointerup",t)}onPointerMove(t){this._initPointerEvent("pointermove",t)}onPointerEnter(t){this._initPointerEvent("pointerenter",t)}onPointerLeave(t){this._initPointerEvent("pointerleave",t)}onPointerOver(t){this._initPointerEvent("pointerover",t)}onPointerOut(t){this._initPointerEvent("pointerout",t)}onPointerCancel(t){this._initPointerEvent("pointercancel",t)}}class Ah{keyboard;pointer;constructor(){this.keyboard=new Th,this.pointer=new Eh,this.keyboard.onKey("x",(t=>console.log(t)))}}class Ch{raycaster=new u.iMs;pointer=new u.FM8;graphics;intersects=[];constructor(t){this.graphics=t,(new Ah).pointer.onPointerMove((t=>{this.pointer.x=+t.clientX/window.innerWidth*2-1,this.pointer.y=-t.clientY/window.innerHeight*2+1}))}getIntersects(t,e){return t=t||this.graphics.scene,e=e||this.graphics.camera,this.raycaster.setFromCamera(this.pointer,e),this.intersects=this.raycaster.intersectObjects(t.children),this.intersects}getObjects(t=!0,e=!0){let n=this.getRaycastObjects();return!0===t&&(n=n.filter((t=>!Os.isDebugMesh(t)))),!0===e&&(n=n.filter((t=>!Os.isParticle(t)))),n}getRaycastObjects=()=>{const t=this.getIntersects(),e=[];let n;for(let i=0;i<t.length;i++){const r=t[i].object;r.parent instanceof u.ZAu?n=Os.isMultiMaterialsObject(r.parent)?r.parent:r:(r.parent instanceof u.Kj0||r.parent instanceof u.xsS)&&(n=r),n&&-1===e.indexOf(n)&&e.push(n)}return e}}class Ph{engineLoop=Rs.getInstance();options={usePhysics:!0};graphicsInstances=[];graphics;physicsInstances=[];physics;onFrame(t){Rs.onFrame(t)}cancelOnFrame(t){Rs.cancelOnFrameListener(t)}static resizeListeners=[];onResize(t){0===Ph.resizeListeners.length&&window.addEventListener("resize",(()=>{Ph.resizeListeners.map((t=>t(window.innerWidth,window.innerHeight)))})),-1===Ph.resizeListeners.indexOf(t)&&Ph.resizeListeners.push(t)}cancelOnResize(t){const e=Ph.resizeListeners.indexOf(t);-1!==e&&Ph.resizeListeners.splice(e,1)}getOptions(){return this.options}constructor(t){this.options=t||this.options}start(t){return 0===this.graphicsInstances.length&&console.log("%c@Engine.start: The EngineLoop starts without Graphics instance!","color: #f88"),console.log("%c@Engine.start: The EngineLoop started","color: #8f8"),this.engineLoop.start((e=>{t&&t(this,e)})),this}stop(){return this.engineLoop.stop(),this}async init(t,n){return t=t||e.Default.envMap,n=n||e.Default.models,console.log(n),new Promise(((e,i)=>{this.initGraphics(t,n).then((t=>{this.initPhysics(t).then((t=>{this.options.usePhysics&&this.physics.start(),e(this)})).catch((t=>{console.error(t),i(t)}))})).catch((t=>{console.error(t),i(t)}))}))}async initGraphics(t,e,n,i){return new Promise(((n,i)=>{this.graphics=new hh,this.graphicsInstances.push(this.graphics),this.graphics.init(t,e).then((()=>n(this.graphics))).catch((t=>i(t)))}))}async initPhysics(t){return new Promise(((e,n)=>{this.physics=new fh(t),this.physicsInstances.push(this.physics),this.physics.init().then((()=>{this.autoBuildPhysicsObjects(),e(this.physics)}))}))}async buildPhysicsObjects(t){const e=new Ml(this.graphics.scene);t.map((t=>{e.setTarget(t.scene),e.findSingleMaterialObjects().map((t=>{rh.success(`PMeshObject "${t.name}" is created`),new bh(t,this.physics)})),e.findMultiMaterialsObjects().map((t=>{rh.success(`PGroupObject "${t.name}" is created`),new _h(t,this.physics,this.graphics)})),e.findCustomShapeObjects().map((t=>{rh.success(`PMultiShapesObject "${t.name}" is created`),new wh(t,this.physics,this.graphics)}))}))}async autoBuildPhysicsObjects(){return new Promise(((t,e)=>{const n=this.graphics.getManager(),i=(t,e,n)=>{console.log(`%c [+] ${t.name} - %c${e}`,"color: #585",`color:${n}`)};console.group("%c AutoBuildPhysicsObjects","color: #5f5");const r=n.findSingleMaterialObjects().filter((t=>!gh.isPropNonPhysicsType(t)));r.map((t=>{i(t,"single-material","#88f")}));const s=n.findMultiMaterialsObjects().filter((t=>!gh.isPropNonPhysicsType(t)));s.map((t=>{i(t,"multi-material","#f88")}));const o=n.findCustomShapeObjects().filter((t=>!gh.isPropNonPhysicsType(t)));o.map((t=>{i(t," custom-shape","#8ff")})),console.groupEnd(),r.map((t=>{new bh(t,this.physics)})),s.map((t=>{new _h(t,this.physics,this.graphics)})),o.map((t=>{new wh(t,this.physics,this.graphics)})),t(this.physics)}))}async startPhysics(){this.physics.start()}async stopPhysics(){this.physics.stop()}getStats(){return this.engineLoop.getStats()}getEngineLoop(){return this.engineLoop}static clearConsole(){return console.clear(),Ph}static Vec3=(t,e,n)=>new f(t,e,n);static Quat=(t,e,n,i)=>new M(t,e,n,i);static Vector2=(t,e)=>new u.FM8(t,e);static Vector3=(t,e,n)=>new u.Pa4(t,e,n);static Vector4=(t,e,n,i)=>new u.Ltg(t,e,n,i);static Quaternion=(t,e,n,i)=>new u._fP(t,e,n,i)}n(521).u;class Rh{static Color={canvasColor:"#111",bgColor:"#222",textGreen:"rgba(41, 145, 126, 1)",textWhite:"rgba(255, 255, 255, 0.9)"}}class Lh{cvs;ctx;width=512;height=512;XS=10;XY=10;_gDx=this.width/this.XS;_gDy=this.height/this.XY;clearColor=Rh.Color.canvasColor;gridEnabled=!1;constructor(t,e=512,n=512){this.cvs=t||this.createCanvasAndContext(e,n),this.enableGrids(!1),console.log(`Canvas grid ${this.gridEnabled?"enabled":"disabled"}.`),this.clear()}getOrg=()=>({x:this.width/2,y:this.height/2});getOx=()=>this.width/2;getOy=()=>this.height/2;gDx=t=>t?(this._gDx=t,this._gDx):this._gDx;gDy=t=>t?(this._gDy=t,this._gDy):this._gDy;gMoveTo=(t,e,n=0,i=0)=>{const r=this.context();return r.moveTo(this.gDx()*t+n,this.gDy()*e+i),r};gLineTo=(t,e,n=0,i=0)=>{const r=this.context();return r.lineTo(this.gDx()*t+n,this.gDy()*e+i),r};gCx=()=>this.width/2;gCy=()=>this.height/2;enableGrids=(t=!0)=>(this.gridEnabled=t,this);drawGrids=(t=10,e=10)=>{const n=this.context(),i=this.gDx(),r=this.gDy();n.strokeStyle="rgba(255, 255, 255, 0.1)",n.lineWidth=1.5,n.setLineDash([4,4]),n.beginPath();for(let e=0;e<t;e++)n.moveTo(0,e*r),n.lineTo(this.width,e*r);n.stroke(),n.beginPath();for(let e=0;e<t;e++)n.moveTo(e*i,0),n.lineTo(e*i,this.height);return n.stroke(),n.setLineDash([0,0]),n.lineWidth=3.5,n.strokeStyle="rgba(255, 0, 0, 0.4)",n.save(),n.translate(this.width/2,this.height/2),n.beginPath(),n.moveTo(-i/4,0),n.lineTo(i/4,0),n.moveTo(0,-r/4),n.lineTo(0,r/4),n.stroke(),n.restore(),n};createCanvasAndContext=(t,e)=>(this.cvs=document.createElement("canvas"),this.resize(t,e),this.ctx=this.cvs.getContext("2d"),this.ctx.lineJoin="round",this.ctx.lineCap="round",this.cvs);resize=(t,e)=>(this.cvs?(this.width=t,this.height=e,this.cvs.width=this.width,this.cvs.height=this.height):this.createCanvasAndContext(this.width,this.height),this);canvas=()=>this.cvs;context=()=>this.ctx;setClearColor=t=>(this.clearColor=t,this);clear(t){const e=this.context();return e.fillStyle=t||this.clearColor,e.fillRect(0,0,this.width,this.height),this.gridEnabled&&this.drawGrids(),this}}class Ih extends Lh{_tS=performance.now();_tE=performance.now();_dt=this._tE-this._tS;_tt=0;_fps=10;_tps=1e3/this._fps;_fc=0;_renderCallback;constructor(){super(),this._renderLoop()}_renderLoop=()=>{requestAnimationFrame(this._renderLoop),this._tE=performance.now(),this._dt=this._tE-this._tS,this._tS=performance.now(),this._tt+=this._dt,this._fc+=1,this._tt>=this._tps&&(this._tt=this._tt-this._tps,this._renderCallback&&this._renderCallback(this._dt,this._tt,this._fc))};setFps=t=>{this._fps=t,this._tps=1e3/this._fps};run=(t,e)=>{this._renderCallback=e,this.setFps(t)}}class Dh extends Ih{update(){}render(t,e,n){}constructor(){super()}_ticks=0;_rval=0;drawIconsRandomValue=()=>{this._ticks++%2==0&&(this._rval=Math.random()),this.drawWaringIcon(this._rval>.5),this.drawSignalIcon(100*this._rval),this.drawBattIcon(100*this._rval)};drawWaringIcon=(t=!0,e=null)=>{if(!t)return;const n=this.context();n.save();const i=e?e.x:void 0,r=e?e.y:void 0;let s=i?i*this.gDx():1*this.gDx(),o=r?r*this.gDy():.65*this.gDy();n.translate(s,o);const a=this.gDx()/2*.6,l=1.2*a;n.beginPath(),n.strokeStyle="#f00",n.lineWidth=a/5,n.lineCap="round",n.moveTo(0,-a),n.lineTo(-l,a),n.lineTo(l,a),n.closePath(),n.stroke(),n.fillStyle="#f00",n.fill(),n.strokeStyle="#fff",n.lineWidth=a/3.5,n.lineCap="square",n.beginPath(),n.moveTo(0,-a/4),n.lineTo(0,a/3),n.stroke(),n.beginPath(),n.moveTo(0,a/1.4),n.lineTo(0,a/1.4),n.stroke(),n.restore()};drawSignalIcon=(t=100,e=null)=>{const n=this.context();n.save();const i=e?e.x:void 0,r=e?e.y:void 0;let s=i?i*this.gDx():2.2*this.gDx(),o=r?r*this.gDy():.9*this.gDy();n.translate(s,o);const a=12*1.1;n.lineWidth=12*.8,n.lineCap="square";const l=t=>{n.strokeStyle=t,n.beginPath(),n.moveTo(0,0),n.lineTo(0,-2.4),n.stroke()},h=t=>{n.strokeStyle=t,n.beginPath(),n.moveTo(a,0),n.lineTo(a,-9.6),n.stroke()},c=t=>{n.strokeStyle=t,n.beginPath(),n.moveTo(2*a,0),n.lineTo(2*a,-19.2),n.stroke()},u="#333";l(u),h(u),c(u);const d=["#F42F0A","#F49D0A","#1FFFC6"],p=Math.round(t/50);l(d[p]),p>0&&h(d[p]),p>1&&c(d[p]),n.restore()};drawBattIcon=(t=20,e=null)=>{const n=this.context();n.save();const i=e?e.x:void 0,r=e?e.y:void 0;let s=i?i*this.gDx():3.5*this.gDx(),o=r?r*this.gDy():.55*this.gDy();n.translate(s,o);n.lineWidth=4;const a=30+70*t/100;n.strokeStyle=`hsl(${a}, 95%, 50%)`,n.fillStyle=`hsl(${a}, 95%, 50%)`,n.beginPath(),n.moveTo(0,0),n.lineTo(0,20),n.lineTo(30,20),n.lineTo(30,0),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(38,5),n.lineTo(38,15),n.stroke(),n.beginPath(),n.fillRect(20/3.7,5,t/100*19.18918918918919,.47*20),n.stroke(),n.restore()};drawTime=(t=null)=>{const e=t=>t<10?`0${t}`:`${t}`,n=new Date,i=(n.getSeconds(),n.getMinutes()),r=`${e(n.getHours())}:${e(i)}`,s=this.context();s.beginPath(),s.fillStyle="#eee",s.strokeStyle="#eee",s.font=.6*this.gDy()+"px Arial",s.textBaseline="bottom",s.textAlign="right";const o=t?t.x*this.gDx():9.5*this.gDx(),a=t?t.y*this.gDy():1.15*this.gDy();s.fillText(r,o,a)}}class Oh extends Dh{FPS=10;constructor(){super()}start=()=>(this.run(this.FPS,this.render),this);render(t,e,n){this.update(),this.clear(Rh.Color.canvasColor),this.drawTimeBigCenter(),this.drawDate(),this.drawHRBars(70+110*Math.random()),this.drawMeasuredParams(),this.drawWalkingGoals(0),this.drawIconsRandomValue(),this.drawTime()}update(){}drawTimeBigCenter=t=>{const e=this.context();e.save();let n=this.gCx()-0*this.gDx(),i=this.gCy()-2.4*this.gDy();e.translate(n,i);const r=t=>t<10?`0${t}`:`${t}`;if(!t){const e=new Date,n=e.getSeconds(),i=e.getMinutes();t=`${r(e.getHours())}:${r(i)}:${r(n)}`}const s=t;e.fillStyle="#eee",e.font="90px Arial",e.textBaseline="middle",e.textAlign="center",e.fillText(s,0,0),e.restore()};drawDate=t=>{const e=this.context();e.save();let n=this.gCx()-0*this.gDx(),i=this.gCy()-1*this.gDy();if(e.translate(n,i),!t){const e=new Date,n=e.getDay(),i=e.getDate();t=`${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n].toUpperCase()} ${(t=>t<10?`0${t}`:`${t}`)(i)}`}const r=t;e.fillStyle="#eee",e.font="30px Arial",e.textBaseline="middle",e.textAlign="center",e.fillText(r,0,0),e.restore()};hbData=[];MAX_HR=180;drawHRBars=(t=90)=>{if(this.hbData.length<16)for(let t=0;t<16;t++)this.hbData.push(this.MAX_HR+Math.random()*this.MAX_HR/2);this.hbData.push(t),this.hbData.length>16&&this.hbData.shift();const e=this.context();e.save();let n=this.gCx()-0*this.gDx(),i=this.gCy()+1.2*this.gDy();e.translate(n,i);const r=3*this.width/5/32,s=1*this.gDy(),o=r,a=e.createLinearGradient(0,0,0,-s);a.addColorStop(0,"#25C6AA"),a.addColorStop(.5,"#9AB66C"),a.addColorStop(1,"#E3834E"),e.fillStyle=a,e.strokeStyle=a,e.lineWidth=r;let l=-n;e.beginPath();for(let t=0;t<16;t++){const n=l+3*r+(r+o)*t;e.moveTo(n,0),e.lineTo(n,0-s*this.hbData[t]/this.MAX_HR),e.stroke()}const h=100-t/this.MAX_HR*100;e.fillStyle=`hsl(${h}, 96%, 50%)`,e.strokeStyle=`hsl(${h}, 96%, 50%)`,e.font="65px Arial",e.textBaseline="bottom",e.textAlign="center",e.fillText(`${t.toFixed(0)}`,150,-20),e.fillStyle="#eee",e.font="30px Arial",e.textBaseline="bottom",e.textAlign="center",e.fillText("BPM",150,9),e.restore()};progSteps=0;goalSteps=1235;drawWalkingGoals=(t=0)=>{const e=this.context();e.save();let n=this.gCx()-5*this.gDx(),i=this.gCy()+2*this.gDy();e.translate(n,i),t<=0?this.progSteps+=50:this.progSteps=t;const r=30,s=(this.width-60)/3,o=(t,n)=>{e.beginPath(),e.strokeStyle=n,e.lineWidth=12,e.moveTo(s*t+r,0),e.lineTo(s*(t+1)+r,0),e.stroke()},a=(t,n)=>{e.beginPath(),e.strokeStyle=n,e.lineWidth=12,e.moveTo(s*(t+1)+r,0),e.arc(s*(t+1)+r,0,7.5,0,2*Math.PI),e.stroke()};o(0,this.bkgColor),o(1,this.bkgColor),o(2,this.bkgColor),a(0,this.bkgColor),a(1,this.bkgColor),a(2,this.bkgColor);const l=this.progSteps/this.goalSteps*100,h=["#F9FF55","#93FF12","#01FF00"];Math.floor(l/33.33),e.lineWidth=12,e.strokeStyle=h[0],e.beginPath();let c=30,u=c+s*l/33;u=u>=s+r?s+r:u,e.moveTo(c,0),e.lineTo(u,0),e.stroke(),l>=33&&(e.strokeStyle=h[1],e.beginPath(),c=r+s,u=(c+s)*l/66,u>r+2*s&&(u=r+2*s),e.moveTo(c,0),e.lineTo(u,0),e.stroke()),l>=66&&(e.strokeStyle=h[2],e.beginPath(),c=r+2*s,u=(c+s)*l/100,u>r+3*s&&(u=r+3*s),e.moveTo(c,0),e.lineTo(u,0),e.stroke()),e.beginPath(),l>=33&&a(0,h[0]),l>=66&&a(1,h[1]),l>=95&&a(2,h[2]),e.restore(),this.progSteps>this.goalSteps&&(this.progSteps=0)};bkgColor="#2A263C";drawRoundRect=(t,e,n,i,r)=>{const s=this.context();n<2*r&&(r=n/2),i<2*r&&(r=i/2),s.strokeStyle="#00000000",s.lineWidth=0,s.beginPath(),s.moveTo(t+r,e),s.arcTo(t+n,e,t+n,e+i,r),s.arcTo(t+n,e+i,t,e+i,r),s.arcTo(t,e+i,t,e,r),s.arcTo(t,e,t+n,e,r),s.closePath(),s.stroke(),s.fillStyle=this.bkgColor,s.fill()};drawMeasuredParams=(t=[])=>{const e=this.context();e.save();let n=this.gCx()-0*this.gDx(),i=this.gCy()-.2*this.gDy();e.translate(n,i);const r=-this.width/2.2,s=this.height/2-110;this.drawRoundRect(r,s,this.width/1.1,100,20);const o=t[0]?t[0]:65*Math.random();e.beginPath(),e.fillStyle="#eee",e.strokeStyle="#eee",e.font="40px Arial",e.textBaseline="middle",e.textAlign="left",e.fillText(`${o.toFixed(1)}`,.87*r,1.25*s),e.font="16px Arial",e.fillText("o",.77*r,1.45*s),e.font="24px Arial",e.fillText("C",.73*r,1.53*s);const a=t[1]?t[1]:90*Math.random();e.font="40px Arial",e.fillText(`${a.toFixed(1)}%`,.25*r,1.25*s),e.font="24px Arial",e.fillText("SPO",.16*r,1.53*s),e.font="16px Arial",e.fillText("2",.06*-r,1.6*s);const l=t[2]?t[2]:1e3*Math.random();e.font="40px Arial",e.fillText(`${l.toFixed(0)}`,.57*-r,1.25*s),e.font="24px Arial",e.fillText("kcal",.62*-r,1.53*s),e.restore()}}class Bh extends Dh{FPS=20;X_SCALE=.8;c0={x:0,y:0};c1={x:0,y:0};c2={x:0,y:0};p0={x:0,y:0};p1={x:0,y:0};p2={x:0,y:0};p3={x:0,y:0};p4={x:0,y:0};r=100;l=Math.PI*this.r;ls=this.l;lc=this.l;td=4*this.l;ns=Math.floor(100);locRot=[];index=0;offsetX=0;offsetY=0;goalSteps=1245;progSteps=0;_stepCount=0;_stepInc=5;trackWidth=14;bkgColor="#1A162C";progressColor="#1FC2C6";constructor(t=0,e=0){super(),this.offsetX=t,this.offsetY=e-this.l/5,this.initParams(this.offsetX,this.offsetY),this.computeLocRotData()}start=()=>(this.run(this.FPS,this.render),this);render(t,e,n){this.update(),this.drawIconsRandomValue(),this.drawTime()}update(){this.progSteps=(this.progSteps+this._stepInc)%this.goalSteps;const t=100*this.progSteps/this.goalSteps;t<=100&&(this.drawBackground(),this.drawProgress(t),this.drawTarget(t))}initParams=(t,e)=>{this.c0.x=t+this.width/2,this.c0.y=e+this.height/2,this.c1.x=this.c0.x-this.l/2,this.c1.y=this.c0.y,this.c2.x=this.c0.x+this.l/2,this.c2.y=this.c0.y,this.p0.x=this.c0.x,this.p0.y=this.c0.y-this.r,this.p1.x=this.c1.x,this.p1.y=this.c1.y-this.r,this.p2.x=this.c2.x,this.p2.y=this.c2.y-this.r,this.p3.x=this.c2.x,this.p3.y=this.c2.y+this.r,this.p4.x=this.c1.x,this.p4.y=this.c1.y+this.r,this.ls=this.l*this.X_SCALE;const n=(this.l-this.ls)/2;this.c2.x-=n,this.p2.x-=n,this.p3.x-=n,this.c1.x+=n,this.p1.x+=n,this.p4.x+=n,this.td=2*this.ls+2*this.lc};drawRoundRect=(t,e,n,i,r)=>{const s=this.context();n<2*r&&(r=n/2),i<2*r&&(r=i/2),s.beginPath(),s.moveTo(t+r,e),s.arcTo(t+n,e,t+n,e+i,r),s.arcTo(t+n,e+i,t,e+i,r),s.arcTo(t,e+i,t,e,r),s.arcTo(t,e,t+n,e,r),s.closePath(),s.fillStyle=this.bkgColor,s.fill()};drawRaceTrack=()=>{const t=this.context();t.strokeStyle=this.bkgColor,t.lineWidth=this.trackWidth,t.beginPath(),t.moveTo(this.p1.x,this.p1.y),t.arc(this.c2.x,this.c2.y,this.r,-Math.PI/2,Math.PI/2),t.arc(this.c1.x,this.c1.y,this.r,Math.PI/2,-Math.PI/2),t.stroke()};drawBackground=(t="#000")=>{this.clear(Rh.Color.canvasColor),this.drawRaceTrack(),this.drawRoundRect(this.c1.x-this.r,4*this.height/5.7,this.ls+2*this.r,this.height/4,this.r/3)};computeLocRotData=()=>{let t=!1,e=0,n=this.p0.x,i=this.p0.y,r=-Math.PI/2;do{0===e?(n+=this.ls/2/(this.ns/2),n>=this.p2.x&&(n-=this.p2.x-n,e+=1,r=-Math.PI/2)):1===e?(r+=Math.PI/this.ns,r>=Math.PI/2&&(r=Math.PI/2,e+=1),n=this.c2.x+this.r*Math.cos(r),i=this.c2.y+this.r*Math.sin(r)):2===e?(n-=this.ls/this.ns,n<=this.p4.x&&(n=this.p4.x,e+=1,r=Math.PI/2)):3===e?(r+=Math.PI/this.ns,r>=1.5*Math.PI&&(r=1.5*Math.PI,e+=1),n=this.c1.x+this.r*Math.cos(r),i=this.c1.y+this.r*Math.sin(r)):4===e&&(n+=this.ls/2/(this.ns/2),n>=this.p0.x&&(n=this.p0.x,e=0,t=!0));const s={x:n,y:i,a:r,s:e};this.locRot.push(s)}while(!t)};randomColor=(t=1)=>`rgba(${Math.floor(255*Math.random())},${Math.floor(255*Math.random())},${Math.floor(255*Math.random())},${t})`;drawProgress=t=>{const e=this.context(),n=this.ns/4,i=n/2;e.strokeStyle=this.progressColor,e.lineWidth=14,e.beginPath(),t>=0&&(e.moveTo(this.p0.x,this.p0.y),t<=i?e.lineTo(this.p0.x+this.ls/2*(t/i),this.p2.y):e.lineTo(this.p2.x,this.p2.y)),t>=i&&(e.moveTo(this.p2.x,this.p2.y),t<=3*i?e.arc(this.c2.x,this.c2.y,this.r,-Math.PI/2,-Math.PI/2+Math.PI*(t-i)/n):e.arc(this.c2.x,this.c2.y,this.r,-Math.PI/2,Math.PI/2)),t>=3*i&&(e.moveTo(this.p3.x,this.p3.y),t<=5*i?e.lineTo(this.p3.x-this.ls*(t-3*i)/n,this.p4.y):e.lineTo(this.p4.x,this.p4.y)),t>5*i&&(e.moveTo(this.p4.x,this.p4.y),t<=7*i?e.arc(this.c1.x,this.c1.y,this.r,Math.PI/2,Math.PI/2+Math.PI*(t-5*i)/n):e.arc(this.c1.x,this.c1.y,this.r,Math.PI/2,3*Math.PI/2)),t>=7*i&&(e.moveTo(this.p1.x,this.p1.y),t<=8*i?e.lineTo(this.p1.x+this.ls*(t-7*i)/n,this.p0.y):e.lineTo(this.p0.x,this.p0.y)),e.stroke()};drawTarget=t=>{const e=this.context();t?(t=(t=t<=0?0:t)>=100?100:t,this.index=Math.floor(t/100*this.locRot.length)%this.locRot.length):this.index=(this.index+1)%this.locRot.length;const n=this.locRot[this.index];e.save(),e.translate(n.x,n.y),e.rotate(n.a+Math.PI/2),e.beginPath(),e.arc(0,0,2*this.trackWidth,0,2*Math.PI);const i=.2+(1+Math.sin(50*Math.PI*(this.index/this.locRot.length)))/4;e.fillStyle=`rgba( 30, 190, 200, ${i})`,e.fill(),e.beginPath(),e.arc(0,0,this.trackWidth,0,2*Math.PI),e.fillStyle=this.progressColor,e.fill(),e.restore(),e.fillStyle=this.progressColor,e.font=`${this.r}px Arial`,e.textBaseline="middle",e.textAlign="right",e.direction="rtl";let r=`${this.progSteps}`;this.progSteps>=1e3&&(r=r.substring(0,r.length-3)+","+r.substring(r.length-3,r.length));let s=e.measureText(r),o=s.fontBoundingBoxAscent+s.fontBoundingBoxDescent;s.actualBoundingBoxAscent,s.actualBoundingBoxDescent,e.fillText(r,this.p2.x+this.r/2,this.c0.y+o/14),r="STEPS",e.fillStyle="#eee",e.font=this.r/4.5+"px Arial",e.textBaseline="top",e.fillText(r,this.p2.x+this.r/2,this.c0.y+o/2.5),r=`${(.75*this.progSteps/1e3).toFixed(1)}`,e.font=this.r/2+"px Arial",e.textBaseline="middle",e.textAlign="left";let a=this.gCx()-3.5*this.gDx(),l=this.gCy()+3.3*this.gDy();e.fillText(r,a,l),r="km",e.font=this.r/4+"px Arial",e.textBaseline="top",e.textAlign="left",s=e.measureText(r),e.fillText(r,1.6*a+s.width,.985*l),r=`${(this.progSteps/9.25).toFixed(0)}`,e.font=.85*this.r+"px Arial",e.textBaseline="middle",e.textAlign="right",e.direction="rtl",a=this.gCx()+2*this.gDx(),l=this.gCy()+3.2*this.gDy(),s=e.measureText(r),e.fillText(r,1.05*a,l),r="kcal",e.font=this.r/3+"px Arial",e.textBaseline="top",e.textAlign="left",s=e.measureText(r),e.fillText(r,1.07*a,.997*l)}}class Nh extends Dh{FPS=20;constructor(){super()}start=()=>(this.run(this.FPS,this.render),this);render(t,e,n){this.update(),this.clear(Rh.Color.canvasColor),this.drawHeartIcon(this._bpm,140,-160,1),this.drawHeartRate(120*this._bpm),this.drawGauges(this._spo),this.drawTemperature(this._temp),this.drawThermometerIcon(),this.drawSpoGraph(this._spo),this.drawTime(),this.drawIconsRandomValue()}_alpha=0;_bpm=0;_spo=0;_temp=0;update(){this._bpm=.5+.25*(Math.sin(20*this._alpha)+1),this._spo=80+10*(Math.sin(15*this._alpha)+1),this._temp=65*this._bpm,this._alpha+=Math.PI/100,this._alpha=this._alpha>2*Math.PI?2*Math.PI-this._alpha:this._alpha}drawHeartIcon=(t=1,e=0,n=0,i=1)=>{const r=this.context();r.save(),r.translate(e+this.gCx(),n+this.gCy()),r.fillStyle="#f00",r.strokeStyle="#f00",r.lineWidth=2;const s=10*i*t;let o=s*Math.cos(Math.PI/4),a=s*Math.sin(Math.PI/4),l=-Math.PI/2-Math.PI/4,h=Math.PI/4;r.beginPath(),r.arc(o,0,s,l,h);let c=3*Math.PI/4,u=-Math.PI/2+Math.PI/4;r.arc(-o,0,s,c,u),r.stroke(),r.fill(),o+=s*Math.cos(h),a=s*Math.sin(h),r.beginPath(),r.moveTo(o,a),r.lineTo(0,2*s),r.lineTo(-o,a),r.closePath(),r.stroke(),r.fill(),r.beginPath(),r.fillStyle=Rh.Color.canvasColor,r.strokeStyle=Rh.Color.canvasColor,r.lineWidth=.2*s,r.moveTo(-o-.2*s,a),r.lineTo(.7*s-o,a),r.lineTo(.9*s-o,a-.3*s),r.lineTo(1.3*s-o,a+.35*s),r.lineTo(1.7*s-o,a-.76*s),r.lineTo(2.1*s-o,a),r.lineTo(3*s-o,a),r.stroke(),r.restore()};drawHeartRate=(t=97)=>{const e=this.context();e.beginPath(),e.fillStyle="#eee",e.font="44px Arial",e.textBaseline="middle",e.textAlign="center",e.fillText(`${t.toFixed(0)}`,9*this.gDx(),2*this.gDy()),e.font="24px Arial",e.fillText("BPM",9*this.gDx(),3*this.gDy()-this.gDy()/3)};drawThermometerIcon=()=>{const t=this.context();t.save(),t.scale(1,1),t.translate(this.gCx(),this.gCy()),t.translate(4*-this.gDx()*1,3*-this.gDx()*1+5),t.fillStyle="#FFCB3F",t.strokeStyle="#FFCB3F",t.lineWidth=2.8;const e=this.gDx()/7;t.beginPath();const n=-Math.PI/2+Math.PI/7,i=-Math.PI/2-Math.PI/7;t.arc(0,0,e,n,i);let r=e*Math.cos(n),s=e*Math.sin(n);const o=2*e;t.moveTo(r,s),t.lineTo(r,s-o),r=e*Math.cos(i),t.moveTo(r,s-o),s=e*Math.sin(i),t.lineTo(r,s),t.stroke(),t.beginPath();const a=e/2.25;s=-(e+o),t.moveTo(-a,s),t.arc(0,s,a,Math.PI,0),t.stroke(),t.fillRect(-a,-(o+e+a),2*a,o-a),t.restore()};drawTemperature=(t=34)=>{const e=this.context();e.save(),e.beginPath(),e.fillStyle="#eee",e.font="44px Arial",e.textBaseline="middle",e.textAlign="left";let n=1*this.gDx()+20,i=2*this.gDy();e.fillText(`${t.toFixed(1)}`,n,i),e.font="24px Arial",e.fillText("C",n,i+this.gDy()/1.5),e.font="16px Arial",e.fillText("o",n-this.gDx()/5,i+this.gDy()/2),e.restore()};drawGauges=(t=97,e=0,n=0,i=1)=>{const r=this.context();r.save(),r.translate(e+this.width/2,n+this.height/2);r.fillStyle="#f00",r.strokeStyle=Rh.Color.bgColor,r.lineWidth=22,r.beginPath();let s=Math.PI/2+Math.PI/8,o=-Math.PI/4;r.arc(0,0,140,s,o),r.strokeStyle="#FFCB3F",r.stroke(),r.beginPath(),s=Math.PI/2,o=Math.PI/2+Math.PI/8,r.arc(0,0,140,s,o),r.strokeStyle="#E9446A",r.stroke(),r.beginPath(),s=-Math.PI/4,o=Math.PI/2,r.arc(0,0,140,s,o),r.strokeStyle="#20C6AD",r.stroke(),r.beginPath(),r.fillStyle="#20C6AD",r.strokeStyle="#20C6AD",r.font=130*i+"px Arial",r.textBaseline="middle",r.textAlign="center",r.fillText(`${t.toFixed(0)}`,0,14),r.fillStyle="#eee",r.font=35*i+"px Arial",r.fillText("SPO",0,-84),r.fillStyle="#eee",r.font=18*i+"px Arial",r.fillText("2",42,-70),r.fillStyle="#eee",r.font=40*i+"px Arial",r.fillText("%",0,84),(t=(t=t<=1?1:t)>=100?99:t)<=89?(r.rotate(Math.PI+Math.PI/32),r.rotate(Math.PI/10*(t/89))):t>=89&&t<=94?(r.rotate(Math.PI+Math.PI/7),r.rotate(Math.PI/8+.96*Math.PI*(t-89)/5)):t>=94&&t<=100?(r.rotate(Math.PI/4),r.rotate(Math.PI/1.3*(t-94)/5.5)):console.warn(`spo2: ${t}`),r.translate(0,-112),r.beginPath(),r.moveTo(0,0),r.lineTo(8,4),r.lineTo(0,-12),r.lineTo(-8,4),r.closePath(),r.strokeStyle="#eee",r.fillStyle="#eee",r.lineWidth=4,r.stroke(),r.fill(),r.restore()};spoData=[];drawSpoGraph_bk=t=>{const e=this.context();let n=this.gDy(),i=this.gDx();for(;this.spoData.length<20;)this.spoData.push(0);this.spoData.length>20&&(this.spoData=this.spoData.slice(1)),this.spoData.push(t);const r=[];r.push(0),r.push(this.height);for(let t=0;t<this.spoData.length-1;t++){let e=(t-1)*(this.width/this.spoData.length+i)-i,s=this.height-this.spoData[t]/100*2*n;r.push(e),r.push(s)}r.push(this.width),r.push(this.height),((t,i,r,s,o)=>{if(e.beginPath(),void(t=>{e.moveTo(t[0],t[1]);for(let n=2;n<t.length-1;n+=2)e.lineTo(t[n],t[n+1])})(((t,e,n,i)=>{e=void 0!==e?e:.5,n=n||!1,i=i||16;var r,s,o,a,l,h,c,u,d,p,f,m,g,v=[],y=[];for(v=t.slice(0),n?(v.unshift(t[t.length-1]),v.unshift(t[t.length-2]),v.unshift(t[t.length-1]),v.unshift(t[t.length-2]),v.push(t[0]),v.push(t[1])):(v.unshift(t[1]),v.unshift(t[0]),v.push(t[t.length-2]),v.push(t[t.length-1])),g=2;g<v.length-4;g+=2)for(m=0;m<=i;m++)o=(v[g+2]-v[g-2])*e,a=(v[g+4]-v[g])*e,l=(v[g+3]-v[g-1])*e,h=(v[g+5]-v[g+1])*e,f=m/i,c=2*Math.pow(f,3)-3*Math.pow(f,2)+1,u=-2*Math.pow(f,3)+3*Math.pow(f,2),d=Math.pow(f,3)-2*Math.pow(f,2)+f,p=Math.pow(f,3)-Math.pow(f,2),r=c*v[g]+u*v[g+2]+d*o+p*a,s=c*v[g+1]+u*v[g+3]+d*l+p*h,y.push(r),y.push(s);return y})(t,.5,!0,10))){e.beginPath();for(var a=0;a<t.length-1;a+=2)e.rect(t[a]-2,t[a+1]-2,4,4)}const l=e.createLinearGradient(0,this.height,0,this.height-2*n);l.addColorStop(0,"#E9446A80"),l.addColorStop(.5,"#FFCB3F80"),l.addColorStop(1,"#20C6AD80"),e.strokeStyle=l,e.fillStyle=l,e.stroke(),e.fill()})(r)};drawSpoGraph=t=>{const e=this.width/19,n=9.8*this.gDy(),i=1.5*this.gDy();if(this.spoData.length<20)for(let t=0;t<20;t++){const t=98+4*Math.random();this.spoData.push(t)}else this.spoData=this.spoData.slice(1),this.spoData.push(t);const r=[];r.push({x:-e,y:n});for(let t=0;t<this.spoData.length;t++){const s=e*t,o=n-this.spoData[t]*i/100;r.push({x:s,y:o})}r.push({x:20*e,y:n}),((t,e)=>{const r=this.context();r.beginPath(),r.moveTo(t[0].x,t[0].y);for(let e=0;e<t.length-1;e++){const n=e>0?t[e-1]:t[0],i=t[e],s=t[e+1],o=e!=t.length-2?t[e+2]:s,a=i.x+(s.x-n.x)/6*1,l=i.y+(s.y-n.y)/6*1,h=s.x-(o.x-i.x)/6*1,c=s.y-(o.y-i.y)/6*1;r.bezierCurveTo(a,l,h,c,s.x,s.y)}const s=r.createLinearGradient(0,n,0,n-i);s.addColorStop(0,"#E9446A80"),s.addColorStop(.5,"#FFCB3F80"),s.addColorStop(1,"#20C6AD80"),r.strokeStyle=s,r.fillStyle=s,r.stroke(),r.fill()})(r)}}class zh{static MAX_R=160;static MIN_R=20;static NUM_C=3;static INC_R=2;radius=zh.MIN_R;alpha=0;id=0;ticks=0;startAfter=0;constructor(t){this.id=t,this.startAfter=this.id*(zh.MAX_R-zh.MIN_R)/zh.NUM_C}update=()=>{this.ticks+=1,this.ticks>=this.startAfter&&(this.radius+=zh.INC_R,this.alpha=1-this.radius/zh.MAX_R,this.radius>=zh.MAX_R&&(this.radius=zh.MIN_R))}}class kh extends Dh{FPS=20;circles=[];constructor(){super();for(let t=0;t<zh.NUM_C;t++){const e=new zh(t);this.circles.push(e)}}start=()=>(this.run(this.FPS,this.render),this);render(t,e,n){this.update(),this.clear(Rh.Color.canvasColor),this.drawIconsRandomValue(),this.drawTime(),this.drawCircles()}_alpha=0;drawCircles=()=>{const t=this.context();t.save();let e=this.gCx(),n=this.gCy()-.5*this.gDy();t.translate(e,n);for(let e=0;e<zh.NUM_C;e++){const n=this.circles[e];n.update(),t.beginPath(),t.arc(0,0,n.radius,0,2*Math.PI),t.fillStyle=`rgba( 30, 190, 200, ${n.alpha})`,t.fill()}t.restore(),t.save(),e=this.gCx(),n=this.gCy()-.5*this.gDy(),t.translate(e,n);let i=.5*(1+Math.sin(this._alpha));i+=1,this._alpha+=Math.PI/20,t.scale(i,i),t.beginPath(),t.fillStyle="rgba( 255, 255, 255, 0.7)",t.rect(-50,-15,100,30),t.rect(-15,-50,30,100),t.fill(),t.restore(),t.save();const r=this.gCx(),s=this.gCy()+3.5*this.gDy();t.translate(r,s),i=.8+i/8,t.scale(i,i),t.fillStyle="#eee",t.font=.8*this.gDx()+"px Kanit",t.textBaseline="middle",t.textAlign="center",t.fillText("",0,0),t.restore()}}class Fh extends Dh{FPS=20;constructor(){super()}start=()=>(this.run(this.FPS,this.render),this);_alpha=0;render(t,e,n){this.update(),this.clear(Rh.Color.canvasColor),this.drawIconsRandomValue(),this.drawTime();let i=50*(Math.sin(this._alpha)+1);this._alpha+=Math.PI/50,this.drawPersonIcon(i),this.drawParamsText(60*i/100,50+i/4)}update(){}drawPersonIcon=(t=10)=>{const e=this.context();e.save();let n=this.gCx()-2.5*this.gDx(),i=this.gCy()-2*this.gDy();e.translate(n,i),e.scale(.95,1),e.fillStyle="rgba(247, 205, 89, 1)",e.strokeStyle="rgba(247, 205, 89, 1)",e.beginPath(),e.filter="blur(1px)",e.arc(0,5,30,0,2*Math.PI),e.fill();let r=[25,25,35,35];e.beginPath(),e.filter="blur(1px)",e.fillRect(-40,40,80,140);let s=[{x:10,y:11},{x:40,y:50},{x:10,y:100},{x:60,y:130},{x:-20,y:120}];n=26,i=42;for(let t=1;t<s.length;t++)e.beginPath(),e.filter="blur(1px)",e.lineWidth=r[t-1],e.moveTo(n+s[t-1].x,i+s[t-1].y),e.lineTo(n+s[t+0].x,i+s[t+0].y),e.stroke();n=-n;for(let t=1;t<s.length;t++)e.beginPath(),e.filter="blur(1px)",e.lineWidth=r[t-1],e.moveTo(n-s[t-1].x,i+s[t-1].y),e.lineTo(n-s[t+0].x,i+s[t+0].y),e.stroke(),t>=2&&(e.lineWidth=35);e.restore(),e.save(),n=.5*this.gDx(),i=2.48*this.gDy();let o=3.43*this.gDx(),a=4.4*this.gDy();e.globalCompositeOperation="darken",e.beginPath(),e.filter="blur(1px)",e.fillStyle="#333";let l=o*(t=(t=t<0?0:t)>100?100:t)/100;e.fillRect(n,i,1.15*l,0+a),e.fill(),e.restore()};drawParamsText=(t=60,e=65)=>{const n=this.context();n.save();let i=9*this.gDx(),r=3.7*this.gDy();n.translate(i,r),n.beginPath(),n.fillStyle=Rh.Color.textGreen,n.font=3.5*this.gDx()+"px Arial",n.textBaseline="middle",n.textAlign="right",n.fillText(`${t.toFixed(0)}`,0,0),n.beginPath(),n.fillStyle=Rh.Color.textWhite,n.font=.6*this.gDx()+"px Arial",n.fillText("Minutes",-8,1.5*this.gDx()),n.beginPath(),n.fillStyle=Rh.Color.textWhite,n.font=1.5*this.gDx()+"px Arial",n.textBaseline="middle",n.textAlign="right",n.fillText(`${e.toFixed(0)}`,0,3.5*this.gDx()),n.beginPath(),n.fillStyle=Rh.Color.textWhite,n.font=.6*this.gDx()+"px Arial",n.textBaseline="middle",n.textAlign="right",n.fillText("Avg HR",0,4.5*this.gDx()),n.restore()}}class Uh extends Dh{FPS=20;constructor(){super()}start=()=>(this.run(this.FPS,this.render),this);_alpha=0;render(t,e,n){this.update(),this.clear(Rh.Color.canvasColor),this.drawIconsRandomValue(),this.drawTime();let i=50*(Math.sin(this._alpha)+1),r=50*(Math.sin(3*this._alpha)+1);this._alpha+=Math.PI/50,this.drawPersonIcon(i,r),this.drawParamsText(60*i/100,600+i)}update(){}drawPersonIcon=(t=10,e=0)=>{const n=this.context();n.save();let i=2*this.gDx(),r=3*this.gDy();n.translate(i,r),n.scale(1,1),n.fillStyle="rgba(247, 205, 89, 1)",n.strokeStyle="rgba(247, 205, 89, 1)",n.beginPath(),n.filter="blur(1px)",n.arc(0,5,25,0,2*Math.PI),n.fill();let s=[30,30];n.beginPath(),n.filter="blur(1px)",n.fillRect(-30,40,60,110);let o=[{x:-50,y:12},{x:-50,y:200}];i=26,r=42;for(let t=1;t<o.length;t++)n.beginPath(),n.filter="blur(1px)",n.lineWidth=s[t-1],n.moveTo(i+o[t-1].x,r+o[t-1].y),n.lineTo(i+o[t+0].x,r+o[t+0].y),n.stroke();i=-i;for(let t=1;t<o.length;t++)n.beginPath(),n.filter="blur(1px)",n.lineWidth=s[t-1],n.moveTo(i-o[t-1].x,r+o[t-1].y),n.lineTo(i-o[t+0].x,r+o[t+0].y),n.stroke();n.restore(),n.save(),i=2.55*this.gDx(),r=4.1*this.gDy(),n.translate(i,r);const a=Math.PI/2,l=Math.PI/6;let h=(a-l)*e/100;n.rotate(-(l+h)),n.strokeStyle="rgba(247, 205, 89, 1)",n.beginPath(),n.filter="blur(1px)",n.lineWidth=s[0],n.moveTo(0,0),n.lineTo(0,100),n.stroke(),n.restore()};drawParamsText=(t=60,e=65)=>{const n=this.context();n.save();let i=9*this.gDx(),r=3.7*this.gDy();n.translate(i,r),n.beginPath(),n.fillStyle=Rh.Color.textGreen,n.font=3.5*this.gDx()+"px Arial",n.textBaseline="middle",n.textAlign="right",n.fillText(`${t.toFixed(0)}`,0,0),n.beginPath(),n.fillStyle=Rh.Color.textWhite,n.font=.6*this.gDx()+"px Arial",n.fillText("Minutes",-8,1.5*this.gDx()),n.beginPath(),n.fillStyle=Rh.Color.textWhite,n.font=1.5*this.gDx()+"px Arial",n.textBaseline="middle",n.textAlign="right",n.fillText(`${e.toFixed(0)}`,0,3.5*this.gDx()),n.beginPath(),n.fillStyle=Rh.Color.textWhite,n.font=.6*this.gDx()+"px Arial",n.textBaseline="middle",n.textAlign="right",n.fillText("kcal",-8,4.5*this.gDx()),n.restore()}}class Hh extends Dh{FPS=20;constructor(){super()}start=()=>(this.run(this.FPS,this.render),this);_alpha=0;render(t,e,n){this.update(),this.clear(Rh.Color.canvasColor),this.drawIconsRandomValue(),this.drawTime();let i=50*(Math.sin(this._alpha)+1);this._alpha+=Math.PI/50,this.drawGauge(i)}update(){}drawGauge=(t=50)=>{const e=this.context();e.save();let n=!1,i="rgba(255,200,20,",r="white";t>99&&(n=!0,i="rgba(41,145,126,",r=Rh.Color.textGreen);let s=this.gCx(),o=this.gCy();e.translate(s,o),e.rotate(-Math.PI/2),e.beginPath(),e.strokeStyle="rgba(255,255,255,0.1)",e.lineWidth=20;const a=this.width/3;e.arc(0,0,a,0,2*Math.PI),e.stroke(),e.beginPath(),e.strokeStyle=`${i}0.7)`,e.lineWidth=20,e.filter="blur(1px)",e.arc(0,0,a,0,2*Math.PI*t/100),e.stroke(),e.beginPath(),e.strokeStyle=`${i}0.5)`,e.lineWidth=30,e.filter="blur(10px)",e.arc(0,0,a,0,2*Math.PI*t/100),e.stroke(),e.restore(),n||(e.save(),s=this.gCx(),o=this.gCx()-2*this.gDy(),e.translate(s,o),e.beginPath(),e.filter="blur(1px)",e.strokeStyle="rgba(255,120,20,1)",e.fillStyle=e.strokeStyle,e.lineWidth=2,e.moveTo(0,-10),e.lineTo(-25,30),e.lineTo(-10,30),e.lineTo(-20,65),e.lineTo(10,25),e.lineTo(0,25),e.lineTo(0,-10),e.stroke(),e.fill(),e.restore()),e.save(),s=this.gCx(),o=this.gCy()-2.5*this.gDy()-(n?this.gDy():0),e.translate(s,o),e.beginPath(),e.fillStyle=r,e.fillStyle=r,e.font=2*this.gDx()+"px Arial",e.textBaseline="middle",e.textAlign="center";let l=r==Rh.Color.textGreen?"Full":`${t.toFixed(0)}%`;e.fillText(l,0,3.5*this.gDx()),e.restore()}}(async(t,e)=>{(new Ph).init().then((t=>{(function(t){console.log("Initializing engine");const e=t.graphics,n=t.physics,i=(n.manager,e.manager);let r,s,o,a;n.toggleDebug(),n.stop(),e.camera.setPosition(50,5,100);const l=[];e.loadModel("models/watch/watch.glb").then((t=>{if(r=i.getObject("Watch"),s=i.getObject("screen_inner"),a=i.getObject("button_L"),o=i.getObject("button_R"),console.log(r,s),console.log(a,o),void 0===r||void 0===s||void 0===a||void 0===o)throw new Error("Target object cannot be found in the model!");const e={btn:a,pos:(new u.Pa4).copy(a.position),name:"button_L"},n={btn:o,pos:(new u.Pa4).copy(o.position),name:"button_R"};l.push(e),l.push(n),r.rotateX(Math.PI/2),h()}));const h=()=>{const n=[];n.push((new Oh).start().canvas()),n.push((new Bh).start().canvas()),n.push((new Nh).start().canvas()),n.push((new kh).start().canvas()),n.push((new Fh).start().canvas()),n.push((new Uh).start().canvas()),n.push((new Hh).start().canvas());let i=0,r=new sh(!0);r.appendToBody(),r.clearHtml(),r.setBackgroundColor(0),r.appendChild(n[i]),r.moveToLeft(),r.hide();const o=[],a=[];n.forEach((t=>{const e=(t=>{const e=new u.ROQ(t);return e.needsUpdate=!0,e.wrapS=e.wrapT=u.uWy,e.flipY=!1,e.center=new u.FM8(0,0),e})(t),n=(t=>{const e=new u.Wid({map:t,color:"#ccffcc",roughness:.7,metalness:.9});return e.needsUpdate=!0,e})(e);o.push(e),a.push(n)}));const h=t=>{r.removeChild(n[i]),i+=t,i=i<0?a.length-1:i,i=i>=a.length?0:i,r.appendChild(n[i]),s.material=a[i]};h(0),(()=>{let t,n=new Ch(e);console.log(n);let i=!1;const r=(e,n)=>{e&&!1===i&&(e.position.x+=n,i=!0,t=setTimeout((()=>{l.map((t=>{t.btn.position.copy(t.pos)})),i=!1,clearTimeout(t)}),200))};Cs.onMouseUp((e=>{l.map((t=>{t.btn.position.copy(t.pos)})),!0===i&&(clearTimeout(t),i=!1)})),Cs.onMouseClick((t=>{(()=>{if(n){const t=n.getObjects(),e=t.find((t=>"button_R"===t.name));if(e)r(e,-1),h(1);else{const e=t.find((t=>"button_L"===t.name));e&&(r(e,1),h(-1))}}else console.error("ray is null!!")})()}))})(),r.addEventListener("click",(t=>{h(1)})),t.onFrame((()=>{void 0!==s&&(o[i].needsUpdate=!0)}));let c=new sh(!0);c.appendToBody(),c.clearHtml(),c.setBackgroundColor(128),c.setHtml('\n            <h3 style="color: #0088ff">Info:</h3>\n            <ul >\n                <li style="fontSize: 0.01rem; color: yellow;">Tab the Blue or Green button to change the display.</li>\n            </ul>\n        '),c.moveToCenterHorizontal(),setTimeout((()=>{c.hide(),c.dispose()}),5e3)}})(t),t.start(e)})).catch((t=>console.error(t)))})(0,(function(t,e){}))})(),i})()));